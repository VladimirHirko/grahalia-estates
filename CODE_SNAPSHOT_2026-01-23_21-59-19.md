# Code snapshot (2026-01-23T21:59:19)
–í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤: 119

## .gitignore

```text
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.*
.yarn/*
!.yarn/patches
!.yarn/plugins
!.yarn/releases
!.yarn/versions

# testing
/coverage

# next.js
/.next/
/out/

# production
/build

# misc
.DS_Store
*.pem

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.pnpm-debug.log*

# env files (can opt-in for committing if needed)
.env*

# vercel
.vercel

# typescript
*.tsbuildinfo
next-env.d.ts

```

---

## README.md

```md
This is a [Next.js](https://nextjs.org) project bootstrapped with [`create-next-app`](https://nextjs.org/docs/app/api-reference/cli/create-next-app).

## Getting Started

First, run the development server:

```bash
npm run dev
# or
yarn dev
# or
pnpm dev
# or
bun dev
```

Open [http://localhost:3000](http://localhost:3000) with your browser to see the result.

You can start editing the page by modifying `app/page.tsx`. The page auto-updates as you edit the file.

This project uses [`next/font`](https://nextjs.org/docs/app/building-your-application/optimizing/fonts) to automatically optimize and load [Geist](https://vercel.com/font), a new font family for Vercel.

## Learn More

To learn more about Next.js, take a look at the following resources:

- [Next.js Documentation](https://nextjs.org/docs) - learn about Next.js features and API.
- [Learn Next.js](https://nextjs.org/learn) - an interactive Next.js tutorial.

You can check out [the Next.js GitHub repository](https://github.com/vercel/next.js) - your feedback and contributions are welcome!

## Deploy on Vercel

The easiest way to deploy your Next.js app is to use the [Vercel Platform](https://vercel.com/new?utm_medium=default-template&filter=next.js&utm_source=create-next-app&utm_campaign=create-next-app-readme) from the creators of Next.js.

Check out our [Next.js deployment documentation](https://nextjs.org/docs/app/building-your-application/deploying) for more details.

```

---

## app/.gitignore

```text
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.*
.yarn/*
!.yarn/patches
!.yarn/plugins
!.yarn/releases
!.yarn/versions

# testing
/coverage

# next.js
/.next/
/out/

# production
/build

# misc
.DS_Store
*.pem

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.pnpm-debug.log*

# env files (can opt-in for committing if needed)
.env*

# vercel
.vercel

# typescript
*.tsbuildinfo
next-env.d.ts

```

---

## app/README.md

```md
This is a [Next.js](https://nextjs.org) project bootstrapped with [`create-next-app`](https://nextjs.org/docs/app/api-reference/cli/create-next-app).

## Getting Started

First, run the development server:

```bash
npm run dev
# or
yarn dev
# or
pnpm dev
# or
bun dev
```

Open [http://localhost:3000](http://localhost:3000) with your browser to see the result.

You can start editing the page by modifying `app/page.tsx`. The page auto-updates as you edit the file.

This project uses [`next/font`](https://nextjs.org/docs/app/building-your-application/optimizing/fonts) to automatically optimize and load [Geist](https://vercel.com/font), a new font family for Vercel.

## Learn More

To learn more about Next.js, take a look at the following resources:

- [Next.js Documentation](https://nextjs.org/docs) - learn about Next.js features and API.
- [Learn Next.js](https://nextjs.org/learn) - an interactive Next.js tutorial.

You can check out [the Next.js GitHub repository](https://github.com/vercel/next.js) - your feedback and contributions are welcome!

## Deploy on Vercel

The easiest way to deploy your Next.js app is to use the [Vercel Platform](https://vercel.com/new?utm_medium=default-template&filter=next.js&utm_source=create-next-app&utm_campaign=create-next-app-readme) from the creators of Next.js.

Check out our [Next.js deployment documentation](https://nextjs.org/docs/app/building-your-application/deploying) for more details.

```

---

## app/[lang]/cookies/page.tsx

```typescript
import Header from "@/components/Header/Header";
import Footer from "@/components/Footer/Footer";
import { getDictionary, isLocale, type Locale } from "@/i18n/dictionaries";

export const dynamic = "force-dynamic";

export default async function CookiesPage({
  params,
}: {
  params: Promise<{ lang: string }>;
}) {
  const { lang: raw } = await params;
  const lang: Locale = isLocale(raw) ? (raw as Locale) : "en";
  const t = await getDictionary(lang);

  const uiLang: "en" | "es" = lang === "es" ? "es" : "en";

  return (
    <>
      <Header lang={uiLang} t={t.header} />

      <main>
        <section className="section">
          <div className="container">
            <h1 className="h2">{lang === "es" ? "Cookies" : "Cookies"}</h1>

            <p className="p" style={{ marginTop: 12 }}>
              {lang === "es"
                ? "Esta p√°gina es una plantilla temporal. Aqu√≠ publicaremos nuestra pol√≠tica de cookies, incluyendo qu√© cookies usamos, para qu√© sirven y c√≥mo puedes gestionar tus preferencias."
                : "This is a temporary placeholder page. Here we‚Äôll publish our cookie policy, including what cookies we use, what they‚Äôre for, and how you can manage your preferences."}
            </p>

            <div style={{ marginTop: 18 }}>
              <h2 className="h2" style={{ fontSize: 18 }}>
                {lang === "es" ? "Resumen" : "Summary"}
              </h2>

              <p className="p" style={{ marginTop: 10 }}>
                {lang === "es"
                  ? "‚Ä¢ Cookies necesarias: para que el sitio funcione correctamente.\n‚Ä¢ Anal√≠tica: para entender el uso del sitio (opcional).\n‚Ä¢ Marketing: para campa√±as y medici√≥n (opcional)."
                  : "‚Ä¢ Necessary cookies: required for the website to work.\n‚Ä¢ Analytics: helps us understand site usage (optional).\n‚Ä¢ Marketing: helps measure campaigns (optional)."}
              </p>
            </div>

            <div style={{ marginTop: 22 }}>
              <a className="btn btnPrimary" href={`/${uiLang}#contact`}>
                {lang === "es" ? "Contacto" : "Contact"}
              </a>
            </div>
          </div>
        </section>
      </main>

      
    </>
  );
}

```

---

## app/[lang]/layout.tsx

```typescript
import "../globals.css";
import AppShell from "@/components/AppShell/AppShell";

import { Inter, Playfair_Display } from "next/font/google";
import { locales, isLocale, type Locale, getDictionary } from "@/i18n/dictionaries";
import type { Metadata } from "next";

const inter = Inter({
  subsets: ["latin"],
  variable: "--font-inter",
  display: "swap",
});

const playfair = Playfair_Display({
  subsets: ["latin"],
  variable: "--font-playfair",
  display: "swap",
});

export function generateStaticParams() {
  return locales.map((lang) => ({ lang }));
}

type LayoutProps = {
  children: React.ReactNode;
  params: Promise<{ lang: string }>;
};

export async function generateMetadata({
  params,
}: {
  params: Promise<{ lang: string }>;
}): Promise<Metadata> {
  const { lang: raw } = await params;
  const lang: Locale = isLocale(raw) ? (raw as Locale) : "en";
  const t = await getDictionary(lang);

  // ‚úÖ –±–∞–∑–æ–≤—ã–π URL (–≤ –ø—Ä–æ–¥–µ –≤–æ–∑—å–º—ë–º –∏–∑ env, –ª–æ–∫–∞–ª—å–Ω–æ fallback)
  const base =
    process.env.NEXT_PUBLIC_SITE_URL
      ? new URL(process.env.NEXT_PUBLIC_SITE_URL)
      : new URL("http://localhost:3000");

  return {
    metadataBase: base,

    title: t.seo.home.title,
    description: t.seo.home.description,

    icons: {
      icon: [
        { url: "/favicon.ico" },
        { url: "/favicon.svg", type: "image/svg+xml" },
        { url: "/favicon-96x96.png", sizes: "96x96", type: "image/png" },
      ],
      apple: [{ url: "/apple-touch-icon.png", sizes: "180x180" }],
    },

    manifest: `${base.origin}/site.webmanifest`,

    alternates: {
      canonical: `/${lang}`,
      languages: {
        en: "/en",
        es: "/es",
      },
    },

    openGraph: {
      title: t.seo.home.ogTitle ?? t.seo.home.title,
      description: t.seo.home.ogDescription ?? t.seo.home.description,
      locale: lang === "es" ? "es_ES" : "en_US",
      type: "website",
    },

    robots: {
      index: true,
      follow: true,
    },
  };
}

export default async function RootLayout({ children, params }: LayoutProps) {
  const { lang: raw } = await params;
  const lang: Locale = isLocale(raw) ? (raw as Locale) : "en";
  const t = await getDictionary(lang);

  const uiLang: "en" | "es" = lang === "es" ? "es" : "en";

  // ‚úÖ —Ñ—É—Ç–µ—Ä –Ω–∞ –≤–µ—Ä—Ö–Ω–µ–º —É—Ä–æ–≤–Ω–µ —Å–ª–æ–≤–∞—Ä—è
  const footerT = (t as any)?.footer;

  // ‚úÖ cookies —Å—Ç—Ä–æ–≥–æ –æ—Ç—Å—é–¥–∞: cookies.consent
  const cookieT = (t as any)?.cookies?.consent;

  return (
    <html lang={lang} className={`${inter.variable} ${playfair.variable}`}>
      <body>
        <AppShell
          lang={uiLang}
          footerT={(t as any)?.footer}
          cookieT={(t as any)?.cookies?.consent}   // ‚úÖ –í–û–¢ –≠–¢–û –ö–õ–Æ–ß–ï–í–û
        >
          {children}
        </AppShell>

      </body>
    </html>
  );
}

```

---

## app/[lang]/page.tsx

```typescript
import Header from "@/components/Header/Header";
import Hero from "@/components/Hero/Hero";
import Featured from "@/components/Featured/Featured";
import Services from "@/components/Services/Services";
import About from "@/components/About/About";
import Contact from "@/components/Contact/Contact";
import Footer from "@/components/Footer/Footer";

import { getDictionary, isLocale, type Locale } from "@/i18n/dictionaries";
import { getFeaturedItems } from "@/app/lib/publicFeatured";

export default async function Page({
  params,
}: {
  params: Promise<{ lang: string }>;
}) {
  const { lang: raw } = await params;
  const lang: Locale = isLocale(raw) ? (raw as Locale) : "en";
  const t = await getDictionary(lang);

  // ‚úÖ –†–µ–∞–ª—å–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã –∏–∑ –ë–î (—Ç–æ–ª—å–∫–æ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã–µ)
  const featuredItems = await getFeaturedItems(lang === "es" ? "es" : "en", 12);

  return (
    <>
      <Header lang={lang} t={t.header} />
      <main>
        <Hero t={t.hero} />
        <Featured lang={lang === "es" ? "es" : "en"} t={t.featured} items={featuredItems} />
        <Services t={t.services} />
        <About t={t.about} />
        <Contact t={t.contact} lang={lang === "es" ? "es" : "en"} />
      </main>
    </>
  );
}

```

---

## app/[lang]/privacy/page.tsx

```typescript
import Header from "@/components/Header/Header";
import Footer from "@/components/Footer/Footer";
import { getDictionary, isLocale, type Locale } from "@/i18n/dictionaries";

export const dynamic = "force-dynamic";

export default async function PrivacyPage({
  params,
}: {
  params: Promise<{ lang: string }>;
}) {
  const { lang: raw } = await params;
  const lang: Locale = isLocale(raw) ? (raw as Locale) : "en";
  const t = await getDictionary(lang);

  const uiLang: "en" | "es" = lang === "es" ? "es" : "en";

  return (
    <>
      <Header lang={uiLang} t={t.header} />

      <main>
        <section className="section">
          <div className="container">
            <h1 className="h2">
              {lang === "es" ? "Pol√≠tica de privacidad" : "Privacy Policy"}
            </h1>

            <p className="p" style={{ marginTop: 12 }}>
              {lang === "es"
                ? "Esta p√°gina es una plantilla temporal. Aqu√≠ explicaremos qu√© datos recopilamos (por ejemplo, cuando env√≠as un formulario), con qu√© finalidad, y c√≥mo puedes solicitar acceso/eliminaci√≥n."
                : "This is a temporary placeholder page. Here we‚Äôll explain what data we collect (for example, when you submit a form), why we collect it, and how you can request access/deletion."}
            </p>

            <div style={{ marginTop: 18 }}>
              <h2 className="h2" style={{ fontSize: 18 }}>
                {lang === "es" ? "Qu√© datos" : "What data"}
              </h2>

              <p className="p" style={{ marginTop: 10 }}>
                {lang === "es"
                  ? "Nombre, tel√©fono, email y mensaje que env√≠as voluntariamente en el formulario de contacto."
                  : "Name, phone, email, and the message you voluntarily submit via the contact form."}
              </p>
            </div>

            <div style={{ marginTop: 18 }}>
              <h2 className="h2" style={{ fontSize: 18 }}>
                {lang === "es" ? "Finalidad" : "Purpose"}
              </h2>

              <p className="p" style={{ marginTop: 10 }}>
                {lang === "es"
                  ? "Responder a tu solicitud y ayudarte con informaci√≥n sobre propiedades y servicios."
                  : "To respond to your request and help you with information about properties and services."}
              </p>
            </div>

            <div style={{ marginTop: 22 }}>
              <a className="btn btnPrimary" href={`/${uiLang}#contact`}>
                {lang === "es" ? "Escribirnos" : "Contact us"}
              </a>
            </div>
          </div>
        </section>
      </main>

      
    </>
  );
}

```

---

## app/[lang]/properties/Filters.tsx

```typescript
"use client";

import { useMemo, useState } from "react";
import { usePathname, useRouter, useSearchParams } from "next/navigation";
import styles from "./properties.module.css";

type FeatureOption = { key: string; label: string };

function parseFeaturesParam(value: string) {
  return new Set(
    (value || "")
      .split(",")
      .map((x) => x.trim().toLowerCase())
      .filter(Boolean)
  );
}

export default function Filters({
  lang,
  features,
}: {
  lang: "en" | "es";
  features: FeatureOption[];
}) {
  const router = useRouter();
  const pathname = usePathname();
  const sp = useSearchParams();

  // ‚úÖ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–≤–µ—Ä–Ω—É—Ç–æ
  const [open, setOpen] = useState(false);

  const [search, setSearch] = useState("");
  const [showAll, setShowAll] = useState(false);

  const filteredFeatures = useMemo(() => {
    const q = search.trim().toLowerCase();
    if (!q) return features;
    return features.filter((f) => {
      const key = String(f.key || "").toLowerCase();
      const label = String(f.label || "").toLowerCase();
      return key.includes(q) || label.includes(q);
    });
  }, [features, search]);

  const visibleFeatures = useMemo(() => {
    if (showAll) return filteredFeatures;
    return filteredFeatures.slice(0, 8);
  }, [filteredFeatures, showAll]);

  const selectedType = (sp.get("type") || "").trim();

  const selectedFeatures = useMemo(() => {
    return parseFeaturesParam(sp.get("features") || "");
  }, [sp]);

  const hasActiveFilters =
    Boolean(selectedType) || selectedFeatures.size > 0;

  function push(next: URLSearchParams) {
    next.set("page", "1");

    // —á–∏—Å—Ç–∏–º –ø—É—Å—Ç—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
    for (const [k, v] of next.entries()) {
      if (!String(v).trim()) next.delete(k);
    }

    const qs = next.toString();
    router.push(qs ? `${pathname}?${qs}` : pathname);
  }

  function setType(value: string) {
    const v = (value || "").trim().toLowerCase();
    const next = new URLSearchParams(sp.toString());

    if (!v) next.delete("type");
    else next.set("type", v);

    push(next);
  }

  function toggleFeature(key: string) {
    const k = String(key || "").trim().toLowerCase();
    if (!k) return;

    const next = new URLSearchParams(sp.toString());
    const cur = parseFeaturesParam(next.get("features") || "");

    if (cur.has(k)) cur.delete(k);
    else cur.add(k);

    const arr = Array.from(cur).sort();
    if (arr.length === 0) next.delete("features");
    else next.set("features", arr.join(","));

    push(next);
  }

  function clearAll() {
    const next = new URLSearchParams(sp.toString());
    next.delete("deal");      // ‚úÖ NEW
    next.delete("type");
    next.delete("features");
    next.set("page", "1");

    const qs = next.toString();
    router.push(qs ? `${pathname}?${qs}` : pathname);
  }

  return (
    <div className={styles.filters}>
      <div className={styles.filtersTop}>
        <button
          type="button"
          className={`btn btnGhost ${styles.filtersToggleBtn}`}
          onClick={() => setOpen((v) => !v)}
          aria-expanded={open}
        >
          <span className={styles.filtersToggleText}>
            {lang === "es" ? "Filtros" : "Filters"}
          </span>

          {hasActiveFilters && (
            <span className={styles.filtersCount}>
              {selectedFeatures.size + (selectedType ? 1 : 0)}
            </span>
          )}

          <span className={styles.filtersChevron} aria-hidden>
            {open ? "‚ñ≤" : "‚ñº"}
          </span>
        </button>

        <button
          className={`btn btnGhost ${styles.clearBtn}`}
          type="button"
          onClick={clearAll}
          disabled={!hasActiveFilters}
          title={
            hasActiveFilters ? "" : (lang === "es" ? "Nada que limpiar" : "Nothing to clear")
          }
        >
          {lang === "es" ? "Limpiar" : "Clear"}
        </button>
      </div>

      {open && (
        <div className={styles.filtersPanel}>
          <div className={styles.filtersGrid}>
            <label className={styles.field}>
              <span className={styles.label}>{lang === "es" ? "Tipo" : "Type"}</span>
              <select
                className={styles.select}
                value={selectedType}
                onChange={(e) => setType(e.target.value)}
              >
                <option value="">{lang === "es" ? "Todos" : "All"}</option>
                <option value="apartment">{lang === "es" ? "Apartamento" : "Apartment"}</option>
                <option value="villa">Villa</option>
                <option value="townhouse">{lang === "es" ? "Adosado" : "Townhouse"}</option>
                <option value="land">{lang === "es" ? "Terreno" : "Land"}</option>
              </select>
            </label>

            <div className={styles.field}>
              <div className={styles.amenitiesHead}>
                <span className={styles.label}>{lang === "es" ? "Comodidades" : "Amenities"}</span>

                {/* –º–∏–Ω–∏-–ø–æ–∏—Å–∫ –ø–æ amenities */}
                <input
                  className={styles.search}
                  placeholder={lang === "es" ? "Buscar‚Ä¶" : "Search‚Ä¶"}
                  value={search}
                  onChange={(e) => setSearch(e.target.value)}
                />
              </div>

              <div className={styles.featuresCompact}>
                {visibleFeatures.map((f) => {
                  const key = String(f.key || "").trim().toLowerCase();
                  const checked = selectedFeatures.has(key);

                  return (
                    <button
                      key={f.key}
                      type="button"
                      className={`btn ${checked ? "btnPrimary" : "btnGhost"} ${styles.pill}`}
                      onClick={() => toggleFeature(key)}
                      aria-pressed={checked}
                    >
                      {f.label}
                    </button>
                  );
                })}
              </div>

              {filteredFeatures.length > 8 && (
                <button
                  type="button"
                  className={`btn btnGhost ${styles.moreBtn}`}
                  onClick={() => setShowAll((v) => !v)}
                >
                  {showAll
                    ? (lang === "es" ? "Mostrar menos" : "Show less")
                    : (lang === "es" ? `Mostrar todo (${filteredFeatures.length})` : `Show all (${filteredFeatures.length})`)}
                </button>
              )}
            </div>
          </div>
        </div>
      )}
    </div>
  );
}

```

---

## app/[lang]/properties/[slug]/page.tsx

```typescript
// app/[lang]/properties/[slug]/page.tsx
import Header from "@/components/Header/Header";
import PropertyGallery from "@/components/PropertyGallery/PropertyGallery";
import LeadContactForm from "@/components/LeadContactForm/LeadContactForm";
import { getDictionary, isLocale, type Locale } from "@/i18n/dictionaries";
import { getPropertyBySlug } from "@/app/lib/publicProperties";
import styles from "./property.module.css";

export const dynamic = "force-dynamic";

export default async function PropertyDetailPage({
  params,
}: {
  params: Promise<{ lang: string; slug: string }>;
}) {
  const { lang: raw, slug } = await params;
  const lang: Locale = isLocale(raw) ? (raw as Locale) : "en";
  const t = await getDictionary(lang);

  const uiLang = lang === "es" ? "es" : "en";
  const property = await getPropertyBySlug({ lang: uiLang, slug });

  if (!property) {
    return (
      <>
        <Header lang={lang} t={t.header} />
        <main>
          <section className="section">
            <div className="container">
              <h1 className={styles.title}>
                {lang === "es" ? "Propiedad no encontrada" : "Property not found"}
              </h1>
              <p className={styles.muted}>
                {lang === "es"
                  ? "Puede que no est√© publicada o el enlace sea incorrecto."
                  : "It may be unpublished or the link is incorrect."}
              </p>
            </div>
          </section>
        </main>
      </>
    );
  }

  return (
    <>
      <Header lang={lang} t={t.header} />
      <main>
        <section className="section">
          <div className="container">
            <div className={styles.head}>
              <div>
                <h1 className={styles.title}>{property.title}</h1>
                <div className={styles.location}>{property.location}</div>
              </div>

              <div className={styles.price}>{property.priceText}</div>
            </div>

            {/* ‚úÖ Gallery (with modal) */}
            {property.images?.length ? (
              <PropertyGallery images={property.images} />
            ) : (
              <div className={styles.coverPlaceholder} />
            )}

            {/* Specs */}
            <div className={styles.specs}>
              <div className={styles.specItem}>
                üõè {property.beds} {t.featured.card.beds}
              </div>
              <div className={styles.specItem}>
                üõÅ {property.baths} {t.featured.card.baths}
              </div>
              <div className={styles.specItem}>üìê {property.builtArea} m¬≤</div>
            </div>

            {/* Description */}
            {property.description?.trim() ? (
              <div className={styles.block}>
                <div className={styles.blockTitle}>
                  {lang === "es" ? "Descripci√≥n" : "Description"}
                </div>
                <p className={styles.description}>{property.description}</p>
              </div>
            ) : null}

            {/* Amenities */}
            {property.features.length > 0 ? (
              <div className={styles.block}>
                <div className={styles.blockTitle}>
                  {lang === "es" ? "Comodidades" : "Amenities"}
                </div>
                <div className={styles.amenities}>
                  {property.features.map((f) => (
                    <span key={f.key} className={styles.amenity}>
                      {f.label}
                    </span>
                  ))}
                </div>
              </div>
            ) : null}

            {/* Plans */}
            {property.plansUrl ? (
              <div className={styles.block}>
                <div className={styles.blockTitle}>
                  {lang === "es" ? "Planos (PDF)" : "Plans (PDF)"}
                </div>
                <a
                  className={`btn btnGhost ${styles.planBtn}`}
                  href={property.plansUrl}
                  target="_blank"
                  rel="noreferrer"
                >
                  {lang === "es" ? "Abrir PDF" : "Open PDF"}
                </a>
              </div>
            ) : null}

            {/* ‚úÖ Lead form (anchored) */}
            <div id="contact" className={styles.block}>
              <LeadContactForm
                lang={uiLang}
                propertyId={property.id}
                propertySlug={property.slug}
                title={lang === "es" ? "Solicitar detalles" : "Request details"}
                subtitle={
                  lang === "es"
                    ? "D√©janos tus datos y te contactaremos por esta propiedad."
                    : "Leave your details and we‚Äôll contact you about this property."
                }
                labels={
                  lang === "es"
                    ? {
                        name: "Nombre",
                        phone: "Tel√©fono",
                        email: "Email",
                        message: "Mensaje",
                        send: "Enviar",
                        sending: "Enviando...",
                        sent: "Enviado ‚úÖ",
                        namePlaceholder: "Tu nombre",
                        phonePlaceholder: "+34 ...",
                        emailPlaceholder: "tu@email.com",
                        messagePlaceholder: "Cu√©ntanos qu√© buscas‚Ä¶",
                        errRequired: "Rellena nombre, tel√©fono y email.",
                        errEmail: "Email no v√°lido.",
                        errFailed: "Error al enviar. Int√©ntalo de nuevo.",
                      }
                    : {
                        name: "Your Name",
                        phone: "Phone",
                        email: "Email",
                        message: "Message",
                        send: "Send Message",
                        sending: "Sending...",
                        sent: "Sent ‚úÖ",
                        namePlaceholder: "Name",
                        phonePlaceholder: "+34 ...",
                        emailPlaceholder: "you@email.com",
                        messagePlaceholder: "Tell us what you are looking for‚Ä¶",
                        errRequired: "Please fill name, phone and email.",
                        errEmail: "Invalid email.",
                        errFailed: "Failed to send. Try again.",
                      }
                }
              />
            </div>
          </div>
        </section>
      </main>
    </>
  );
}

```

---

## app/[lang]/properties/[slug]/property.module.css

```css
.title {
  margin: 0;
}

.muted {
  color: var(--muted);
}

.head {
  display: flex;
  align-items: flex-end;
  justify-content: space-between;
  gap: 16px;
  margin-bottom: 18px;
}

.location {
  margin-top: 6px;
  color: rgba(28, 28, 28, 0.62);
}

.price {
  font-size: 22px;
  font-weight: 700;
  white-space: nowrap;
}

.gallery {
  display: grid;
  grid-template-columns: 1.6fr 1fr;
  gap: 14px;
  margin: 16px 0 18px;

  align-items: start; /* ‚úÖ –≤–∞–∂–Ω–æ: —É–±–∏—Ä–∞–µ—Ç —Ä–∞—Å—Ç—è–≥–∏–≤–∞–Ω–∏–µ coverWrap */
}

.coverWrap {
  border-radius: var(--radius);
  overflow: hidden;
  border: 1px solid var(--border);
  background: #fff;
}

.cover {
  display: block;
  width: 100%;
  height: 420px;
  object-fit: cover;
}

.coverPlaceholder {
  height: 420px;
  border-radius: var(--radius);
  border: 1px solid var(--border);
  background: rgba(0,0,0,0.03);
}

.thumbs {
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 10px;

  max-height: 420px;      /* ‚úÖ –≤—ã—Å–æ—Ç–∞ –∫–∞–∫ —É cover */
  overflow-y: auto;       /* ‚úÖ –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ */
  padding-right: 4px;     /* —á—Ç–æ–±—ã —Å–∫—Ä–æ–ª–ª –Ω–µ –ø—Ä–∏–ª–∏–ø–∞–ª */
}

.thumb {
  width: 100%;
  height: 205px;
  object-fit: cover;
  border-radius: 12px;
  border: 1px solid var(--border);
  background: #fff;
}

.specs {
  display: flex;
  gap: 14px;
  flex-wrap: wrap;
  margin: 10px 0 18px;
}

.specItem {
  padding: 10px 12px;
  border: 1px solid var(--border);
  border-radius: 12px;
  background: rgba(255,255,255,0.75);
}

.block {
  margin-top: 18px;
}

.blockTitle {
  font-weight: 700;
  margin-bottom: 10px;
}

.amenities {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
}

.amenity {
  padding: 8px 12px;
  border: 1px solid var(--border);
  border-radius: 999px;
  background: rgba(255,255,255,0.75);
  font-size: 13px;
  color: rgba(28, 28, 28, 0.78);
}

.planBtn {
  padding: 10px 14px;
}

.cta {
  margin-top: 24px;
  padding: 16px;
  border: 1px solid var(--border);
  border-radius: var(--radius);
  background: rgba(255,255,255,0.75);
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 14px;
}

.ctaText {
  color: rgba(28, 28, 28, 0.75);
}

@media (max-width: 980px) {
  .head {
    flex-direction: column;
    align-items: flex-start;
  }

  .gallery {
    grid-template-columns: 1fr;
    align-items: start;
  }

  .cover {
    height: 340px;
  }

  .thumb {
    height: 160px;
  }

  .cta {
    flex-direction: column;
    align-items: flex-start;
  }
}

.description {
  color: rgba(28, 28, 28, 0.78);
  line-height: 1.7;
  white-space: pre-line;
  max-width: 900px;
}

```

---

## app/[lang]/properties/page.tsx

```typescript
import Header from "@/components/Header/Header";
import PropertyCard from "@/components/PropertyCard/PropertyCard";
import { getDictionary, isLocale, type Locale } from "@/i18n/dictionaries";
import styles from "./properties.module.css";

import Filters from "./Filters";
import { getAllFeaturesForFilters, getCatalogItems } from "@/app/lib/publicProperties";

export const dynamic = "force-dynamic";

function parseFeaturesParam(v: string | undefined): string[] {
  if (!v) return [];
  return v
    .split(",")
    .map((x) => x.trim().toLowerCase())
    .filter(Boolean);
}

type Deal = "all" | "sale" | "rent";
function parseDealParam(v: string | undefined): Deal {
  const s = String(v ?? "").trim().toLowerCase();
  if (s === "sale" || s === "rent") return s;
  return "all";
}

export default async function PropertiesPage({
  params,
  searchParams,
}: {
  params: Promise<{ lang: string }>;
  searchParams: Promise<Record<string, string | string[] | undefined>>;
}) {
  const { lang: raw } = await params;
  const lang: Locale = isLocale(raw) ? (raw as Locale) : "en";
  const t = await getDictionary(lang);

  const uiLang = lang === "es" ? "es" : "en";

  const sp = await searchParams;
  const page = Number(Array.isArray(sp.page) ? sp.page[0] : sp.page) || 1;

  const type = String(Array.isArray(sp.type) ? sp.type[0] : sp.type || "").trim() || null;

  const features = parseFeaturesParam(
    String(Array.isArray(sp.features) ? sp.features[0] : sp.features || "")
  );

  // ‚úÖ NEW: deal filter
  const deal = parseDealParam(String(Array.isArray(sp.deal) ? sp.deal[0] : sp.deal || ""));

  const [featuresForFilters, result] = await Promise.all([
    getAllFeaturesForFilters(uiLang),
    getCatalogItems({
      lang: uiLang,
      page,
      pageSize: 12,
      filters: {
        type,
        featureKeys: features,
        // ‚úÖ NEW: –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ–º deal (sale/rent/all)
        deal,
      },
    }),
  ]);

  return (
    <>
      <Header lang={lang} t={t.header} />
      <main>
        <section className="section">
          <div className="container">
            <div className="section__head">
              <h1 className="sectionTitle">
                <span className="sectionTitleText">
                  {lang === "es" ? "Cat√°logo" : "Properties Catalog"}
                </span>
              </h1>
              <p className="section__kicker">
                {lang === "es" ? "Todas las propiedades publicadas" : "All published properties"}
              </p>
            </div>

            {/* Deal toggle (All / Sale / Rent) */}
            <div className={styles.dealRow}>
              <div className={styles.dealSeg}>
                <a
                  className={`btn ${deal === "all" ? "btnPrimary" : "btnGhost"} ${styles.dealBtn}`}
                  href={buildSetParamHref(sp, { deal: "all" })}
                >
                  {lang === "es" ? "Todas" : "All"}
                </a>

                <a
                  className={`btn ${deal === "sale" ? "btnPrimary" : "btnGhost"} ${styles.dealBtn}`}
                  href={buildSetParamHref(sp, { deal: "sale" })}
                >
                  {lang === "es" ? "Venta" : "For Sale"}
                </a>

                <a
                  className={`btn ${deal === "rent" ? "btnPrimary" : "btnGhost"} ${styles.dealBtn}`}
                  href={buildSetParamHref(sp, { deal: "rent" })}
                >
                  {lang === "es" ? "Alquiler" : "For Rent"}
                </a>
              </div>
            </div>

            {/* ‚úÖ –§–∏–ª—å—Ç—Ä—ã */}
            <Filters lang={uiLang} features={featuresForFilters} />

            {result.items.length === 0 ? (
              <div className={styles.empty}>
                {lang === "es" ? "No hay propiedades con estos filtros." : "No properties match these filters."}
              </div>
            ) : (
              <>
                <div className={styles.grid}>
                  {result.items.map((p) => (
                    <PropertyCard
                      key={String(p.id)}
                      property={{
                        title: p.title,
                        location: p.location,
                        price: p.priceText,
                        beds: p.beds,
                        baths: p.baths,
                        area: p.area,
                        image: p.image,

                        // ‚úÖ amenities –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–µ
                        features: p.features,

                        href: `/${lang}/properties/${p.slug}`,
                      }}
                      t={t.featured.card}
                    />
                  ))}
                </div>

                {/* ‚úÖ –ü–∞–≥–∏–Ω–∞—Ü–∏—è */}
                <div className={styles.pager}>
                  <div className={styles.pagerInfo}>
                    {lang === "es" ? `P√°gina ${result.page} de ${result.totalPages}` : `Page ${result.page} of ${result.totalPages}`}
                  </div>

                  <div className={styles.pagerBtns}>
                    {result.page > 1 && (
                      <a className={`btn btnGhost ${styles.pagerBtn}`} href={buildPageHref(sp, result.page - 1)}>
                        ‚Üê {lang === "es" ? "Anterior" : "Prev"}
                      </a>
                    )}

                    {result.page < result.totalPages && (
                      <a className={`btn btnPrimary ${styles.pagerBtn}`} href={buildPageHref(sp, result.page + 1)}>
                        {lang === "es" ? "Siguiente" : "Next"} ‚Üí
                      </a>
                    )}
                  </div>
                </div>
              </>
            )}
          </div>
        </section>
      </main>
    </>
  );
}

function buildPageHref(sp: Record<string, string | string[] | undefined>, nextPage: number) {
  const u = new URLSearchParams();

  for (const [k, v] of Object.entries(sp)) {
    if (v === undefined) continue;
    if (k === "page") continue;

    const value = Array.isArray(v) ? v[0] : v;
    if (value !== undefined && String(value).trim() !== "") {
      u.set(k, String(value));
    }
  }

  u.set("page", String(nextPage));
  const qs = u.toString();
  return qs ? `?${qs}` : "?page=1";
}

/**
 * –ú–µ–Ω—è–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä deal),
 * –∏ –≤—Å–µ–≥–¥–∞ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º page ‚Üí 1, —á—Ç–æ–±—ã –Ω–µ —É–µ—Ö–∞—Ç—å –Ω–∞ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É.
 */
function buildSetParamHref(
  sp: Record<string, string | string[] | undefined>,
  patch: Partial<Record<string, string>>
) {
  const u = new URLSearchParams();

  for (const [k, v] of Object.entries(sp)) {
    if (v === undefined) continue;
    if (k === "page") continue; // —Å–±—Ä–æ—Å–∏–º
    const value = Array.isArray(v) ? v[0] : v;
    if (value !== undefined && String(value).trim() !== "") {
      u.set(k, String(value));
    }
  }

  for (const [k, v] of Object.entries(patch)) {
    if (!v || v === "all") u.delete(k);
    else u.set(k, v);
  }

  // –ø–æ—Å–ª–µ —Å–º–µ–Ω—ã —Ñ–∏–ª—å—Ç—Ä–∞ –Ω–∞—á–∏–Ω–∞–µ–º —Å 1 —Å—Ç—Ä–∞–Ω–∏—Ü—ã
  u.set("page", "1");

  const qs = u.toString();
  return qs ? `?${qs}` : "?page=1";
}


```

---

## app/[lang]/properties/properties.module.css

```css
/* =========================
   Catalog grid + empty
========================= */

.grid {
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 22px;
  align-items: stretch;
}

.empty {
  padding: 24px 0;
  color: var(--muted);
}

/* =========================
   Deal toggle (segmented)
   (–µ—Å–ª–∏ —É–∂–µ –¥–æ–±–∞–≤–ª—è–ª)
========================= */

.dealRow {
  display: flex;
  justify-content: flex-start;
  margin: 18px 0 12px;
}

.dealSeg {
  display: inline-flex;
  border: 1px solid var(--border);
  background: rgba(255, 255, 255, 0.78);
  border-radius: 999px;
  overflow: hidden;
  box-shadow: var(--shadow);
}

.dealBtn {
  border: 0 !important;
  border-radius: 0 !important;
  padding: 10px 14px;
  line-height: 1;
}

.dealBtn:first-child {
  border-top-left-radius: 999px !important;
  border-bottom-left-radius: 999px !important;
}

.dealBtn:last-child {
  border-top-right-radius: 999px !important;
  border-bottom-right-radius: 999px !important;
}

/* =========================
   Filters (compact)
========================= */

.filters {
  margin: 16px 0 18px;
}

.filtersTop {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
}

/* –ö–Ω–æ–ø–∫–∞ "Filters" ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π .btn btnGhost,
   —Ç—É—Ç —Ç–æ–ª—å–∫–æ –∫–æ–º–ø–∞–∫—Ç–Ω–æ—Å—Ç—å –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã */
.filtersToggleBtn {
  display: inline-flex;
  align-items: center;
  gap: 10px;
}

.filtersToggleText {
  font-weight: 700;
  letter-spacing: 0.2px;
}

.filtersChevron {
  font-size: 12px;
  opacity: 0.7;
}

.filtersCount {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  min-width: 22px;
  height: 22px;
  padding: 0 7px;
  border-radius: 999px;
  background: var(--accent);
  color: #fff;
  font-size: 12px;
  font-weight: 700;
}

.clearBtn {
  white-space: nowrap;
}

/* –ø–∞–Ω–µ–ª—å —Ñ–∏–ª—å—Ç—Ä–æ–≤ (–≤–º–µ—Å—Ç–æ –æ–≥—Ä–æ–º–Ω–æ–π —Å–µ—Ç–∫–∏) */
.filtersPanel {
  margin-top: 12px;
  border: 1px solid var(--border);
  background: rgba(255, 255, 255, 0.86);
  border-radius: 16px;
  box-shadow: var(--shadow);
  padding: 14px;
}

/* —Å–∞–º–∞ —Ä–∞—Å–∫–ª–∞–¥–∫–∞ –≤–Ω—É—Ç—Ä–∏ */
.filtersGrid {
  display: grid;
  grid-template-columns: 260px 1fr;
  gap: 14px;
  align-items: start;
}

.field {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.label {
  font-size: 12px;
  text-transform: uppercase;
  letter-spacing: 0.35px;
  color: rgba(28, 28, 28, 0.62);
}

/* —Å–µ–ª–µ–∫—Ç –≤ —Å—Ç–∏–ª–µ –ø—Ä–æ–µ–∫—Ç–∞ */
.select {
  width: 100%;
  padding: 11px 12px;
  border: 1px solid var(--border);
  border-radius: 12px;
  background: rgba(255, 255, 255, 0.92);
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.03);
}

.select:focus-visible {
  outline: 2px solid rgba(43, 69, 55, 0.25);
  outline-offset: 3px;
}

/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ amenities + –ø–æ–∏—Å–∫ */
.amenitiesHead {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
  margin-bottom: 10px;
}

.search {
  width: min(240px, 100%);
  padding: 10px 12px;
  border-radius: 12px;
  border: 1px solid var(--border);
  background: rgba(255, 255, 255, 0.92);
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.03);
}

.search:focus-visible {
  outline: 2px solid rgba(43, 69, 55, 0.25);
  outline-offset: 3px;
}

/* –í–º–µ—Å—Ç–æ –≥–∏–≥–∞–Ω—Ç—Å–∫–∏—Ö —á–µ–∫–±–æ–∫—Å–æ–≤ ‚Äî pills */
.featuresCompact {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.pill {
  padding: 8px 12px;
  border-radius: 999px !important;
  font-weight: 600;
  line-height: 1;
}

/* –∫–Ω–æ–ø–∫–∞ "Show all" */
.moreBtn {
  margin-top: 10px;
}

/* =========================
   Pager
========================= */

.pager {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 14px;
  margin-top: 22px;
  padding-top: 14px;
  border-top: 1px solid var(--border);
}

.pagerInfo {
  color: var(--muted);
  font-size: 13px;
}

.pagerBtns {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
}

.pagerBtn {
  padding: 10px 14px;
  white-space: nowrap;
}

/* =========================
   Responsive
========================= */

@media (max-width: 980px) {
  .grid {
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }

  .filtersGrid {
    grid-template-columns: 1fr;
  }

  .pager {
    flex-direction: column;
    align-items: flex-start;
  }
}

@media (max-width: 640px) {
  .grid {
    grid-template-columns: 1fr;
  }

  .dealRow {
    justify-content: center;
  }

  .filtersPanel {
    padding: 12px;
  }

  .amenitiesHead {
    flex-direction: column;
    align-items: stretch;
  }

  .search {
    width: 100%;
  }

  .pill {
    padding: 8px 10px;
  }
}

```

---

## app/[lang]/terms/page.tsx

```typescript
import Header from "@/components/Header/Header";
import Footer from "@/components/Footer/Footer";
import { getDictionary, isLocale, type Locale } from "@/i18n/dictionaries";

export const dynamic = "force-dynamic";

export default async function TermsPage({
  params,
}: {
  params: Promise<{ lang: string }>;
}) {
  const { lang: raw } = await params;
  const lang: Locale = isLocale(raw) ? (raw as Locale) : "en";
  const t = await getDictionary(lang);

  const uiLang: "en" | "es" = lang === "es" ? "es" : "en";

  return (
    <>
      <Header lang={uiLang} t={t.header} />

      <main>
        <section className="section">
          <div className="container">
            <h1 className="h2">
              {lang === "es" ? "T√©rminos y condiciones" : "Terms & Conditions"}
            </h1>

            <p className="p" style={{ marginTop: 12 }}>
              {lang === "es"
                ? "Esta p√°gina es una plantilla temporal. Aqu√≠ publicaremos los t√©rminos de uso del sitio, avisos legales y limitaciones de responsabilidad."
                : "This is a temporary placeholder page. Here we‚Äôll publish the website terms of use, legal notices, and limitations of liability."}
            </p>

            <div style={{ marginTop: 18 }}>
              <h2 className="h2" style={{ fontSize: 18 }}>
                {lang === "es" ? "Nota" : "Note"}
              </h2>

              <p className="p" style={{ marginTop: 10 }}>
                {lang === "es"
                  ? "La informaci√≥n del sitio puede cambiar. Para confirmar disponibilidad y precios, cont√°ctanos."
                  : "Information on this website may change. To confirm availability and pricing, please contact us."}
              </p>
            </div>

            <div style={{ marginTop: 22 }}>
              <a className="btn btnPrimary" href={`/${uiLang}#contact`}>
                {lang === "es" ? "Contactar" : "Contact"}
              </a>
            </div>
          </div>
        </section>
      </main>

      
    </>
  );
}

```

---

## app/admin/layout.tsx

```typescript
import "../globals.css";
import { Inter, Playfair_Display } from "next/font/google";

const inter = Inter({
  subsets: ["latin"],
  variable: "--font-inter",
  display: "swap",
});

const playfair = Playfair_Display({
  subsets: ["latin"],
  variable: "--font-playfair",
  display: "swap",
});

export default function AdminLayout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="en" className={`${inter.variable} ${playfair.variable}`}>
      <body>{children}</body>
    </html>
  );
}

```

---

## app/admin/leads/[id]/page.tsx

```typescript
import Link from "next/link";
import { redirect } from "next/navigation";
import { sql } from "drizzle-orm";
import { db } from "@/db";

export const dynamic = "force-dynamic";

type PageProps = {
  params: Promise<{ id: string }>;
};

type LeadRow = {
  id: number;
  created_at: string;
  name: string;
  phone: string;
  email: string;
  message: string | null;

  lang: string;
  page_url: string;

  property_id: number | null;
  property_slug: string | null;

  status: string;
  source: string | null;
  processed_at: string | null;
};

function fmtDate(v: unknown) {
  const s = String(v ?? "");
  if (!s) return "‚Äî";
  return s.replace("T", " ").replace("Z", "");
}

function row(label: string, value: React.ReactNode) {
  return (
    <div style={{ display: "grid", gridTemplateColumns: "180px 1fr", gap: 12, padding: "10px 0", borderTop: "1px solid #F1F1EE" }}>
      <div style={{ opacity: 0.75, fontSize: 13 }}>{label}</div>
      <div style={{ fontWeight: 500 }}>{value}</div>
    </div>
  );
}

export default async function AdminLeadDetailPage({ params }: PageProps) {
  const { id: raw } = await params;
  const id = Number(raw);
  if (!Number.isFinite(id)) redirect("/admin/leads");

  const res = await db.execute(sql`
    SELECT
      id,
      created_at,
      name,
      phone,
      email,
      message,
      lang,
      page_url,
      property_id,
      property_slug,
      status,
      source,
      processed_at
    FROM leads
    WHERE id = ${id}
    LIMIT 1
  `);

  const lead = ((res as any).rows?.[0] ?? null) as LeadRow | null;
  if (!lead) redirect("/admin/leads");

  const isProcessed = String(lead.status || "").toLowerCase() === "processed";

  async function markProcessed() {
    "use server";

    await db.execute(sql`
      UPDATE leads
      SET status = 'processed',
          processed_at = NOW()
      WHERE id = ${id}
    `);

    redirect(`/admin/leads/${id}`);
  }

  return (
    <main style={{ maxWidth: 980, margin: "60px auto", padding: 16 }}>
      <header style={{ display: "flex", alignItems: "center", justifyContent: "space-between", gap: 12, flexWrap: "wrap" }}>
        <div>
          <h1 style={{ fontSize: 34, margin: 0 }}>Lead #{lead.id}</h1>
          <p style={{ marginTop: 8, opacity: 0.75 }}>
            Status:{" "}
            <strong style={{ color: isProcessed ? "rgba(28,28,28,0.75)" : "#0E5E56" }}>
              {isProcessed ? "Processed" : "New"}
            </strong>
          </p>
        </div>

        <div style={{ display: "flex", gap: 10, alignItems: "center", flexWrap: "wrap" }}>
          <Link
            href="/admin/leads"
            style={{
              padding: "10px 14px",
              borderRadius: 12,
              border: "1px solid #E2E2DE",
              textDecoration: "none",
              color: "inherit",
            }}
          >
            ‚Üê Back to leads
          </Link>

          {!isProcessed && (
            <form action={markProcessed}>
              <button
                type="submit"
                style={{
                  padding: "10px 14px",
                  borderRadius: 12,
                  border: "1px solid #0E5E56",
                  background: "#0E5E56",
                  color: "#fff",
                  cursor: "pointer",
                  fontWeight: 600,
                }}
              >
                Mark as processed
              </button>
            </form>
          )}
        </div>
      </header>

      <section
        style={{
          marginTop: 18,
          border: "1px solid #E2E2DE",
          borderRadius: 16,
          background: "#fff",
          padding: 18,
        }}
      >
        {row("Created", <span style={{ opacity: 0.85 }}>{fmtDate(lead.created_at)}</span>)}
        {row("Name", lead.name || "‚Äî")}
        {row("Email", <a href={`mailto:${lead.email}`} style={{ color: "#0E5E56", fontWeight: 600 }}>{lead.email}</a>)}
        {row("Phone", <a href={`tel:${lead.phone}`} style={{ color: "#0E5E56", fontWeight: 600 }}>{lead.phone}</a>)}

        {row("Language", <span style={{ opacity: 0.85 }}>{lead.lang}</span>)}
        {row(
          "Page URL",
          <a href={lead.page_url} target="_blank" rel="noreferrer" style={{ color: "#0E5E56", fontWeight: 600 }}>
            {lead.page_url}
          </a>
        )}

        {row("Source", <span style={{ opacity: 0.85 }}>{lead.source || "‚Äî"}</span>)}

        {row(
          "Property",
          lead.property_slug ? (
            <span style={{ opacity: 0.9 }}>
              {lead.property_slug}{" "}
              {lead.property_id ? <span style={{ opacity: 0.6 }}>(id: {lead.property_id})</span> : null}
            </span>
          ) : (
            "‚Äî"
          )
        )}

        {row(
          "Processed at",
          <span style={{ opacity: 0.85 }}>{lead.processed_at ? fmtDate(lead.processed_at) : "‚Äî"}</span>
        )}

        <div style={{ padding: "10px 0", borderTop: "1px solid #F1F1EE", marginTop: 6 }}>
          <div style={{ opacity: 0.75, fontSize: 13, marginBottom: 8 }}>Message</div>
          <div style={{ whiteSpace: "pre-wrap", lineHeight: 1.6 }}>
            {lead.message?.trim() ? lead.message : <span style={{ opacity: 0.6 }}>‚Äî</span>}
          </div>
        </div>
      </section>
    </main>
  );
}

```

---

## app/admin/leads/page.tsx

```typescript
import Link from "next/link";
import { redirect } from "next/navigation";
import { sql } from "drizzle-orm";
import { db } from "@/db";

export const dynamic = "force-dynamic";

type LeadRow = {
  id: number;
  created_at: string;
  name: string;
  phone: string;
  email: string;
  lang: string;
  page_url: string;
  property_id: number | null;
  property_slug: string | null;
  status: string;
  source: string | null;
  processed_at: string | null;
};

function badgeStyle(status: string) {
  const isNew = String(status || "").toLowerCase() !== "processed";
  return {
    display: "inline-flex",
    alignItems: "center",
    gap: 6,
    padding: "4px 10px",
    borderRadius: 999,
    border: "1px solid #E2E2DE",
    background: isNew ? "rgba(14, 94, 86, 0.08)" : "rgba(0,0,0,0.04)",
    color: isNew ? "#0E5E56" : "rgba(28,28,28,0.75)",
    fontSize: 12,
    fontWeight: 600 as const,
    whiteSpace: "nowrap" as const,
  };
}

function fmtDate(v: unknown) {
  const s = String(v ?? "");
  if (!s) return "‚Äî";
  return s.replace("T", " ").replace("Z", "");
}

export default async function AdminLeadsPage({
  searchParams,
}: {
  searchParams: Promise<Record<string, string | string[] | undefined>>;
}) {
  const sp = await searchParams;

  const status = String(Array.isArray(sp.status) ? sp.status[0] : sp.status ?? "")
    .trim()
    .toLowerCase();

  const qRaw = String(Array.isArray(sp.q) ? sp.q[0] : sp.q ?? "").trim();
  const q = qRaw.slice(0, 80);

  // ‚úÖ Server Action: –ø–æ–º–µ—Ç–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–º
  async function markProcessed(formData: FormData) {
    "use server";

    const idRaw = String(formData.get("id") ?? "").trim();
    const id = Number(idRaw);

    const backStatus = String(formData.get("status") ?? "").trim();
    const backQ = String(formData.get("q") ?? "").trim();

    if (!Number.isFinite(id)) {
      redirect("/admin/leads");
    }

    await db.execute(sql`
      UPDATE leads
      SET status = 'processed',
          processed_at = NOW()
      WHERE id = ${id}
        AND status <> 'processed'
    `);

    const params = new URLSearchParams();
    if (backStatus) params.set("status", backStatus);
    if (backQ) params.set("q", backQ);

    const qs = params.toString();
    redirect(qs ? `/admin/leads?${qs}` : "/admin/leads");
  }

  let whereSql = sql`TRUE`;

  if (status === "new") whereSql = sql`${whereSql} AND status <> 'processed'`;
  if (status === "processed") whereSql = sql`${whereSql} AND status = 'processed'`;

  if (q) {
    const like = `%${q}%`;
    whereSql = sql`${whereSql} AND (
      name ILIKE ${like}
      OR email ILIKE ${like}
      OR phone ILIKE ${like}
      OR COALESCE(property_slug, '') ILIKE ${like}
      OR COALESCE(page_url, '') ILIKE ${like}
    )`;
  }

  const res = await db.execute(sql`
    SELECT
      id,
      created_at,
      name,
      phone,
      email,
      lang,
      page_url,
      property_id,
      property_slug,
      status,
      source,
      processed_at
    FROM leads
    WHERE ${whereSql}
    ORDER BY created_at DESC, id DESC
    LIMIT 200
  `);

  const leads = ((res as any).rows ?? []) as LeadRow[];

  const buildLink = (nextStatus: "" | "new" | "processed") => {
    const params = new URLSearchParams();
    if (nextStatus) params.set("status", nextStatus);
    if (q) params.set("q", q);
    const qs = params.toString();
    return qs ? `/admin/leads?${qs}` : "/admin/leads";
  };

  const clearLink = status ? `/admin/leads?status=${status}` : "/admin/leads";

  // ‚úÖ Export CSV link —Å —É—á–µ—Ç–æ–º —Ñ–∏–ª—å—Ç—Ä–æ–≤
  const exportHref = (() => {
    const params = new URLSearchParams();
    if (status) params.set("status", status);
    if (q) params.set("q", q);
    const qs = params.toString();
    return qs ? `/api/admin/leads/export?${qs}` : "/api/admin/leads/export";
  })();

  const btnPrimary = {
    padding: "10px 14px",
    borderRadius: 12,
    border: "1px solid #0E5E56",
    background: "#0E5E56",
    color: "#fff",
    cursor: "pointer",
    fontWeight: 600,
    whiteSpace: "nowrap" as const,
    display: "inline-flex",
    alignItems: "center",
    justifyContent: "center",
    lineHeight: 1,
  };

  const btnGhost = {
    padding: "10px 14px",
    borderRadius: 12,
    border: "1px solid #E2E2DE",
    textDecoration: "none",
    color: "inherit",
    background: "#fff",
    whiteSpace: "nowrap" as const,
    display: "inline-flex",
    alignItems: "center",
    justifyContent: "center",
    lineHeight: 1,
  };

  return (
    <main style={{ maxWidth: 1100, margin: "60px auto", padding: 16 }}>
      <header
        style={{
          display: "flex",
          alignItems: "flex-start",
          justifyContent: "space-between",
          gap: 12,
          flexWrap: "wrap",
        }}
      >
        <div style={{ flex: "1 1 520px" }}>
          <h1 style={{ fontSize: 34, margin: 0 }}>Leads</h1>
          <p style={{ marginTop: 8, opacity: 0.75 }}>
            Incoming contact requests (latest 200). Search by email, phone, name, property slug or page URL.
          </p>

          {/* ‚úÖ Search + Export CSV –≤ –û–î–ù–û–ô –ª–∏–Ω–∏–∏ */}
          <form
            action="/admin/leads"
            method="GET"
            style={{
              display: "flex",
              gap: 10,
              marginTop: 12,
              flexWrap: "nowrap",
              alignItems: "center",
            }}
          >
            {status ? <input type="hidden" name="status" value={status} /> : null}

            <input
              name="q"
              defaultValue={q}
              placeholder="Search: email, phone, name‚Ä¶"
              style={{
                flex: "1 1 auto",
                minWidth: 240,
                padding: "10px 12px",
                borderRadius: 12,
                border: "1px solid #E2E2DE",
                outline: "none",
              }}
            />

            <button type="submit" style={btnPrimary}>
              Search
            </button>

            <a href={exportHref} style={btnPrimary}>
              Export CSV
            </a>

            {q ? (
              <Link href={clearLink} style={btnGhost}>
                Clear
              </Link>
            ) : null}
          </form>

          <div style={{ display: "flex", gap: 10, marginTop: 12, flexWrap: "wrap" }}>
            <Link
              href={buildLink("")}
              style={{
                padding: "8px 12px",
                borderRadius: 999,
                border: "1px solid #E2E2DE",
                textDecoration: "none",
                color: "inherit",
                background: !status ? "rgba(0,0,0,0.03)" : "transparent",
              }}
            >
              All
            </Link>

            <Link
              href={buildLink("new")}
              style={{
                padding: "8px 12px",
                borderRadius: 999,
                border: "1px solid #E2E2DE",
                textDecoration: "none",
                color: "inherit",
                background: status === "new" ? "rgba(0,0,0,0.03)" : "transparent",
              }}
            >
              New
            </Link>

            <Link
              href={buildLink("processed")}
              style={{
                padding: "8px 12px",
                borderRadius: 999,
                border: "1px solid #E2E2DE",
                textDecoration: "none",
                color: "inherit",
                background: status === "processed" ? "rgba(0,0,0,0.03)" : "transparent",
              }}
            >
              Processed
            </Link>
          </div>
        </div>

        {/* ‚úÖ –°–ø—Ä–∞–≤–∞: —Ç–æ–ª—å–∫–æ Admin */}
        <Link
          href="/admin"
          style={{
            padding: "10px 14px",
            borderRadius: 12,
            border: "1px solid #E2E2DE",
            textDecoration: "none",
            color: "inherit",
            whiteSpace: "nowrap",
          }}
        >
          ‚Üê Admin
        </Link>
      </header>

      <div
        style={{
          marginTop: 18,
          border: "1px solid #E2E2DE",
          borderRadius: 16,
          background: "#fff",
          overflow: "hidden",
        }}
      >
        <div
          style={{
            padding: 14,
            borderBottom: "1px solid #E2E2DE",
            display: "flex",
            justifyContent: "space-between",
            gap: 12,
            flexWrap: "wrap",
          }}
        >
          <div style={{ fontWeight: 600 }}>
            {leads.length} item(s)
            {q ? <span style={{ marginLeft: 10, opacity: 0.7, fontWeight: 500 }}>for ‚Äú{q}‚Äù</span> : null}
          </div>
          <div style={{ opacity: 0.7, fontSize: 13 }}>Tip: process leads –ø—Ä—è–º–æ –∏–∑ —Å–ø–∏—Å–∫–∞</div>
        </div>

        {leads.length === 0 ? (
          <div style={{ padding: 16, opacity: 0.8 }}>No leads found.</div>
        ) : (
          <div style={{ width: "100%", overflowX: "auto" }}>
            <table style={{ width: "100%", borderCollapse: "collapse", minWidth: 1120 }}>
              <thead>
                <tr style={{ textAlign: "left", fontSize: 12, letterSpacing: 0.3, opacity: 0.7 }}>
                  <th style={{ padding: "12px 14px" }}>ID</th>
                  <th style={{ padding: "12px 14px" }}>Status</th>
                  <th style={{ padding: "12px 14px" }}>Name</th>
                  <th style={{ padding: "12px 14px" }}>Email</th>
                  <th style={{ padding: "12px 14px" }}>Phone</th>
                  <th style={{ padding: "12px 14px" }}>Property</th>
                  <th style={{ padding: "12px 14px" }}>Source</th>
                  <th style={{ padding: "12px 14px" }}>Page</th>
                  <th style={{ padding: "12px 14px" }}>Created</th>
                  <th style={{ padding: "12px 14px" }}>Action</th>
                </tr>
              </thead>

              <tbody>
                {leads.map((l) => {
                  const prop = l.property_slug ? `${l.property_slug}` : "‚Äî";
                  const statusText = String(l.status || "new");
                  const isProcessed = statusText.toLowerCase() === "processed";

                  return (
                    <tr key={String(l.id)} style={{ borderTop: "1px solid #F1F1EE" }}>
                      <td style={{ padding: "12px 14px", fontVariantNumeric: "tabular-nums" }}>{l.id}</td>

                      <td style={{ padding: "12px 14px" }}>
                        <span style={badgeStyle(statusText)}>{isProcessed ? "Processed" : "New"}</span>
                      </td>

                      <td style={{ padding: "12px 14px" }}>{l.name || "‚Äî"}</td>

                      <td style={{ padding: "12px 14px" }}>
                        <a href={`mailto:${l.email}`} style={{ color: "inherit" }}>
                          {l.email}
                        </a>
                      </td>

                      <td style={{ padding: "12px 14px" }}>
                        <a href={`tel:${l.phone}`} style={{ color: "inherit" }}>
                          {l.phone}
                        </a>
                      </td>

                      <td style={{ padding: "12px 14px", opacity: 0.85 }}>{prop}</td>
                      <td style={{ padding: "12px 14px", opacity: 0.85 }}>{l.source || "‚Äî"}</td>

                      <td style={{ padding: "12px 14px", opacity: 0.85, maxWidth: 280 }}>
                        <span
                          title={l.page_url || ""}
                          style={{
                            display: "inline-block",
                            maxWidth: 280,
                            overflow: "hidden",
                            textOverflow: "ellipsis",
                            whiteSpace: "nowrap",
                            verticalAlign: "bottom",
                          }}
                        >
                          {l.page_url || "‚Äî"}
                        </span>
                      </td>

                      <td style={{ padding: "12px 14px", opacity: 0.85 }}>{fmtDate(l.created_at)}</td>

                      <td style={{ padding: "12px 14px", display: "flex", gap: 10, alignItems: "center" }}>
                        <Link
                          href={`/admin/leads/${l.id}`}
                          style={{ textDecoration: "none", fontWeight: 600, color: "#0E5E56" }}
                        >
                          View ‚Üí
                        </Link>

                        {!isProcessed ? (
                          <form action={markProcessed}>
                            <input type="hidden" name="id" value={String(l.id)} />
                            <input type="hidden" name="status" value={status} />
                            <input type="hidden" name="q" value={q} />

                            <button
                              type="submit"
                              style={{
                                padding: "6px 10px",
                                borderRadius: 10,
                                border: "1px solid #E2E2DE",
                                background: "rgba(0,0,0,0.03)",
                                cursor: "pointer",
                                fontWeight: 600,
                              }}
                            >
                              Mark processed
                            </button>
                          </form>
                        ) : null}
                      </td>
                    </tr>
                  );
                })}
              </tbody>
            </table>
          </div>
        )}
      </div>
    </main>
  );
}

```

---

## app/admin/login/page.tsx

```typescript
import { cookies } from "next/headers";
import { redirect } from "next/navigation";

export const dynamic = "force-dynamic";

export default function AdminLoginPage() {
  async function login(formData: FormData) {
    "use server";

    const password = String(formData.get("password") || "");
    const expected = process.env.ADMIN_PASSWORD || "";

    if (!expected) {
      throw new Error("ADMIN_PASSWORD is not set in environment.");
    }

    if (password !== expected) {
      // –ø—Ä–æ—Å—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞ –ª–æ–≥–∏–Ω (–º–æ–∂–Ω–æ –ø–æ–∑–∂–µ –¥–æ–±–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ)
      redirect("/admin/login");
    }

    // –í Next.js 15/16 cookies() ‚Äî async
    const cookieStore = await cookies();
    cookieStore.set("admin", "1", {
      httpOnly: true,
      sameSite: "lax",
      path: "/",
      maxAge: 60 * 60 * 24 * 7, // 7 –¥–Ω–µ–π
    });

    redirect("/admin");
  }

  return (
    <main style={{ maxWidth: 420, margin: "80px auto", padding: 16 }}>
      <h1 style={{ fontSize: 28, marginBottom: 8 }}>Admin Login</h1>
      <p style={{ opacity: 0.7, marginBottom: 24 }}>
        Enter the admin password to continue.
      </p>

      <form action={login}>
        <label style={{ display: "block", marginBottom: 8 }}>Password</label>
        <input
          name="password"
          type="password"
          required
          style={{
            width: "100%",
            padding: 12,
            borderRadius: 10,
            border: "1px solid #ddd",
            marginBottom: 12,
          }}
        />

        <button
          type="submit"
          style={{
            width: "100%",
            padding: 12,
            borderRadius: 10,
            border: "1px solid #111",
            cursor: "pointer",
          }}
        >
          Sign in
        </button>
      </form>

      <p style={{ opacity: 0.6, marginTop: 16, fontSize: 13 }}>
        (Local dev simple auth. We‚Äôll upgrade later if needed.)
      </p>
    </main>
  );
}

```

---

## app/admin/page.tsx

```typescript
import Link from "next/link";

export const dynamic = "force-dynamic";

export default function AdminHomePage() {
  return (
    <main style={{ maxWidth: 900, margin: "80px auto", padding: 16 }}>
      <h1 style={{ fontSize: 34, marginBottom: 8 }}>Admin</h1>
      <p style={{ margin: 10, opacity: 0.75 }}>‚úÖ You are logged in. Next step: </p>

      <div style={{ display: "flex", gap: 12, flexWrap: "wrap" }}>
        <Link
          href="/admin/properties"
          style={{
            padding: "10px 14px",
            borderRadius: 12,
            border: "1px solid #0E5E56",
            background: "#fff",
            textDecoration: "none",
            color: "#0E5E56",
            fontWeight: 600,
          }}
        >
          Go to Properties ‚Üí
        </Link>

        <Link
          href="/admin/leads"
          style={{
            padding: "10px 14px",
            borderRadius: 12,
            border: "1px solid #0E5E56",
            background: "#fff",
            textDecoration: "none",
            color: "#0E5E56",
            fontWeight: 600,
          }}
        >
          Go to Leads ‚Üí
        </Link>
      </div>

    </main>
  );
}

```

---

## app/admin/properties/RentFieldsSync.tsx

```typescript
"use client";

import { useEffect } from "react";

export default function RentFieldsSync() {
  useEffect(() => {
    const sel = document.getElementById("dealType") as HTMLSelectElement | null;
    const box = document.getElementById("rentFields") as HTMLDivElement | null;

    if (!sel || !box) return;

    const sync = () => {
      const isRent = (sel.value || "").toLowerCase() === "rent";

      // show/hide block
      box.style.display = isRent ? "" : "none";

      // disable/enable inputs so Sale –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–ª rent-–ø–æ–ª—è
      const inputs = box.querySelectorAll<HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement>(
        "[data-rent-input]"
      );
      inputs.forEach((i) => {
        i.disabled = !isRent;
      });
    };

    sel.addEventListener("change", sync);
    sync(); // initial

    return () => sel.removeEventListener("change", sync);
  }, []);

  return null;
}

```

---

## app/admin/properties/[id]/UploadForms.tsx

```typescript
"use client";

import { useState } from "react";

type Props = {
  propertyId: number;
};

export default function UploadForms({ propertyId }: Props) {
  const [imgLoading, setImgLoading] = useState(false);
  const [pdfLoading, setPdfLoading] = useState(false);
  const [msg, setMsg] = useState<string | null>(null);

  async function uploadImages(e: React.FormEvent<HTMLFormElement>) {
    e.preventDefault();
    setMsg(null);
    setImgLoading(true);

    const formEl = e.currentTarget;
    const input = formEl.elements.namedItem("files") as HTMLInputElement;
    if (!input.files || input.files.length === 0) {
      setMsg("Select at least one image");
      setImgLoading(false);
      return;
    }

    const fd = new FormData();
    for (const f of Array.from(input.files)) fd.append("files", f);

    const res = await fetch(`/api/admin/properties/${propertyId}/images`, {
      method: "POST",
      body: fd,
    });

    setImgLoading(false);

    if (!res.ok) {
      const text = await res.text().catch(() => "");
      setMsg(`Images upload failed (${res.status}). ${text}`);
      return;
    }

    // –æ–±–Ω–æ–≤–ª—è–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –Ω–æ–≤—ã–µ —Ñ–æ—Ç–æ
    window.location.reload();
  }

  async function uploadPlans(e: React.FormEvent<HTMLFormElement>) {
    e.preventDefault();
    setMsg(null);
    setPdfLoading(true);

    const formEl = e.currentTarget;
    const input = formEl.elements.namedItem("file") as HTMLInputElement;
    const file = input.files?.[0];
    if (!file) {
      setMsg("Select a PDF file");
      setPdfLoading(false);
      return;
    }

    const fd = new FormData();
    fd.append("file", file);

    const res = await fetch(`/api/admin/properties/${propertyId}/plans`, {
      method: "POST",
      body: fd,
    });

    setPdfLoading(false);

    if (!res.ok) {
      const text = await res.text().catch(() => "");
      setMsg(`PDF upload failed (${res.status}). ${text}`);
      return;
    }

    window.location.reload();
  }

  return (
    <div style={{ display: "grid", gap: 18 }}>
      {msg ? (
        <div style={{ padding: 12, border: "1px solid #e2a3a3", borderRadius: 12, background: "#fff5f5" }}>
          {msg}
        </div>
      ) : null}

      <form onSubmit={uploadPlans} style={{ display: "flex", gap: 10, alignItems: "center", flexWrap: "wrap" }}>
        <input name="file" type="file" accept="application/pdf" />
        <button type="submit" disabled={pdfLoading} style={btnPrimary}>
          {pdfLoading ? "Uploading..." : "Upload PDF"}
        </button>
      </form>

      <form onSubmit={uploadImages} style={{ display: "flex", gap: 10, alignItems: "center", flexWrap: "wrap" }}>
        <input name="files" type="file" accept="image/*" multiple />
        <button type="submit" disabled={imgLoading} style={btnPrimary}>
          {imgLoading ? "Uploading..." : "Upload images"}
        </button>
      </form>
    </div>
  );
}

const btnPrimary: React.CSSProperties = {
  padding: "10px 14px",
  borderRadius: 12,
  border: "1px solid #0E5E56",
  background: "#0E5E56",
  color: "#fff",
  fontWeight: 600,
  cursor: "pointer",
};

```

---

## app/admin/properties/[id]/page.tsx

```typescript
// app/admin/properties/[id]/page.tsx
import Link from "next/link";
import { redirect } from "next/navigation";
import { sql } from "drizzle-orm";
import { db } from "@/db";
import UploadForms from "./UploadForms";
import RentFieldsSync from "../RentFieldsSync";

export const dynamic = "force-dynamic";

function toInt(s: string) {
  const v = s.trim();
  if (!v) return null;
  const n = Number.parseInt(v, 10);
  return Number.isFinite(n) ? n : null;
}

function toDecimal(s: string) {
  const v = s.trim().replace(",", ".");
  if (!v) return null;
  const n = Number.parseFloat(v);
  return Number.isFinite(n) ? n : null;
}

function normalizeSlugBase(input: string) {
  return input
    .trim()
    .toLowerCase()
    .replace(/\s+/g, "-")
    .replace(/[^a-z0-9-]/g, "")
    .replace(/-+/g, "-")
    .replace(/^-|-$/g, "")
    .slice(0, 220);
}

function normalizePublicPath(p: unknown) {
  const s = String(p ?? "").trim();
  if (!s) return null;
  return s.startsWith("/") ? s : `/${s}`;
}

function stripPublicIdSuffix(slug: string, publicId: string) {
  const s = String(slug ?? "");
  const pid = String(publicId ?? "").trim().toLowerCase();
  if (!s || !pid) return s;
  const suffix = `-${pid}`;
  return s.toLowerCase().endsWith(suffix) ? s.slice(0, -suffix.length) : s;
}

type PageProps = {
  params: Promise<{ id: string }>;
};

export default async function AdminPropertyEditPage({ params }: PageProps) {
  const resolved = await params;
  const id = Number(resolved.id);
  if (!Number.isFinite(id)) redirect("/admin/properties");

  const propRes = await db.execute(sql`SELECT * FROM properties WHERE id = ${id} LIMIT 1`);
  const prop = (propRes as any).rows?.[0];
  if (!prop) redirect("/admin/properties");

  const imagesRes = await db.execute(sql`
    SELECT id, url, alt, sort_order, is_cover
    FROM property_images
    WHERE property_id = ${id}
    ORDER BY sort_order ASC, id ASC
  `);
  const images = ((imagesRes as any).rows ?? []) as Array<any>;

  const plansHref = normalizePublicPath(prop.plans_url);

  // features list (EN labels)
  const featuresRes = await db.execute(sql`
    SELECT
      f.id,
      f.key,
      COALESCE(ft.label, f.key) AS label
    FROM features f
    LEFT JOIN feature_translations ft
      ON ft.feature_id = f.id AND ft.lang = 'en'
    ORDER BY COALESCE(ft.label, f.key) ASC
  `);
  const features = ((featuresRes as any).rows ?? []) as Array<{ id: number; key: string; label: string }>;

  // selected features
  const selectedRes = await db.execute(sql`
    SELECT feature_id
    FROM property_features
    WHERE property_id = ${id}
  `);
  const selectedRows = ((selectedRes as any).rows ?? []) as Array<{ feature_id: number }>;
  const selectedSet = new Set<number>(selectedRows.map((r) => Number(r.feature_id)));

  async function updateBase(formData: FormData) {
    "use server";

    const publicId = String((prop as any).public_id ?? "").trim();
    const publicIdLower = publicId.toLowerCase();

    // base slug -> —Ñ–∏–Ω–∞–ª—å–Ω—ã–π slug = `${baseSlug}-${publicIdLower}`
    const baseSlugRaw = String(formData.get("baseSlug") || "");
    const baseSlug = normalizeSlugBase(baseSlugRaw);

    if (!publicId || !baseSlug) redirect(`/admin/properties/${id}`);
    const finalSlug = `${baseSlug}-${publicIdLower}`;

    const isPublished = formData.get("isPublished") === "on";

    const price = toDecimal(String(formData.get("price") || ""));
    const currency =
      String(formData.get("currency") || "EUR")
        .trim()
        .toUpperCase()
        .slice(0, 3) || "EUR";

    const location = String(formData.get("location") || "").trim() || null;

    const dealTypeRaw = String(formData.get("dealType") || "sale").trim().toLowerCase();
    const dealType = dealTypeRaw === "rent" ? "rent" : "sale";

    const rentTypeRaw = String(formData.get("rentType") || "").trim().toLowerCase();
    const rentType = ["long_term", "short_term", "holiday"].includes(rentTypeRaw) ? rentTypeRaw : null;

    const rentPeriodRaw = String(formData.get("rentPeriod") || "").trim().toLowerCase();
    const rentPeriod = ["month", "week", "day"].includes(rentPeriodRaw) ? rentPeriodRaw : null;

    const rentPrice = toDecimal(String(formData.get("rentPrice") || ""));

    const finalRentType = dealType === "rent" ? rentType : null;
    const finalRentPeriod = dealType === "rent" ? rentPeriod : null;
    const finalRentPrice = dealType === "rent" ? rentPrice : null;

    if (dealType === "rent") {
      if (!finalRentType || finalRentPrice === null) {
        redirect(`/admin/properties/${id}`);
      }
    }

    const propertyTypeRaw = String(formData.get("propertyType") || "").trim().toLowerCase();
    const propertyType = propertyTypeRaw || null;

    const conditionRaw = String(formData.get("condition") || "").trim().toLowerCase();
    const condition = conditionRaw || null;

    const statusRaw = String(formData.get("status") || "available").trim().toLowerCase();
    const status = ["available", "reserved", "sold"].includes(statusRaw) ? statusRaw : "available";

    const floor = toInt(String(formData.get("floor") || ""));
    const totalFloors = toInt(String(formData.get("totalFloors") || ""));

    const descriptionEn = String(formData.get("descriptionEn") || "").trim() || null;
    const descriptionEs = String(formData.get("descriptionEs") || "").trim() || null;

    const bedrooms = toInt(String(formData.get("bedrooms") || ""));
    const bathrooms = toInt(String(formData.get("bathrooms") || ""));

    const plotArea = toDecimal(String(formData.get("plotAreaM2") || ""));
    const builtArea = toDecimal(String(formData.get("builtAreaM2") || ""));
    const terraceArea = toDecimal(String(formData.get("terraceAreaM2") || ""));

    const rawFeatureIds = formData.getAll("features");
    const featureIds = rawFeatureIds
      .map((v) => Number(String(v)))
      .filter((n) => Number.isFinite(n)) as number[];

    try {
      // ‚úÖ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è: –±–∞–∑–∞ + amenities —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è –∞—Ç–æ–º–∞—Ä–Ω–æ
      await db.execute(sql`BEGIN`);

      await db.execute(sql`
        UPDATE properties
        SET
          slug = ${finalSlug},
          is_published = ${isPublished},
          price = ${price},
          currency = ${currency},
          deal_type = ${dealType},
          rent_type = ${finalRentType},
          rent_price = ${finalRentPrice},
          rent_period = ${finalRentPeriod},
          property_type = ${propertyType},
          condition = ${condition},
          status = ${status},
          floor = ${floor},
          total_floors = ${totalFloors},
          location = ${location},
          description_en = ${descriptionEn},
          description_es = ${descriptionEs},
          bedrooms = ${bedrooms},
          bathrooms = ${bathrooms},
          plot_area_m2 = ${plotArea},
          built_area_m2 = ${builtArea},
          terrace_area_m2 = ${terraceArea},
          updated_at = NOW()
        WHERE id = ${id}
      `);

      await db.execute(sql`
        DELETE FROM property_features
        WHERE property_id = ${id}
      `);

      if (featureIds.length > 0) {
        const valuesSql = sql.join(
          featureIds.map((fid) => sql`(${id}, ${fid})`),
          sql`, `
        );

        await db.execute(sql`
          INSERT INTO property_features (property_id, feature_id)
          VALUES ${valuesSql}
          ON CONFLICT DO NOTHING
        `);
      }

      await db.execute(sql`COMMIT`);
    } catch (e) {
      try {
        await db.execute(sql`ROLLBACK`);
      } catch {
        // ignore rollback errors
      }
      console.error("UPDATE PROPERTY ERROR:", e);
      redirect(`/admin/properties/${id}`);
    }

    redirect(`/admin/properties/${id}`);
  }

  const baseSlugDefault = stripPublicIdSuffix(String(prop.slug ?? ""), String(prop.public_id ?? ""));

  return (
    <main style={{ padding: 18 }}>
      <div
        style={{
          display: "flex",
          justifyContent: "space-between",
          alignItems: "center",
          gap: 12,
          flexWrap: "wrap",
        }}
      >
        <h1 style={{ margin: 0 }}>Edit property #{id}</h1>

        <div style={{ display: "flex", gap: 10, flexWrap: "wrap" }}>
          <Link href="/admin/properties" style={btnGhost}>
            ‚Üê Back
          </Link>
          <a href={`/properties/${prop.slug ?? ""}`} style={btnGhost} target="_blank" rel="noreferrer">
            Public page
          </a>
        </div>
      </div>

      {/* Base fields + Amenities */}
      <section style={card}>
        <form action={updateBase}>
          <RentFieldsSync />

          <div style={grid2}>
            <Field label="Public ID">
              <input value={prop.public_id ?? ""} readOnly style={{ ...input, background: "#f6f6f6" }} />
            </Field>

            <Field label="Base slug">
              <input name="baseSlug" defaultValue={baseSlugDefault} style={input} />
            </Field>
          </div>

          <div style={grid3}>
            <Field label="Deal type">
              <select name="dealType" id="dealType" defaultValue={prop.deal_type ?? "sale"} style={input}>
                <option value="sale">Sale</option>
                <option value="rent">Rent</option>
              </select>
            </Field>

            <Field label="Status">
              <select name="status" defaultValue={prop.status ?? "available"} style={input}>
                <option value="available">Available</option>
                <option value="reserved">Reserved</option>
                <option value="sold">Sold</option>
              </select>
            </Field>

            <Field label="Currency">
              <input name="currency" defaultValue={prop.currency ?? "EUR"} style={input} />
            </Field>
          </div>

          <div style={grid3}>
            <Field label="Property type">
              <select name="propertyType" defaultValue={prop.property_type ?? ""} style={input}>
                <option value="">‚Äî</option>
                <option value="villa">Villa</option>
                <option value="house">House</option>
                <option value="townhouse">Townhouse</option>
                <option value="apartment">Apartment</option>
                <option value="penthouse">Penthouse</option>
                <option value="duplex">Duplex</option>
                <option value="studio">Studio</option>
                <option value="plot">Plot</option>
              </select>
            </Field>

            <Field label="Condition">
              <select name="condition" defaultValue={prop.condition ?? ""} style={input}>
                <option value="">‚Äî</option>
                <option value="new_build">New build</option>
                <option value="resale">Resale</option>
              </select>
            </Field>

            <Field label="Floor / Total floors">
              <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 10 }}>
                <input name="floor" defaultValue={prop.floor ?? ""} style={input} placeholder="Floor" />
                <input name="totalFloors" defaultValue={prop.total_floors ?? ""} style={input} placeholder="Total" />
              </div>
            </Field>
          </div>

          <div style={grid3}>
            <Field label="Price">
              <input name="price" defaultValue={prop.price ?? ""} style={input} />
            </Field>
            <Field label="Bedrooms">
              <input name="bedrooms" defaultValue={prop.bedrooms ?? ""} style={input} />
            </Field>
            <Field label="Bathrooms">
              <input name="bathrooms" defaultValue={prop.bathrooms ?? ""} style={input} />
            </Field>
          </div>

          {/* RENT fields (visible only when Deal type = Rent) */}
          <div
            id="rentFields"
            style={{
              marginTop: 12,
              padding: 14,
              borderRadius: 14,
              border: "1px dashed #E2E2DE",
              background: "#fafafa",
              display: "none", // ‚úÖ —á—Ç–æ–±—ã –Ω–µ –º–∏–≥–∞–ª–æ
            }}
          >
            <div style={{ fontWeight: 700, marginBottom: 10 }}>Rent details</div>

            <div style={grid3}>
              <Field label="Rent type">
                <select name="rentType" data-rent-input defaultValue={prop.rent_type ?? ""} style={input}>
                  <option value="">‚Äî</option>
                  <option value="long_term">Long-term</option>
                  <option value="short_term">Short-term</option>
                  <option value="holiday">Holiday</option>
                </select>
              </Field>

              <Field label="Rent price">
                <input name="rentPrice" data-rent-input defaultValue={prop.rent_price ?? ""} style={input} />
              </Field>

              <Field label="Rent period">
                <select name="rentPeriod" data-rent-input defaultValue={prop.rent_period ?? ""} style={input}>
                  <option value="">‚Äî</option>
                  <option value="month">/ month</option>
                  <option value="week">/ week</option>
                  <option value="day">/ day</option>
                </select>
              </Field>
            </div>

            <div style={{ marginTop: 10, fontSize: 12, opacity: 0.7 }}>
              These fields are required for Rent objects (type + price).
            </div>
          </div>

          <Field label="Location">
            <input name="location" defaultValue={prop.location ?? ""} style={input} />
          </Field>

          <Field label="Description (EN)">
            <textarea
              name="descriptionEn"
              defaultValue={prop.description_en ?? ""}
              rows={6}
              style={textarea}
              placeholder="Short description in English..."
            />
          </Field>

          <Field label="Description (ES)">
            <textarea
              name="descriptionEs"
              defaultValue={prop.description_es ?? ""}
              rows={6}
              style={textarea}
              placeholder="Descripci√≥n en espa√±ol..."
            />
          </Field>

          <div style={grid3}>
            <Field label="Plot area (m¬≤)">
              <input name="plotAreaM2" defaultValue={prop.plot_area_m2 ?? ""} style={input} />
            </Field>
            <Field label="Built area (m¬≤)">
              <input name="builtAreaM2" defaultValue={prop.built_area_m2 ?? ""} style={input} />
            </Field>
            <Field label="Terrace area (m¬≤)">
              <input name="terraceAreaM2" defaultValue={prop.terrace_area_m2 ?? ""} style={input} />
            </Field>
          </div>

          {/* Amenities */}
          <div style={{ marginTop: 10, borderTop: "1px solid #E2E2DE", paddingTop: 12 }}>
            <div style={{ fontWeight: 700, marginBottom: 8 }}>Amenities</div>

            {features.length === 0 ? (
              <div style={{ opacity: 0.7 }}>No features found. (Seed features first.)</div>
            ) : (
              <div style={amenitiesGrid}>
                {features.map((f) => {
                  const checked = selectedSet.has(Number(f.id));
                  return (
                    <label key={f.id} style={amenityItem}>
                      <input type="checkbox" name="features" value={String(f.id)} defaultChecked={checked} />
                      <span style={{ marginLeft: 8 }}>{f.label}</span>
                    </label>
                  );
                })}
              </div>
            )}
          </div>

          <div style={{ marginTop: 10, display: "flex", alignItems: "center", gap: 10 }}>
            <input id="isPublished" name="isPublished" type="checkbox" defaultChecked={!!prop.is_published} />
            <label htmlFor="isPublished">Published</label>
          </div>

          <div style={{ marginTop: 14 }}>
            <button type="submit" style={btnPrimaryFill}>
              Save changes
            </button>
          </div>
        </form>
      </section>

      {/* Plans PDF */}
      <section style={card}>
        <h2 style={h2}>Plans (PDF)</h2>

        {plansHref ? (
          <div style={{ marginTop: 8, display: "flex", alignItems: "center", gap: 10, flexWrap: "wrap" }}>
            <span>
              Current:{" "}
              <a href={plansHref} target="_blank" rel="noreferrer">
                {plansHref}
              </a>
            </span>

            <form action={`/api/admin/properties/${id}/plans`} method="post">
              <input type="hidden" name="_method" value="delete" />
              <button type="submit" style={btnDanger}>
                Delete PDF
              </button>
            </form>
          </div>
        ) : (
          <p style={{ marginTop: 8, opacity: 0.7 }}>No plans uploaded yet.</p>
        )}

        <div style={{ marginTop: 12 }}>
          <UploadForms propertyId={id} />
        </div>
      </section>

      {/* Images preview */}
      <section style={card}>
        <h2 style={h2}>Images</h2>

        {images.length === 0 ? (
          <p style={{ marginTop: 12, opacity: 0.7 }}>No images yet.</p>
        ) : (
          <div
            style={{
              marginTop: 14,
              display: "grid",
              gridTemplateColumns: "repeat(auto-fill, minmax(200px, 1fr))",
              gap: 12,
            }}
          >
            {images.map((img, idx) => {
              const isFirst = idx === 0;
              const isLast = idx === images.length - 1;

              return (
                <div key={img.id} style={{ border: "1px solid #E2E2DE", borderRadius: 14, overflow: "hidden" }}>
                  <img src={img.url} alt={img.alt ?? ""} style={{ width: "100%", height: 150, objectFit: "cover" }} />

                  <div style={{ padding: 10, fontSize: 13 }}>
                    <div style={{ display: "flex", justifyContent: "space-between", gap: 10, alignItems: "center" }}>
                      <span style={{ opacity: 0.75 }}>#{img.sort_order}</span>
                      {img.is_cover ? <strong>Cover</strong> : <span style={{ opacity: 0.5 }}>‚Äî</span>}
                    </div>

                    <div style={{ marginTop: 6, opacity: 0.7, wordBreak: "break-all" }}>{img.url}</div>

                    <div style={{ marginTop: 10, display: "flex", gap: 8, flexWrap: "wrap" }}>
                      <form action={`/api/admin/properties/${id}/images`} method="post">
                        <input type="hidden" name="_method" value="setCover" />
                        <input type="hidden" name="imageId" value={String(img.id)} />
                        <button type="submit" style={btnMini} disabled={!!img.is_cover}>
                          {img.is_cover ? "Cover" : "Set cover"}
                        </button>
                      </form>

                      <form action={`/api/admin/properties/${id}/images`} method="post">
                        <input type="hidden" name="_method" value="move" />
                        <input type="hidden" name="dir" value="up" />
                        <input type="hidden" name="imageId" value={String(img.id)} />
                        <button type="submit" style={btnMini} disabled={isFirst}>
                          ‚Üë Up
                        </button>
                      </form>

                      <form action={`/api/admin/properties/${id}/images`} method="post">
                        <input type="hidden" name="_method" value="move" />
                        <input type="hidden" name="dir" value="down" />
                        <input type="hidden" name="imageId" value={String(img.id)} />
                        <button type="submit" style={btnMini} disabled={isLast}>
                          ‚Üì Down
                        </button>
                      </form>

                      <form action={`/api/admin/properties/${id}/images`} method="post">
                        <input type="hidden" name="_method" value="delete" />
                        <input type="hidden" name="imageId" value={String(img.id)} />
                        <button type="submit" style={btnMiniDanger}>
                          Delete
                        </button>

                      </form>
                    </div>
                  </div>
                </div>
              );
            })}
          </div>
        )}
      </section>
    </main>
  );
}

function Field({ label, children }: { label: string; children: React.ReactNode }) {
  return (
    <div style={{ marginBottom: 12 }}>
      <label style={{ fontWeight: 600, display: "block", marginBottom: 6 }}>{label}</label>
      {children}
    </div>
  );
}

const card: React.CSSProperties = {
  marginTop: 18,
  border: "1px solid #E2E2DE",
  borderRadius: 16,
  padding: 16,
  background: "#fff",
};

const h2: React.CSSProperties = { fontSize: 18, margin: 0 };
const input: React.CSSProperties = { width: "100%", padding: 12, borderRadius: 12, border: "1px solid #E2E2DE" };
const grid2: React.CSSProperties = { display: "grid", gridTemplateColumns: "1fr 1fr", gap: 14 };
const grid3: React.CSSProperties = { display: "grid", gridTemplateColumns: "1fr 1fr 1fr", gap: 14 };

const amenitiesGrid: React.CSSProperties = {
  display: "grid",
  gridTemplateColumns: "repeat(auto-fill, minmax(220px, 1fr))",
  gap: 10,
};

const amenityItem: React.CSSProperties = {
  display: "flex",
  alignItems: "center",
  gap: 8,
  padding: "10px 12px",
  borderRadius: 12,
  border: "1px solid #E2E2DE",
  background: "#fafafa",
};

const btnGhost: React.CSSProperties = {
  padding: "10px 14px",
  borderRadius: 12,
  border: "1px solid #E2E2DE",
  textDecoration: "none",
  color: "inherit",
};

const btnPrimaryFill: React.CSSProperties = {
  padding: "10px 14px",
  borderRadius: 12,
  border: "1px solid #0E5E56",
  background: "#0E5E56",
  color: "#fff",
  fontWeight: 600,
  cursor: "pointer",
};

const btnDanger: React.CSSProperties = {
  padding: "10px 14px",
  borderRadius: 12,
  border: "1px solid #d95555",
  background: "#d95555",
  color: "#fff",
  fontWeight: 600,
  cursor: "pointer",
};

const btnMini: React.CSSProperties = {
  padding: "8px 10px",
  borderRadius: 10,
  border: "1px solid #E2E2DE",
  background: "#fff",
  cursor: "pointer",
  fontWeight: 600,
};

const btnMiniDanger: React.CSSProperties = {
  padding: "8px 10px",
  borderRadius: 10,
  border: "1px solid #d95555",
  background: "#fff5f5",
  cursor: "pointer",
  fontWeight: 600,
  color: "#a11d1d",
};

const textarea: React.CSSProperties = {
  width: "100%",
  padding: 12,
  borderRadius: 12,
  border: "1px solid #E2E2DE",
  resize: "vertical",
  minHeight: 120,
};

```

---

## app/admin/properties/new/page.tsx

```typescript
import Link from "next/link";
import { redirect } from "next/navigation";
import { sql } from "drizzle-orm";
import { db } from "@/db";
import RentFieldsSync from "../RentFieldsSync";

export const dynamic = "force-dynamic";

function toInt(v: FormDataEntryValue | null) {
  if (v === null) return null;
  const s = String(v).trim();
  if (!s) return null;
  const n = Number.parseInt(s, 10);
  return Number.isFinite(n) ? n : null;
}

function toDecimal(v: FormDataEntryValue | null) {
  if (v === null) return null;
  const s = String(v).trim().replace(",", ".");
  if (!s) return null;
  const n = Number.parseFloat(s);
  return Number.isFinite(n) ? n : null;
}

function normalizeSlugBase(input: string) {
  return input
    .trim()
    .toLowerCase()
    .replace(/\s+/g, "-")
    .replace(/[^a-z0-9-]/g, "")
    .replace(/-+/g, "-")
    .replace(/^-|-$/g, "")
    .slice(0, 220);
}

export default async function AdminPropertyNewPage() {
  // ‚úÖ features –¥–ª—è —á–µ–∫–±–æ–∫—Å–æ–≤ (EN labels, –∞–¥–º–∏–Ω–∫–∞ –±–µ–∑ i18n)
  const featuresRes = await db.execute(sql`
    SELECT
      f.id,
      f.key,
      COALESCE(ft.label, f.key) AS label
    FROM features f
    LEFT JOIN feature_translations ft
      ON ft.feature_id = f.id AND ft.lang = 'en'
    ORDER BY COALESCE(ft.label, f.key) ASC
  `);
  const features = ((featuresRes as any).rows ?? []) as Array<{
    id: number;
    key: string;
    label: string;
  }>;

  async function create(formData: FormData) {
    "use server";

    const slugRaw = String(formData.get("slug") || "");
    const baseSlug = normalizeSlugBase(slugRaw);

    if (!baseSlug) redirect("/admin/properties/new");

    // nonce —á—Ç–æ–±—ã temp –∑–Ω–∞—á–µ–Ω–∏—è –±—ã–ª–∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ –¥–∞–∂–µ –ø—Ä–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö
    const nonce = `${Date.now()}-${Math.random().toString(16).slice(2, 10)}`;

    // –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (–ø—Ä–æ—Ö–æ–¥–∏–º NOT NULL + unique)
    const tempSlug = `${baseSlug}-${nonce}`;
    const tempPublicId = `TMP-${Math.random().toString(36).slice(2, 10).toUpperCase()}`; // 12 chars –ø—Ä–∏–º–µ—Ä–Ω–æ

    const isPublished = formData.get("isPublished") === "on";

    const price = toDecimal(formData.get("price"));
    const currency =
      String(formData.get("currency") || "EUR").trim().toUpperCase().slice(0, 3) || "EUR";

    const location = String(formData.get("location") || "").trim() || null;

    const bedrooms = toInt(formData.get("bedrooms"));
    const bathrooms = toInt(formData.get("bathrooms"));

    const plotAreaM2 = toInt(formData.get("plotAreaM2"));
    const builtAreaM2 = toInt(formData.get("builtAreaM2"));
    const terraceAreaM2 = toInt(formData.get("terraceAreaM2"));

    const descriptionEn = String(formData.get("descriptionEn") || "").trim() || null;
    const descriptionEs = String(formData.get("descriptionEs") || "").trim() || null;

    const plansUrl = String(formData.get("plansUrl") || "").trim() || null;

    // ‚úÖ NEW: deal/property/condition/status + floors
    const dealTypeRaw = String(formData.get("dealType") || "sale").trim().toLowerCase();
    const dealType = dealTypeRaw === "rent" ? "rent" : "sale";

    const propertyTypeRaw = String(formData.get("propertyType") || "").trim().toLowerCase();
    const propertyType = propertyTypeRaw || null;

    const conditionRaw = String(formData.get("condition") || "").trim().toLowerCase();
    const condition = conditionRaw || null;

    const statusRaw = String(formData.get("status") || "available").trim().toLowerCase();
    const status = ["available", "reserved", "sold"].includes(statusRaw) ? statusRaw : "available";

    const floor = toInt(formData.get("floor"));
    const totalFloors = toInt(formData.get("totalFloors"));

    // ‚úÖ RENT fields
    const rentTypeRaw = String(formData.get("rentType") || "").trim().toLowerCase();
    const rentType = ["long_term", "short_term", "holiday"].includes(rentTypeRaw) ? rentTypeRaw : null;

    const rentPeriodRaw = String(formData.get("rentPeriod") || "").trim().toLowerCase();
    const rentPeriod = ["month", "week", "day"].includes(rentPeriodRaw) ? rentPeriodRaw : null;

    const rentPrice = toDecimal(formData.get("rentPrice"));

    const finalRentType = dealType === "rent" ? rentType : null;
    const finalRentPeriod = dealType === "rent" ? rentPeriod : null;
    const finalRentPrice = dealType === "rent" ? rentPrice : null;

    // ‚úÖ —Å–µ—Ä–≤–µ—Ä–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è: –¥–ª—è rent ‚Äî —Ç–∏–ø –∏ —Ü–µ–Ω–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã
    if (dealType === "rent") {
      if (!finalRentType || finalRentPrice === null) {
        redirect("/admin/properties/new");
      }
    }

    // ‚úÖ Amenities (features) –∏–∑ —á–µ–∫–±–æ–∫—Å–æ–≤
    const rawFeatureIds = formData.getAll("features");
    const featureIds = rawFeatureIds
      .map((v) => Number(String(v)))
      .filter((n) => Number.isFinite(n)) as number[];

    try {
      // ‚úÖ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è: –ª–∏–±–æ –≤—Å—ë, –ª–∏–±–æ –Ω–∏—á–µ–≥–æ
      await db.execute(sql`BEGIN`);

      // 1) INSERT (—Å temp slug/public_id)
      const inserted = await db.execute(sql`
        INSERT INTO properties
          (
            slug,
            public_id,
            is_published,
            price,
            currency,
            bedrooms,
            bathrooms,
            location,
            description_en,
            description_es,
            plot_area_m2,
            built_area_m2,
            terrace_area_m2,
            plans_url,
            deal_type,
            property_type,
            condition,
            status,
            floor,
            total_floors,
            rent_type,
            rent_price,
            rent_period
          )
        VALUES
          (
            ${tempSlug},
            ${tempPublicId},
            ${isPublished},
            ${price},
            ${currency},
            ${bedrooms},
            ${bathrooms},
            ${location},
            ${descriptionEn},
            ${descriptionEs},
            ${plotAreaM2},
            ${builtAreaM2},
            ${terraceAreaM2},
            ${plansUrl},
            ${dealType},
            ${propertyType},
            ${condition},
            ${status},
            ${floor},
            ${totalFloors},
            ${finalRentType},
            ${finalRentPrice},
            ${finalRentPeriod}
          )
        RETURNING id
      `);

      const newId = Number((inserted as any).rows?.[0]?.id);
      if (!Number.isFinite(newId)) {
        await db.execute(sql`ROLLBACK`);
        redirect("/admin/properties/new");
      }

      // 2) —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
      const publicId = `GE-${String(newId).padStart(6, "0")}`;
      const finalSlug = `${baseSlug}-${publicId.toLowerCase()}`;

      await db.execute(sql`
        UPDATE properties
        SET
          public_id = ${publicId},
          slug = ${finalSlug},
          updated_at = NOW()
        WHERE id = ${newId}
      `);

      // 3) amenities
      if (featureIds.length > 0) {
        const valuesSql = sql.join(
          featureIds.map((fid) => sql`(${newId}, ${fid})`),
          sql`, `
        );

        await db.execute(sql`
          INSERT INTO property_features (property_id, feature_id)
          VALUES ${valuesSql}
          ON CONFLICT DO NOTHING
        `);
      }

      await db.execute(sql`COMMIT`);
    } catch (e) {
      try {
        await db.execute(sql`ROLLBACK`);
      } catch {
        // ignore rollback errors
      }
      console.error("CREATE PROPERTY ERROR:", e);
      redirect("/admin/properties/new");
    }

    redirect("/admin/properties");
  }

  return (
    <main style={{ maxWidth: 900, margin: "60px auto", padding: 16 }}>
      <header style={{ display: "flex", alignItems: "center", justifyContent: "space-between", gap: 12 }}>
        <div>
          <h1 style={{ fontSize: 34, margin: 0 }}>Create property</h1>
          <p style={{ marginTop: 8, opacity: 0.75 }}>
            –ó–∞–ø–æ–ª–Ω–∏ —Ç–æ–ª—å–∫–æ —Ç–æ, —á—Ç–æ –∏–∑–≤–µ—Å—Ç–Ω–æ. –ü—É—Å—Ç—ã–µ –ø–æ–ª—è –Ω–µ –±—É–¥—É—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å—Å—è –Ω–∞ —Å–∞–π—Ç–µ.
          </p>
        </div>

        <Link
          href="/admin/properties"
          style={{
            padding: "10px 14px",
            borderRadius: 12,
            border: "1px solid #E2E2DE",
            textDecoration: "none",
            color: "inherit",
          }}
        >
          ‚Üê Back to list
        </Link>
      </header>

      <form action={create} style={{ marginTop: 18 }}>
        <RentFieldsSync />

        <div
          style={{
            border: "1px solid #E2E2DE",
            borderRadius: 16,
            background: "#fff",
            padding: 18,
          }}
        >
          <Field label="Slug (required)" hint="URL id, –Ω–∞–ø—Ä–∏–º–µ—Ä: modern-villa-marbella">
            <input name="slug" required placeholder="modern-villa-marbella" style={inputStyle} />
          </Field>

          <h2 style={{ fontSize: 18, marginTop: 18, marginBottom: 10 }}>Basics</h2>

          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 14 }}>
            <Field label="Deal type">
              <select name="dealType" id="dealType" defaultValue="sale" style={inputStyle}>
                <option value="sale">Sale</option>
                <option value="rent">Rent</option>
              </select>
            </Field>

            <Field label="Status">
              <select name="status" defaultValue="available" style={inputStyle}>
                <option value="available">Available</option>
                <option value="reserved">Reserved</option>
                <option value="sold">Sold</option>
              </select>
            </Field>
          </div>

          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 14 }}>
            <Field label="Property type">
              <select name="propertyType" defaultValue="" style={inputStyle}>
                <option value="">‚Äî</option>
                <option value="villa">Villa</option>
                <option value="house">House</option>
                <option value="townhouse">Townhouse</option>
                <option value="apartment">Apartment</option>
                <option value="penthouse">Penthouse</option>
                <option value="duplex">Duplex</option>
                <option value="studio">Studio</option>
                <option value="plot">Plot</option>
              </select>
            </Field>

            <Field label="Condition">
              <select name="condition" defaultValue="" style={inputStyle}>
                <option value="">‚Äî</option>
                <option value="new_build">New build</option>
                <option value="resale">Resale</option>
              </select>
            </Field>
          </div>

          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 14 }}>
            <Field label="Floor">
              <input name="floor" inputMode="numeric" placeholder="2" style={inputStyle} />
            </Field>

            <Field label="Total floors">
              <input name="totalFloors" inputMode="numeric" placeholder="6" style={inputStyle} />
            </Field>
          </div>

          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 14 }}>
            <Field label="Price" hint="–Ω–∞–ø—Ä–∏–º–µ—Ä: 350000">
              <input name="price" inputMode="decimal" placeholder="350000" style={inputStyle} />
            </Field>

            <Field label="Currency" hint="EUR / USD ...">
              <input name="currency" defaultValue="EUR" style={inputStyle} />
            </Field>
          </div>

          {/* RENT fields (visible only when Deal type = Rent) */}
          <div
            id="rentFields"
            style={{
              marginTop: 12,
              padding: 14,
              borderRadius: 14,
              border: "1px dashed #E2E2DE",
              background: "#fafafa",
              display: "none", // ‚úÖ —á—Ç–æ–±—ã –Ω–µ –º–∏–≥–∞–ª–æ
            }}
          >
            <div style={{ fontWeight: 700, marginBottom: 10 }}>Rent details</div>

            <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr 1fr", gap: 14 }}>
              <Field label="Rent type">
                <select name="rentType" data-rent-input defaultValue="" style={inputStyle}>
                  <option value="">‚Äî</option>
                  <option value="long_term">Long-term</option>
                  <option value="short_term">Short-term</option>
                  <option value="holiday">Holiday</option>
                </select>
              </Field>

              <Field label="Rent price" hint="–Ω–∞–ø—Ä–∏–º–µ—Ä: 2000">
                <input name="rentPrice" data-rent-input inputMode="decimal" placeholder="2000" style={inputStyle} />
              </Field>

              <Field label="Rent period">
                <select name="rentPeriod" data-rent-input defaultValue="" style={inputStyle}>
                  <option value="">‚Äî</option>
                  <option value="month">/ month</option>
                  <option value="week">/ week</option>
                  <option value="day">/ day</option>
                </select>
              </Field>
            </div>

            <div style={{ marginTop: 10, fontSize: 12, opacity: 0.7 }}>
              These fields are required for Rent objects (type + price).
            </div>
          </div>

          <Field label="Location" hint="–Ω–∞–ø—Ä–∏–º–µ—Ä: Marbella, Nueva Andaluc√≠a">
            <input name="location" placeholder="Marbella" style={inputStyle} />
          </Field>

          <Field label="Description (EN)" hint="–ö–æ—Ä–æ—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º">
            <textarea name="descriptionEn" rows={6} placeholder="Short description in English..." style={textarea} />
          </Field>

          <Field label="Description (ES)" hint="Descripci√≥n en espa√±ol">
            <textarea name="descriptionEs" rows={6} placeholder="Descripci√≥n en espa√±ol..." style={textarea} />
          </Field>

          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 14 }}>
            <Field label="Bedrooms">
              <input name="bedrooms" inputMode="numeric" placeholder="3" style={inputStyle} />
            </Field>

            <Field label="Bathrooms">
              <input name="bathrooms" inputMode="numeric" placeholder="2" style={inputStyle} />
            </Field>
          </div>

          <h2 style={{ fontSize: 18, marginTop: 18, marginBottom: 10 }}>Areas (m¬≤)</h2>

          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr 1fr", gap: 14 }}>
            <Field label="Plot area" hint="—É—á–∞—Å—Ç–æ–∫ (–¥–ª—è –¥–æ–º–∞/–≤–∏–ª–ª—ã)">
              <input name="plotAreaM2" inputMode="numeric" placeholder="450" style={inputStyle} />
            </Field>

            <Field label="Built area" hint="–ø–ª–æ—â–∞–¥—å –∑–∞—Å—Ç—Ä–æ–π–∫–∏">
              <input name="builtAreaM2" inputMode="numeric" placeholder="120" style={inputStyle} />
            </Field>

            <Field label="Terrace area" hint="—Ç–µ—Ä—Ä–∞—Å—ã">
              <input name="terraceAreaM2" inputMode="numeric" placeholder="30" style={inputStyle} />
            </Field>
          </div>

          <h2 style={{ fontSize: 18, marginTop: 18, marginBottom: 10 }}>Amenities</h2>

          {features.length === 0 ? (
            <p style={{ marginTop: 6, opacity: 0.7 }}>No features found. (Seed features first.)</p>
          ) : (
            <div style={amenitiesGrid}>
              {features.map((f) => (
                <label key={f.id} style={amenityItem}>
                  <input type="checkbox" name="features" value={String(f.id)} />
                  <span style={{ marginLeft: 8 }}>{f.label}</span>
                </label>
              ))}
            </div>
          )}

          <h2 style={{ fontSize: 18, marginTop: 18, marginBottom: 10 }}>Plans</h2>

          <Field label="Plans URL / Path" hint="–ø–æ–∫–∞ —Å—Å—ã–ª–∫–∞, –ø–æ–∑–∂–µ —Å–¥–µ–ª–∞–µ–º upload PDF">
            <input name="plansUrl" placeholder="/uploads/plans/..." style={inputStyle} />
          </Field>

          <div style={{ marginTop: 14, display: "flex", alignItems: "center", gap: 10 }}>
            <input id="isPublished" name="isPublished" type="checkbox" />
            <label htmlFor="isPublished" style={{ userSelect: "none" }}>
              Published
            </label>
          </div>

          <div style={{ marginTop: 18, display: "flex", gap: 10 }}>
            <button
              type="submit"
              style={{
                padding: "10px 14px",
                borderRadius: 12,
                border: "1px solid #0E5E56",
                background: "#0E5E56",
                color: "#fff",
                fontWeight: 600,
                cursor: "pointer",
              }}
            >
              Save
            </button>

            <Link
              href="/admin/properties"
              style={{
                padding: "10px 14px",
                borderRadius: 12,
                border: "1px solid #E2E2DE",
                textDecoration: "none",
                color: "inherit",
              }}
            >
              Cancel
            </Link>
          </div>

          <p style={{ marginTop: 14, opacity: 0.65, fontSize: 13 }}>
            –ï—Å–ª–∏ slug —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç ‚Äî —Ñ–æ—Ä–º–∞ –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –∑–∞–Ω–æ–≤–æ (–ø–æ–∑–∂–µ –¥–æ–±–∞–≤–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ).
          </p>
        </div>

      </form>
    </main>
  );
}

function Field({
  label,
  hint,
  children,
}: {
  label: string;
  hint?: string;
  children: React.ReactNode;
}) {
  return (
    <div style={{ marginBottom: 14 }}>
      <div style={{ display: "flex", alignItems: "baseline", justifyContent: "space-between", gap: 10 }}>
        <label style={{ fontWeight: 600 }}>{label}</label>
        {hint ? <span style={{ fontSize: 12, opacity: 0.6 }}>{hint}</span> : null}
      </div>
      <div style={{ marginTop: 6 }}>{children}</div>
    </div>
  );
}

const inputStyle: React.CSSProperties = {
  width: "100%",
  padding: 12,
  borderRadius: 12,
  border: "1px solid #E2E2DE",
};

const textarea: React.CSSProperties = {
  width: "100%",
  padding: 12,
  borderRadius: 12,
  border: "1px solid #E2E2DE",
  resize: "vertical",
  minHeight: 120,
};

const amenitiesGrid: React.CSSProperties = {
  display: "grid",
  gridTemplateColumns: "repeat(auto-fill, minmax(220px, 1fr))",
  gap: 10,
};

const amenityItem: React.CSSProperties = {
  display: "flex",
  alignItems: "center",
  gap: 8,
  padding: "10px 12px",
  borderRadius: 12,
  border: "1px solid #E2E2DE",
  background: "#fafafa",
};

```

---

## app/admin/properties/page.tsx

```typescript
import Link from "next/link";
import { sql } from "drizzle-orm";
import { db } from "@/db";

export const dynamic = "force-dynamic";

type PropertyRow = {
  id: number;
  slug: string;
  is_published: boolean;
  price: string | null;
  currency: string;
  location: string | null;
  created_at: string;
};

export default async function AdminPropertiesPage() {
  const result = await db.execute(sql`
    SELECT id, slug, is_published, price, currency, location, created_at
    FROM properties
    ORDER BY id DESC
    LIMIT 200
  `);

  const rows = (result as any).rows as PropertyRow[];

  return (
    <main style={{ maxWidth: 1100, margin: "60px auto", padding: 16 }}>
      <header style={{ display: "flex", alignItems: "center", justifyContent: "space-between", gap: 12 }}>
        <div>
          <h1 style={{ fontSize: 34, margin: 0 }}>Properties</h1>
          <p style={{ marginTop: 8, opacity: 0.75 }}>
            {rows.length} item(s)
          </p>
        </div>

        <div style={{ display: "flex", gap: 10 }}>
          <Link href="/admin" style={btnGhost}>‚Üê Admin</Link>
          <Link href="/admin/properties/new" style={btnPrimary}>+ Create</Link>
        </div>
      </header>

      <section style={card}>
        {rows.length === 0 ? (
          <div style={{ padding: 18 }}>
            <p style={{ margin: 0 }}>No properties yet.</p>
          </div>
        ) : (
          <div style={{ overflowX: "auto" }}>
            <table style={{ width: "100%", borderCollapse: "collapse" }}>
              <thead>
                <tr>
                  {["ID", "Slug", "Status", "Price", "Location", "Created", "Actions"].map((h) => (
                    <th key={h} style={th}>{h}</th>
                  ))}
                </tr>
              </thead>
              <tbody>
                {rows.map((p) => (
                  <tr key={p.id}>
                    <td style={td}>{p.id}</td>
                    <td style={td}><code>{p.slug}</code></td>
                    <td style={td}>{p.is_published ? "Published" : "Draft"}</td>
                    <td style={td}>
                      {p.price ? `${p.price} ${p.currency}` : <span style={{ opacity: 0.5 }}>‚Äî</span>}
                    </td>
                    <td style={td}>{p.location ?? <span style={{ opacity: 0.5 }}>‚Äî</span>}</td>
                    <td style={td}>{new Date(p.created_at).toLocaleString()}</td>
                    <td style={td}>
                      <Link href={`/admin/properties/${p.id}`} style={{ textDecoration: "none", fontWeight: 600 }}>
                        Edit ‚Üí
                      </Link>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        )}
      </section>
    </main>
  );
}

const card: React.CSSProperties = {
  marginTop: 18,
  border: "1px solid #E2E2DE",
  borderRadius: 16,
  overflow: "hidden",
  background: "#fff",
};

const th: React.CSSProperties = {
  textAlign: "left",
  fontSize: 12,
  letterSpacing: 0.3,
  textTransform: "uppercase",
  padding: "12px 14px",
  borderBottom: "1px solid #E2E2DE",
  background: "#F6F5F2",
  whiteSpace: "nowrap",
};

const td: React.CSSProperties = {
  padding: "12px 14px",
  borderBottom: "1px solid #F0F0ED",
  verticalAlign: "top",
  whiteSpace: "nowrap",
};

const btnGhost: React.CSSProperties = {
  padding: "10px 14px",
  borderRadius: 12,
  border: "1px solid #E2E2DE",
  textDecoration: "none",
  color: "inherit",
};

const btnPrimary: React.CSSProperties = {
  padding: "10px 14px",
  borderRadius: 12,
  border: "1px solid #0E5E56",
  textDecoration: "none",
  color: "#0E5E56",
  fontWeight: 600,
};

```

---

## app/api/admin/leads/export/route.ts

```typescript
import { NextResponse } from "next/server";
import { sql } from "drizzle-orm";
import { db } from "@/db";

export const runtime = "nodejs";
export const dynamic = "force-dynamic";

type LeadRow = {
  id: number;
  created_at: string;
  name: string;
  phone: string;
  email: string;
  lang: string;
  page_url: string;
  property_id: number | null;
  property_slug: string | null;
  status: string;
  source: string | null;
  processed_at: string | null;
};

function escapeCsvCell(v: unknown) {
  const s = String(v ?? "");
  // CSV: –µ—Å–ª–∏ –µ—Å—Ç—å —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã ‚Äî –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º –≤ –∫–∞–≤—ã—á–∫–∏ –∏ —É–¥–≤–∞–∏–≤–∞–µ–º –∫–∞–≤—ã—á–∫–∏
  if (/[",\n\r]/.test(s)) return `"${s.replace(/"/g, '""')}"`;
  return s;
}

function toCsv(rows: Record<string, unknown>[]) {
  if (rows.length === 0) {
    // –¥–∞–∂–µ –µ—Å–ª–∏ –ø—É—Å—Ç–æ ‚Äî –≤–µ—Ä–Ω—ë–º CSV —Å –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏ (—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–æ, —É–¥–æ–±–Ω–æ)
    return "\ufeff" + ["id,created_at,processed_at,status,source,name,email,phone,lang,page_url,property_id,property_slug,message"].join("\n");
  }

  const headers = Object.keys(rows[0]);
  const lines = [
    headers.map(escapeCsvCell).join(","),
    ...rows.map((r) => headers.map((h) => escapeCsvCell(r[h])).join(",")),
  ];

  // BOM –¥–ª—è Excel (—á—Ç–æ–±—ã –∫–∏—Ä–∏–ª–ª–∏—Ü–∞/–∞–∫—Ü–µ–Ω—Ç—ã –Ω–µ –ª–æ–º–∞–ª–∏—Å—å)
  return "\ufeff" + lines.join("\n");
}

async function tryEmailAdminCsv(opts: { filename: string; csv: string; rowsCount: number; status: string; q: string }) {
  const adminEmail = (process.env.ADMIN_EMAIL || "").trim();
  if (!adminEmail) {
    console.warn("[export] ADMIN_EMAIL is not set -> skip email");
    return;
  }

  // –ß—Ç–æ–±—ã –≤–æ–æ–±—â–µ –Ω–µ –ª–æ–º–∞—Ç—å —ç–∫—Å–ø–æ—Ä—Ç, –æ—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ—á—Ç—ã –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é optional
  // –∏ –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç –Ω–∞–ª–∏—á–∏—è SMTP –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö.
  const host = (process.env.SMTP_HOST || "").trim();
  const portRaw = (process.env.SMTP_PORT || "").trim();
  const user = (process.env.SMTP_USER || "").trim();
  const pass = (process.env.SMTP_PASS || "").trim();

  // FROM: –ª–∏–±–æ —è–≤–Ω—ã–π SMTP_FROM, –ª–∏–±–æ SMTP_USER
  const from = (process.env.SMTP_FROM || user || "").trim();

  if (!host || !portRaw || !user || !pass || !from) {
    console.warn("[export] SMTP env is not fully set -> skip email");
    return;
  }

  const port = Number(portRaw);
  if (!Number.isFinite(port)) {
    console.warn("[export] SMTP_PORT invalid -> skip email");
    return;
  }

  try {
    // –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç, —á—Ç–æ–±—ã —Å–±–æ—Ä–∫–∞ –Ω–µ –ø–∞–¥–∞–ª–∞ –µ—Å–ª–∏ nodemailer –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
    const nodemailer = await import("nodemailer");

    const transporter = nodemailer.createTransport({
      host,
      port,
      secure: port === 465, // 465 –æ–±—ã—á–Ω–æ secure; 587/25 –æ–±—ã—á–Ω–æ STARTTLS
      auth: { user, pass },
    });

    const subject = `Leads export (${opts.rowsCount})`;
    const text =
      `CSV export attached.\n\n` +
      `Filters:\n` +
      `status: ${opts.status || "all"}\n` +
      `q: ${opts.q || "‚Äî"}\n` +
      `rows: ${opts.rowsCount}\n`;

    await transporter.sendMail({
      from,
      to: adminEmail,
      subject,
      text,
      attachments: [
        {
          filename: opts.filename,
          content: Buffer.from(opts.csv, "utf8"),
          contentType: "text/csv; charset=utf-8",
        },
      ],
    });

    console.log("[export] Email sent to admin:", adminEmail);
  } catch (e) {
    console.error("[export] Email failed (ignored):", e);
  }
}

export async function GET(req: Request) {
  // ‚úÖ –∑–∞—â–∏—Ç–∞: —ç–∫—Å–ø–æ—Ä—Ç —Ç–æ–ª—å–∫–æ –∏–∑ –∞–¥–º–∏–Ω–∫–∏
  const cookie = req.headers.get("cookie") || "";
  const isAdmin = /(?:^|;\s*)admin=1(?:;|$)/.test(cookie);
  if (!isAdmin) {
    return NextResponse.json({ error: "Unauthorized" }, { status: 401 });
  }

  const url = new URL(req.url);

  const status = String(url.searchParams.get("status") || "").trim().toLowerCase();
  const qRaw = String(url.searchParams.get("q") || "").trim();
  const q = qRaw.slice(0, 80);

  let whereSql = sql`TRUE`;

  if (status === "new") whereSql = sql`${whereSql} AND status <> 'processed'`;
  if (status === "processed") whereSql = sql`${whereSql} AND status = 'processed'`;

  if (q) {
    const like = `%${q}%`;
    whereSql = sql`${whereSql} AND (
      name ILIKE ${like}
      OR email ILIKE ${like}
      OR phone ILIKE ${like}
      OR COALESCE(property_slug, '') ILIKE ${like}
      OR COALESCE(page_url, '') ILIKE ${like}
    )`;
  }

  const res = await db.execute(sql`
    SELECT
      id,
      created_at,
      processed_at,
      status,
      source,
      name,
      email,
      phone,
      lang,
      page_url,
      property_id,
      property_slug,
      message
    FROM leads
    WHERE ${whereSql}
    ORDER BY created_at DESC, id DESC
    LIMIT 5000
  `);

  const leads = ((res as any).rows ?? []) as (LeadRow & { message?: string | null })[];

  const rows = leads.map((l) => ({
    id: l.id,
    created_at: l.created_at,
    processed_at: l.processed_at ?? "",
    status: l.status ?? "",
    source: l.source ?? "",
    name: l.name ?? "",
    email: l.email ?? "",
    phone: l.phone ?? "",
    lang: l.lang ?? "",
    page_url: l.page_url ?? "",
    property_id: l.property_id ?? "",
    property_slug: l.property_slug ?? "",
    message: (l as any).message ?? "",
  }));

  const csv = toCsv(rows);

  const today = new Date().toISOString().slice(0, 10);
  const filename = `leads-${today}.csv`;

  // ‚úÖ –ê–≤—Ç–æ-–æ—Ç–ø—Ä–∞–≤–∫–∞ –∞–¥–º–∏–Ω—É: –Ω–µ –ª–æ–º–∞–µ–º —ç–∫—Å–ø–æ—Ä—Ç –¥–∞–∂–µ –µ—Å–ª–∏ —É–ø–∞–¥—ë—Ç
  // (–ø–∏—Å—å–º–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º "–≤ —Ñ–æ–Ω–µ" –≤ —Å–º—ã—Å–ª–µ: –Ω–µ –≤–ª–∏—è—è –Ω–∞ Response)
  // –ù–æ –≤–Ω—É—Ç—Ä–∏ serverless –æ–±—ã—á–Ω–æ –≤—Å—ë —Ä–∞–≤–Ω–æ —É—Å–ø–µ–µ—Ç.
  void tryEmailAdminCsv({
    filename,
    csv,
    rowsCount: rows.length,
    status,
    q,
  });

  return new NextResponse(csv, {
    headers: {
      "Content-Type": "text/csv; charset=utf-8",
      "Content-Disposition": `attachment; filename="${filename}"`,
      "Cache-Control": "no-store",
    },
  });
}

```

---

## app/api/admin/properties/[id]/images/route.ts

```typescript
// app/api/admin/properties/[id]/images/route.ts
import { NextResponse } from "next/server";
import { sql } from "drizzle-orm";
import { db } from "@/db";
import path from "path";
import fs from "fs/promises";

export const runtime = "nodejs";
export const dynamic = "force-dynamic";

function safeName(name: string) {
  return name
    .toLowerCase()
    .replace(/\s+/g, "-")
    .replace(/[^a-z0-9.\-_]/g, "");
}

function toDiskPathFromPublicUrl(publicUrl: string) {
  // publicUrl –≤–∏–¥–∞ "/uploads/properties/xxx.jpg"
  const clean = publicUrl.startsWith("/") ? publicUrl.slice(1) : publicUrl;
  return path.join(process.cwd(), "public", clean);
}

async function ensureBelongsToProperty(imageId: number, propertyId: number) {
  const res = await db.execute(sql`
    SELECT id, property_id, url, is_cover, sort_order
    FROM property_images
    WHERE id = ${imageId}
    LIMIT 1
  `);

  const img = (res as any).rows?.[0];
  if (!img || Number(img.property_id) !== propertyId) return null;
  return img as { id: number; property_id: number; url: string; is_cover: boolean; sort_order: number };
}

async function setCover(imageId: number, propertyId: number) {
  // 1) —Å–Ω—è—Ç—å cover —Å–æ –≤—Å–µ—Ö
  await db.execute(sql`
    UPDATE property_images
    SET is_cover = false
    WHERE property_id = ${propertyId}
  `);

  // 2) –ø–æ—Å—Ç–∞–≤–∏—Ç—å cover –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É
  await db.execute(sql`
    UPDATE property_images
    SET is_cover = true
    WHERE id = ${imageId}
  `);
}

async function moveImage(imageId: number, propertyId: number, dir: "up" | "down") {
  const current = await ensureBelongsToProperty(imageId, propertyId);
  if (!current) return { ok: false, status: 404 as const, error: "Image not found" };

  const curSort = Number(current.sort_order);

  // –ù–∞—Ö–æ–¥–∏–º "—Å–æ—Å–µ–¥–∞" –ø–æ sort_order
  const neighborRes =
    dir === "up"
      ? await db.execute(sql`
          SELECT id, sort_order
          FROM property_images
          WHERE property_id = ${propertyId}
            AND (sort_order < ${curSort} OR (sort_order = ${curSort} AND id < ${imageId}))
          ORDER BY sort_order DESC, id DESC
          LIMIT 1
        `)
      : await db.execute(sql`
          SELECT id, sort_order
          FROM property_images
          WHERE property_id = ${propertyId}
            AND (sort_order > ${curSort} OR (sort_order = ${curSort} AND id > ${imageId}))
          ORDER BY sort_order ASC, id ASC
          LIMIT 1
        `);

  const neighbor = (neighborRes as any).rows?.[0];
  if (!neighbor) {
    // —É–∂–µ –∫—Ä–∞–π–Ω–∏–π
    return { ok: true as const };
  }

  const neighborId = Number(neighbor.id);
  const neighborSort = Number(neighbor.sort_order);

  // swap sort_order –º–µ—Å—Ç–∞–º–∏
  await db.execute(sql`
    UPDATE property_images
    SET sort_order = ${neighborSort}
    WHERE id = ${imageId}
  `);

  await db.execute(sql`
    UPDATE property_images
    SET sort_order = ${curSort}
    WHERE id = ${neighborId}
  `);

  return { ok: true as const };
}

// ‚úÖ upload images (multiple) + delete + setCover + move
export async function POST(req: Request, ctx: { params: Promise<{ id: string }> }) {
  const { id } = await ctx.params;
  const propertyId = Number(id);
  if (!Number.isFinite(propertyId)) {
    return NextResponse.json({ error: "Bad id" }, { status: 400 });
  }

  const form = await req.formData();

  // ‚úÖ –º–µ—Ç–æ–¥-–æ–≤–µ—Ä—Ä–∞–π–¥ (–∫–∞–∫ —É —Ç–µ–±—è —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ –¥–ª—è delete)
  const methodOverride = String(form.get("_method") || "").toLowerCase();

  // 1) delete image
  if (methodOverride === "delete") {
    const imageId = Number(form.get("imageId"));
    if (!Number.isFinite(imageId)) {
      return NextResponse.json({ error: "Bad imageId" }, { status: 400 });
    }

    const img = await ensureBelongsToProperty(imageId, propertyId);
    if (!img) {
      return NextResponse.json({ error: "Image not found" }, { status: 404 });
    }

    // —É–¥–∞–ª—è–µ–º —Ñ–∞–π–ª —Å –¥–∏—Å–∫–∞ (–µ—Å–ª–∏ –≤–¥—Ä—É–≥ —É–∂–µ —É–¥–∞–ª—ë–Ω ‚Äî –Ω–µ –ø–∞–¥–∞–µ–º)
    const diskPath = toDiskPathFromPublicUrl(String(img.url));
    try {
      await fs.unlink(diskPath);
    } catch {
      // ignore
    }

    // —É–¥–∞–ª—è–µ–º –∑–∞–ø–∏—Å—å –∏–∑ –ë–î
    await db.execute(sql`DELETE FROM property_images WHERE id = ${imageId}`);

    // –µ—Å–ª–∏ —É–¥–∞–ª–∏–ª–∏ cover ‚Äî –Ω–∞–∑–Ω–∞—á–∏–º –Ω–æ–≤—ã–π cover (–ø–µ—Ä–≤—É—é –ø–æ sort_order)
    if (img.is_cover) {
      const nextRes = await db.execute(sql`
        SELECT id
        FROM property_images
        WHERE property_id = ${propertyId}
        ORDER BY sort_order ASC, id ASC
        LIMIT 1
      `);
      const nextId = (nextRes as any).rows?.[0]?.id;
      if (nextId) {
        await setCover(Number(nextId), propertyId);
      }
    }

    return NextResponse.redirect(new URL(`/admin/properties/${propertyId}`, req.url), 303);
  }

  // 2) set cover
  if (methodOverride === "setcover") {
    const imageId = Number(form.get("imageId"));
    if (!Number.isFinite(imageId)) {
      return NextResponse.json({ error: "Bad imageId" }, { status: 400 });
    }

    const img = await ensureBelongsToProperty(imageId, propertyId);
    if (!img) {
      return NextResponse.json({ error: "Image not found" }, { status: 404 });
    }

    await setCover(imageId, propertyId);
    return NextResponse.redirect(new URL(`/admin/properties/${propertyId}`, req.url), 303);
  }

  // 3) move up/down
  if (methodOverride === "move") {
    const imageId = Number(form.get("imageId"));
    const dirRaw = String(form.get("dir") || "").toLowerCase();
    const dir = dirRaw === "up" ? "up" : dirRaw === "down" ? "down" : null;

    if (!Number.isFinite(imageId) || !dir) {
      return NextResponse.json({ error: "Bad move params" }, { status: 400 });
    }

    const res = await moveImage(imageId, propertyId, dir);
    if (!res.ok) return NextResponse.json({ error: res.error }, { status: res.status });

    return NextResponse.redirect(new URL(`/admin/properties/${propertyId}`, req.url), 303);
  }

  // 4) –æ–±—ã—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ (–∫–∞–∫ —É —Ç–µ–±—è —Å–µ–π—á–∞—Å)
  const files = form.getAll("files").filter((x) => x instanceof File) as File[];

  if (files.length === 0) {
    return NextResponse.json({ error: "No files (field name must be 'files')" }, { status: 400 });
  }

  // max sort_order
  const maxRes = await db.execute(sql`
    SELECT COALESCE(MAX(sort_order), 0) AS max
    FROM property_images
    WHERE property_id = ${propertyId}
  `);
  const maxSort = Number((maxRes as any).rows?.[0]?.max ?? 0);

  // already has cover?
  const coverRes = await db.execute(sql`
    SELECT id
    FROM property_images
    WHERE property_id = ${propertyId} AND is_cover = true
    LIMIT 1
  `);
  const hasCover = !!(coverRes as any).rows?.length;

  let i = 0;
  for (const file of files) {
    if (!file.type.startsWith("image/")) continue;

    const bytes = await file.arrayBuffer();
    const buffer = Buffer.from(bytes);

    const filename = `property-${propertyId}-${Date.now()}-${i}-${safeName(file.name || "image")}`;
    const diskPath = path.join(process.cwd(), "public", "uploads", "properties", filename);
    const publicUrl = `/uploads/properties/${filename}`;

    await fs.mkdir(path.dirname(diskPath), { recursive: true });
    await fs.writeFile(diskPath, buffer);

    const sortOrder = maxSort + i + 1;
    const isCover = !hasCover && i === 0;

    await db.execute(sql`
      INSERT INTO property_images (property_id, url, alt, sort_order, is_cover)
      VALUES (${propertyId}, ${publicUrl}, ${null}, ${sortOrder}, ${isCover})
    `);

    i++;
  }

  return NextResponse.redirect(new URL(`/admin/properties/${propertyId}`, req.url), 303);
}

```

---

## app/api/admin/properties/[id]/plans/route.ts

```typescript
import { NextResponse } from "next/server";
import { sql } from "drizzle-orm";
import { db } from "@/db";
import path from "node:path";
import fs from "node:fs/promises";

export const runtime = "nodejs";
export const dynamic = "force-dynamic";

function safeName(name: string) {
  return name
    .toLowerCase()
    .replace(/\s+/g, "-")
    .replace(/[^a-z0-9.\-_]/g, "");
}

async function ensureDir(dirPath: string) {
  await fs.mkdir(dirPath, { recursive: true });
}

async function deleteFileIfInUploads(plansUrl: string | null) {
  if (!plansUrl) return;
  const url = String(plansUrl).trim();
  if (!url.startsWith("/uploads/")) return;

  // url: /uploads/plans/xxx.pdf
  const filePath = path.join(process.cwd(), "public", url);
  try {
    await fs.unlink(filePath);
  } catch {
    // –µ—Å–ª–∏ —Ñ–∞–π–ª–∞ –Ω–µ—Ç ‚Äî –ø—Ä–æ—Å—Ç–æ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º
  }
}

async function getCurrentPlansUrl(propertyId: number) {
  const res = await db.execute(sql`
    SELECT plans_url
    FROM properties
    WHERE id = ${propertyId}
    LIMIT 1
  `);
  const row = (res as any).rows?.[0];
  return (row?.plans_url ?? null) as string | null;
}

/**
 * POST:
 * - –æ–±—ã—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ pdf (field: file)
 * - –∏–ª–∏ "_method=delete" –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ HTML form
 */
export async function POST(req: Request, ctx: { params: Promise<{ id: string }> }) {
  const { id } = await ctx.params;
  const propertyId = Number(id);

  if (!Number.isFinite(propertyId)) {
    return NextResponse.json({ error: "Bad id" }, { status: 400 });
  }

  const form = await req.formData();

  // ‚úÖ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ delete —á–µ—Ä–µ–∑ hidden _method
  const override = String(form.get("_method") || "").toLowerCase();
  if (override === "delete") {
    return handleDelete(req, propertyId);
  }

  const file = form.get("file");

  if (!(file instanceof File)) {
    return NextResponse.json({ error: "No file (field name must be 'file')" }, { status: 400 });
  }

  if (file.type !== "application/pdf") {
    return NextResponse.json({ error: "Only PDF allowed" }, { status: 400 });
  }

  // ‚úÖ —á–∏—Ç–∞–µ–º —Ñ–∞–π–ª
  const bytes = await file.arrayBuffer();
  const buffer = Buffer.from(bytes);

  // ‚úÖ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º, —á—Ç–æ –ø–∞–ø–∫–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
  const plansDir = path.join(process.cwd(), "public", "uploads", "plans");
  await ensureDir(plansDir);

  // ‚úÖ —É–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π pdf (–µ—Å–ª–∏ –±—ã–ª)
  const oldUrl = await getCurrentPlansUrl(propertyId);

  const filename = `property-${propertyId}-${Date.now()}-${safeName(file.name || "plans.pdf")}`;
  const diskPath = path.join(plansDir, filename);
  const publicUrl = `/uploads/plans/${filename}`;

  await fs.writeFile(diskPath, buffer);

  await db.execute(sql`
    UPDATE properties
    SET plans_url = ${publicUrl}, updated_at = NOW()
    WHERE id = ${propertyId}
  `);

  // ‚úÖ —á–∏—Å—Ç–∏–º —Å—Ç–∞—Ä—ã–π —Ñ–∞–π–ª –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∑–∞–ø–∏—Å–∏ –Ω–æ–≤–æ–≥–æ
  await deleteFileIfInUploads(oldUrl);

  return NextResponse.redirect(new URL(`/admin/properties/${propertyId}`, req.url), 303);
}

/**
 * DELETE:
 * - —É–¥–∞–ª—è–µ—Ç plans_url –∏–∑ –ë–î
 * - —É–¥–∞–ª—è–µ—Ç —Ñ–∏–∑–∏—á–µ—Å–∫–∏–π —Ñ–∞–π–ª –∏–∑ public/uploads/...
 */
export async function DELETE(req: Request, ctx: { params: Promise<{ id: string }> }) {
  const { id } = await ctx.params;
  const propertyId = Number(id);

  if (!Number.isFinite(propertyId)) {
    return NextResponse.json({ error: "Bad id" }, { status: 400 });
  }

  return handleDelete(req, propertyId);
}

async function handleDelete(req: Request, propertyId: number) {
  const oldUrl = await getCurrentPlansUrl(propertyId);

  // —É–±–∏—Ä–∞–µ–º —Å—Å—ã–ª–∫—É –∏–∑ –ë–î
  await db.execute(sql`
    UPDATE properties
    SET plans_url = NULL, updated_at = NOW()
    WHERE id = ${propertyId}
  `);

  // —É–¥–∞–ª—è–µ–º —Ñ–∞–π–ª
  await deleteFileIfInUploads(oldUrl);

  return NextResponse.redirect(new URL(`/admin/properties/${propertyId}`, req.url), 303);
}

```

---

## app/api/leads/route.ts

```typescript
import { NextResponse } from "next/server";
import { sql } from "drizzle-orm";
import { db } from "@/db";
import { leads, leadRateLimits } from "@/db/schema";
import { sendLeadNotification } from "@/app/lib/email/sendLeadNotification";

export const runtime = "nodejs";
export const dynamic = "force-dynamic";

function isEmail(x: string) {
  return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(x);
}

// –ø—Ä–æ—Å—Ç–∞—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (–Ω–µ –≤–∞–ª–∏–¥–∞—Ü–∏—è, –∞ —á–∏—Å—Ç–∫–∞ –º—É—Å–æ—Ä–∞)
function normalizePhone(x: string) {
  return x.replace(/[^\d+()\-\s]/g, "").trim();
}

type LeadPayload = {
  name: string;
  phone: string;
  email: string;
  message?: string | null;
  lang: "en" | "es";
  page_url: string;
  property_id?: number | null;
  property_slug?: string | null;
  source?: string | null;

  // ‚úÖ Honeypot
  website?: string | null;
};

function getClientIp(req: Request) {
  // –í –ø—Ä–æ–¥–µ –∑–∞ –ø—Ä–æ–∫—Å–∏ –æ–±—ã—á–Ω–æ –µ—Å—Ç—å x-forwarded-for
  const xf = req.headers.get("x-forwarded-for");
  if (xf) return xf.split(",")[0].trim();

  const xr = req.headers.get("x-real-ip");
  if (xr) return xr.trim();

  // –ª–æ–∫–∞–ª—å–Ω–æ —á–∞—Å—Ç–æ –±—É–¥–µ—Ç IPv6 loopback, –Ω–æ –æ–Ω –æ–±—ã—á–Ω–æ –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏
  // –æ—Å—Ç–∞–≤–∏–º "unknown" –∫–∞–∫ fallback ‚Äî —ç—Ç–æ –æ–∫ –¥–ª—è dev
  return "unknown";
}

export async function POST(req: Request) {
  try {
    const body = (await req.json()) as Partial<LeadPayload>;

    // ‚úÖ Honeypot: –µ—Å–ª–∏ –±–æ—Ç –∑–∞–ø–æ–ª–Ω–∏–ª —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ ‚Äî –º–æ–ª—á–∞ ‚Äú—É—Å–ø–µ—Ö‚Äù
    const website = String(body?.website ?? "").trim();
    if (website) {
      return NextResponse.json({ success: true });
    }

    const name = String(body?.name ?? "").trim();
    const phone = normalizePhone(String(body?.phone ?? ""));
    const email = String(body?.email ?? "").trim();
    const message = body?.message ? String(body.message).trim() : null;

    const lang = String(body?.lang ?? "").trim();
    const pageUrl = String(body?.page_url ?? "").trim();

    const propertyId =
      body?.property_id === null || body?.property_id === undefined
        ? null
        : Number(body.property_id);

    const propertySlug = body?.property_slug ? String(body.property_slug).trim() : null;
    const source = body?.source ? String(body.source).trim().slice(0, 80) : null;

    // ‚úÖ –±–∞–∑–æ–≤–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è required
    if (!name || !phone || !email || !lang || !pageUrl) {
      return NextResponse.json({ error: "Missing required fields" }, { status: 400 });
    }
    if (!isEmail(email)) {
      return NextResponse.json({ error: "Invalid email" }, { status: 400 });
    }
    if (lang !== "en" && lang !== "es") {
      return NextResponse.json({ error: "Invalid lang" }, { status: 400 });
    }
    if (propertyId !== null && Number.isNaN(propertyId)) {
      return NextResponse.json({ error: "Invalid property_id" }, { status: 400 });
    }

    // ‚úÖ –∞–Ω—Ç–∏—Å–ø–∞–º-–ª–∏–º–∏—Ç—ã –ø–æ –¥–ª–∏–Ω–µ
    if (name.length > 120) return NextResponse.json({ error: "Name too long" }, { status: 400 });
    if (phone.length > 60) return NextResponse.json({ error: "Phone too long" }, { status: 400 });
    if (email.length > 160) return NextResponse.json({ error: "Email too long" }, { status: 400 });
    if (pageUrl.length > 2000) return NextResponse.json({ error: "Page URL too long" }, { status: 400 });
    if (propertySlug && propertySlug.length > 255) return NextResponse.json({ error: "Property slug too long" }, { status: 400 });
    if (message && message.length > 2000) return NextResponse.json({ error: "Message too long" }, { status: 400 });

    // ‚úÖ –ø—Ä–æ—Å—Ç–∞—è —ç–≤—Ä–∏—Å—Ç–∏–∫–∞: –µ—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –µ—Å—Ç—å, –Ω–æ –ø–æ—á—Ç–∏ –±–µ–∑ –±—É–∫–≤ ‚Äî —á–∞—Å—Ç–æ –º—É—Å–æ—Ä
    if (message) {
      const letters = message.replace(/[^a-zA-Z–∞-—è–ê-–Ø]+/g, "");
      if (letters.length > 0 && letters.length < 5) {
        return NextResponse.json({ error: "Invalid message" }, { status: 400 });
      }
    }

    // ‚úÖ Rate limit –ø–æ IP
    const ip = getClientIp(req);

    // –ª–∏–º–∏—Ç: –Ω–µ –±–æ–ª—å—à–µ 5 –∑–∞–ø—Ä–æ—Å–æ–≤ –∑–∞ 10 –º–∏–Ω—É—Ç —Å –æ–¥–Ω–æ–≥–æ IP
    const WINDOW_MIN = 10;
    const MAX_REQ = 5;

    // ‚úÖ FIX: –Ω–µ–ª—å–∑—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞—Ç—å INTERVAL '...'
    const countRes = await db.execute(sql`
      SELECT COUNT(*)::int AS cnt
      FROM lead_rate_limits
      WHERE ip = ${ip}
        AND created_at > NOW() - (${WINDOW_MIN} * INTERVAL '1 minute')
    `);

    const cnt = Number((countRes as any).rows?.[0]?.cnt ?? 0);

    if (cnt >= MAX_REQ) {
      return NextResponse.json({ error: "Too many requests. Try again later." }, { status: 429 });
    }

    // –ª–æ–≥–∏—Ä—É–µ–º –ø–æ–ø—ã—Ç–∫—É (–¥–∞–∂–µ –µ—Å–ª–∏ –¥–∞–ª—å—à–µ —á—Ç–æ-—Ç–æ —É–ø–∞–¥–µ—Ç ‚Äî —É–∂–µ –æ—Ç—Å–µ–∫–∞–µ–º —Ñ–ª—É–¥)
    await db.insert(leadRateLimits).values({ ip });

    // ‚úÖ –≤—Å—Ç–∞–≤–∫–∞ + –≤–æ–∑–≤—Ä–∞—Ç id
    const inserted = await db
      .insert(leads)
      .values({
        name,
        phone,
        email,
        message,
        lang,
        pageUrl,
        propertyId,
        propertySlug,
        source,
        // status –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 'new' –∏–∑ –º–∏–≥—Ä–∞—Ü–∏–∏
      })
      .returning({ id: leads.id, createdAt: leads.createdAt });

    const row = inserted?.[0];

    // ‚úÖ –ø–∏—Å—å–º–æ –∞–¥–º–∏–Ω—É (–Ω–µ –ª–æ–º–∞–µ—Ç, –µ—Å–ª–∏ env –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω)
    await sendLeadNotification({
      id: row?.id,
      createdAt: row?.createdAt ? String(row.createdAt) : null,
      name,
      phone,
      email,
      message,
      lang,
      pageUrl,
      propertyId,
      propertySlug,
      source,
    });

    return NextResponse.json({ success: true, id: row?.id ?? null });
  } catch (e) {
    console.error("POST /api/leads error:", e);
    return NextResponse.json({ error: "Server error" }, { status: 500 });
  }
}

```

---

## app/eslint.config.mjs

```javascript
import { defineConfig, globalIgnores } from "eslint/config";
import nextVitals from "eslint-config-next/core-web-vitals";
import nextTs from "eslint-config-next/typescript";

const eslintConfig = defineConfig([
  ...nextVitals,
  ...nextTs,
  // Override default ignores of eslint-config-next.
  globalIgnores([
    // Default ignores of eslint-config-next:
    ".next/**",
    "out/**",
    "build/**",
    "next-env.d.ts",
  ]),
]);

export default eslintConfig;

```

---

## app/globals.css

```css
:root {
  --bg: #fcf8f2;
  --surface: #FFFFFF;
  --text: #1C1C1C;
  --muted: #6B6B6B;
  --border: #E2E2DE;
  --accent: #2B4537;
  --accentHover: #345945;
  --header-h: 15px;
  --radius: 6px;
  --shadow: 0 10px 26px rgba(0, 0, 0, 0.06);
  --container-pad: 14px;
}

/* --- Reset / base --- */
*,
*::before,
*::after {
  box-sizing: border-box;
}

html,
body {
  max-width: 100%;
  overflow-x: hidden;
  margin: 0;
  padding: 0;
  background: var(--bg);
  color: var(--text);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  
  padding-top: var(--header-h);
}

img {
  max-width: 100%;
  height: auto;
}

main {
  display: block;
}

/* Container used across components */
.container {
  width: min(1120px, calc(100% - 48px));
  margin: 0 auto;
}

@media (max-width: 520px) {
  .container {
    width: calc(100% - 28px);
  }
}

/* Make links look like design elements (not default browser links) */
a {
  color: inherit;
  text-decoration: none;
}

a:hover {
  text-decoration: none;
}

/* Improve section rhythm */
section {
  scroll-margin-top: 90px; /* anchor links won't hide under sticky header */
}

.section {
  padding: 72px 0;
}

.section--tight {
  padding: 56px 0;
}

.section__head {
  display: grid;
  gap: 8px;
  justify-items: center;
  text-align: center;
  margin-bottom: 28px;
}

.section__kicker {
  color: var(--muted);
  font-size: 14px;
}

/* ===== Centered title with side lines ===== */
.sectionTitle {
  width: 100%;
  display: flex;
  align-items: center;
  gap: 18px;
  justify-content: center;
  margin: 0;
}

.sectionTitle::before,
.sectionTitle::after {
  content: "";
  height: 1px;
  flex: 1;
  background: var(--border);
}

.sectionTitleText {
  font-size: 34px;
  letter-spacing: 0.2px;
  font-weight: 500;
}

/* optional: slightly smaller on mobile */
@media (max-width: 640px) {
  .sectionTitleText {
    font-size: 26px;
  }
  .section {
    padding: 56px 0;
  }
}

/* ===== Buttons alignment helpers ===== */
.section__actions {
  width: 100%;
  display: flex;
  justify-content: center;
  margin-top: 22px;
}

/* Softer typography defaults */
p {
  margin: 0;
}

/* --- Typography helpers used in page/components --- */
.h1 {
  font-family: var(--font-playfair), Georgia, "Times New Roman", serif;
  font-weight: 600;
  font-size: clamp(36px, 5vw, 56px);
  line-height: 1.08;
  margin: 0;
}

.h2 {
  font-family: var(--font-playfair), Georgia, "Times New Roman", serif;
  font-weight: 600;
  font-size: 28px;
  line-height: 1.15;
  margin: 0;
}

.p {
  color: rgba(28, 28, 28, 0.72);
  font-size: 15px;
  line-height: 1.6;
}

/* --- Buttons --- */
.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  padding: 12px 18px;
  border-radius: 3px;
  font-weight: 600;
  border: 1px solid transparent;
  cursor: pointer;
  transition: transform 0.12s ease, background 0.12s ease, border 0.12s ease;
  user-select: none;
}

.btn:active {
  transform: translateY(1px);
}

.btnPrimary {
  background: var(--accent);
  color: #fff;
}

.btnPrimary:hover {
  background: var(--accentHover);
}

.btnGhost {
  background: rgba(255, 255, 255, 0.78);
  border-color: var(--border);
  color: var(--text);
  backdrop-filter: blur(6px);
}

.btnGhost:hover {
  background: rgba(255, 255, 255, 0.92);
}

/* Make <button class="btn"> look same as <a class="btn"> */
button.btn {
  appearance: none;
}

/* --- Inputs baseline (so forms look consistent) --- */
input,
textarea,
select,
button {
  font: inherit;
}

input,
textarea,
select {
  outline: none;
}

::placeholder {
  color: rgba(28, 28, 28, 0.45);
}

/* --- Segmented controls (tabs-like buttons) --- */
.seg {
  display: inline-flex;
  border: 1px solid var(--border);
  border-radius: 999px; /* pill */
  overflow: hidden;
  background: rgba(255, 255, 255, 0.78);
  backdrop-filter: blur(6px);
}

.seg .btn {
  border: 0;              /* –≥—Ä–∞–Ω–∏—Ü–∞ —É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ */
  border-radius: 0;       /* —á—Ç–æ–±—ã –Ω–µ –ª–æ–º–∞—Ç—å pill */
  padding: 10px 14px;
  min-height: 38px;
}

.seg .btn + .btn {
  border-left: 1px solid var(--border);
}

.seg .btnPrimary {
  background: var(--accent);
  color: #fff;
}

.seg .btnPrimary:hover {
  background: var(--accentHover);
}

.seg .btnGhost {
  background: transparent;
}
.seg .btnGhost:hover {
  background: rgba(255, 255, 255, 0.92);
}



```

---

## app/lib/cookies/consent.ts

```typescript
export type CookieConsent = {
  necessary: true;      // –≤—Å–µ–≥–¥–∞ true
  analytics: boolean;
  marketing: boolean;
  updatedAt: number;
};

const STORAGE_KEY = "grahalia_cookie_consent";
const COOKIE_NAME = "grahalia_cookie_consent";

export function getDefaultConsent(): CookieConsent {
  return { necessary: true, analytics: false, marketing: false, updatedAt: Date.now() };
}

export function readConsent(): CookieConsent | null {
  if (typeof window === "undefined") return null;

  try {
    const raw = window.localStorage.getItem(STORAGE_KEY);
    if (!raw) return null;
    const parsed = JSON.parse(raw);

    // –ø—Ä–æ—Å—Ç–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
    if (typeof parsed !== "object" || parsed === null) return null;
    if (typeof parsed.analytics !== "boolean") return null;
    if (typeof parsed.marketing !== "boolean") return null;

    return {
      necessary: true,
      analytics: parsed.analytics,
      marketing: parsed.marketing,
      updatedAt: typeof parsed.updatedAt === "number" ? parsed.updatedAt : Date.now(),
    };
  } catch {
    return null;
  }
}

export function writeConsent(consent: CookieConsent) {
  if (typeof window === "undefined") return;

  const safe: CookieConsent = {
    necessary: true,
    analytics: !!consent.analytics,
    marketing: !!consent.marketing,
    updatedAt: Date.now(),
  };

  window.localStorage.setItem(STORAGE_KEY, JSON.stringify(safe));

  // cookie –Ω–∞ –≥–æ–¥
  const maxAge = 60 * 60 * 24 * 365;
  document.cookie = `${COOKIE_NAME}=${encodeURIComponent(JSON.stringify(safe))}; Path=/; Max-Age=${maxAge}; SameSite=Lax`;
}

export function hasMadeChoice(): boolean {
  return !!readConsent();
}

```

---

## app/lib/email/sendLeadNotification.ts

```typescript
import nodemailer from "nodemailer";

type LeadMail = {
  id?: number;
  name: string;
  phone: string;
  email: string;
  message?: string | null;
  lang: string;
  pageUrl: string;
  propertyId?: number | null;
  propertySlug?: string | null;
  source?: string | null;
  createdAt?: string | null;
};

function env(name: string) {
  const v = process.env[name];
  if (!v) throw new Error(`Missing env: ${name}`);
  return v;
}

export async function sendLeadNotification(lead: LeadMail) {
  // –ï—Å–ª–∏ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ ‚Äî —Ç–∏—Ö–æ –≤—ã—Ö–æ–¥–∏–º (—á—Ç–æ–±—ã –Ω–µ –ª–æ–º–∞—Ç—å –ø—Ä–æ–¥)
  if (!process.env.LEADS_NOTIFY_TO) return;

  const host = env("SMTP_HOST");
  const port = Number(process.env.SMTP_PORT || "465");
  const secure = String(process.env.SMTP_SECURE || "true") === "true";
  const user = env("SMTP_USER");
  const pass = env("SMTP_PASS");
  const from = process.env.SMTP_FROM || user;
  const to = env("LEADS_NOTIFY_TO");

  const transporter = nodemailer.createTransport({
    host,
    port,
    secure,
    auth: { user, pass },
  });

  const subject = `New lead #${lead.id ?? "‚Äî"} ‚Äî ${lead.name}`;

  const text =
`New lead received

Name: ${lead.name}
Phone: ${lead.phone}
Email: ${lead.email}
Lang: ${lead.lang}
Source: ${lead.source ?? "‚Äî"}
Page: ${lead.pageUrl}
Property: ${lead.propertySlug ?? "‚Äî"} (id: ${lead.propertyId ?? "‚Äî"})

Message:
${lead.message ?? "‚Äî"}
`;

  await transporter.sendMail({
    from,
    to,
    subject,
    text,
  });
}

```

---

## app/lib/publicFeatured.ts

```typescript
// app/lib/publicFeatured.ts
import { sql } from "drizzle-orm";
import { db } from "@/db";

export type FeaturedItem = {
  id: number;
  slug: string;
  title: string;
  location: string;
  price: string; // formatted for UI
  beds: number;
  baths: number;
  area: number;
  image: string;
};

function titleFromSlug(slug: string) {
  if (!slug) return "Property";
  return slug
    .split("-")
    .filter(Boolean)
    .map((w) => w.charAt(0).toUpperCase() + w.slice(1))
    .join(" ");
}

function formatPrice(opts: { lang: "en" | "es"; value: number | null; currency: string | null }) {
  const { lang, value, currency } = opts;

  if (value === null || value === undefined) {
    return lang === "es" ? "Precio bajo consulta" : "Price on Request";
  }

  const cur = (currency || "EUR").toUpperCase();

  try {
    return new Intl.NumberFormat(lang === "es" ? "es-ES" : "en-GB", {
      style: "currency",
      currency: cur,
      maximumFractionDigits: 0,
    }).format(value);
  } catch {
    const n = new Intl.NumberFormat(lang === "es" ? "es-ES" : "en-GB", {
      maximumFractionDigits: 0,
    }).format(value);
    return cur === "EUR" ? `‚Ç¨${n}` : `${n} ${cur}`;
  }
}

export async function getFeaturedItems(lang: "en" | "es", limit = 6): Promise<FeaturedItem[]> {
  // 1) Published properties
  const propsRes = await db.execute(sql`
    SELECT
      id,
      slug,
      location,
      price,
      currency,
      bedrooms,
      bathrooms,
      built_area_m2
    FROM properties
    WHERE is_published = true
    ORDER BY created_at DESC
    LIMIT ${limit}
  `);

  const props = ((propsRes as any).rows ?? []) as Array<any>;
  if (props.length === 0) return [];

  const ids = props.map((p) => Number(p.id)).filter((n) => Number.isFinite(n));

  // 2) One image per property: cover first, else first by sort_order
  // ‚úÖ –í–º–µ—Å—Ç–æ ANY(int[]) –∏—Å–ø–æ–ª—å–∑—É–µ–º IN (...)
  const idSqlList = sql.join(ids.map((id) => sql`${id}`), sql`, `);

  const imagesRes = await db.execute(sql`
    SELECT DISTINCT ON (property_id)
      property_id,
      url
    FROM property_images
    WHERE property_id IN (${idSqlList})
    ORDER BY property_id, is_cover DESC, sort_order ASC, id ASC
  `);

  const images = ((imagesRes as any).rows ?? []) as Array<any>;
  const coverMap = new Map<number, string>();
  for (const row of images) {
    coverMap.set(Number(row.property_id), String(row.url));
  }

  return props.map((p) => {
    const id = Number(p.id);
    const slug = String(p.slug || "");
    const image = coverMap.get(id) ?? "/properties/p1.jpg";

    return {
      id,
      slug,
      title: titleFromSlug(slug) || `Property #${id}`,
      location: p.location ? String(p.location) : "",
      price: formatPrice({
        lang,
        value: p.price !== null && p.price !== undefined ? Number(p.price) : null,
        currency: p.currency ? String(p.currency) : null,
      }),
      beds: p.bedrooms !== null && p.bedrooms !== undefined ? Number(p.bedrooms) : 0,
      baths: p.bathrooms !== null && p.bathrooms !== undefined ? Number(p.bathrooms) : 0,
      area: p.built_area_m2 !== null && p.built_area_m2 !== undefined ? Number(p.built_area_m2) : 0,
      image,
    };
  });
}

```

---

## app/lib/publicProperties.ts

```typescript
// app/lib/publicProperties.ts
import { sql } from "drizzle-orm";
import { db } from "@/db";

/* -----------------------------
   Shared helpers
------------------------------ */

function titleFromSlug(slug: string) {
  // "modern-villa-marbella" -> "Modern Villa Marbella"
  return slug
    .split("-")
    .filter(Boolean)
    .map((w) => w.charAt(0).toUpperCase() + w.slice(1))
    .join(" ");
}

function formatPrice(opts: { lang: "en" | "es"; value: number | null; currency: string | null }) {
  const { lang, value, currency } = opts;

  if (value === null || value === undefined) {
    return lang === "es" ? "Precio bajo consulta" : "Price on Request";
  }

  const cur = (currency || "EUR").toUpperCase();

  try {
    return new Intl.NumberFormat(lang === "es" ? "es-ES" : "en-GB", {
      style: "currency",
      currency: cur,
      maximumFractionDigits: 0,
    }).format(value);
  } catch {
    const n = new Intl.NumberFormat(lang === "es" ? "es-ES" : "en-GB", {
      maximumFractionDigits: 0,
    }).format(value);
    return cur === "EUR" ? `‚Ç¨${n}` : `${n} ${cur}`;
  }
}

/* -----------------------------
   Featured (home page) - keep as is
------------------------------ */

export type FeaturedProperty = {
  id: number;
  slug: string;
  title: string;
  location: string | null;
  price: number | null;
  currency: string | null;
  bedrooms: number | null;
  bathrooms: number | null;
  built_area_m2: number | null;
  cover_url: string | null;
};

export async function getFeaturedProperties(limit = 6): Promise<FeaturedProperty[]> {
  const propsRes = await db.execute(sql`
    SELECT
      id,
      slug,
      location,
      price,
      currency,
      bedrooms,
      bathrooms,
      built_area_m2
    FROM properties
    WHERE is_published = true
    ORDER BY created_at DESC
    LIMIT ${limit}
  `);

  const props = ((propsRes as any).rows ?? []) as Array<any>;
  if (props.length === 0) return [];

  const ids = props.map((p) => Number(p.id));

  const imagesRes = await db.execute(sql`
    SELECT DISTINCT ON (property_id)
      property_id,
      url
    FROM property_images
    WHERE property_id = ANY(${ids}::int[])
    ORDER BY property_id, is_cover DESC, sort_order ASC, id ASC
  `);

  const images = ((imagesRes as any).rows ?? []) as Array<any>;
  const coverMap = new Map<number, string>();
  for (const row of images) {
    coverMap.set(Number(row.property_id), String(row.url));
  }

  return props.map((p) => {
    const slug = String(p.slug ?? "");
    return {
      id: Number(p.id),
      slug,
      title: titleFromSlug(slug || `property-${p.id}`),
      location: p.location ? String(p.location) : null,
      price: p.price !== null && p.price !== undefined ? Number(p.price) : null,
      currency: p.currency ? String(p.currency) : null,
      bedrooms: p.bedrooms !== null && p.bedrooms !== undefined ? Number(p.bedrooms) : null,
      bathrooms: p.bathrooms !== null && p.bathrooms !== undefined ? Number(p.bathrooms) : null,
      built_area_m2:
        p.built_area_m2 !== null && p.built_area_m2 !== undefined ? Number(p.built_area_m2) : null,
      cover_url: coverMap.get(Number(p.id)) ?? null,
    };
  });
}

/* -----------------------------
   Catalog + filters + amenities
------------------------------ */

export type CatalogFeature = {
  key: string;
  label: string;
};

export type CatalogItem = {
  id: number;
  slug: string;

  title: string;
  location: string;
  priceText: string;

  beds: number;
  baths: number;
  area: number;

  image: string;
  features: CatalogFeature[];
};

export type CatalogFilters = {
  type?: string | null;
  deal?: "all" | "sale" | "rent" | null;
  featureKeys?: string[] | null; // –æ–±—ä–µ–∫—Ç –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –í–°–ï –≤—ã–±—Ä–∞–Ω–Ω—ã–µ keys
};

// ‚úÖ –ü–æ—Å—Ç–∞–≤—å true, –∫–æ–≥–¥–∞ —Ä–µ–∞–ª—å–Ω–æ –¥–æ–±–∞–≤–∏—à—å —ç—Ç–∏ –≤–µ—â–∏ –≤ –ë–î
const HAS_PROPERTY_TYPE = false;
const HAS_PROPERTY_TRANSLATIONS = false;

function normalizeFeatureKeys(v: unknown): string[] {
  if (!Array.isArray(v)) return [];
  return v
    .map((x) => String(x || "").trim().toLowerCase())
    .filter(Boolean);
}

export async function getCatalogItems(opts: {
  lang: "en" | "es";
  page: number;
  pageSize: number;
  filters?: CatalogFilters;
}): Promise<{ items: CatalogItem[]; total: number; page: number; pageSize: number; totalPages: number }> {
  const { lang, pageSize } = opts;

  const page = Number.isFinite(opts.page) && opts.page > 0 ? Math.floor(opts.page) : 1;

  const type = (opts.filters?.type || "").trim() || null;

  const dealRaw = String(opts.filters?.deal ?? "").trim().toLowerCase();
  const deal = dealRaw === "sale" || dealRaw === "rent" ? dealRaw : null;

  const featureKeys = normalizeFeatureKeys(opts.filters?.featureKeys);
  const needFeatures = featureKeys.length > 0;

  // WHERE
  const whereParts: any[] = [sql`p.is_published = true`];
  if (deal) whereParts.push(sql`p.deal_type = ${deal}`);
  if (HAS_PROPERTY_TYPE && type) whereParts.push(sql`p.property_type = ${type}`);
  const whereSql = sql.join(whereParts, sql` AND `);

  // TOTAL
  let total = 0;

  if (!needFeatures) {
    const totalRes = await db.execute(sql`
      SELECT COUNT(*)::int AS total
      FROM properties p
      WHERE ${whereSql}
    `);
    total = Number((totalRes as any).rows?.[0]?.total ?? 0);
  } else {
    const keysList = sql.join(featureKeys.map((k) => sql`${k}`), sql`, `);

    const totalRes = await db.execute(sql`
      SELECT COUNT(*)::int AS total
      FROM (
        SELECT p.id
        FROM properties p
        JOIN property_features pf ON pf.property_id = p.id
        JOIN features f ON f.id = pf.feature_id
        WHERE ${whereSql}
          AND f.key IN (${keysList})
        GROUP BY p.id
        HAVING COUNT(DISTINCT f.key) = ${featureKeys.length}
      ) x
    `);
    total = Number((totalRes as any).rows?.[0]?.total ?? 0);
  }

  const totalPages = Math.max(1, Math.ceil(total / pageSize));
  const safePage = Math.min(page, totalPages);
  const offset = (safePage - 1) * pageSize;

  // IDS
  let ids: number[] = [];

  if (!needFeatures) {
    const idsRes = await db.execute(sql`
      SELECT p.id
      FROM properties p
      WHERE ${whereSql}
      ORDER BY p.created_at DESC
      LIMIT ${pageSize}
      OFFSET ${offset}
    `);

    ids = ((idsRes as any).rows ?? [])
      .map((r: any) => Number(r.id))
      .filter((n: any) => Number.isFinite(n));
  } else {
    const keysList = sql.join(featureKeys.map((k) => sql`${k}`), sql`, `);

    const idsRes = await db.execute(sql`
      SELECT p.id
      FROM properties p
      JOIN property_features pf ON pf.property_id = p.id
      JOIN features f ON f.id = pf.feature_id
      WHERE ${whereSql}
        AND f.key IN (${keysList})
      GROUP BY p.id
      HAVING COUNT(DISTINCT f.key) = ${featureKeys.length}
      ORDER BY MAX(p.created_at) DESC
      LIMIT ${pageSize}
      OFFSET ${offset}
    `);

    ids = ((idsRes as any).rows ?? [])
      .map((r: any) => Number(r.id))
      .filter((n: any) => Number.isFinite(n));
  }

  if (ids.length === 0) {
    return { items: [], total, page: safePage, pageSize, totalPages };
  }

  const idSqlList = sql.join(ids.map((id) => sql`${id}`), sql`, `);

  // PROPS (–±–µ–∑ translations ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω–æ)
  // –ï—Å–ª–∏ –ø–æ–∑–∂–µ –¥–æ–±–∞–≤–∏—à—å property_translations ‚Äî –ø–µ—Ä–µ–∫–ª—é—á–∏—à—å —Ñ–ª–∞–≥ –∏ JOIN –≤–∫–ª—é—á–∏—Ç—Å—è
  let propsRows: any[] = [];
  if (!HAS_PROPERTY_TRANSLATIONS) {
    const res = await db.execute(sql`
      SELECT
        p.id,
        p.slug,
        p.location,
        p.price,
        p.currency,
        p.bedrooms,
        p.bathrooms,
        p.built_area_m2
      FROM properties p
      WHERE p.id IN (${idSqlList})
    `);
    propsRows = ((res as any).rows ?? []) as any[];
  } else {
    const res = await db.execute(sql`
      SELECT
        p.id,
        p.slug,
        p.location,
        p.price,
        p.currency,
        p.bedrooms,
        p.bathrooms,
        p.built_area_m2,
        COALESCE(pt.title, NULL) AS title
      FROM properties p
      LEFT JOIN property_translations pt
        ON pt.property_id = p.id AND pt.lang = ${lang}
      WHERE p.id IN (${idSqlList})
    `);
    propsRows = ((res as any).rows ?? []) as any[];
  }

  // COVER
  const imagesRes = await db.execute(sql`
    SELECT DISTINCT ON (pi.property_id)
      pi.property_id,
      pi.url
    FROM property_images pi
    WHERE pi.property_id IN (${idSqlList})
    ORDER BY pi.property_id, pi.is_cover DESC, pi.sort_order ASC, pi.id ASC
  `);

  const coverMap = new Map<number, string>();
  for (const row of ((imagesRes as any).rows ?? []) as any[]) {
    coverMap.set(Number(row.property_id), String(row.url));
  }

  // FEATURES
  const featsRes = await db.execute(sql`
    SELECT
      pf.property_id,
      f.key,
      COALESCE(ft.label, f.key) AS label
    FROM property_features pf
    JOIN features f ON f.id = pf.feature_id
    LEFT JOIN feature_translations ft
      ON ft.feature_id = f.id AND ft.lang = ${lang}
    WHERE pf.property_id IN (${idSqlList})
    ORDER BY pf.property_id, f.key ASC
  `);

  const featMap = new Map<number, CatalogFeature[]>();
  for (const row of ((featsRes as any).rows ?? []) as any[]) {
    const pid = Number(row.property_id);
    const arr = featMap.get(pid) ?? [];
    arr.push({ key: String(row.key), label: String(row.label) });
    featMap.set(pid, arr);
  }

  // Keep same order as ids
  const rowById = new Map<number, any>();
  for (const r of propsRows) rowById.set(Number(r.id), r);

  const items: CatalogItem[] = ids.map((id) => {
    const p = rowById.get(id);

    const slug = String(p?.slug ?? "");
    const title =
      HAS_PROPERTY_TRANSLATIONS && p?.title ? String(p.title) : titleFromSlug(slug || `property-${id}`);

    const priceValue = p?.price !== null && p?.price !== undefined ? Number(p.price) : null;
    const currency = p?.currency ? String(p.currency) : null;

    return {
      id,
      slug,
      title,
      location: p?.location ? String(p.location) : "",
      priceText: formatPrice({ lang, value: priceValue, currency }),
      beds: p?.bedrooms !== null && p?.bedrooms !== undefined ? Number(p.bedrooms) : 0,
      baths: p?.bathrooms !== null && p?.bathrooms !== undefined ? Number(p.bathrooms) : 0,
      area: p?.built_area_m2 !== null && p?.built_area_m2 !== undefined ? Number(p.built_area_m2) : 0,
      image: coverMap.get(id) ?? "/properties/p1.jpg",
      features: featMap.get(id) ?? [],
    };
  });

  return { items, total, page: safePage, pageSize, totalPages };
}

export async function getAllFeaturesForFilters(lang: "en" | "es") {
  const res = await db.execute(sql`
    SELECT f.key, COALESCE(ft.label, f.key) AS label
    FROM features f
    LEFT JOIN feature_translations ft
      ON ft.feature_id = f.id AND ft.lang = ${lang}
    ORDER BY f.key ASC
  `);

  return ((res as any).rows ?? []).map((r: any) => ({
    key: String(r.key),
    label: String(r.label),
  }));
}

export type PropertyDetail = {
  id: number;
  slug: string;
  title: string;

  location: string;
  description: string;

  priceText: string;

  beds: number;
  baths: number;
  builtArea: number;

  plansUrl: string | null;

  images: Array<{ url: string; isCover: boolean; sortOrder: number }>;
  features: Array<{ key: string; label: string }>;
};

export async function getPropertyBySlug(opts: { lang: "en" | "es"; slug: string }) {
  const { lang, slug } = opts;

  // 1) property
  const propRes = await db.execute(sql`
    SELECT
      p.id,
      p.slug,
      p.location,
      p.description_en,
      p.description_es,
      p.price,
      p.currency,
      p.bedrooms,
      p.bathrooms,
      p.built_area_m2,
      p.plans_url
    FROM properties p
    WHERE p.is_published = true AND p.slug = ${slug}
    LIMIT 1
  `);

  const p = (propRes as any).rows?.[0];
  if (!p) return null;

  const id = Number(p.id);

  const description =
    lang === "es"
      ? (p.description_es ? String(p.description_es) : "")
      : (p.description_en ? String(p.description_en) : "");


  // title –ø–æ–∫–∞ —Å—Ç—Ä–æ–∏–º –∏–∑ slug (–±–µ–∑ translations, —á—Ç–æ–±—ã –Ω–∏—á–µ–≥–æ –Ω–µ –ø–∞–¥–∞–ª–æ)
  const title = titleFromSlug(String(p.slug || slug));

  const priceValue = p.price !== null && p.price !== undefined ? Number(p.price) : null;
  const currency = p.currency ? String(p.currency) : null;

  // 2) images
  const imagesRes = await db.execute(sql`
    SELECT
      url,
      is_cover,
      sort_order
    FROM property_images
    WHERE property_id = ${id}
    ORDER BY is_cover DESC, sort_order ASC, id ASC
  `);

  const images = ((imagesRes as any).rows ?? []).map((r: any) => ({
    url: String(r.url),
    isCover: Boolean(r.is_cover),
    sortOrder: r.sort_order !== null && r.sort_order !== undefined ? Number(r.sort_order) : 0,
  }));

  // 3) features
  const featsRes = await db.execute(sql`
    SELECT
      f.key,
      COALESCE(ft.label, f.key) AS label
    FROM property_features pf
    JOIN features f ON f.id = pf.feature_id
    LEFT JOIN feature_translations ft
      ON ft.feature_id = f.id AND ft.lang = ${lang}
    WHERE pf.property_id = ${id}
    ORDER BY f.key ASC
  `);

  const features = ((featsRes as any).rows ?? []).map((r: any) => ({
    key: String(r.key),
    label: String(r.label),
  }));

  const plansUrlRaw = p.plans_url ? String(p.plans_url).trim() : "";
  const plansUrl = plansUrlRaw
    ? (plansUrlRaw.startsWith("/") ? plansUrlRaw : `/${plansUrlRaw}`)
    : null;

  return {
    id,
    slug: String(p.slug),
    title,
    location: p.location ? String(p.location) : "",
    description,
    priceText: formatPrice({ lang, value: priceValue, currency }),

    beds: p.bedrooms !== null && p.bedrooms !== undefined ? Number(p.bedrooms) : 0,
    baths: p.bathrooms !== null && p.bathrooms !== undefined ? Number(p.bathrooms) : 0,
    builtArea:
      p.built_area_m2 !== null && p.built_area_m2 !== undefined
        ? Number(p.built_area_m2)
        : 0,

    plansUrl, // ‚úÖ –í–û–¢ –ó–î–ï–°–¨ ‚Äî –≤–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ p.plans_url

    images,
    features,
  } satisfies PropertyDetail;
}

```

---

## app/next.config.ts

```typescript
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  /* config options here */
  reactCompiler: true,
};

export default nextConfig;

```

---

## app/package.json

```json
{
  "name": "app",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "eslint"
  },
  "dependencies": {
    "next": "16.1.1",
    "react": "19.2.3",
    "react-dom": "19.2.3"
  },
  "devDependencies": {
    "@types/node": "^20",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "babel-plugin-react-compiler": "1.0.0",
    "eslint": "^9",
    "eslint-config-next": "16.1.1",
    "typescript": "^5"
  }
}

```

---

## app/page.tsx

```typescript

```

---

## app/site.webmanifest/route.ts

```typescript
import { NextResponse } from "next/server";

export function GET() {
  const manifest = {
    name: "Grahalia Estates",
    short_name: "Grahalia",
    start_url: "/en",
    display: "standalone",
    background_color: "#fcf8f2",
    theme_color: "#2B4537",
    icons: [
      { src: "/web-app-manifest-192x192.png", sizes: "192x192", type: "image/png" },
      { src: "/web-app-manifest-512x512.png", sizes: "512x512", type: "image/png" }
    ]
  };

  return NextResponse.json(manifest, {
    headers: {
      "Content-Type": "application/manifest+json; charset=utf-8",
      "Cache-Control": "public, max-age=3600"
    }
  });
}

```

---

## app/src/app/globals.css

```css
@import "../styles/tokens.css";

:root {
  --background: #ffffff;
  --foreground: #171717;
}

@media (prefers-color-scheme: dark) {
  :root {
    --background: #0a0a0a;
    --foreground: #ededed;
  }
}

html,
body {
  max-width: 100vw;
  overflow-x: hidden;
}

body {
  color: var(--foreground);
  background: var(--background);
  font-family: Arial, Helvetica, sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

* {
  box-sizing: border-box;
  padding: 0;
  margin: 0;
}

a {
  color: inherit;
  text-decoration: none;
}

@media (prefers-color-scheme: dark) {
  html {
    color-scheme: dark;
  }
}

```

---

## app/src/app/layout.tsx

```typescript
import type { Metadata } from "next";
import "./globals.css";
import { Inter, Cormorant_Garamond } from "next/font/google";

const inter = Inter({
  subsets: ["latin", "cyrillic"],
  variable: "--font-sans",
  display: "swap",
});

const cormorant = Cormorant_Garamond({
  subsets: ["latin", "cyrillic"],
  weight: ["400", "500", "600"],
  variable: "--font-serif",
  display: "swap",
});

export const metadata: Metadata = {
  title: "Grahalia Estates",
  description: "Real estate on Costa del Sol",
};

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="ru" className={`${inter.variable} ${cormorant.variable}`}>
      <body>{children}</body>
    </html>
  );
}

```

---

## app/src/app/page.module.css

```css
.page {
  --background: #fafafa;
  --foreground: #fff;

  --text-primary: #000;
  --text-secondary: #666;

  --button-primary-hover: #383838;
  --button-secondary-hover: #f2f2f2;
  --button-secondary-border: #ebebeb;

  display: flex;
  min-height: 100vh;
  align-items: center;
  justify-content: center;
  font-family: var(--font-geist-sans);
  background-color: var(--background);
}

.main {
  display: flex;
  min-height: 100vh;
  width: 100%;
  max-width: 800px;
  flex-direction: column;
  align-items: flex-start;
  justify-content: space-between;
  background-color: var(--foreground);
  padding: 120px 60px;
}

.intro {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  text-align: left;
  gap: 24px;
}

.intro h1 {
  max-width: 320px;
  font-size: 40px;
  font-weight: 600;
  line-height: 48px;
  letter-spacing: -2.4px;
  text-wrap: balance;
  color: var(--text-primary);
}

.intro p {
  max-width: 440px;
  font-size: 18px;
  line-height: 32px;
  text-wrap: balance;
  color: var(--text-secondary);
}

.intro a {
  font-weight: 500;
  color: var(--text-primary);
}

.ctas {
  display: flex;
  flex-direction: row;
  width: 100%;
  max-width: 440px;
  gap: 16px;
  font-size: 14px;
}

.ctas a {
  display: flex;
  justify-content: center;
  align-items: center;
  height: 40px;
  padding: 0 16px;
  border-radius: 128px;
  border: 1px solid transparent;
  transition: 0.2s;
  cursor: pointer;
  width: fit-content;
  font-weight: 500;
}

a.primary {
  background: var(--text-primary);
  color: var(--background);
  gap: 8px;
}

a.secondary {
  border-color: var(--button-secondary-border);
}

/* Enable hover only on non-touch devices */
@media (hover: hover) and (pointer: fine) {
  a.primary:hover {
    background: var(--button-primary-hover);
    border-color: transparent;
  }

  a.secondary:hover {
    background: var(--button-secondary-hover);
    border-color: transparent;
  }
}

@media (max-width: 600px) {
  .main {
    padding: 48px 24px;
  }

  .intro {
    gap: 16px;
  }

  .intro h1 {
    font-size: 32px;
    line-height: 40px;
    letter-spacing: -1.92px;
  }
}

@media (prefers-color-scheme: dark) {
  .logo {
    filter: invert();
  }

  .page {
    --background: #000;
    --foreground: #000;

    --text-primary: #ededed;
    --text-secondary: #999;

    --button-primary-hover: #ccc;
    --button-secondary-hover: #1a1a1a;
    --button-secondary-border: #1a1a1a;
  }
}

```

---

## app/src/app/page.tsx

```typescript
import { Header } from "@/components/Header/Header";
import { Hero } from "@/components/Hero/Hero";

function Section({ id, title, children }: { id: string; title: string; children: React.ReactNode }) {
  return (
    <section id={id} style={{ padding: "84px 0" }}>
      <div className="container">
        <p style={{ color: "var(--accent)", fontSize: 12, letterSpacing: 1.2, textTransform: "uppercase" }}>
          Grahalia Estates
        </p>
        <h2 style={{ fontFamily: "var(--font-serif)", margin: "10px 0 12px" }}>{title}</h2>
        <div style={{ color: "var(--text-muted)", maxWidth: 820 }}>{children}</div>
      </div>
    </section>
  );
}

export default function HomePage() {
  return (
    <>
      <Header />

      <main>
        <Section id="home" title="–ù–∞–π–¥–∏—Ç–µ —Å–≤–æ–π –∏–¥–µ–∞–ª—å–Ω—ã–π –¥–æ–º –Ω–∞ –ö–æ—Å—Ç–∞-–¥–µ–ª—å-–°–æ–ª—å">
          –ó–¥–µ—Å—å –±—É–¥–µ—Ç hero-–±–ª–æ–∫: –∫—Ä—É–ø–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫, –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –∫–Ω–æ–ø–∫–∞ ‚Äú–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –æ–±—ä–µ–∫—Ç—ã‚Äù.
        </Section>

        <Section id="about" title="–í–∞—à –Ω–∞–¥—ë–∂–Ω—ã–π –ø–∞—Ä—Ç–Ω—ë—Ä –≤ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏">
          –ö–æ—Ä–æ—Ç–∫–æ –ø—Ä–æ –∫–æ–º–ø–∞–Ω–∏—é, –≥–µ–æ–≥—Ä–∞—Ñ–∏—é (Costa del Sol), —Å—Ç–∏–ª—å —Ä–∞–±–æ—Ç—ã –∏ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ —Å–¥–µ–ª–∫–∏.
        </Section>

        <Section id="services" title="–£—Å–ª—É–≥–∏">
          –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ ¬∑ –ü—Ä–æ–¥–∞–∂–∞ ¬∑ –ê—Ä–µ–Ω–¥–∞ ‚Äî –≤ –≤–∏–¥–µ –∫–∞—Ä—Ç–æ—á–µ–∫ (–∫–ª–∏–∫ ‚Üí –æ—Ç–¥–µ–ª—å–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞).
        </Section>

        <Section id="gallery" title="–ì–∞–ª–µ—Ä–µ—è">
          –¢—É—Ç –±—É–¥–µ—Ç —Å–µ—Ç–∫–∞ —Ñ–æ—Ç–æ + –º–æ–¥–∞–ª–∫–∞ —Å –∑–∞—Ç–µ–º–Ω–µ–Ω–∏–µ–º (–∫–∞–∫ –≤ —à–∞–±–ª–æ–Ω–µ).
        </Section>

        <Section id="contact" title="–°–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞–º–∏">
          –ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è —Ñ–æ—Ä–º–∞ + –∫–æ–Ω—Ç–∞–∫—Ç—ã + —Ä–∞–±–æ—á–∏–µ —á–∞—Å—ã.
        </Section>
      </main>
    </>
  );
}

```

---

## app/src/components/Header/Header.tsx

```typescript
"use client";

import styles from "./header.module.css";
import { NAV } from "@/lib/nav";
import { useActiveSection } from "@/lib/useActiveSection";

export function Header() {
  const activeId = useActiveSection(NAV.map((n) => n.id));

  return (
    <header className={styles.header}>
      <div className={`${styles.inner} container`}>
        <div className={styles.brand}>
          {/* –ø–æ—Ç–æ–º –∑–∞–º–µ–Ω–∏–º –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π –ª–æ–≥–æ—Ç–∏–ø –∏–∑ /public */}
          <span className={styles.logoMark}>G</span>
          <span className={styles.brandText}>Grahalia Estates</span>
        </div>

        <nav className={styles.nav}>
          {NAV.map((item) => (
            <a
              key={item.id}
              href={`#${item.id}`}
              className={`${styles.link} ${activeId === item.id ? styles.active : ""}`}
            >
              {item.label}
            </a>
          ))}
        </nav>

        <a href="#contact" className={styles.cta}>
          –ö–æ–Ω—Ç–∞–∫—Ç
        </a>
      </div>
    </header>
  );
}

```

---

## app/src/components/Header/header.module.css

```css
.header {
  position: sticky;
  top: 0;
  z-index: 50;
  height: var(--header-h);
  background: color-mix(in srgb, var(--bg) 85%, white 15%);
  border-bottom: 1px solid var(--border);
  backdrop-filter: blur(10px);
}

.inner {
  height: 100%;
  display: flex;
  align-items: center;
  gap: 18px;
}

.brand {
  display: flex;
  align-items: center;
  gap: 10px;
  min-width: 240px;
}

.logoMark {
  width: 34px;
  height: 34px;
  border: 1px solid var(--border);
  border-radius: 999px;
  display: grid;
  place-items: center;
  font-weight: 600;
}

.brandText {
  font-family: var(--font-serif);
  letter-spacing: 0.2px;
}

.nav {
  display: flex;
  gap: 18px;
  margin-left: auto;
}

.link {
  color: var(--text-muted);
  font-size: 14px;
  padding: 8px 2px;
  transition: color var(--dur-2) var(--ease);
}

.active {
  color: var(--text);
  position: relative;
}

.active::after {
  content: "";
  position: absolute;
  left: 0;
  right: 0;
  bottom: -12px;
  height: 2px;
  background: var(--accent);
}

.cta {
  margin-left: 10px;
  padding: 10px 14px;
  border: 1px solid var(--border);
  border-radius: 999px;
  font-size: 14px;
  transition: background var(--dur-2) var(--ease), border-color var(--dur-2) var(--ease);
}

.cta:hover {
  border-color: color-mix(in srgb, var(--accent) 40%, var(--border) 60%);
  background: color-mix(in srgb, var(--accent) 10%, transparent 90%);
}

/* –º–æ–±–∏–ª–∫–∞: –º–µ–Ω—é –ø–æ—Ç–æ–º —Å–¥–µ–ª–∞–µ–º –±—É—Ä–≥–µ—Ä–æ–º */
@media (max-width: 860px) {
  .nav {
    display: none;
  }
  .brand {
    min-width: auto;
  }
}

```

---

## app/src/components/Hero/Hero.tsx

```typescript
import Image from "next/image";
import styles from "./hero.module.css";
import { Button } from "@/components/ui/Button";

export function Hero() {
  return (
    <section id="home" className={styles.hero}>
      <div className={`${styles.inner} container`}>
        <div className={styles.copy}>
          <p className={styles.kicker}>–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å –Ω–∞ –ö–æ—Å—Ç–∞-–¥–µ–ª—å-–°–æ–ª—å</p>
          <h1 className={styles.title}>–ù–∞–π–¥–∏—Ç–µ —Å–≤–æ–π –∏–¥–µ–∞–ª—å–Ω—ã–π –¥–æ–º —Å–µ–≥–æ–¥–Ω—è</h1>
          <p className={styles.subtitle}>
            –ü–æ–¥–±–æ—Ä –æ–±—ä–µ–∫—Ç–æ–≤, —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ —Å–¥–µ–ª–∫–∏ –∏ –∞—Ä–µ–Ω–¥–∞. –ú–∏–Ω–∏–º–∞–ª–∏–∑–º –≤ —Å–∞–π—Ç–µ ‚Äî –º–∞–∫—Å–∏–º—É–º –ø–æ–ª—å–∑—ã –≤ —Ä–∞–±–æ—Ç–µ.
          </p>

          <div className={styles.actions}>
            <Button href="#services" variant="primary">
              –°–º–æ—Ç—Ä–µ—Ç—å —É—Å–ª—É–≥–∏
            </Button>
            <Button href="#contact" variant="ghost">
              –°–≤—è–∑–∞—Ç—å—Å—è
            </Button>
          </div>
        </div>

        <div className={styles.visual}>
          <div className={styles.imageWrap}>
            <Image
              src="/hero/house.jpg"
              alt="Modern villa on Costa del Sol"
              fill
              priority
              sizes="(max-width: 900px) 92vw, 980px"
              style={{ objectFit: "cover" }}
            />
          </div>
        </div>
      </div>
    </section>
  );
}

```

---

## app/src/components/Hero/hero.module.css

```css
.hero {
  padding: 42px 0 22px;
}

.inner {
  display: grid;
  grid-template-columns: 1.05fr 1fr;
  gap: 34px;
  align-items: center;
}

.copy {
  animation: rise var(--dur-3) var(--ease) both;
}

.kicker {
  color: var(--accent);
  font-size: 12px;
  letter-spacing: 1.2px;
  text-transform: uppercase;
  margin: 0 0 10px;
}

.title {
  font-family: var(--font-serif);
  font-size: var(--hero-title);
  line-height: 1.05;
  letter-spacing: 0.2px;
  margin: 0 0 14px;
}

.subtitle {
  color: var(--text-muted);
  font-size: var(--hero-subtitle);
  margin: 0 0 20px;
  max-width: 52ch;
}

.actions {
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
}

.visual {
  animation: fade var(--dur-3) var(--ease) both;
}

.imageWrap {
  position: relative;
  width: 100%;
  aspect-ratio: 16 / 10;
  border-radius: var(--radius);
  overflow: hidden;
  box-shadow: var(--shadow);
  border: 1px solid var(--border);
}

/* –º–æ–±–∏–ª–∫–∞ */
@media (max-width: 900px) {
  .inner {
    grid-template-columns: 1fr;
  }
  .hero {
    padding: 26px 0 10px;
  }
}

@keyframes rise {
  from { opacity: 0; transform: translateY(8px); }
  to { opacity: 1; transform: translateY(0); }
}

@keyframes fade {
  from { opacity: 0; }
  to { opacity: 1; }
}

```

---

## app/src/components/ui/Button.tsx

```typescript
import styles from "./button.module.css";

type Props = {
  href?: string;
  children: React.ReactNode;
  variant?: "primary" | "ghost";
  className?: string;
};

export function Button({ href, children, variant = "primary", className = "" }: Props) {
  const cls = `${styles.btn} ${styles[variant]} ${className}`;

  if (href) {
    return (
      <a className={cls} href={href}>
        {children}
      </a>
    );
  }

  return <button className={cls}>{children}</button>;
}

```

---

## app/src/components/ui/button.module.css

```css
.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  padding: 12px 18px;
  border-radius: 999px;
  font-size: 14px;
  letter-spacing: 0.2px;
  transition: transform var(--dur-2) var(--ease),
              background var(--dur-2) var(--ease),
              border-color var(--dur-2) var(--ease),
              color var(--dur-2) var(--ease);
  user-select: none;
}

.btn:hover { transform: translateY(-1px); }
.btn:active { transform: translateY(0px); }

.primary {
  background: var(--accent);
  color: white;
  border: 1px solid color-mix(in srgb, var(--accent) 70%, black 30%);
}

.primary:hover {
  background: var(--accent-hover);
}

.ghost {
  background: transparent;
  color: var(--text);
  border: 1px solid var(--border);
}

.ghost:hover {
  border-color: color-mix(in srgb, var(--accent) 35%, var(--border) 65%);
  background: color-mix(in srgb, var(--accent) 8%, transparent 92%);
}

```

---

## app/src/lib/nav.ts

```typescript
export type NavItem = {
  id: string;
  label: string;
};

export const NAV: NavItem[] = [
  { id: "home", label: "–ì–ª–∞–≤–Ω–∞—è" },
  { id: "about", label: "–û –Ω–∞—Å" },
  { id: "services", label: "–£—Å–ª—É–≥–∏" },
  { id: "gallery", label: "–ì–∞–ª–µ—Ä–µ—è" },
  { id: "contact", label: "–ö–æ–Ω—Ç–∞–∫—Ç" },
];

```

---

## app/src/lib/useActiveSection.ts

```typescript
"use client";

import { useEffect, useState } from "react";

export function useActiveSection(ids: string[]) {
  const [activeId, setActiveId] = useState(ids[0] ?? "");

  useEffect(() => {
    const els = ids
      .map((id) => document.getElementById(id))
      .filter(Boolean) as HTMLElement[];

    if (!els.length) return;

    const obs = new IntersectionObserver(
      (entries) => {
        const visible = entries
          .filter((e) => e.isIntersecting)
          .sort((a, b) => (b.intersectionRatio ?? 0) - (a.intersectionRatio ?? 0))[0];

        if (visible?.target?.id) setActiveId(visible.target.id);
      },
      {
        root: null,
        rootMargin: "-40% 0px -55% 0px",
        threshold: [0.1, 0.2, 0.35, 0.5],
      }
    );

    els.forEach((el) => obs.observe(el));
    return () => obs.disconnect();
  }, [ids.join("|")]);

  return activeId;
}

```

---

## app/src/styles/globals.css

```css
@import "./tokens.css";

* { box-sizing: border-box; }
html { scroll-behavior: smooth; scroll-padding-top: var(--header-h); }
body {
  margin: 0;
  font-family: var(--font-sans);
  font-size: var(--text-base);
  line-height: var(--line-height);
  color: var(--text);
  background: var(--bg);
}

a { color: inherit; text-decoration: none; }
.container { width: min(var(--container), calc(100% - 32px)); margin: 0 auto; }

```

---

## app/src/styles/tokens.css

```css
:root {
  /* Colors */
  --bg: #f7f7f5;
  --surface: #ffffff;
  --text: #111214;
  --text-muted: #5b6068;
  --border: #e6e7ea;

  --accent: #0b5d63;
  --accent-hover: #094b50;

    /* Typography */
  --font-sans: var(--font-sans), ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial, "Noto Sans", "Helvetica Neue", sans-serif;
  --font-serif: var(--font-serif), ui-serif, "Georgia", "Times New Roman", serif;

  --text-base: 16px;
  --line-height: 1.6;

  /* Hero */
  --hero-title: clamp(34px, 5vw, 56px);
  --hero-subtitle: clamp(16px, 2vw, 18px);

  /* Radius / Shadows */
  --radius: 14px;
  --radius-sm: 10px;
  --shadow: 0 10px 30px rgba(0,0,0,0.08);

  /* Layout */
  --container: 1120px;
  --header-h: 78px;

  /* Motion */
  --ease: cubic-bezier(.2,.8,.2,1);
  --dur-1: 150ms;
  --dur-2: 250ms;
  --dur-3: 350ms;
}

```

---

## app/tsconfig.json

```json
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "react-jsx",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": [
    "next-env.d.ts",
    "**/*.ts",
    "**/*.tsx",
    ".next/types/**/*.ts",
    ".next/dev/types/**/*.ts",
    "**/*.mts"
  ],
  "exclude": ["node_modules"]
}

```

---

## backup_grahalia_db.sql

```sql

```

---

## components/About/About.module.css

```css
.section {
  padding: 72px 0;
  border-top: 1px solid rgba(226, 226, 222, 0.8);
}

.grid {
  display: grid;
  grid-template-columns: 1.1fr 0.9fr;
  gap: 22px;
  align-items: center;
}

.text {
  background: rgba(255, 255, 255, 0.62);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 22px;
  box-shadow: var(--shadow);
}

.subtitle {
  margin-top: 10px;
  font-size: 15px;
}

.body {
  margin-top: 14px;
  font-size: 15px;
}

.btn {
  margin-top: 18px;
  width: fit-content;
  padding: 10px 14px;
}

.media {
  border-radius: var(--radius);
  overflow: hidden;
  border: 1px solid var(--border);
  box-shadow: var(--shadow);
  background: #eee;
  aspect-ratio: 4 / 3;
}

.image {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}

@media (max-width: 960px) {
  .grid {
    grid-template-columns: 1fr;
  }

  .media {
    aspect-ratio: 16 / 10;
  }
}

```

---

## components/About/About.tsx

```typescript
"use client";

import { scrollToHash } from "@/utils/smoothScroll";
import styles from "./About.module.css";

type AboutDict = {
  title: string;
  subtitle: string;
  body: string;
  cta: string;
};

export default function About({ t }: { t: AboutDict }) {
  const OFFSET = 90;

  return (
    <section id="about" className={`section ${styles.section}`}>
      <div className="container">
        {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å–µ–∫—Ü–∏–∏ –∫–∞–∫ –≤ –º–∞–∫–µ—Ç–µ: –ø–æ —Ü–µ–Ω—Ç—Ä—É + –ª–∏–Ω–∏–∏ */}
        <div className="section__head">
          <h2 className="sectionTitle">
            <span className="sectionTitleText">{t.title}</span>
          </h2>
        </div>

        <div className={styles.grid}>
          <div className={styles.text}>
            <p className={`p ${styles.subtitle}`}>{t.subtitle}</p>

            <p className={`p ${styles.body}`}>{t.body}</p>

            <a
              className={`btn btnPrimary ${styles.btn}`}
              href="#contact"
              onClick={(e) => {
                e.preventDefault();
                scrollToHash("#contact", { offset: OFFSET });
              }}
            >
              {t.cta}
            </a>
          </div>

          <div className={styles.media}>
            <img
              className={styles.image}
              src="/about.jpg"
              alt={t.title}
              loading="lazy"
            />
          </div>
        </div>
      </div>
    </section>
  );
}

```

---

## components/AppShell/AppShell.tsx

```typescript
"use client";

import { useCallback, useState } from "react";
import Footer from "@/components/Footer/Footer";
import CookieConsentUI from "@/components/CookieConsent/CookieConsent";

export default function AppShell({
  lang,
  footerT,
  cookieT,
  children,
}: {
  lang: "en" | "es";
  footerT?: any;
  cookieT?: any;
  children: React.ReactNode;
}) {
  // ‚úÖ –≤–∞–∂–Ω–æ: undefined –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, —á—Ç–æ–±—ã –º–æ–¥–∞–ª–∫–∞ –ù–ï –æ—Ç–∫—Ä—ã–≤–∞–ª–∞—Å—å —Å—Ä–∞–∑—É
  const [openKey, setOpenKey] = useState<number | undefined>(undefined);

  const onManageCookies = useCallback(() => {
    // ‚úÖ –Ω–æ–≤—ã–π –∫–ª—é—á –Ω–∞ –∫–∞–∂–¥—ã–π –∫–ª–∏–∫
    setOpenKey(Date.now());
  }, []);

  return (
    <>
      {children}

      {/* ‚úÖ —Ñ—É—Ç–µ—Ä –º–æ–∂–Ω–æ —Å–∫—Ä—ã—Ç—å, –µ—Å–ª–∏ –Ω–µ—Ç —Å–ª–æ–≤–∞—Ä—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ –∞–¥–º–∏–Ω–∫–µ) */}
      <Footer lang={lang} t={footerT} onManageCookies={onManageCookies} />

      {/* ‚úÖ –±–∞–Ω–Ω–µ—Ä/–º–æ–¥–∞–ª–∫–∞ —Ç–æ–∂–µ —Ç–∏—Ö–æ –Ω–µ –ø–æ–∫–∞–∂—É—Ç—Å—è, –µ—Å–ª–∏ cookieT –Ω–µ—Ç */}
      <CookieConsentUI t={cookieT} openKey={openKey} />
    </>
  );
}

```

---

## components/Contact/Contact.module.css

```css
.section {
  padding: 72px 0 90px;
  border-top: 1px solid rgba(226, 226, 222, 0.8);
  overflow: visible;
}

.head {
  margin-bottom: 18px;
}

.grid {
  display: grid;
  grid-template-columns: 1.2fr 0.8fr;
  gap: 18px;
  align-items: start;
  margin-top: 16px;
}

/* --- Form --- */
.form {
  background: rgba(255, 255, 255, 0.62);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 22px;
  box-shadow: var(--shadow);

  display: flex;
  flex-direction: column;
  gap: 12px;
}

.row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
  align-items: end; /* ‚úÖ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–µ–º –∫–æ–ª–æ–Ω–∫–∏ –ø–æ –Ω–∏–∂–Ω–µ–º—É –∫—Ä–∞—é */
}

.field {
  display: flex;
  flex-direction: column;
  margin-top: 12px;
  gap: 0; /* ‚úÖ —á—Ç–æ–±—ã –æ—Ç—Å—Ç—É–ø –∑–∞–¥–∞–≤–∞–ª label */
}

.field:first-child {
  margin-top: 0;
}

.label {
  display: block;
  min-height: 16px;   /* ‚úÖ –æ–¥–∏–Ω–∞–∫–æ–≤–∞—è –≤—ã—Å–æ—Ç–∞ –ª–µ–π–±–ª–∞ */
  line-height: 16px;  /* ‚úÖ —á—Ç–æ–±—ã –Ω–∏–≥–¥–µ –Ω–µ "–ø–ª–∞–≤–∞–ª–æ" */
  font-size: 12px;
  color: rgba(28, 28, 28, 0.75);
  font-weight: 600;
  margin-bottom: 6px; /* ‚úÖ —Ñ–∏–∫—Å–∏—Ä—É–µ–º –æ—Ç—Å—Ç—É–ø, –≤–º–µ—Å—Ç–æ gap */
}

.input,
.textarea {
  border: 1px solid var(--border);
  border-radius: 10px;     /* –±—ã–ª–æ 12 */
  padding: 9px 12px;      /* –±—ã–ª–æ 12 12 */
  font-size: 14px;
  outline: none;
  background: rgba(255, 255, 255, 0.85);
}

.input:focus,
.textarea:focus {
  border-color: rgba(43, 69, 55, 0.45); /* –ø–æ–¥ —Ç–≤–æ–π --accent */
  box-shadow: 0 0 0 4px rgba(43, 69, 55, 0.10);
}

.textarea {
  min-height: 96px;
  max-height: 220px;
  resize: vertical;
}

/* ===== Contact primary button (always visible, no "lift" on hover) ===== */
.form :global(.btn.btnPrimary) {
  margin-top: 10px;
  width: 220px;
  justify-content: center;

  background: var(--accent) !important;
  color: #fff !important;
  opacity: 1 !important;
  visibility: visible !important;

  border: 1px solid transparent;
}

/* hover = —Ç–æ–ª—å–∫–æ —Å–º–µ–Ω–∞ —Ü–≤–µ—Ç–∞, –±–µ–∑ transform */
.form :global(.btn.btnPrimary:hover) {
  background: var(--accentHover) !important;
  transform: none !important;
}

/* active –æ—Å—Ç–∞–≤–ª—è–µ–º "—Ç–∞–ø" –∫–∞–∫ –≤ –≥–ª–æ–±–∞–ª–µ */
.form :global(.btn.btnPrimary:active) {
  transform: translateY(1px);
}

/* --- Status texts under button --- */
.actionsRow {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-top: 12px;
}

.okText {
  color: var(--accent);
  font-weight: 600;
}

.errText {
  color: #b00020;
  font-weight: 600;
}

/* --- Info card --- */
.infoCard {
  background: rgba(255, 255, 255, 0.62);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 22px;
  box-shadow: var(--shadow);
}

.infoTitle {
  font-family: var(--font-playfair), Georgia, "Times New Roman", serif;
  font-size: 18px;
  margin-bottom: 12px;
}

.infoItem {
  display: flex;
  gap: 10px;
  align-items: center;
  padding: 8px 0;
}

.infoIcon {
  width: 28px;
  height: 28px;
  border-radius: 10px;
  display: grid;
  place-items: center;
  background: rgba(43, 69, 55, 0.08); /* –ø–æ–¥ --accent */
}

.infoLink {
  color: var(--text);
  font-weight: 600;
}

.infoLink:hover {
  color: var(--accent);
}

.divider {
  height: 1px;
  background: rgba(226, 226, 222, 0.8);
  margin: 12px 0;
}

.waBtn {
  width: 100%;
  justify-content: center;
  margin-top: 6px;
  text-decoration: none;
}

.note {
  margin-top: 12px;
  font-size: 13px;
}

.footerLine {
  height: 1px;
  background: rgba(226, 226, 222, 0.8);
  margin-top: 28px;
}

/* --- Responsive --- */
@media (max-width: 960px) {
  .grid {
    grid-template-columns: 1fr;
  }

  .row {
    grid-template-columns: 1fr;
  }
}

@media (max-width: 560px) {
  .form :global(.btn.btnPrimary) {
    width: 100%;
  }
}

```

---

## components/Contact/Contact.tsx

```typescript
"use client";

import { useMemo, useState } from "react";
import styles from "./Contact.module.css";

type ContactDict = {
  title: string;
  subtitle: string;

  form: {
    name: string;
    phone: string;
    email: string;
    message: string;
    send: string;
    namePlaceholder: string;
    phonePlaceholder: string;
    emailPlaceholder: string;
    messagePlaceholder: string;
  };

  info: {
    title: string;
    whatsapp: string;
    note: string;
  };

  footerRights: string;
};

type Props = {
  t: ContactDict;
  lang: "en" | "es"; // ‚úÖ –¥–æ–±–∞–≤–∏–ª–∏
};

function isEmail(x: string) {
  return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(x);
}

export default function Contact({ t, lang }: Props) {
  const pageUrl = useMemo(() => {
    if (typeof window !== "undefined") return window.location.href;
    return "";
  }, []);

  const [name, setName] = useState("");
  const [phone, setPhone] = useState("");
  const [email, setEmail] = useState("");
  const [message, setMessage] = useState("");

  const [loading, setLoading] = useState(false);
  const [ok, setOk] = useState(false);
  const [error, setError] = useState<string | null>(null);

  async function onSubmit(e: React.FormEvent) {
    e.preventDefault();
    setOk(false);
    setError(null);

    const cleanName = name.trim();
    const cleanPhone = phone.trim();
    const cleanEmail = email.trim();
    const cleanMessage = message.trim();

    if (!cleanName || !cleanPhone || !cleanEmail) {
      setError(lang === "es" ? "Rellena nombre, tel√©fono y email." : "Please fill name, phone and email.");
      return;
    }
    if (!isEmail(cleanEmail)) {
      setError(lang === "es" ? "Email no v√°lido." : "Invalid email.");
      return;
    }

    setLoading(true);

    try {
      const res = await fetch("/api/leads", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          name: cleanName,
          phone: cleanPhone,
          email: cleanEmail,
          message: cleanMessage ? cleanMessage : null,
          lang,
          page_url: pageUrl || `/${lang}`,
          property_id: null,
          property_slug: null,
        }),
      });

      const data = await res.json().catch(() => ({}));

      if (!res.ok) {
        setError(data?.error || (lang === "es" ? "Error al enviar. Int√©ntalo de nuevo." : "Failed to send. Try again."));
        return;
      }

      setOk(true);
      setName("");
      setPhone("");
      setEmail("");
      setMessage("");
    } catch {
      setError(lang === "es" ? "Error al enviar. Int√©ntalo de nuevo." : "Failed to send. Try again.");
    } finally {
      setLoading(false);
    }
  }

  return (
    <section id="contact" className={`section ${styles.section}`}>
      <div className="container">
        {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å–µ–∫—Ü–∏–∏ */}
        <div className="section__head">
          <h2 className="sectionTitle">
            <span className="sectionTitleText">{t.title}</span>
          </h2>
          <p className="section__kicker">{t.subtitle}</p>
        </div>

        <div className={styles.grid}>
          {/* Form */}
          <form className={styles.form} onSubmit={onSubmit}>
            <div className={styles.row}>
              <div className={styles.field}>
                <label className={styles.label} htmlFor="name">
                  {t.form.name}
                </label>
                <input
                  className={styles.input}
                  id="name"
                  name="name"
                  placeholder={t.form.namePlaceholder}
                  value={name}
                  onChange={(e) => setName(e.target.value)}
                  required
                  autoComplete="name"
                />
              </div>

              <div className={styles.field}>
                <label className={styles.label} htmlFor="phone">
                  {t.form.phone}
                </label>
                <input
                  className={styles.input}
                  id="phone"
                  name="phone"
                  placeholder={t.form.phonePlaceholder}
                  value={phone}
                  onChange={(e) => setPhone(e.target.value)}
                  required
                  autoComplete="tel"
                />
              </div>
            </div>

            <div className={styles.field}>
              <label className={styles.label} htmlFor="email">
                {t.form.email}
              </label>
              <input
                className={styles.input}
                id="email"
                name="email"
                placeholder={t.form.emailPlaceholder}
                value={email}
                onChange={(e) => setEmail(e.target.value)}
                required
                autoComplete="email"
                inputMode="email"
              />
            </div>

            <div className={styles.field}>
              <label className={styles.label} htmlFor="message">
                {t.form.message}
              </label>
              <textarea
                className={styles.textarea}
                id="message"
                name="message"
                placeholder={t.form.messagePlaceholder}
                value={message}
                onChange={(e) => setMessage(e.target.value)}
                rows={5}
              />
            </div>

            <div className={styles.actionsRow}>
              <button className="btn btnPrimary" type="submit" disabled={loading}>
                {loading ? (lang === "es" ? "Enviando..." : "Sending...") : t.form.send}
              </button>

              {ok ? (
                <span className={styles.okText}>{lang === "es" ? "Enviado ‚úÖ" : "Sent ‚úÖ"}</span>
              ) : null}

              {error ? <span className={styles.errText}>{error}</span> : null}
            </div>
          </form>

          {/* Info */}
          <aside className={styles.info}>
            <div className={styles.infoCard}>
              <div className={styles.infoTitle}>{t.info.title}</div>

              <div className={styles.infoItem}>
                <span className={styles.infoIcon}>üìû</span>
                <a className={styles.infoLink} href="tel:+34123456789">
                  +34 123 456 789
                </a>
              </div>

              <div className={styles.infoItem}>
                <span className={styles.infoIcon}>‚úâÔ∏è</span>
                <a className={styles.infoLink} href="mailto:info@grahaliaestates.com">
                  info@grahaliaestates.com
                </a>
              </div>

              <div className={styles.divider} />

              <a className={`btn btnPrimary ${styles.waBtn}`} href="https://wa.me/34123456789" target="_blank" rel="noreferrer">
                {t.info.whatsapp}
              </a>

              <p className={`p ${styles.note}`}>{t.info.note}</p>
            </div>
          </aside>
        </div>

        
        
      </div>
    </section>
  );
}

```

---

## components/CookieConsent/CookieConsent.module.css

```css
.banner {
  position: fixed;
  left: 14px;
  right: 14px;
  bottom: 14px;
  z-index: 9999;
}

.bannerInner {
  background: rgba(255, 255, 255, 0.86);
  border: 1px solid var(--border);
  border-radius: 12px;
  box-shadow: var(--shadow);
  backdrop-filter: blur(8px);
  padding: 14px;
  display: grid;
  gap: 12px;
}

.text {
  color: rgba(28, 28, 28, 0.75);
  font-size: 13px;
  line-height: 1.45;
}

.actions {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  justify-content: flex-end;
}

/* Modal */
.overlay {
  position: fixed;
  inset: 0;
  z-index: 10000;
  background: rgba(0, 0, 0, 0.36);
  display: grid;
  place-items: center;
  padding: 16px;
}

.modal {
  width: min(560px, 100%);
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  box-shadow: var(--shadow);
  padding: 16px;
}

.modalTop {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
}

.modalTitle {
  font-family: var(--font-playfair), Georgia, "Times New Roman", serif;
  font-size: 18px;
  font-weight: 600;
}

.close {
  appearance: none;
  border: 1px solid var(--border);
  background: rgba(255, 255, 255, 0.85);
  border-radius: 10px;
  padding: 8px 10px;
  cursor: pointer;
}

.modalText {
  margin-top: 10px;
  color: rgba(28, 28, 28, 0.72);
  font-size: 13px;
  line-height: 1.5;
}

.rows {
  margin-top: 12px;
  display: grid;
  gap: 10px;
}

.row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 14px;
  padding: 12px;
  border: 1px solid var(--border);
  border-radius: 12px;
  background: rgba(255, 255, 255, 0.7);
}

.rowTitle {
  font-weight: 600;
  font-size: 13px;
}

.rowNote {
  margin-top: 3px;
  font-size: 12px;
  color: rgba(28, 28, 28, 0.6);
}

.locked {
  font-weight: 700;
  color: rgba(28, 28, 28, 0.7);
}

/* Switch */
.switch {
  position: relative;
  width: 44px;
  height: 26px;
}
.switch input {
  display: none;
}
.slider {
  position: absolute;
  inset: 0;
  border-radius: 999px;
  border: 1px solid var(--border);
  background: rgba(255, 255, 255, 0.85);
  cursor: pointer;
  transition: background 0.15s ease, border 0.15s ease;
}
.slider::after {
  content: "";
  position: absolute;
  top: 3px;
  left: 3px;
  width: 20px;
  height: 20px;
  border-radius: 999px;
  background: var(--accent);
  transition: transform 0.15s ease;
}
.switch input:checked + .slider {
  background: rgba(43, 69, 55, 0.12);
  border-color: rgba(43, 69, 55, 0.35);
}
.switch input:checked + .slider::after {
  transform: translateX(18px);
}

.modalActions {
  margin-top: 14px;
  display: flex;
  justify-content: flex-end;
  gap: 10px;
}

```

---

## components/CookieConsent/CookieConsent.tsx

```typescript
"use client";

import { useEffect, useState } from "react";
import styles from "./CookieConsent.module.css";
import {
  CookieConsent,
  getDefaultConsent,
  hasMadeChoice,
  readConsent,
  writeConsent,
} from "@/app/lib/cookies/consent";

type Dict = {
  bannerText: string;
  acceptAll: string;
  rejectAll: string;
  manage: string;

  modalTitle: string;
  modalText: string;

  necessaryTitle: string;
  necessaryDesc: string;

  analyticsTitle: string;
  analyticsDesc: string;

  marketingTitle: string;
  marketingDesc: string;

  save: string;
  close: string;
};

export default function CookieConsentUI({
  t,
  openKey,
}: {
  t?: Dict;          // ‚úÖ –¥–µ–ª–∞–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ
  openKey?: number;
}) {
  // ‚úÖ –µ—Å–ª–∏ —Å–ª–æ–≤–∞—Ä—è –Ω–µ—Ç ‚Äî –Ω–µ –ª–æ–º–∞–µ–º —Å–∞–π—Ç
  if (!t) return null;

  const [visible, setVisible] = useState(false);
  const [modalOpen, setModalOpen] = useState(false);

  const [analytics, setAnalytics] = useState(false);
  const [marketing, setMarketing] = useState(false);

  useEffect(() => {
    setVisible(!hasMadeChoice());

    const current = readConsent();
    if (current) {
      setAnalytics(!!current.analytics);
      setMarketing(!!current.marketing);
    }
  }, []);

  useEffect(() => {
    if (openKey === undefined) return;

    const current = readConsent();
    if (current) {
      setAnalytics(!!current.analytics);
      setMarketing(!!current.marketing);
    } else {
      const d = getDefaultConsent();
      setAnalytics(!!d.analytics);
      setMarketing(!!d.marketing);
    }

    setModalOpen(true);
    setVisible(false);
  }, [openKey]);

  const acceptAll = () => {
    writeConsent({
      necessary: true,
      analytics: true,
      marketing: true,
      updatedAt: Date.now(),
    });
    setAnalytics(true);
    setMarketing(true);
    setVisible(false);
    setModalOpen(false);
  };

  const rejectAll = () => {
    writeConsent({
      necessary: true,
      analytics: false,
      marketing: false,
      updatedAt: Date.now(),
    });
    setAnalytics(false);
    setMarketing(false);
    setVisible(false);
    setModalOpen(false);
  };

  const save = () => {
    writeConsent({
      necessary: true,
      analytics,
      marketing,
      updatedAt: Date.now(),
    });
    setVisible(false);
    setModalOpen(false);
  };

  return (
    <>
      {/* Banner */}
      {visible ? (
        <div className={styles.banner} role="region" aria-label="Cookie banner">
          <div className={styles.bannerInner}>
            <div className={styles.text}>{t.bannerText}</div>

            <div className={styles.actions}>
              <button
                className="btn btnGhost"
                type="button"
                onClick={() => setModalOpen(true)}
              >
                {t.manage}
              </button>

              <button className="btn btnGhost" type="button" onClick={rejectAll}>
                {t.rejectAll}
              </button>

              <button className="btn btnPrimary" type="button" onClick={acceptAll}>
                {t.acceptAll}
              </button>
            </div>
          </div>
        </div>
      ) : null}

      {/* Modal */}
      {modalOpen ? (
        <div
          className={styles.overlay}
          role="dialog"
          aria-modal="true"
          aria-label={t.modalTitle}
          onClick={(e) => {
            if (e.target === e.currentTarget) setModalOpen(false);
          }}
        >
          <div className={styles.modal}>
            <div className={styles.modalTop}>
              <div className={styles.modalTitle}>{t.modalTitle}</div>
              <button
                className={styles.close}
                type="button"
                onClick={() => setModalOpen(false)}
              >
                {t.close}
              </button>
            </div>

            <div className={styles.modalText}>{t.modalText}</div>

            <div className={styles.rows}>
              {/* Necessary */}
              <div className={styles.row}>
                <div>
                  <div className={styles.rowTitle}>{t.necessaryTitle}</div>
                  <div className={styles.rowNote}>{t.necessaryDesc}</div>
                </div>
                <div className={styles.locked}>On</div>
              </div>

              {/* Analytics */}
              <div className={styles.row}>
                <div>
                  <div className={styles.rowTitle}>{t.analyticsTitle}</div>
                  <div className={styles.rowNote}>{t.analyticsDesc}</div>
                </div>
                <label className={styles.switch}>
                  <input
                    type="checkbox"
                    checked={analytics}
                    onChange={(e) => setAnalytics(e.target.checked)}
                  />
                  <span className={styles.slider} />
                </label>
              </div>

              {/* Marketing */}
              <div className={styles.row}>
                <div>
                  <div className={styles.rowTitle}>{t.marketingTitle}</div>
                  <div className={styles.rowNote}>{t.marketingDesc}</div>
                </div>
                <label className={styles.switch}>
                  <input
                    type="checkbox"
                    checked={marketing}
                    onChange={(e) => setMarketing(e.target.checked)}
                  />
                  <span className={styles.slider} />
                </label>
              </div>
            </div>

            <div className={styles.modalActions}>
              <button className="btn btnGhost" type="button" onClick={rejectAll}>
                {t.rejectAll}
              </button>
              <button className="btn btnPrimary" type="button" onClick={save}>
                {t.save}
              </button>
            </div>
          </div>
        </div>
      ) : null}
    </>
  );
}

```

---

## components/DealToggle/DealToggle.tsx

```typescript
"use client";

import Link from "next/link";
import { usePathname, useSearchParams } from "next/navigation";

type Deal = "all" | "sale" | "rent";

function withParam(params: URLSearchParams, key: string, value?: string) {
  const p = new URLSearchParams(params.toString());
  if (!value || value === "all") p.delete(key);
  else p.set(key, value);
  p.delete("page"); // –ø—Ä–∏ —Å–º–µ–Ω–µ —Ç–∏–ø–∞ —Å–¥–µ–ª–∫–∏ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–∞–≥–∏–Ω–∞—Ü–∏—é
  const qs = p.toString();
  return qs ? `?${qs}` : "";
}

export default function DealToggle() {
  const pathname = usePathname();
  const sp = useSearchParams();

  const deal = (sp.get("deal") as Deal) || "all";

  const items: Array<{ key: Deal; label: string }> = [
    { key: "all", label: "All" },
    { key: "sale", label: "For Sale" },
    { key: "rent", label: "For Rent" },
  ];

  return (
    <div style={{ display: "inline-flex", gap: 8, alignItems: "center" }}>
      {items.map((it) => {
        const active = deal === it.key;
        return (
          <Link
            key={it.key}
            href={`${pathname}${withParam(new URLSearchParams(sp.toString()), "deal", it.key)}`}
            style={{
              padding: "8px 12px",
              borderRadius: 999,
              border: "1px solid #E2E2DE",
              textDecoration: "none",
              color: "inherit",
              fontWeight: 600,
              background: active ? "#0E5E56" : "#fff",
              color: active ? "#fff" : "inherit",
            }}
          >
            {it.label}
          </Link>
        );
      })}
    </div>
  );
}

```

---

## components/Featured/Featured.module.css

```css
.section {
  padding: 72px 0;
}

.head {
  display: flex;
  align-items: flex-end;
  justify-content: space-between;
  gap: 16px;
  margin-bottom: 18px;
}

.allBtn {
  padding: 10px 14px;
  white-space: nowrap;
}

.grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 18px;
  margin-top: 16px;
}

.fadeWrap {
  will-change: opacity, transform;
}

/* –ú–Ø–ì–ö–û–ï –ü–û–Ø–í–õ–ï–ù–ò–ï */
.fadeIn {
  opacity: 1;
  transform: translateY(0);
  transition:
    opacity var(--fade-ms, 800ms)
      cubic-bezier(0.2, 0.8, 0.2, 1),
    transform var(--fade-ms, 800ms)
      cubic-bezier(0.2, 0.8, 0.2, 1);
}

/* –ú–Ø–ì–ö–û–ï –ò–°–ß–ï–ó–ù–û–í–ï–ù–ò–ï */
.fadeOut {
  opacity: 0;
  transform: translateY(6px);
  transition:
    opacity var(--fade-ms, 500ms)
      cubic-bezier(0.4, 0.0, 0.2, 1),
    transform var(--fade-ms, 500ms)
      cubic-bezier(0.4, 0.0, 0.2, 1);
}


@media (max-width: 960px) {
  .grid {
    grid-template-columns: 1fr;
  }

  .head {
    align-items: flex-start;
    flex-direction: column;
  }
}

```

---

## components/Featured/Featured.tsx

```typescript
"use client";

import { useEffect, useMemo, useRef, useState } from "react";
import Link from "next/link";
import PropertyCard from "../PropertyCard/PropertyCard";
import styles from "./Featured.module.css";

type FeaturedDict = {
  title: string;
  subtitle: string;
  cta: string;
  card: any;
};

export type FeaturedItem = {
  id?: number | string;
  title: string;
  location: string;
  price: string;
  beds: number;
  baths: number;
  area: number;
  image: string;
  slug?: string;
};

const fallbackFeatured: FeaturedItem[] = [
  {
    title: "Modern Villa in Marbella",
    location: "Marbella ¬∑ Costa del Sol",
    price: "‚Ç¨1,250,000",
    beds: 4,
    baths: 3,
    area: 250,
    image: "/properties/p1.jpg",
  },
  {
    title: "Seaside Apartment in Estepona",
    location: "Estepona ¬∑ Costa del Sol",
    price: "‚Ç¨850,000",
    beds: 2,
    baths: 2,
    area: 120,
    image: "/properties/p2.jpg",
  },
  {
    title: "Luxury Villa in Benahav√≠s",
    location: "Benahav√≠s ¬∑ Costa del Sol",
    price: "Price on Request",
    beds: 5,
    baths: 5,
    area: 450,
    image: "/properties/p3.jpg",
  },
];

type Props = {
  lang: "en" | "es";
  t: FeaturedDict;
  items?: FeaturedItem[];

  itemsPerView?: number;
  intervalMs?: number;
  randomStart?: boolean;
  fadeMs?: number;
};

export default function Featured({
  lang,
  t,
  items,
  itemsPerView = 3,
  intervalMs = 6000,
  randomStart = true,
  fadeMs = 1000,
}: Props) {
  const pool: FeaturedItem[] = useMemo(() => {
    return Array.isArray(items) && items.length > 0 ? items : fallbackFeatured;
  }, [items]);

  const pageCount = Math.max(1, Math.ceil(pool.length / itemsPerView));

  const [page, setPage] = useState(0);
  const [isFading, setIsFading] = useState(false);

  const intervalRef = useRef<number | null>(null);
  const fadeTimeoutRef = useRef<number | null>(null);

  useEffect(() => {
    return () => {
      if (intervalRef.current) window.clearInterval(intervalRef.current);
      if (fadeTimeoutRef.current) window.clearTimeout(fadeTimeoutRef.current);
    };
  }, []);

  useEffect(() => {
    if (page >= pageCount) setPage(0);
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [pageCount]);

  useEffect(() => {
    if (!randomStart) return;
    if (pageCount <= 1) return;

    setPage((current) => {
      if (current !== 0) return current;
      return Math.floor(Math.random() * pageCount);
    });
  }, [randomStart, pageCount]);

  const goNext = () => {
    if (pageCount <= 1) return;

    setIsFading(true);

    if (fadeTimeoutRef.current) window.clearTimeout(fadeTimeoutRef.current);

    fadeTimeoutRef.current = window.setTimeout(() => {
      setPage((p) => (p + 1) % pageCount);
      setIsFading(false);
    }, fadeMs);
  };

  useEffect(() => {
    if (pageCount <= 1) return;

    if (intervalRef.current) window.clearInterval(intervalRef.current);

    intervalRef.current = window.setInterval(() => {
      goNext();
    }, intervalMs);

    return () => {
      if (intervalRef.current) window.clearInterval(intervalRef.current);
      intervalRef.current = null;
    };
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [pageCount, intervalMs, fadeMs]);

  const visible = useMemo(() => {
    const start = page * itemsPerView;
    const slice = pool.slice(start, start + itemsPerView);

    if (slice.length < itemsPerView && pool.length > slice.length) {
      return slice.concat(pool.slice(0, itemsPerView - slice.length));
    }

    return slice;
  }, [pool, page, itemsPerView]);

  return (
    <section id="properties" className={`section ${styles.section}`}>
      <div className="container">
        <div className="section__head">
          <h2 className="sectionTitle">
            <span className="sectionTitleText">{t.title}</span>
          </h2>
          <p className="section__kicker">{t.subtitle}</p>
        </div>

        <div
          className={`${styles.fadeWrap} ${isFading ? styles.fadeOut : styles.fadeIn}`}
          style={{ ["--fade-ms" as any]: `${fadeMs}ms` }}
        >
          <div className={styles.grid}>
            {visible.map((p) => (
              <PropertyCard
                key={String(p.id ?? p.title)}
                property={{
                  ...p,
                  // ‚úÖ —Ç–µ–ø–µ—Ä—å "View Details" –≤–µ–¥—ë—Ç –Ω–∞ –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ–±—ä–µ–∫—Ç–∞
                  href: p.slug ? `/${lang}/properties/${p.slug}` : `/${lang}#contact`,
                }}
                t={t.card}
              />
            ))}
          </div>
        </div>

        <div className="section__actions">
          <Link className={`btn btnPrimary ${styles.allBtn}`} href={`/${lang}/properties`}>
            {t.cta}
          </Link>
        </div>
      </div>
    </section>
  );
}

```

---

## components/Footer/Footer.module.css

```css
.footer {
  border-top: 1px solid rgba(226, 226, 222, 0.8);
  padding: 44px 0 26px;
  background: rgba(255, 255, 255, 0.35);
}

.inner {
  display: grid;
  gap: 22px;
}

.grid {
  display: grid;
  grid-template-columns: 1.2fr 1fr 0.8fr;
  gap: 18px;
  align-items: start;
}

.col {
  display: grid;
  gap: 10px;
}

.brand {
  font-family: var(--font-playfair), Georgia, "Times New Roman", serif;
  font-size: 18px;
  font-weight: 600;
}

.meta {
  color: rgba(28, 28, 28, 0.55);
  font-size: 13px;
}

.title {
  font-size: 12px;
  font-weight: 700;
  letter-spacing: 0.12em;
  text-transform: uppercase;
  color: rgba(28, 28, 28, 0.7);
}

.links,
.socials {
  display: grid;
  gap: 10px;
}

.links a,
.socials a {
  color: var(--text);
  font-weight: 600;
  font-size: 14px;
}

.links a:hover {
  color: var(--accent);
}

.socialDisabled {
  opacity: 0.55;
  cursor: not-allowed;
}

.hint {
  color: rgba(28, 28, 28, 0.45);
  font-size: 12px;
  margin-top: -4px;
}

.bottom {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 14px;
  padding-top: 16px;
  border-top: 1px solid rgba(226, 226, 222, 0.8);
}

.copy {
  font-size: 12px;
  color: rgba(28, 28, 28, 0.6);
}

.legal {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
  justify-content: flex-end;
  align-items: center;
}

.legal a {
  font-size: 12px;
  color: rgba(28, 28, 28, 0.7);
  font-weight: 600;
}

.legal a:hover {
  color: var(--accent);
}

.manageBtn {
  appearance: none;
  border: 1px solid rgba(226, 226, 222, 0.9);
  background: rgba(255, 255, 255, 0.6);
  color: rgba(28, 28, 28, 0.8);
  padding: 8px 10px;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 700;
  font-size: 12px;
}

.manageBtn:hover {
  background: rgba(255, 255, 255, 0.85);
}

.brandBlock {
  display: flex;
  flex-direction: column;
  align-items: center;   /* ‚úÖ —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –≤—Å—ë */
  gap: 6px;              /* –∫–æ–º–ø–∞–∫—Ç–Ω–µ–µ */
  max-width: 260px;
}

.brandLogo {
  width: 150px;
  height: auto;
  opacity: 0.95;
}

.location {
  margin-top: -2px;      /* ‚úÖ –ø–æ–¥—Ç—è–≥–∏–≤–∞–µ–º –±–ª–∏–∂–µ –∫ –ª–æ–≥–æ—Ç–∏–ø—É */
  font-size: 13px;
  color: rgba(28, 28, 28, 0.6);
  text-align: center;
  letter-spacing: 0.2px;
}

/* ===== Mobile footer layout: centered logo, links left, socials right ===== */

/* Small phones: logo centered, then 2 columns below */
@media (max-width: 519px) {
  .grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 18px 18px;
    align-items: start;
  }

  /* Brand ‚Äî –Ω–∞ –≤—Å—é —à–∏—Ä–∏–Ω—É –∏ –ø–æ —Ü–µ–Ω—Ç—Ä—É */
  .col:first-child {
    grid-column: 1 / -1;
    display: grid;
    justify-items: center;
    text-align: center;
    margin-bottom: 6px;
  }

  /* –£–±–∏—Ä–∞–µ–º —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Å–ª–æ–≥–∞–Ω, –µ—Å–ª–∏ –æ–Ω –µ—â—ë –≥–¥–µ-—Ç–æ –±—ã–ª */
  .tagline {
    display: none;
  }

  /* Costa del Sol ‚Ä¢ Spain –ø–æ–¥ –ª–æ–≥–æ—Ç–∏–ø–æ–º, –±–ª–∏–∂–µ */
  .meta {
    margin-top: 8px;
    text-align: center;
  }

  /* Links ‚Äî —Å–ª–µ–≤–∞ */
  .col:nth-child(2) {
    justify-self: start;
    text-align: left;
  }

  /* Social ‚Äî —Å–ø—Ä–∞–≤–∞ */
  .col:nth-child(3) {
    justify-self: end;
    text-align: right;
  }

  .links {
    display: grid;
    gap: 10px;
    padding-top: 6px;
  }

  .socials {
    display: grid;
    gap: 10px;
    padding-top: 6px;
  }

  /* Bottom row */
  .bottom {
    display: grid;
    grid-template-columns: 1fr;
    gap: 10px;
    margin-top: 16px;
    padding-top: 14px;
  }

  .copy {
    text-align: left;
  }

  /* Legal –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É + wrap */
  .legal {
    display: flex;
    flex-wrap: wrap;
    justify-content: flex-start;
    align-items: center;
    gap: 8px 14px;
  }

  /* Manage cookies ‚Äî –≤ —Ç–æ–π –∂–µ –≥—Ä—É–ø–ø–µ, –Ω–æ –Ω–µ –æ–≥—Ä–æ–º–Ω–æ–π –ø–æ–ª–æ—Å–æ–π */
  .manageBtn {
    margin-left: auto; /* ‚úÖ —É–µ–∑–∂–∞–µ—Ç –≤–ø—Ä–∞–≤–æ */
    padding: 8px 12px;
    border-radius: 10px;
    white-space: nowrap;
  }
}

/* Wider mobile / small tablets: —Ç–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç ‚Äú3 –∑–æ–Ω—ã –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É‚Äù */
@media (min-width: 520px) and (max-width: 860px) {
  .grid {
    display: grid;
    grid-template-columns: 1fr auto 1fr; /* links | logo | social */
    gap: 18px;
    align-items: start;
  }

  /* Links —Å–ª–µ–≤–∞ */
  .col:nth-child(2) {
    order: 1;
    justify-self: start;
    text-align: left;
  }

  /* Brand –ø–æ —Ü–µ–Ω—Ç—Ä—É */
  .col:first-child {
    order: 2;
    justify-self: center;
    text-align: center;
    display: grid;
    justify-items: center;
  }

  /* Social —Å–ø—Ä–∞–≤–∞ */
  .col:nth-child(3) {
    order: 3;
    justify-self: end;
    text-align: right;
  }

  .tagline {
    display: none;
  }

  .meta {
    margin-top: 8px;
    text-align: center;
  }

  .bottom {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    align-items: center;
    margin-top: 18px;
    padding-top: 14px;
  }

  .copy {
    text-align: left;
  }

  .legal {
    display: flex;
    justify-content: flex-end;
    align-items: center;
    flex-wrap: wrap;
    gap: 10px 14px;
  }

  .manageBtn {
    padding: 8px 12px;
    border-radius: 10px;
    white-space: nowrap;
  }
}

```

---

## components/Footer/Footer.tsx

```typescript
"use client";

import Link from "next/link";
import Image from "next/image";
import { usePathname, useRouter } from "next/navigation";
import styles from "./Footer.module.css";
import { scrollToHash } from "@/utils/smoothScroll";

type FooterDict = {
  tagline: string;
  locationLine: string;

  navTitle: string;
  nav: {
    home: string;
    properties: string;
    services: string;
    about: string;
    contact: string;
  };

  socialTitle: string;
  socials: {
    instagram: string;
    facebook: string;
    linkedin: string;
  };

  legal: {
    privacy: string;
    cookies: string;
    terms: string;
    manageCookies: string;
  };

  rights: string;
};

export default function Footer({
  lang,
  t,
  onManageCookies,
}: {
  lang: "en" | "es";
  t?: FooterDict;
  onManageCookies?: () => void;
}) {
  if (!t) return null;

  const year = new Date().getFullYear();

  const router = useRouter();
  const pathname = usePathname();

  const HEADER_OFFSET = 90;
  const isHome = pathname === `/${lang}` || pathname === `/${lang}/`;

  const goToSection = (id: string) => (e: React.MouseEvent) => {
    e.preventDefault();

    // –ù–∞ –≥–ª–∞–≤–Ω–æ–π ‚Äî —Å–∫—Ä–æ–ª–ª–∏–º –º—è–≥–∫–æ —Å—Ä–∞–∑—É
    if (isHome) {
      scrollToHash(`#${id}`, { offset: HEADER_OFFSET });
      return;
    }

    // –ù–∞ –¥—Ä—É–≥–∏—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö ‚Äî –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å hash.
    // Header —É–∂–µ —É–º–µ–µ—Ç –ø–æ—Å–ª–µ –ø–µ—Ä–µ—Ö–æ–¥–∞ —Å–¥–µ–ª–∞—Ç—å –ø–ª–∞–≤–Ω—ã–π —Å–∫—Ä–æ–ª–ª.
    router.push(`/${lang}#${id}`);
  };

  return (
    <footer className={styles.footer}>
      <div className={`container ${styles.inner}`}>
        <div className={styles.grid}>
          {/* Brand */}
          <div className={styles.col}>
            <div className={styles.brandBlock}>
              <Image
                src="/logo_cuadrado.png"
                alt="Grahalia Estates"
                width={140}
                height={140}
                className={styles.brandLogo}
              />
              <div className={styles.location}>{t.locationLine}</div>
            </div>
          </div>

          {/* Nav */}
          <div className={styles.col}>
            <div className={styles.title}>{t.navTitle}</div>
            <nav className={styles.links}>
              <a href={`/${lang}#home`} onClick={goToSection("home")}>
                {t.nav.home}
              </a>

              <Link href={`/${lang}/properties`}>{t.nav.properties}</Link>

              <a href={`/${lang}#services`} onClick={goToSection("services")}>
                {t.nav.services}
              </a>

              <a href={`/${lang}#about`} onClick={goToSection("about")}>
                {t.nav.about}
              </a>

              <a href={`/${lang}#contact`} onClick={goToSection("contact")}>
                {t.nav.contact}
              </a>
            </nav>
          </div>

          {/* Socials (placeholders) */}
          <div className={styles.col}>
            <div className={styles.title}>{t.socialTitle}</div>
            <div className={styles.socials}>
              <a
                className={styles.socialDisabled}
                href="#"
                onClick={(e) => e.preventDefault()}
                aria-disabled="true"
              >
                {t.socials.instagram}
              </a>
              <a
                className={styles.socialDisabled}
                href="#"
                onClick={(e) => e.preventDefault()}
                aria-disabled="true"
              >
                {t.socials.facebook}
              </a>
              <a
                className={styles.socialDisabled}
                href="#"
                onClick={(e) => e.preventDefault()}
                aria-disabled="true"
              >
                {t.socials.linkedin}
              </a>
            </div>

            <div className={styles.hint}>*</div>
          </div>
        </div>

        <div className={styles.bottom}>
          <div className={styles.copy}>
            ¬© {year} Grahalia Estates ¬∑ {t.rights}
          </div>

          <div className={styles.legal}>
            <Link href={`/${lang}/privacy`}>{t.legal.privacy}</Link>
            <Link href={`/${lang}/cookies`}>{t.legal.cookies}</Link>
            <Link href={`/${lang}/terms`}>{t.legal.terms}</Link>

            <button
              type="button"
              className={styles.manageBtn}
              onClick={() => onManageCookies?.()}
            >
              {t.legal.manageCookies}
            </button>

          </div>
        </div>
      </div>
    </footer>
  );
}

```

---

## components/GalleryModal/GalleryModal.module.css

```css
.overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.85);
  z-index: 1000;
  display: flex;
  align-items: center;
  justify-content: center;
}

.modal {
  position: relative;
  max-width: 92vw;
  max-height: 92vh;
}

.image {
  max-width: 92vw;
  max-height: 92vh;
  object-fit: contain;
  user-select: none;
}

.close {
  position: absolute;
  top: -40px;
  right: 0;
  background: none;
  border: none;
  color: #fff;
  font-size: 28px;
  cursor: pointer;
}

.prev,
.next {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  background: none;
  border: none;
  color: #fff;
  font-size: 48px;
  cursor: pointer;
  padding: 10px;
  user-select: none;
}

.prev { left: -60px; }
.next { right: -60px; }

.counter {
  position: absolute;
  bottom: -32px;
  right: 0;
  color: rgba(255,255,255,0.75);
  font-size: 14px;
}

@media (max-width: 768px) {
  .prev { left: 10px; }
  .next { right: 10px; }
}

```

---

## components/GalleryModal/GalleryModal.tsx

```typescript
"use client";

import { useEffect } from "react";
import styles from "./GalleryModal.module.css";

type ImageItem = {
  url: string;
};

type Props = {
  images: ImageItem[];
  index: number;
  onClose: () => void;
  onPrev: () => void;
  onNext: () => void;
};

export default function GalleryModal({
  images,
  index,
  onClose,
  onPrev,
  onNext,
}: Props) {
  const img = images[index];

  // ‚å®Ô∏è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞
  useEffect(() => {
    function onKey(e: KeyboardEvent) {
      if (e.key === "Escape") onClose();
      if (e.key === "ArrowLeft") onPrev();
      if (e.key === "ArrowRight") onNext();
    }
    window.addEventListener("keydown", onKey);
    return () => window.removeEventListener("keydown", onKey);
  }, [onClose, onPrev, onNext]);

  return (
    <div className={styles.overlay} onClick={onClose}>
      <div className={styles.modal} onClick={(e) => e.stopPropagation()}>
        <button className={styles.close} onClick={onClose}>‚úï</button>

        <button className={styles.prev} onClick={onPrev}>‚Äπ</button>
        <button className={styles.next} onClick={onNext}>‚Ä∫</button>

        <img
          src={img.url}
          alt=""
          className={styles.image}
          draggable={false}
        />

        <div className={styles.counter}>
          {index + 1} / {images.length}
        </div>
      </div>
    </div>
  );
}

```

---

## components/Header/Header.module.css

```css
.header {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: 1000;
  background: #fcf8f2;
  backdrop-filter: blur(10px);
  border-bottom: 1px solid rgba(226, 226, 222, 0.7);
  /* –∑–∞—â–∏—Ç–∞ –æ—Ç –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ —Å–∫—Ä–æ–ª–ª–∞ */
  width: 100%;
  max-width: 100%;
}

/* row */
.row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  height: 72px;
  gap: 18px;
}

/* logo */
.logo {
  display: inline-flex;
  align-items: center;
  cursor: pointer;
  line-height: 0; /* —É–±–∏—Ä–∞–µ—Ç –ª–∏—à–Ω—é—é –≤—ã—Å–æ—Ç—É */
}

/* —Å–∞–º –ª–æ–≥–æ—Ç–∏–ø-–∫–∞—Ä—Ç–∏–Ω–∫–∞ */
.logoImg {
  height: 75px;   /* ‚úÖ –≤—ã—Å–æ—Ç–∞ –ª–æ–≥–æ—Ç–∏–ø–∞ –≤ —Ö–µ–¥–µ—Ä–µ */
  width: auto;
  display: block;
  object-fit: contain;
}

.logo:focus-visible {
  outline: 2px solid rgba(14, 94, 86, 0.35);
  outline-offset: 4px;
  border-radius: 12px;
}

.logoMark {
  font-family: var(--font-playfair), Georgia, "Times New Roman", serif;
  font-weight: 600;
  font-size: 20px;
}

.logoSub {
  font-size: 12px;
  color: var(--muted);
  font-weight: 700;
}

/* desktop nav */
.nav {
  position: relative;
  display: flex;
  gap: 22px;
  align-items: center;
}

/* –ü–ª–∞–≤–∞—é—â–∏–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä */
.indicator {
  position: absolute;
  bottom: 6px;
  left: 0;
  height: 2px;
  background: rgba(14, 94, 86, 0.9);
  border-radius: 2px;
  transition: transform 320ms cubic-bezier(0.22, 1, 0.36, 1),
    width 320ms cubic-bezier(0.22, 1, 0.36, 1);
  will-change: transform, width;
  pointer-events: none;
}

.link {
  position: relative;
  font-size: 14px;
  color: rgba(28, 28, 28, 0.72);
  padding: 10px 10px;
  border-radius: 12px;
  transition: background 0.15s ease, color 0.15s ease;
}

.link:hover {
  color: var(--text);
  background: rgba(255, 255, 255, 0.65);
}

.active {
  color: var(--text);
}

/* –í–ê–ñ–ù–û: —É–±–∏—Ä–∞–µ–º ::after, —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ "–¥–≤—É—Ö –ª–∏–Ω–∏–π" (–∏ –¥–µ—Ä–≥–∞–Ω—å—è –≤–∏–∑—É–∞–ª—å–Ω–æ) */
.active::after {
  content: none;
}

/* right */
.right {
  display: flex;
  align-items: center;
  gap: 14px;
}

.lang {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 13px;
  color: rgba(28, 28, 28, 0.75);
}

.langBtn {
  background: transparent;
  border: none;
  cursor: pointer;
  font-weight: 600;
  color: inherit;
  padding: 6px 6px;
  border-radius: 10px;
}

.langBtn:hover {
  background: rgba(255, 255, 255, 0.55);
  color: var(--text);
}

.sep {
  opacity: 0.5;
}

.wa {
  padding: 10px 16px;
  border-radius: 3px;
  text-decoration: none;
}

/* -------------------------
   Mobile burger + menu
-------------------------- */

.burger {
  display: none;
  height: 44px;
  width: auto;          /* <-- –≤–∞–∂–Ω–æ */
  padding: 0 12px;      /* <-- –≤–∞–∂–Ω–æ */

  border-radius: 12px;
  border: 1px solid rgba(226, 226, 222, 0.9);
  background: rgba(255, 255, 255, 0.55);
  backdrop-filter: blur(8px);

  align-items: center;
  justify-content: center;
  gap: 10px;            /* –±—ã–ª–æ 5px ‚Äî —É–≤–µ–ª–∏—á–∏–º, —á—Ç–æ–±—ã —Ç–µ–∫—Å—Ç/–∏–∫–æ–Ω–∫–∞ –¥—ã—à–∞–ª–∏ */
  cursor: pointer;
  transition: transform 0.12s ease, background 0.12s ease, border 0.12s ease;
}

.burgerText {
  font-size: 13px;
  font-weight: 700;
  letter-spacing: 0.02em;
  color: rgba(28, 28, 28, 0.85);
  line-height: 1;
}

.burgerLines {
  width: 18px;
  height: 14px;
  display: inline-flex;
  flex-direction: column;
  justify-content: space-between;
}

.burger:hover {
  background: rgba(255, 255, 255, 0.75);
}

.burger:active {
  transform: translateY(1px);
}

.burgerLines span {
  display: block;
  width: 18px;
  height: 2px;
  background: rgba(28, 28, 28, 0.85);
  border-radius: 2px;
  transition: transform 220ms cubic-bezier(0.22, 1, 0.36, 1),
    opacity 180ms ease;
}

/* –∫—Ä–µ—Å—Ç–∏–∫ */
.burgerOpen .burgerLines span:nth-child(1) {
  transform: translateY(6px) rotate(45deg);
}
.burgerOpen .burgerLines span:nth-child(2) {
  opacity: 0;
}
.burgerOpen .burgerLines span:nth-child(3) {
  transform: translateY(-6px) rotate(-45deg);
}

/* overlay */
.mobileOverlay {
  position: fixed;
  inset: 0;
  z-index: 60;
  background: rgba(18, 18, 18, 0.25);
  opacity: 0;
  pointer-events: none;
  transition: opacity 220ms ease;
  width: 100%;
  max-width: 100%;
}

.mobileOverlayOpen {
  opacity: 1;
  pointer-events: auto;
}

/* panel */
.mobilePanel {
  position: absolute;
  right: 12px;
  top: 12px;
  width: min(92vw, 360px);
  border-radius: 16px;
  background: rgba(252, 248, 242, 0.96);
  border: 1px solid rgba(226, 226, 222, 0.9);
  backdrop-filter: blur(10px);
  box-shadow: 0 18px 50px rgba(0, 0, 0, 0.18);

  transform: translateY(-8px) scale(0.98);
  opacity: 0;
  transition: transform 260ms cubic-bezier(0.22, 1, 0.36, 1),
    opacity 220ms ease;
}

.mobileOverlayOpen .mobilePanel {
  transform: translateY(0) scale(1);
  opacity: 1;
}

.mobileTop {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 14px 14px 10px;
  border-bottom: 1px solid rgba(226, 226, 222, 0.8);
}

.mobileTitle {
  font-weight: 700;
  letter-spacing: 0.06em;
  font-size: 12px;
  color: rgba(28, 28, 28, 0.7);
  text-transform: uppercase;
}

.mobileClose {
  width: 36px;
  height: 36px;
  border-radius: 12px;
  border: 1px solid rgba(226, 226, 222, 0.9);
  background: rgba(255, 255, 255, 0.55);
  cursor: pointer;
  transition: transform 0.12s ease, background 0.12s ease;
}

.mobileClose:hover {
  background: rgba(255, 255, 255, 0.78);
}

.mobileClose:active {
  transform: translateY(1px);
}

.mobileLinks {
  padding: 10px 10px 6px;
  display: grid;
  gap: 6px;
}

.mobileLink {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 12px;
  border-radius: 14px;
  color: rgba(28, 28, 28, 0.82);
  font-weight: 600;
  background: rgba(255, 255, 255, 0.45);
  border: 1px solid rgba(226, 226, 222, 0.75);
  transition: background 0.14s ease, transform 0.14s ease;
}

.mobileLink:hover {
  background: rgba(255, 255, 255, 0.7);
}

.mobileLink:active {
  transform: translateY(1px);
}

.mobileActive {
  background: rgba(14, 94, 86, 0.1);
  border-color: rgba(14, 94, 86, 0.25);
  color: var(--text);
}

.mobileBottom {
  padding: 12px 12px 14px;
  border-top: 1px solid rgba(226, 226, 222, 0.8);
  display: grid;
  gap: 10px;
}

.mobileWa {
  width: 100%;
  justify-content: center;
}

.mobileLang {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  font-size: 13px;
  color: rgba(28, 28, 28, 0.75);
}

/* -------------------------
   Responsive rules
-------------------------- */

@media (max-width: 860px) {
  .nav {
    display: none;
  }

  .burger {
    display: inline-flex;
  }

  /* —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ —Å–∫—Ä–æ–ª–ª–∞ –∏–∑-–∑–∞ "–ø—Ä–∞–≤–æ–≥–æ –±–ª–æ–∫–∞" */
  .right {
    gap: 10px;
  }

  /* –Ω–∞ –æ—á–µ–Ω—å —É–∑–∫–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö WhatsApp –º–æ–∂–Ω–æ –ø—Ä—è—Ç–∞—Ç—å, –æ—Å—Ç–∞–≤–∏–≤ –≤ –º–µ–Ω—é */
  .wa {
    display: none;
  }
}

@media (max-width: 420px) {
  .row {
    gap: 12px;
  }

  .logoMark {
    font-size: 18px;
  }

  .logoSub {
    font-size: 11px;
  }

  .lang {
    display: none; /* —è–∑—ã–∫–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ –º–æ–±–∏–ª—å–Ω–æ–º –º–µ–Ω—é */
  }
}

/* mobile */
@media (max-width: 640px) {
  .logoImg {
    height: 65px;
  }
}
```

---

## components/Header/Header.tsx

```typescript
"use client";

import { useEffect, useLayoutEffect, useMemo, useRef, useState } from "react";
import { usePathname, useRouter } from "next/navigation";
import styles from "./Header.module.css";
import { scrollToHash } from "@/utils/smoothScroll";
import Image from "next/image";

type NavItem = { id: string; label: string };

type HeaderProps = {
  lang: "en" | "es";
  t: {
    nav: Record<string, string>;
    menuTitle: string;
    whatsapp: string;
  };
};

export default function Header({ lang, t }: HeaderProps) {
  const router = useRouter();
  const pathname = usePathname();

  const nav: NavItem[] = useMemo(
    () => [
      { id: "home", label: t.nav.home },
      { id: "properties", label: t.nav.properties },
      { id: "services", label: t.nav.services },
      { id: "about", label: t.nav.about },
      { id: "contact", label: t.nav.contact },
    ],
    [t]
  );

  const HEADER_OFFSET = 90;

  const isHome = pathname === `/${lang}` || pathname === `/${lang}/`;

  // ‚úÖ –ª—é–±—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã properties: –∫–∞—Ç–∞–ª–æ–≥ + –¥–µ—Ç–∞–ª—å–Ω–∞—è
  const isProperties = pathname?.startsWith(`/${lang}/properties`);
  const isCatalog = pathname === `/${lang}/properties`;

  const [activeId, setActiveId] = useState<string>("home");
  const [menuOpen, setMenuOpen] = useState(false);

  const navRef = useRef<HTMLElement | null>(null);
  const linkRefs = useRef<Record<string, HTMLAnchorElement | null>>({});
  const [indicator, setIndicator] = useState<{ left: number; width: number }>({
    left: 0,
    width: 0,
  });

  const closeMenu = () => setMenuOpen(false);

  const goTo = (id: string) => {
    setActiveId(id);
    closeMenu();

    // –ù–∞ –≥–ª–∞–≤–Ω–æ–π ‚Äî –≤—Å–µ–≥–¥–∞ –ø–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ–ª—ë—Ç –ø–æ —è–∫–æ—Ä—é
    if (isHome) {
      scrollToHash(`#${id}`, { offset: HEADER_OFFSET });
      return;
    }

    // ‚úÖ –µ—Å–ª–∏ –∫–ª–∏–∫–Ω—É–ª–∏ "Properties" –ù–ï –Ω–∞ –≥–ª–∞–≤–Ω–æ–π ‚Äî –≤–µ–¥—ë–º –≤ –∫–∞—Ç–∞–ª–æ–≥
    if (id === "properties") {
      router.push(`/${lang}/properties`);
      return;
    }

    // –ù–∞ –¥—Ä—É–≥–∏—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö ‚Äî —É–≤–æ–¥–∏–º –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å hash
    router.push(`/${lang}#${id}`);
  };

  // --- helpers for locale switch ---
  function buildLocalePath(nextLang: "en" | "es") {
    // pathname —Ç–∏–ø–∞: /en –∏–ª–∏ /es (–∏ –ø–æ–∑–∂–µ –º–æ–∂–µ—Ç –±—ã—Ç—å /en/—á—Ç–æ-—Ç–æ)
    const parts = (pathname || "/").split("/");
    // ["", "en", ...]
    parts[1] = nextLang;
    const base = parts.join("/") || `/${nextLang}`;

    // —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–π hash —Å–µ–∫—Ü–∏–∏ (–¥–ª—è one-page)
    const hash =
      typeof window !== "undefined"
        ? window.location.hash || `#${activeId}`
        : `#${activeId}`;

    return `${base}${hash}`;
  }

  function switchLang(nextLang: "en" | "es") {
    closeMenu();
    router.push(buildLocalePath(nextLang));
  }

  useEffect(() => {
    if (!isHome) return;

    const hash = typeof window !== "undefined" ? window.location.hash : "";
    if (!hash) return;

    const id = hash.replace("#", "");
    if (!id) return;

    // –¥–∞—ë–º DOM –ø—Ä–æ–≥—Ä—É–∑–∏—Ç—å —Å–µ–∫—Ü–∏–∏, –ø–æ—Ç–æ–º —Å–∫—Ä–æ–ª–ª–∏–º –º—è–≥–∫–æ
    const tmr = window.setTimeout(() => {
      scrollToHash(`#${id}`, { offset: HEADER_OFFSET });
    }, 50);

    return () => window.clearTimeout(tmr);
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [pathname, lang]);

  useEffect(() => {
    // ‚úÖ –Ω–∞ –∫–∞—Ç–∞–ª–æ–≥–µ –∏ –Ω–∞ –¥–µ—Ç–∞–ª—å–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º Properties
    if (isProperties) {
      setActiveId("properties");
    }
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [pathname]);

  // 1) Active section picker
  useEffect(() => {
    // ‚úÖ —Ç–æ–ª—å–∫–æ –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∏–º–µ–µ—Ç —Å–µ–∫—Ü–∏–∏
    if (!isHome) return;

    // –ï—Å–ª–∏ –º—ã –Ω–∞ –∫–∞—Ç–∞–ª–æ–≥–µ ‚Äî —Å–µ–∫—Ü–∏–π –Ω–µ—Ç, –ø–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º Properties –≤—Ä—É—á–Ω—É—é
    if (isCatalog) {
      setActiveId("properties");
      return;
    }

    const sections = nav
      .map((n) => document.getElementById(n.id))
      .filter(Boolean) as HTMLElement[];

    if (!sections.length) return;

    const PIVOT_PAD = 22;
    const MIN_SWITCH_MS = 260;

    let raf = 0;
    let lastId = activeId;
    let lastSwitchAt = 0;

    const pickActive = () => {
      const now = performance.now();
      const pivot = HEADER_OFFSET + PIVOT_PAD;

      let bestId = lastId;
      let bestScore = Number.POSITIVE_INFINITY;

      for (const el of sections) {
        const rect = el.getBoundingClientRect();
        const delta = rect.top - pivot;
        const score = delta < 0 ? Math.abs(delta) * 0.7 : Math.abs(delta) * 1.0;

        if (score < bestScore) {
          bestScore = score;
          bestId = el.id;
        }
      }

      if (bestId !== lastId && now - lastSwitchAt < MIN_SWITCH_MS) return;

      if (bestId !== lastId) {
        lastId = bestId;
        lastSwitchAt = now;
        setActiveId(bestId);
      }
    };

    const onScroll = () => {
      cancelAnimationFrame(raf);
      raf = requestAnimationFrame(pickActive);
    };

    window.addEventListener("scroll", onScroll, { passive: true });
    window.addEventListener("resize", onScroll);

    onScroll();

    return () => {
      cancelAnimationFrame(raf);
      window.removeEventListener("scroll", onScroll);
      window.removeEventListener("resize", onScroll);
    };
  }, [nav, isCatalog, activeId, HEADER_OFFSET]);


  // 2) Desktop indicator
  const recalcIndicator = () => {
    const navEl = navRef.current;
    const linkEl = linkRefs.current[activeId];
    if (!navEl || !linkEl) return;

    const navBox = navEl.getBoundingClientRect();
    const linkBox = linkEl.getBoundingClientRect();

    const padding = 10;
    const left = linkBox.left - navBox.left + padding;
    const width = Math.max(18, linkBox.width - padding * 2);

    setIndicator({ left, width });
  };

  useLayoutEffect(() => {
    recalcIndicator();
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [activeId]);

  useEffect(() => {
    const onResize = () => recalcIndicator();
    window.addEventListener("resize", onResize);
    const tmr = window.setTimeout(recalcIndicator, 150);

    return () => {
      window.removeEventListener("resize", onResize);
      window.clearTimeout(tmr);
    };
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [activeId]);

  // 3) Lock body scroll when mobile menu open + close on ESC
  useEffect(() => {
    const onKeyDown = (e: KeyboardEvent) => {
      if (e.key === "Escape") closeMenu();
    };

    if (menuOpen) {
      document.body.style.overflow = "hidden";
      window.addEventListener("keydown", onKeyDown);
    } else {
      document.body.style.overflow = "";
      window.removeEventListener("keydown", onKeyDown);
    }

    return () => {
      document.body.style.overflow = "";
      window.removeEventListener("keydown", onKeyDown);
    };
  }, [menuOpen]);

  const onNavClick =
    (id: string) => (e: React.MouseEvent<HTMLAnchorElement>) => {
      e.preventDefault();
      goTo(id);
    };

  return (
    <header className={styles.header}>
      <div className={`container ${styles.row}`}>
        {/* Logo */}
        <div
          className={styles.logo}
          role="button"
          tabIndex={0}
          onClick={() => goTo("home")}
          onKeyDown={(e) => {
            if (e.key === "Enter" || e.key === " ") goTo("home");
          }}
          aria-label="Grahalia Estates"
        >
          <Image
            src="/logo.png"
            alt="Grahalia Estates"
            width={520}
            height={96}
            priority
            className={styles.logoImg}
          />
        </div>
        {/* Desktop nav */}
        <nav className={styles.nav} ref={(el) => (navRef.current = el)}>
          <span
            className={styles.indicator}
            style={{
              transform: `translateX(${indicator.left}px)`,
              width: `${indicator.width}px`,
            }}
            aria-hidden="true"
          />

          {nav.map((item) => (
            <a
              key={item.id}
              href={`#${item.id}`}
              onClick={onNavClick(item.id)}
              ref={(el) => {
                linkRefs.current[item.id] = el;
              }}
              className={`${styles.link} ${
                activeId === item.id ? styles.active : ""
              }`}
            >
              {item.label}
            </a>
          ))}
        </nav>

        {/* Right controls */}
        <div className={styles.right}>
          <div className={styles.lang}>
            <button
              className={styles.langBtn}
              type="button"
              aria-current={lang === "en" ? "page" : undefined}
              onClick={() => switchLang("en")}
            >
              EN
            </button>
            <span className={styles.sep}>|</span>
            <button
              className={styles.langBtn}
              type="button"
              aria-current={lang === "es" ? "page" : undefined}
              onClick={() => switchLang("es")}
            >
              ES
            </button>
          </div>

          <a
            className={`${styles.wa} btn btnPrimary`}
            href="https://wa.me/34123456789"
            target="_blank"
            rel="noreferrer"
          >
            {t.whatsapp}
          </a>

          {/* Burger (mobile) */}
          <button
            type="button"
            className={`${styles.burger} ${menuOpen ? styles.burgerOpen : ""}`}
            aria-label={menuOpen ? "Close menu" : "Open menu"}
            aria-expanded={menuOpen}
            aria-controls="mobile-menu"
            onClick={() => setMenuOpen((v) => !v)}
          >
            <span className={styles.burgerText}>
              {menuOpen ? "Close" : "Menu"}
            </span>

            <span className={styles.burgerLines} aria-hidden="true">
              <span />
              <span />
              <span />
            </span>
          </button>
        </div>
      </div>

      {/* Mobile menu overlay */}
      <div
        id="mobile-menu"
        className={`${styles.mobileOverlay} ${
          menuOpen ? styles.mobileOverlayOpen : ""
        }`}
        aria-hidden={!menuOpen}
        onClick={(e) => {
          if (e.target === e.currentTarget) closeMenu();
        }}
      >
        <div className={styles.mobilePanel}>
          <div className={styles.mobileTop}>
            <div className={styles.mobileTitle}>{t.menuTitle}</div>

            <button
              type="button"
              className={styles.mobileClose}
              aria-label="Close menu"
              onClick={closeMenu}
            >
              ‚úï
            </button>
          </div>

          <div className={styles.mobileLinks}>
            {nav.map((item) => (
              <a
                key={item.id}
                href={`#${item.id}`}
                className={`${styles.mobileLink} ${
                  activeId === item.id ? styles.mobileActive : ""
                }`}
                onClick={(e) => {
                  e.preventDefault();
                  goTo(item.id);
                }}
              >
                {item.label}
              </a>
            ))}
          </div>

          <div className={styles.mobileBottom}>
            <a
              className={`btn btnPrimary ${styles.mobileWa}`}
              href="https://wa.me/34123456789"
              target="_blank"
              rel="noreferrer"
              onClick={() => closeMenu()}
            >
              {t.whatsapp}
            </a>

            <div className={styles.mobileLang}>
              <button
                className={styles.langBtn}
                type="button"
                onClick={() => switchLang("en")}
              >
                EN
              </button>
              <span className={styles.sep}>|</span>
              <button
                className={styles.langBtn}
                type="button"
                onClick={() => switchLang("es")}
              >
                ES
              </button>
            </div>
          </div>
        </div>
      </div>
    </header>
  );
}

```

---

## components/Hero/Hero.module.css

```css
.hero {
  position: relative;
  overflow: hidden; /* –≤–∞–∂–Ω–æ */
  border-bottom: 1px solid rgba(226, 226, 222, 0.8);
  min-height: 520px;

  /* —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞ –ø—Ä–æ—Ç–∏–≤ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ —Å–∫—Ä–æ–ª–ª–∞ */
  width: 100%;
  max-width: 100%;
}

.inner {
  position: relative;
  z-index: 2;
  padding: 86px 0 78px;
}

.content {
  max-width: 720px;
}

.sub {
  margin-top: 14px;
  font-size: 16px;
}

.actions {
  display: flex;
  gap: 12px;
  margin-top: 26px;
  flex-wrap: wrap;
}

.ital {
  font-style: italic;
  font-weight: 500;
}

.bg {
  position: absolute;
  inset: 0;
  z-index: 1;

  /* –≤–∞–∂–Ω–æ: —É–±–∏—Ä–∞–µ–º transform: scale(1.02), –æ–Ω —á–∞—Å—Ç–æ –¥–∞—ë—Ç –≤—ã–ª–µ–∑–∞–Ω–∏–µ */
  background-image:
    linear-gradient(
      90deg,
      rgba(246, 245, 242, 0.95) 0%,
      rgba(246, 245, 242, 0.72) 40%,
      rgba(246, 245, 242, 0.22) 72%,
      rgba(246, 245, 242, 0.06) 100%
    ),
    url("/hero.jpg");

  /* –≤–º–µ—Å—Ç–æ scale ‚Äî —á—É—Ç—å ‚Äú–ø—Ä–∏–±–ª–∏–∑–∏–º‚Äù —á–µ—Ä–µ–∑ background-size */
  background-size: 102% auto;
  background-repeat: no-repeat;
  background-position: center;

  /* —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞ */
  width: 100%;
  max-width: 100%;
}

.fade {
  position: absolute;
  left: 0;
  right: 0;
  bottom: 0;
  height: 120px;
  z-index: 2; /* —á—Ç–æ–±—ã –ª–µ–∂–∞–ª–æ –ø–æ–≤–µ—Ä—Ö —Ñ–æ–Ω–∞ */
  background: linear-gradient(to bottom, rgba(246, 245, 242, 0), var(--bg));
}

@media (max-width: 720px) {
  .inner {
    padding: 64px 0 56px;
  }

  .hero {
    min-height: 520px;
  }

  /* –Ω–∞ –º–æ–±–∏–ª–∫–µ —Ñ–æ–Ω –ª—É—á—à–µ –¥–µ–ª–∞—Ç—å cover, —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ */
  .bg {
    background-size: cover;
    background-position: 70% center; /* –ª—ë–≥–∫–∏–π —Å–¥–≤–∏–≥ –≤–ø—Ä–∞–≤–æ, —á—Ç–æ–±—ã –¥–æ–º –±—ã–ª –≤–∏–¥–Ω–µ–µ */
  }
}

```

---

## components/Hero/Hero.tsx

```typescript
"use client";

import styles from "./Hero.module.css";
import { scrollToHash } from "@/utils/smoothScroll";

type HeroDict = {
  titleA: string;
  titleB: string;
  subtitle: string;
  ctaPrimary: string;
  ctaSecondary: string;
};

export default function Hero({ t }: { t: HeroDict }) {
  const OFFSET = 90;

  return (
    <section id="home" className={styles.hero}>
      <div className={`container ${styles.inner}`}>
        <div className={styles.content}>
          <h1 className="h1">
            {t.titleA} <span className={styles.ital}>{t.titleB}</span>
          </h1>

          <p className={`p ${styles.sub}`}>{t.subtitle}</p>

          <div className={styles.actions}>
            <a
              className="btn btnPrimary"
              href="#properties"
              onClick={(e) => {
                e.preventDefault();
                scrollToHash("#properties", { offset: OFFSET });
              }}
            >
              {t.ctaPrimary}
            </a>

            <a
              className="btn btnGhost"
              href="#contact"
              onClick={(e) => {
                e.preventDefault();
                scrollToHash("#contact", { offset: OFFSET });
              }}
            >
              {t.ctaSecondary}
            </a>
          </div>
        </div>
      </div>

      <div className={styles.bg} aria-hidden="true" />
      <div className={styles.fade} aria-hidden="true" />
    </section>
  );
}

```

---

## components/LeadContactForm/LeadContactForm.tsx

```typescript
"use client";

import { useState } from "react";
import styles from "@/components/Contact/Contact.module.css";

function isEmail(x: string) {
  return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(x);
}

type Props = {
  lang: "en" | "es";
  propertyId?: number | null;
  propertySlug?: string | null;

  title: string;
  subtitle: string;

  labels: {
    name: string;
    phone: string;
    email: string;
    message: string;
    send: string;
    namePlaceholder: string;
    phonePlaceholder: string;
    emailPlaceholder: string;
    messagePlaceholder: string;
    sending: string;
    sent: string;
    errRequired: string;
    errEmail: string;
    errFailed: string;
  };
};

export default function LeadContactForm({
  lang,
  propertyId = null,
  propertySlug = null,
  title,
  subtitle,
  labels,
}: Props) {
  const [name, setName] = useState("");
  const [phone, setPhone] = useState("");
  const [email, setEmail] = useState("");
  const [message, setMessage] = useState("");

  const [loading, setLoading] = useState(false);
  const [ok, setOk] = useState(false);
  const [error, setError] = useState<string | null>(null);

  const [website, setWebsite] = useState(""); // honeypot

  async function onSubmit(e: React.FormEvent) {
    e.preventDefault();
    setOk(false);
    setError(null);

    const cleanName = name.trim();
    const cleanPhone = phone.trim();
    const cleanEmail = email.trim();
    const cleanMessage = message.trim();

    if (!cleanName || !cleanPhone || !cleanEmail) {
      setError(labels.errRequired);
      return;
    }
    if (!isEmail(cleanEmail)) {
      setError(labels.errEmail);
      return;
    }

    // ‚úÖ source –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
    const source = propertySlug ? "property" : "contact";

    // ‚úÖ –í–ê–ñ–ù–û: –±–µ—Ä—ë–º –∞–∫—Ç—É–∞–ª—å–Ω—ã–π URL –í –ú–û–ú–ï–ù–¢ –û–¢–ü–†–ê–í–ö–ò
    const currentUrl =
      typeof window !== "undefined" && window.location?.href
        ? window.location.href
        : `/${lang}`;

    const payload = {
      name: cleanName,
      phone: cleanPhone,
      email: cleanEmail,
      message: cleanMessage ? cleanMessage : null,
      lang,
      page_url: currentUrl,
      property_id: propertyId ?? null,
      property_slug: propertySlug ?? null,
      source,
      website,
    };

    setLoading(true);
    try {
      const res = await fetch("/api/leads", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload),
      });

      const data = await res.json().catch(() => ({}));
      if (!res.ok) {
        setError(data?.error || labels.errFailed);
        return;
      }

      setOk(true);
      setName("");
      setPhone("");
      setEmail("");
      setMessage("");
    } catch {
      setError(labels.errFailed);
    } finally {
      setLoading(false);
    }
  }

  return (
    <div>
      <div className="section__head">
        <h2 className="sectionTitle">
          <span className="sectionTitleText">{title}</span>
        </h2>
        <p className="section__kicker">{subtitle}</p>
      </div>

      <form className={styles.form} onSubmit={onSubmit}>
        <div className={styles.row}>
          {/* Honeypot (–±–æ—Ç—ã —á–∞—Å—Ç–æ –∑–∞–ø–æ–ª–Ω—è—é—Ç) */}
          <div style={{ position: "absolute", left: "-10000px", top: "auto", width: 1, height: 1, overflow: "hidden" }}>
            <label htmlFor="website">Website</label>
            <input
              id="website"
              name="website"
              value={website}
              onChange={(e) => setWebsite(e.target.value)}
              autoComplete="off"
              tabIndex={-1}
            />
          </div>
          <div className={styles.field}>
            <label className={styles.label} htmlFor="name">
              {labels.name}
            </label>
            <input
              className={styles.input}
              id="name"
              name="name"
              placeholder={labels.namePlaceholder}
              value={name}
              onChange={(e) => setName(e.target.value)}
              required
              autoComplete="name"
            />
          </div>

          <div className={styles.field}>
            <label className={styles.label} htmlFor="phone">
              {labels.phone}
            </label>
            <input
              className={styles.input}
              id="phone"
              name="phone"
              placeholder={labels.phonePlaceholder}
              value={phone}
              onChange={(e) => setPhone(e.target.value)}
              required
              autoComplete="tel"
            />
          </div>
        </div>

        <div className={styles.field}>
          <label className={styles.label} htmlFor="email">
            {labels.email}
          </label>
          <input
            className={styles.input}
            id="email"
            name="email"
            placeholder={labels.emailPlaceholder}
            value={email}
            onChange={(e) => setEmail(e.target.value)}
            required
            autoComplete="email"
            inputMode="email"
          />
        </div>

        <div className={styles.field}>
          <label className={styles.label} htmlFor="message">
            {labels.message}
          </label>
          <textarea
            className={styles.textarea}
            id="message"
            name="message"
            placeholder={labels.messagePlaceholder}
            value={message}
            onChange={(e) => setMessage(e.target.value)}
            rows={5}
          />
        </div>

        <div className={styles.actionsRow}>
          <button className="btn btnPrimary" type="submit" disabled={loading}>
            {loading ? labels.sending : labels.send}
          </button>
          {ok ? <span className={styles.okText}>{labels.sent}</span> : null}
          {error ? <span className={styles.errText}>{error}</span> : null}
        </div>

        <div className={styles.footerText} style={{ marginTop: 10, opacity: 0.7 }}>
          {propertySlug ? `Property: ${propertySlug}` : "General inquiry"}
        </div>
      </form>
    </div>
  );
}

```

---

## components/LeadForm/LeadForm.module.css

```css
.wrap {
  width: 100%;
  max-width: 760px;
  margin: 0 auto;
  padding: 28px;
  background: var(--surface, #fff);
  border: 1px solid var(--border, #E2E2DE);
  border-radius: 16px;
}

.head {
  margin-bottom: 18px;
}

.title {
  margin: 0 0 8px 0;
  font-size: 28px;
  line-height: 1.15;
}

.subtitle {
  margin: 0;
  color: var(--textSecondary, #6B6B6B);
}

.form {
  margin-top: 18px;
}

.grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 14px;
}

.field {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.fieldFull {
  grid-column: 1 / -1;
}

.label {
  font-size: 13px;
  color: var(--textSecondary, #6B6B6B);
}

.input,
.textarea {
  width: 100%;
  padding: 12px 12px;
  border-radius: 12px;
  border: 1px solid var(--border, #E2E2DE);
  background: var(--background, #F6F5F2);
  color: var(--textPrimary, #1C1C1C);
  outline: none;
}

.input:focus,
.textarea:focus {
  border-color: var(--accent, #0E5E56);
}

.actions {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-top: 16px;
}

.button {
  padding: 12px 18px;
  border-radius: 999px;
  border: none;
  background: var(--accent, #0E5E56);
  color: white;
  cursor: pointer;
}

.button:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

.ok {
  color: var(--accent, #0E5E56);
  font-weight: 600;
}

.err {
  color: #b00020;
  font-weight: 600;
}

.meta {
  margin-top: 16px;
  font-size: 12px;
  color: var(--textSecondary, #6B6B6B);
}

@media (max-width: 720px) {
  .wrap {
    padding: 18px;
  }
  .grid {
    grid-template-columns: 1fr;
  }
}

```

---

## components/LeadForm/LeadForm.tsx

```typescript
"use client";

import { useMemo, useState } from "react";
import styles from "./LeadForm.module.css";

type LeadFormProps = {
  lang: "en" | "es";
  pageUrl?: string;
  propertyId?: number | null;
  propertySlug?: string | null;
  title?: string;
  subtitle?: string;
};

export default function LeadForm({
  lang,
  pageUrl,
  propertyId = null,
  propertySlug = null,
  title = "Contact us",
  subtitle = "Leave your details and we will get back to you shortly.",
}: LeadFormProps) {
  const resolvedPageUrl = useMemo(() => {
    if (pageUrl) return pageUrl;
    return "";
  }, [pageUrl]);

  const [name, setName] = useState("");
  const [phone, setPhone] = useState("");
  const [email, setEmail] = useState("");
  const [message, setMessage] = useState("");

  const [loading, setLoading] = useState(false);
  const [ok, setOk] = useState(false);
  const [error, setError] = useState<string | null>(null);

  const [website, setWebsite] = useState(""); // honeypot

  async function onSubmit(e: React.FormEvent) {
    e.preventDefault();
    setLoading(true);
    setError(null);
    setOk(false);

    const source = propertySlug ? "property" : "contact";

    // ‚úÖ –í–ê–ñ–ù–û: –∞–∫—Ç—É–∞–ª—å–Ω—ã–π URL –≤ –º–æ–º–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏
    const currentUrl =
      typeof window !== "undefined" && window.location?.href
        ? window.location.href
        : resolvedPageUrl || "/";

    const payload = {
      name: name.trim(),
      phone: phone.trim(),
      email: email.trim(),
      message: message.trim() ? message.trim() : null,
      lang,
      page_url: currentUrl,
      property_id: propertyId ?? null,
      property_slug: propertySlug ?? null,
      source,
      website,
    };

    try {
      const res = await fetch("/api/leads", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload),
      });

      const data = await res.json().catch(() => ({}));
      if (!res.ok) {
        setError(data?.error || "Failed to send. Please try again.");
        return;
      }

      setOk(true);
      setName("");
      setPhone("");
      setEmail("");
      setMessage("");
    } catch {
      setError("Failed to send. Please try again.");
    } finally {
      setLoading(false);
    }
  }

  return (
    <section className={styles.wrap} aria-label="Lead form">
      <div className={styles.head}>
        <h2 className={styles.title}>{title}</h2>
        <p className={styles.subtitle}>{subtitle}</p>
      </div>

      <form className={styles.form} onSubmit={onSubmit}>
        <div className={styles.grid}>
          {/* Honeypot (–±–æ—Ç—ã —á–∞—Å—Ç–æ –∑–∞–ø–æ–ª–Ω—è—é—Ç) */}
          <div style={{ position: "absolute", left: "-10000px", top: "auto", width: 1, height: 1, overflow: "hidden" }}>
            <label htmlFor="website">Website</label>
            <input
              id="website"
              name="website"
              value={website}
              onChange={(e) => setWebsite(e.target.value)}
              autoComplete="off"
              tabIndex={-1}
            />
          </div>
          <label className={styles.field}>
            <span className={styles.label}>Name *</span>
            <input
              className={styles.input}
              value={name}
              onChange={(e) => setName(e.target.value)}
              required
              autoComplete="name"
            />
          </label>

          <label className={styles.field}>
            <span className={styles.label}>Phone *</span>
            <input
              className={styles.input}
              value={phone}
              onChange={(e) => setPhone(e.target.value)}
              required
              autoComplete="tel"
            />
          </label>

          <label className={styles.field}>
            <span className={styles.label}>Email *</span>
            <input
              className={styles.input}
              type="email"
              value={email}
              onChange={(e) => setEmail(e.target.value)}
              required
              autoComplete="email"
            />
          </label>

          <label className={`${styles.field} ${styles.fieldFull}`}>
            <span className={styles.label}>Message</span>
            <textarea
              className={styles.textarea}
              value={message}
              onChange={(e) => setMessage(e.target.value)}
              rows={4}
            />
          </label>
        </div>

        <div className={styles.actions}>
          <button className={styles.button} disabled={loading}>
            {loading ? "Sending..." : "Send"}
          </button>

          {ok && <span className={styles.ok}>Sent ‚úÖ</span>}
          {error && <span className={styles.err}>{error}</span>}
        </div>
      </form>

      <div className={styles.meta}>
        {propertySlug ? <span>Property: {propertySlug}</span> : <span>General inquiry</span>}
      </div>
    </section>
  );
}

```

---

## components/PropertyCard/PropertyCard.module.css

```css
.card {
  background: rgba(255, 255, 255, 0.72);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  overflow: hidden;
  box-shadow: var(--shadow);
  display: flex;
  flex-direction: column;
  height: 100%; /* ‚úÖ –≤–∞–∂–Ω–æ: –∫–∞—Ä—Ç–æ—á–∫–∞ —Ç—è–Ω–µ—Ç—Å—è –ø–æ –≤—ã—Å–æ—Ç–µ —è—á–µ–π–∫–∏ */
  transition: transform 0.16s ease, box-shadow 0.16s ease;
}

.card:hover {
  transform: translateY(-2px);
  box-shadow: 0 14px 36px rgba(0, 0, 0, 0.08);
}

.imageWrap {
  position: relative;
  width: 100%;
  aspect-ratio: 16 / 10;
  overflow: hidden;
  background: #eee;
}

.image {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}

.body {
  padding: 18px 18px 16px;

  /* ‚úÖ –∫–ª—é—á–µ–≤–æ–π —Ñ–∏–∫—Å: —Ç–µ–ª–æ –∫–∞—Ä—Ç–æ—á–∫–∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–π —Ä–∞—Å–∫–ª–∞–¥–∫–æ–π */
  display: flex;
  flex-direction: column;
  flex: 1;        /* –∑–∞–Ω–∏–º–∞–µ—Ç –≤—Å—ë –æ—Å—Ç–∞–≤—à–µ–µ—Å—è –º–µ—Å—Ç–æ */
  min-height: 0;

  /* ‚úÖ –¥–æ–±–∞–≤–ª—è–µ–º "—Ä–∏—Ç–º" –º–µ–∂–¥—É –±–ª–æ–∫–∞–º–∏ */
  gap: 6px;
}

.spacer {
  flex: 1;
  min-height: 14px; /* ‚úÖ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π "–≤–æ–∑–¥—É—Ö" –ø–µ—Ä–µ–¥ –∫–Ω–æ–ø–∫–æ–π */
}

.title {
  margin: 0;
  font-family: var(--font-playfair), Georgia, "Times New Roman", serif;
  font-size: 18px;
  line-height: 1.2;
}

.meta {
  margin-top: 6px;
  color: var(--muted);
  font-size: 13px;
}

.price {
  margin-top: 10px;
  font-weight: 700;
  color: var(--accent);
  font-size: 15px;
}

.specs {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: 8px;
  margin-top: 10px;
  color: rgba(28, 28, 28, 0.75);
  font-size: 13px;
}

.specItem {
  white-space: nowrap;
}

.dot {
  opacity: 0.4;
}

.btn {
  /* ‚úÖ –Ω–æ –º—ã –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º "–≤–æ–∑–¥—É—Ö" –Ω–∞–¥ –∫–Ω–æ–ø–∫–æ–π */
  padding-top: 14px;

  align-self: flex-start;

  width: fit-content;
  padding: 10px 14px;
  border-radius: 4px;
  text-decoration: none;
}

.badges {
  margin-top: 10px;
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  align-items: center;
}

.badge {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 6px 10px;
  border: 1px solid var(--border);
  border-radius: 999px;
  background: rgba(255, 255, 255, 0.75);
  font-size: 12px;
  color: rgba(28, 28, 28, 0.78);
  max-width: 100%;
}

.badgeIcon {
  opacity: 0.9;
}

.badgeText {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 160px;
}

.more {
  font-size: 12px;
  color: var(--muted);
}

```

---

## components/PropertyCard/PropertyCard.tsx

```typescript
"use client";

import Link from "next/link";
import { scrollToHash } from "@/utils/smoothScroll";
import styles from "./PropertyCard.module.css";

type Feature = {
  key: string;   // parking, pool...
  label: string; // translated label
};

type Property = {
  title: string;
  location: string;
  price: string;
  beds: number;
  baths: number;
  area: number;
  image: string;

  // ‚úÖ –ù–æ–≤–æ–µ (–Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ)
  href?: string;              // –µ—Å–ª–∏ –µ—Å—Ç—å ‚Äî –∫–Ω–æ–ø–∫–∞ –≤–µ–¥—ë—Ç –ø–æ —Å—Å—ã–ª–∫–µ, –∞ –Ω–µ —Å–∫—Ä–æ–ª–ª–∏—Ç
  features?: Feature[];       // amenities –¥–ª—è –±–µ–π–¥–∂–µ–π
  showFeatures?: boolean;     // –º–æ–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä –Ω–∞ –≥–ª–∞–≤–Ω–æ–π)
};

type CardT = {
  beds: string;
  baths: string;
  details: string;
};

const ICON: Record<string, string> = {
  parking: "üÖøÔ∏è",
  garage: "üöó",
  pool: "üèä",
  gym: "üèãÔ∏è",
  lift: "üõó",
  terrace: "üå§Ô∏è",
  garden: "üåø",
  sea_view: "üåä",
  storage: "üì¶",
  aircon: "‚ùÑÔ∏è",
  heating: "üî•",
  gated: "üîí",
};

export default function PropertyCard({
  property,
  t,
}: {
  property: Property;
  t: CardT;
}) {
  const feats = Array.isArray(property.features) ? property.features : [];
  const showFeatures = property.showFeatures !== false; // –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–æ–∫–∞–∑—ã–≤–∞–µ–º

  return (
    <article className={styles.card}>
      <div className={styles.imageWrap}>
        <img
          className={styles.image}
          src={property.image}
          alt={property.title}
          loading="lazy"
        />
      </div>

      <div className={styles.body}>
        <h3 className={styles.title}>{property.title}</h3>
        <div className={styles.meta}>{property.location}</div>

        <div className={styles.price}>{property.price}</div>

        <div className={styles.specs}>
          <span className={styles.specItem}>
            üõè {property.beds} {t.beds}
          </span>
          <span className={styles.dot}>‚Ä¢</span>
          <span className={styles.specItem}>
            üõÅ {property.baths} {t.baths}
          </span>
          <span className={styles.dot}>‚Ä¢</span>
          <span className={styles.specItem}>üìê {property.area} m¬≤</span>
        </div>

        {/* ‚úÖ Amenities / Features (–±–µ–π–¥–∂–∏) */}
        {showFeatures && feats.length > 0 && (
          <div className={styles.badges} aria-label="Amenities">
            {feats.slice(0, 5).map((f) => (
              <span key={f.key} className={styles.badge} title={f.label}>
                <span className={styles.badgeIcon}>{ICON[f.key] ?? "‚Ä¢"}</span>
                <span className={styles.badgeText}>{f.label}</span>
              </span>
            ))}
            {feats.length > 5 && (
              <span className={styles.more}>+{feats.length - 5}</span>
            )}
          </div>
        )}

        {/* ‚úÖ spacer */}
        <div className={styles.spacer} />

        {/* ‚úÖ –í–ê–ñ–ù–û: –µ—Å–ª–∏ href –µ—Å—Ç—å ‚Äî –æ–±—ã—á–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è, –∏–Ω–∞—á–µ —è–∫–æ—Ä—å */}
        {property.href ? (
          <Link className={`btn btnPrimary ${styles.btn}`} href={property.href}>
            {t.details}
          </Link>
        ) : (
          <a
            className={`btn btnPrimary ${styles.btn}`}
            href="#contact"
            onClick={(e) => {
              e.preventDefault();
              scrollToHash("#contact", { offset: 90 });
            }}
          >
            {t.details}
          </a>
        )}
      </div>
    </article>
  );
}

```

---

## components/PropertyGallery/PropertyGallery.module.css

```css
/* components/PropertyGallery/PropertyGallery.module.css */

.gallery {
  --cover-h: 520px;

  display: grid;
  grid-template-columns: 2fr 1fr;
  gap: 14px;
  align-items: start;
}

/* Cover */
.coverBtn {
  border: 0;
  padding: 0;
  margin: 0;
  background: transparent;
  cursor: pointer;
  border-radius: 18px;
  overflow: hidden;
  display: block;
  width: 100%;
}

.cover {
  width: 100%;
  height: var(--cover-h);
  object-fit: cover;
  display: block;
}

/* Thumbs (desktop) */
.thumbs {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;

  /* ‚úÖ –∫–ª—é—á–µ–≤–æ–µ: –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –≤—ã—Å–æ—Ç—É –ø—Ä–∞–≤–æ–π –∫–æ–ª–æ–Ω–∫–∏ –∏ –≤–∫–ª—é—á–∞–µ–º —Å–∫—Ä–æ–ª–ª */
  height: var(--cover-h);
  overflow-y: auto;
  overflow-x: hidden;

  align-content: start;
  align-items: start;

  /* —á—Ç–æ–±—ã —Å–∫—Ä–æ–ª–ª –Ω–µ "—Å—ä–µ–¥–∞–ª" —à–∏—Ä–∏–Ω—É –∏ —Å–µ—Ç–∫–∞ –Ω–µ –ø—Ä—ã–≥–∞–ª–∞ */
  scrollbar-gutter: stable;
  padding-right: 6px;
}

.thumbBtn {
  border: 0;
  padding: 0;
  margin: 0;
  background: transparent;
  cursor: pointer;
  border-radius: 16px;
  overflow: hidden;
  display: block;
  width: 100%;
}

.thumb {
  width: 100%;
  height: 120px;
  object-fit: cover;
  display: block;
}

/* -----------------------------
   Mobile layout: cover top, thumbs below (2 rows, horizontal scroll)
------------------------------ */
@media (max-width: 720px) {
  .gallery {
    --cover-h: 320px;

    grid-template-columns: 1fr;
    gap: 12px;
  }

  /* 2 rows, horizontal scroll */
  .thumbs {
    height: auto;                 /* ‚úÖ —É–±–∏—Ä–∞–µ–º –¥–µ—Å–∫—Ç–æ–ø-–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ */
    overflow-y: hidden;
    overflow-x: auto;

    display: grid;
    grid-auto-flow: column;
    grid-template-rows: repeat(2, 1fr);
    grid-auto-columns: 140px;
    gap: 10px;

    padding: 0 0 6px 0;
    margin: 0;

    -webkit-overflow-scrolling: touch;
    scroll-snap-type: x mandatory;

    justify-content: start;
    justify-items: start;
    align-content: start;
  }

  .thumbBtn {
    scroll-snap-align: start;
    width: 140px;
    display: block;
  }

  .thumb {
    height: 95px;
  }
}

/* -----------------------------
   Modal
------------------------------ */
.overlay {
  position: fixed;
  inset: 0;
  background: rgba(10, 10, 10, 0.75);
  z-index: 9999;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 18px;
}

.modal {
  width: min(1100px, 100%);
  height: min(720px, 100%);
  display: grid;
  grid-template-rows: auto 1fr auto;
  gap: 12px;
}

.modalTop {
  display: flex;
  justify-content: flex-end;
}

.closeBtn {
  border: 1px solid rgba(255, 255, 255, 0.25);
  background: rgba(255, 255, 255, 0.08);
  color: #fff;
  padding: 10px 14px;
  border-radius: 12px;
  cursor: pointer;
  font-weight: 600;
}

.stage {
  position: relative;
  border-radius: 16px;
  overflow: hidden;
  background: rgba(255, 255, 255, 0.06);
}

.stageImg {
  width: 100%;
  height: 100%;
  object-fit: contain;
  display: block;
}

.navBtn {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  border: 1px solid rgba(255, 255, 255, 0.25);
  background: rgba(0, 0, 0, 0.35);
  color: #fff;
  width: 46px;
  height: 46px;
  border-radius: 999px;
  cursor: pointer;
  font-size: 22px;
  line-height: 46px;
}

.prev {
  left: 12px;
}
.next {
  right: 12px;
}

.modalBottom {
  display: flex;
  justify-content: center;
  color: rgba(255, 255, 255, 0.85);
  font-size: 14px;
}

```

---

## components/PropertyGallery/PropertyGallery.tsx

```typescript
"use client";

import { useState } from "react";
import GalleryModal from "@/components/GalleryModal/GalleryModal";
import styles from "./PropertyGallery.module.css";

type ImageItem = {
  url: string;
  isCover?: boolean;
};

export default function PropertyGallery({ images }: { images: ImageItem[] }) {
  const [open, setOpen] = useState(false);
  const [index, setIndex] = useState(0);

  function openAt(i: number) {
    setIndex(i);
    setOpen(true);
  }

  function prev() {
    setIndex((i) => (i - 1 + images.length) % images.length);
  }

  function next() {
    setIndex((i) => (i + 1) % images.length);
  }

  const coverIndex = images.findIndex((i) => i.isCover);
  const cover = coverIndex >= 0 ? images[coverIndex] : images[0];

  return (
    <>
      <div className={styles.gallery}>
        <div className={styles.coverWrap}>
          <img
            src={cover.url}
            className={styles.cover}
            onClick={() => openAt(coverIndex >= 0 ? coverIndex : 0)}
          />
        </div>

        <div className={styles.thumbs}>
          {images.map((img, i) => (
            <img
              key={`${img.url}-${i}`}
              src={img.url}
              className={styles.thumb}
              onClick={() => openAt(i)}
            />
          ))}
        </div>
      </div>

      {open && (
        <GalleryModal
          images={images}
          index={index}
          onClose={() => setOpen(false)}
          onPrev={prev}
          onNext={next}
        />
      )}
    </>
  );
}

```

---

## components/Services/Services.module.css

```css
.section {
  padding: 72px 0;
  border-top: 1px solid rgba(226, 226, 222, 0.8);
}

.head {
  margin-bottom: 18px;
}

.grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 18px;
  margin-top: 16px;
}

.card {
  background: rgba(255, 255, 255, 0.72);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  padding: 18px 18px;
  display: flex;
  gap: 12px;
  align-items: flex-start;
  transition: transform 0.16s ease, box-shadow 0.16s ease;
}

.card:hover {
  transform: translateY(-2px);
  box-shadow: 0 14px 36px rgba(0, 0, 0, 0.08);
}

.icon {
  width: 44px;
  height: 44px;
  border-radius: 12px;
  background: rgba(14, 94, 86, 0.08);
  display: grid;
  place-items: center;
  font-size: 20px;
  flex: 0 0 auto;
}

.title {
  font-weight: 700;
  font-size: 15px;
}

.text {
  margin-top: 6px;
  color: var(--muted);
  font-size: 13px;
  line-height: 1.5;
}

@media (max-width: 960px) {
  .grid {
    grid-template-columns: 1fr;
  }
}

```

---

## components/Services/Services.tsx

```typescript
"use client";

import styles from "./Services.module.css";

type ServicesDict = {
  title: string;
  subtitle: string;
  items: {
    title: string;
    text: string;
    icon: string;
  }[];
};

export default function Services({ t }: { t: ServicesDict }) {
  return (
    <section id="services" className={`section ${styles.section}`}>
      <div className="container">
        {/* –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ + –ª–∏–Ω–∏–∏, –∫–∞–∫ –≤ –º–∞–∫–µ—Ç–µ */}
        <div className="section__head">
          <h2 className="sectionTitle">
            <span className="sectionTitleText">{t.title}</span>
          </h2>
          <p className="section__kicker">{t.subtitle}</p>
        </div>

        <div className={styles.grid}>
          {t.items.map((s) => (
            <div key={s.title} className={styles.card}>
              <div className={styles.icon}>{s.icon}</div>

              <div className={styles.content}>
                <div className={styles.title}>{s.title}</div>
                <div className={styles.text}>{s.text}</div>
              </div>
            </div>
          ))}
        </div>
      </div>
    </section>
  );
}

```

---

## db/index.ts

```typescript
// db/index.ts
import { drizzle } from "drizzle-orm/node-postgres";
import { Pool } from "pg";

const connectionString = process.env.DATABASE_URL;
if (!connectionString) {
  throw new Error("DATABASE_URL is not set");
}

declare global {
  // eslint-disable-next-line no-var
  var __grahaliaPool: Pool | undefined;
}

const pool =
  global.__grahaliaPool ??
  new Pool({
    connectionString,
  });

global.__grahaliaPool = pool;

export const db = drizzle(pool);

```

---

## db/migrations/0000_square_stark_industries.sql

```sql
CREATE TABLE "feature_translations" (
	"id" serial PRIMARY KEY NOT NULL,
	"feature_id" integer NOT NULL,
	"lang" varchar(2) NOT NULL,
	"label" varchar(120) NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
CREATE TABLE "features" (
	"id" serial PRIMARY KEY NOT NULL,
	"key" varchar(80) NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
CREATE TABLE "properties" (
	"id" serial PRIMARY KEY NOT NULL,
	"slug" varchar(120) NOT NULL,
	"is_published" boolean DEFAULT false NOT NULL,
	"price" numeric(12, 2),
	"currency" varchar(3) DEFAULT 'EUR' NOT NULL,
	"bedrooms" integer,
	"bathrooms" integer,
	"area_m2" integer,
	"location" varchar(120),
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
CREATE TABLE "property_features" (
	"property_id" integer NOT NULL,
	"feature_id" integer NOT NULL,
	CONSTRAINT "property_features_property_id_feature_id_pk" PRIMARY KEY("property_id","feature_id")
);
--> statement-breakpoint
CREATE TABLE "property_images" (
	"id" serial PRIMARY KEY NOT NULL,
	"property_id" integer NOT NULL,
	"url" text NOT NULL,
	"alt" varchar(200),
	"sort_order" integer DEFAULT 0 NOT NULL,
	"is_cover" boolean DEFAULT false NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
CREATE TABLE "property_translations" (
	"id" serial PRIMARY KEY NOT NULL,
	"property_id" integer NOT NULL,
	"lang" varchar(2) NOT NULL,
	"title" varchar(200) NOT NULL,
	"summary" varchar(300),
	"description" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
ALTER TABLE "feature_translations" ADD CONSTRAINT "feature_translations_feature_id_features_id_fk" FOREIGN KEY ("feature_id") REFERENCES "public"."features"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "property_features" ADD CONSTRAINT "property_features_property_id_properties_id_fk" FOREIGN KEY ("property_id") REFERENCES "public"."properties"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "property_features" ADD CONSTRAINT "property_features_feature_id_features_id_fk" FOREIGN KEY ("feature_id") REFERENCES "public"."features"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "property_images" ADD CONSTRAINT "property_images_property_id_properties_id_fk" FOREIGN KEY ("property_id") REFERENCES "public"."properties"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "property_translations" ADD CONSTRAINT "property_translations_property_id_properties_id_fk" FOREIGN KEY ("property_id") REFERENCES "public"."properties"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
CREATE UNIQUE INDEX "feature_translations_feature_lang_unique" ON "feature_translations" USING btree ("feature_id","lang");--> statement-breakpoint
CREATE UNIQUE INDEX "features_key_unique" ON "features" USING btree ("key");--> statement-breakpoint
CREATE UNIQUE INDEX "properties_slug_unique" ON "properties" USING btree ("slug");--> statement-breakpoint
CREATE UNIQUE INDEX "property_images_property_sort_unique" ON "property_images" USING btree ("property_id","sort_order");--> statement-breakpoint
CREATE UNIQUE INDEX "property_translations_property_lang_unique" ON "property_translations" USING btree ("property_id","lang");
```

---

## db/migrations/0001_sleepy_agent_brand.sql

```sql
ALTER TABLE "properties" ADD COLUMN "plot_area_m2" integer;--> statement-breakpoint
ALTER TABLE "properties" ADD COLUMN "built_area_m2" integer;--> statement-breakpoint
ALTER TABLE "properties" ADD COLUMN "terrace_area_m2" integer;--> statement-breakpoint
ALTER TABLE "properties" ADD COLUMN "plans_url" text;--> statement-breakpoint
ALTER TABLE "properties" DROP COLUMN "area_m2";
```

---

## db/migrations/0002_steep_lady_vermin.sql

```sql
ALTER TABLE "properties" ALTER COLUMN "slug" SET DATA TYPE varchar(255);
```

---

## db/migrations/0003_hot_doctor_spectrum.sql

```sql
ALTER TABLE "properties" ADD COLUMN "property_type" varchar(24);--> statement-breakpoint
ALTER TABLE "properties" ADD COLUMN "condition" varchar(24);--> statement-breakpoint
ALTER TABLE "properties" ADD COLUMN "status" varchar(16) DEFAULT 'available' NOT NULL;--> statement-breakpoint
ALTER TABLE "properties" ADD COLUMN "city" varchar(80);--> statement-breakpoint
ALTER TABLE "properties" ADD COLUMN "area" varchar(80);--> statement-breakpoint
ALTER TABLE "properties" ADD COLUMN "subarea" varchar(80);--> statement-breakpoint
ALTER TABLE "properties" ADD COLUMN "lat" numeric(9, 6);--> statement-breakpoint
ALTER TABLE "properties" ADD COLUMN "lng" numeric(9, 6);--> statement-breakpoint
ALTER TABLE "properties" ADD COLUMN "floor" integer;--> statement-breakpoint
ALTER TABLE "properties" ADD COLUMN "total_floors" integer;--> statement-breakpoint
ALTER TABLE "properties" ADD COLUMN "community_fees_month" numeric(10, 2);--> statement-breakpoint
ALTER TABLE "properties" ADD COLUMN "ibi_year" numeric(10, 2);--> statement-breakpoint
ALTER TABLE "properties" ADD COLUMN "garbage_tax_year" numeric(10, 2);--> statement-breakpoint
ALTER TABLE "properties" ADD COLUMN "orientation" varchar(2);--> statement-breakpoint
ALTER TABLE "properties" ADD COLUMN "energy_rating" varchar(1);--> statement-breakpoint
ALTER TABLE "properties" ADD COLUMN "year_built" integer;
```

---

## db/migrations/0004_seed_features.sql

```sql
-- Seed features (amenities) for Grahalia Estates
-- Safe to re-run: uses ON CONFLICT DO NOTHING

BEGIN;

-- 1) features (keys)
INSERT INTO features(key)
VALUES
  ('air_conditioning'),
  ('pool'),
  ('garden'),
  ('terrace'),
  ('parking'),
  ('garage'),
  ('sea_view'),
  ('mountain_view'),
  ('lift'),
  ('storage_room'),
  ('gym'),
  ('security'),
  ('gated_community'),
  ('furnished'),
  ('pets_allowed'),
  ('heating'),
  ('fireplace'),
  ('barbecue'),
  ('sauna'),
  ('jacuzzi'),
  ('near_beach'),
  ('near_golf'),
  ('near_schools'),
  ('smart_home')
ON CONFLICT (key) DO NOTHING;

-- 2) translations (EN)
INSERT INTO feature_translations(feature_id, lang, label)
SELECT f.id, 'en',
  CASE f.key
    WHEN 'air_conditioning' THEN 'Air conditioning'
    WHEN 'pool' THEN 'Pool'
    WHEN 'garden' THEN 'Garden'
    WHEN 'terrace' THEN 'Terrace'
    WHEN 'parking' THEN 'Parking'
    WHEN 'garage' THEN 'Garage'
    WHEN 'sea_view' THEN 'Sea view'
    WHEN 'mountain_view' THEN 'Mountain view'
    WHEN 'lift' THEN 'Lift'
    WHEN 'storage_room' THEN 'Storage room'
    WHEN 'gym' THEN 'Gym'
    WHEN 'security' THEN 'Security'
    WHEN 'gated_community' THEN 'Gated community'
    WHEN 'furnished' THEN 'Furnished'
    WHEN 'pets_allowed' THEN 'Pets allowed'
    WHEN 'heating' THEN 'Heating'
    WHEN 'fireplace' THEN 'Fireplace'
    WHEN 'barbecue' THEN 'Barbecue'
    WHEN 'sauna' THEN 'Sauna'
    WHEN 'jacuzzi' THEN 'Jacuzzi'
    WHEN 'near_beach' THEN 'Near beach'
    WHEN 'near_golf' THEN 'Near golf'
    WHEN 'near_schools' THEN 'Near schools'
    WHEN 'smart_home' THEN 'Smart home'
    ELSE f.key
  END
FROM features f
ON CONFLICT (feature_id, lang) DO NOTHING;

-- 3) translations (ES)
INSERT INTO feature_translations(feature_id, lang, label)
SELECT f.id, 'es',
  CASE f.key
    WHEN 'air_conditioning' THEN 'Aire acondicionado'
    WHEN 'pool' THEN 'Piscina'
    WHEN 'garden' THEN 'Jard√≠n'
    WHEN 'terrace' THEN 'Terraza'
    WHEN 'parking' THEN 'Aparcamiento'
    WHEN 'garage' THEN 'Garaje'
    WHEN 'sea_view' THEN 'Vistas al mar'
    WHEN 'mountain_view' THEN 'Vistas a la monta√±a'
    WHEN 'lift' THEN 'Ascensor'
    WHEN 'storage_room' THEN 'Trastero'
    WHEN 'gym' THEN 'Gimnasio'
    WHEN 'security' THEN 'Seguridad'
    WHEN 'gated_community' THEN 'Urbanizaci√≥n cerrada'
    WHEN 'furnished' THEN 'Amueblado'
    WHEN 'pets_allowed' THEN 'Se admiten mascotas'
    WHEN 'heating' THEN 'Calefacci√≥n'
    WHEN 'fireplace' THEN 'Chimenea'
    WHEN 'barbecue' THEN 'Barbacoa'
    WHEN 'sauna' THEN 'Sauna'
    WHEN 'jacuzzi' THEN 'Jacuzzi'
    WHEN 'near_beach' THEN 'Cerca de la playa'
    WHEN 'near_golf' THEN 'Cerca de campos de golf'
    WHEN 'near_schools' THEN 'Cerca de colegios'
    WHEN 'smart_home' THEN 'Casa inteligente'
    ELSE f.key
  END
FROM features f
ON CONFLICT (feature_id, lang) DO NOTHING;

COMMIT;

```

---

## db/migrations/0005_add_leads.sql

```sql
CREATE TABLE "leads" (
	"id" serial PRIMARY KEY NOT NULL,
	"name" varchar(120) NOT NULL,
	"phone" varchar(60) NOT NULL,
	"email" varchar(160) NOT NULL,
	"message" text,
	"lang" varchar(2) NOT NULL,
	"page_url" text NOT NULL,
	"property_id" integer,
	"property_slug" varchar(255),
	"created_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
ALTER TABLE "properties" ADD COLUMN "description_en" text;--> statement-breakpoint
ALTER TABLE "properties" ADD COLUMN "description_es" text;--> statement-breakpoint
ALTER TABLE "leads" ADD CONSTRAINT "leads_property_id_properties_id_fk" FOREIGN KEY ("property_id") REFERENCES "public"."properties"("id") ON DELETE set null ON UPDATE no action;
```

---

## db/migrations/0005_rapid_union_jack.sql

```sql
ALTER TABLE "leads" ADD COLUMN "status" varchar(20) DEFAULT 'new' NOT NULL;--> statement-breakpoint
ALTER TABLE "leads" ADD COLUMN "source" varchar(80);--> statement-breakpoint
ALTER TABLE "leads" ADD COLUMN "processed_at" timestamp with time zone;
```

---

## db/migrations/0006_large_kinsey_walden.sql

```sql
CREATE TABLE "lead_rate_limits" (
	"id" serial PRIMARY KEY NOT NULL,
	"ip" varchar(64) NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
CREATE INDEX "lead_rate_limits_ip_idx" ON "lead_rate_limits" USING btree ("ip");--> statement-breakpoint
CREATE INDEX "lead_rate_limits_created_at_idx" ON "lead_rate_limits" USING btree ("created_at");
```

---

## db/migrations/0007_happy_carnage.sql

```sql
ALTER TABLE "properties" ADD COLUMN "deal_type" varchar(8) DEFAULT 'sale' NOT NULL;
```

---

## db/migrations/0008_add_public_id.sql

```sql
-- 0008_add_public_id.sql
-- Adds public_id to properties and backfills existing rows.
-- public_id format: GE-000123

ALTER TABLE properties
  ADD COLUMN public_id varchar(16);

-- Backfill for existing rows
UPDATE properties
SET public_id = 'GE-' || lpad(id::text, 6, '0')
WHERE public_id IS NULL;

ALTER TABLE properties
  ALTER COLUMN public_id TYPE varchar(32);

CREATE UNIQUE INDEX properties_public_id_unique
  ON properties(public_id);

```

---

## db/migrations/0008_first_bucky.sql

```sql
CREATE TYPE "public"."rent_period" AS ENUM('month', 'week', 'day');--> statement-breakpoint
CREATE TYPE "public"."rent_type" AS ENUM('long_term', 'short_term', 'holiday');--> statement-breakpoint
ALTER TABLE "properties" ADD COLUMN "public_id" varchar(16) NOT NULL;--> statement-breakpoint
ALTER TABLE "properties" ADD COLUMN "rent_type" "rent_type";--> statement-breakpoint
ALTER TABLE "properties" ADD COLUMN "rent_price" numeric(12, 2);--> statement-breakpoint
ALTER TABLE "properties" ADD COLUMN "rent_period" "rent_period";--> statement-breakpoint
CREATE UNIQUE INDEX "properties_public_id_unique" ON "properties" USING btree ("public_id");
```

---

## db/migrations/meta/0000_snapshot.json

```json
{
  "id": "ea2ff403-1244-4331-9472-6738058293de",
  "prevId": "00000000-0000-0000-0000-000000000000",
  "version": "7",
  "dialect": "postgresql",
  "tables": {
    "public.feature_translations": {
      "name": "feature_translations",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "feature_id": {
          "name": "feature_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "lang": {
          "name": "lang",
          "type": "varchar(2)",
          "primaryKey": false,
          "notNull": true
        },
        "label": {
          "name": "label",
          "type": "varchar(120)",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "feature_translations_feature_lang_unique": {
          "name": "feature_translations_feature_lang_unique",
          "columns": [
            {
              "expression": "feature_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "lang",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "feature_translations_feature_id_features_id_fk": {
          "name": "feature_translations_feature_id_features_id_fk",
          "tableFrom": "feature_translations",
          "tableTo": "features",
          "columnsFrom": [
            "feature_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.features": {
      "name": "features",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "key": {
          "name": "key",
          "type": "varchar(80)",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "features_key_unique": {
          "name": "features_key_unique",
          "columns": [
            {
              "expression": "key",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.properties": {
      "name": "properties",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "slug": {
          "name": "slug",
          "type": "varchar(120)",
          "primaryKey": false,
          "notNull": true
        },
        "is_published": {
          "name": "is_published",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true,
          "default": false
        },
        "price": {
          "name": "price",
          "type": "numeric(12, 2)",
          "primaryKey": false,
          "notNull": false
        },
        "currency": {
          "name": "currency",
          "type": "varchar(3)",
          "primaryKey": false,
          "notNull": true,
          "default": "'EUR'"
        },
        "bedrooms": {
          "name": "bedrooms",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "bathrooms": {
          "name": "bathrooms",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "area_m2": {
          "name": "area_m2",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "location": {
          "name": "location",
          "type": "varchar(120)",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "properties_slug_unique": {
          "name": "properties_slug_unique",
          "columns": [
            {
              "expression": "slug",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.property_features": {
      "name": "property_features",
      "schema": "",
      "columns": {
        "property_id": {
          "name": "property_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "feature_id": {
          "name": "feature_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "property_features_property_id_properties_id_fk": {
          "name": "property_features_property_id_properties_id_fk",
          "tableFrom": "property_features",
          "tableTo": "properties",
          "columnsFrom": [
            "property_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        },
        "property_features_feature_id_features_id_fk": {
          "name": "property_features_feature_id_features_id_fk",
          "tableFrom": "property_features",
          "tableTo": "features",
          "columnsFrom": [
            "feature_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {
        "property_features_property_id_feature_id_pk": {
          "name": "property_features_property_id_feature_id_pk",
          "columns": [
            "property_id",
            "feature_id"
          ]
        }
      },
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.property_images": {
      "name": "property_images",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "property_id": {
          "name": "property_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "url": {
          "name": "url",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "alt": {
          "name": "alt",
          "type": "varchar(200)",
          "primaryKey": false,
          "notNull": false
        },
        "sort_order": {
          "name": "sort_order",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "is_cover": {
          "name": "is_cover",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true,
          "default": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "property_images_property_sort_unique": {
          "name": "property_images_property_sort_unique",
          "columns": [
            {
              "expression": "property_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "sort_order",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "property_images_property_id_properties_id_fk": {
          "name": "property_images_property_id_properties_id_fk",
          "tableFrom": "property_images",
          "tableTo": "properties",
          "columnsFrom": [
            "property_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.property_translations": {
      "name": "property_translations",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "property_id": {
          "name": "property_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "lang": {
          "name": "lang",
          "type": "varchar(2)",
          "primaryKey": false,
          "notNull": true
        },
        "title": {
          "name": "title",
          "type": "varchar(200)",
          "primaryKey": false,
          "notNull": true
        },
        "summary": {
          "name": "summary",
          "type": "varchar(300)",
          "primaryKey": false,
          "notNull": false
        },
        "description": {
          "name": "description",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "property_translations_property_lang_unique": {
          "name": "property_translations_property_lang_unique",
          "columns": [
            {
              "expression": "property_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "lang",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "property_translations_property_id_properties_id_fk": {
          "name": "property_translations_property_id_properties_id_fk",
          "tableFrom": "property_translations",
          "tableTo": "properties",
          "columnsFrom": [
            "property_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    }
  },
  "enums": {},
  "schemas": {},
  "sequences": {},
  "roles": {},
  "policies": {},
  "views": {},
  "_meta": {
    "columns": {},
    "schemas": {},
    "tables": {}
  }
}
```

---

## db/migrations/meta/0001_snapshot.json

```json
{
  "id": "017fd64b-ec5e-4a5d-bfb5-cd11e2150473",
  "prevId": "ea2ff403-1244-4331-9472-6738058293de",
  "version": "7",
  "dialect": "postgresql",
  "tables": {
    "public.feature_translations": {
      "name": "feature_translations",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "feature_id": {
          "name": "feature_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "lang": {
          "name": "lang",
          "type": "varchar(2)",
          "primaryKey": false,
          "notNull": true
        },
        "label": {
          "name": "label",
          "type": "varchar(120)",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "feature_translations_feature_lang_unique": {
          "name": "feature_translations_feature_lang_unique",
          "columns": [
            {
              "expression": "feature_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "lang",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "feature_translations_feature_id_features_id_fk": {
          "name": "feature_translations_feature_id_features_id_fk",
          "tableFrom": "feature_translations",
          "tableTo": "features",
          "columnsFrom": [
            "feature_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.features": {
      "name": "features",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "key": {
          "name": "key",
          "type": "varchar(80)",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "features_key_unique": {
          "name": "features_key_unique",
          "columns": [
            {
              "expression": "key",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.properties": {
      "name": "properties",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "slug": {
          "name": "slug",
          "type": "varchar(120)",
          "primaryKey": false,
          "notNull": true
        },
        "is_published": {
          "name": "is_published",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true,
          "default": false
        },
        "price": {
          "name": "price",
          "type": "numeric(12, 2)",
          "primaryKey": false,
          "notNull": false
        },
        "currency": {
          "name": "currency",
          "type": "varchar(3)",
          "primaryKey": false,
          "notNull": true,
          "default": "'EUR'"
        },
        "bedrooms": {
          "name": "bedrooms",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "bathrooms": {
          "name": "bathrooms",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "plot_area_m2": {
          "name": "plot_area_m2",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "built_area_m2": {
          "name": "built_area_m2",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "terrace_area_m2": {
          "name": "terrace_area_m2",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "location": {
          "name": "location",
          "type": "varchar(120)",
          "primaryKey": false,
          "notNull": false
        },
        "plans_url": {
          "name": "plans_url",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "properties_slug_unique": {
          "name": "properties_slug_unique",
          "columns": [
            {
              "expression": "slug",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.property_features": {
      "name": "property_features",
      "schema": "",
      "columns": {
        "property_id": {
          "name": "property_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "feature_id": {
          "name": "feature_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "property_features_property_id_properties_id_fk": {
          "name": "property_features_property_id_properties_id_fk",
          "tableFrom": "property_features",
          "tableTo": "properties",
          "columnsFrom": [
            "property_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        },
        "property_features_feature_id_features_id_fk": {
          "name": "property_features_feature_id_features_id_fk",
          "tableFrom": "property_features",
          "tableTo": "features",
          "columnsFrom": [
            "feature_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {
        "property_features_property_id_feature_id_pk": {
          "name": "property_features_property_id_feature_id_pk",
          "columns": [
            "property_id",
            "feature_id"
          ]
        }
      },
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.property_images": {
      "name": "property_images",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "property_id": {
          "name": "property_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "url": {
          "name": "url",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "alt": {
          "name": "alt",
          "type": "varchar(200)",
          "primaryKey": false,
          "notNull": false
        },
        "sort_order": {
          "name": "sort_order",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "is_cover": {
          "name": "is_cover",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true,
          "default": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "property_images_property_sort_unique": {
          "name": "property_images_property_sort_unique",
          "columns": [
            {
              "expression": "property_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "sort_order",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "property_images_property_id_properties_id_fk": {
          "name": "property_images_property_id_properties_id_fk",
          "tableFrom": "property_images",
          "tableTo": "properties",
          "columnsFrom": [
            "property_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.property_translations": {
      "name": "property_translations",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "property_id": {
          "name": "property_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "lang": {
          "name": "lang",
          "type": "varchar(2)",
          "primaryKey": false,
          "notNull": true
        },
        "title": {
          "name": "title",
          "type": "varchar(200)",
          "primaryKey": false,
          "notNull": true
        },
        "summary": {
          "name": "summary",
          "type": "varchar(300)",
          "primaryKey": false,
          "notNull": false
        },
        "description": {
          "name": "description",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "property_translations_property_lang_unique": {
          "name": "property_translations_property_lang_unique",
          "columns": [
            {
              "expression": "property_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "lang",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "property_translations_property_id_properties_id_fk": {
          "name": "property_translations_property_id_properties_id_fk",
          "tableFrom": "property_translations",
          "tableTo": "properties",
          "columnsFrom": [
            "property_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    }
  },
  "enums": {},
  "schemas": {},
  "sequences": {},
  "roles": {},
  "policies": {},
  "views": {},
  "_meta": {
    "columns": {},
    "schemas": {},
    "tables": {}
  }
}
```

---

## db/migrations/meta/0002_snapshot.json

```json
{
  "id": "d73d6116-c88c-4065-bb9c-49c8e70f9647",
  "prevId": "017fd64b-ec5e-4a5d-bfb5-cd11e2150473",
  "version": "7",
  "dialect": "postgresql",
  "tables": {
    "public.feature_translations": {
      "name": "feature_translations",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "feature_id": {
          "name": "feature_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "lang": {
          "name": "lang",
          "type": "varchar(2)",
          "primaryKey": false,
          "notNull": true
        },
        "label": {
          "name": "label",
          "type": "varchar(120)",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "feature_translations_feature_lang_unique": {
          "name": "feature_translations_feature_lang_unique",
          "columns": [
            {
              "expression": "feature_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "lang",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "feature_translations_feature_id_features_id_fk": {
          "name": "feature_translations_feature_id_features_id_fk",
          "tableFrom": "feature_translations",
          "tableTo": "features",
          "columnsFrom": [
            "feature_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.features": {
      "name": "features",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "key": {
          "name": "key",
          "type": "varchar(80)",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "features_key_unique": {
          "name": "features_key_unique",
          "columns": [
            {
              "expression": "key",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.properties": {
      "name": "properties",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "slug": {
          "name": "slug",
          "type": "varchar(255)",
          "primaryKey": false,
          "notNull": true
        },
        "is_published": {
          "name": "is_published",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true,
          "default": false
        },
        "price": {
          "name": "price",
          "type": "numeric(12, 2)",
          "primaryKey": false,
          "notNull": false
        },
        "currency": {
          "name": "currency",
          "type": "varchar(3)",
          "primaryKey": false,
          "notNull": true,
          "default": "'EUR'"
        },
        "bedrooms": {
          "name": "bedrooms",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "bathrooms": {
          "name": "bathrooms",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "plot_area_m2": {
          "name": "plot_area_m2",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "built_area_m2": {
          "name": "built_area_m2",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "terrace_area_m2": {
          "name": "terrace_area_m2",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "location": {
          "name": "location",
          "type": "varchar(120)",
          "primaryKey": false,
          "notNull": false
        },
        "plans_url": {
          "name": "plans_url",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "properties_slug_unique": {
          "name": "properties_slug_unique",
          "columns": [
            {
              "expression": "slug",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.property_features": {
      "name": "property_features",
      "schema": "",
      "columns": {
        "property_id": {
          "name": "property_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "feature_id": {
          "name": "feature_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "property_features_property_id_properties_id_fk": {
          "name": "property_features_property_id_properties_id_fk",
          "tableFrom": "property_features",
          "tableTo": "properties",
          "columnsFrom": [
            "property_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        },
        "property_features_feature_id_features_id_fk": {
          "name": "property_features_feature_id_features_id_fk",
          "tableFrom": "property_features",
          "tableTo": "features",
          "columnsFrom": [
            "feature_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {
        "property_features_property_id_feature_id_pk": {
          "name": "property_features_property_id_feature_id_pk",
          "columns": [
            "property_id",
            "feature_id"
          ]
        }
      },
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.property_images": {
      "name": "property_images",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "property_id": {
          "name": "property_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "url": {
          "name": "url",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "alt": {
          "name": "alt",
          "type": "varchar(200)",
          "primaryKey": false,
          "notNull": false
        },
        "sort_order": {
          "name": "sort_order",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "is_cover": {
          "name": "is_cover",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true,
          "default": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "property_images_property_sort_unique": {
          "name": "property_images_property_sort_unique",
          "columns": [
            {
              "expression": "property_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "sort_order",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "property_images_property_id_properties_id_fk": {
          "name": "property_images_property_id_properties_id_fk",
          "tableFrom": "property_images",
          "tableTo": "properties",
          "columnsFrom": [
            "property_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.property_translations": {
      "name": "property_translations",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "property_id": {
          "name": "property_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "lang": {
          "name": "lang",
          "type": "varchar(2)",
          "primaryKey": false,
          "notNull": true
        },
        "title": {
          "name": "title",
          "type": "varchar(200)",
          "primaryKey": false,
          "notNull": true
        },
        "summary": {
          "name": "summary",
          "type": "varchar(300)",
          "primaryKey": false,
          "notNull": false
        },
        "description": {
          "name": "description",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "property_translations_property_lang_unique": {
          "name": "property_translations_property_lang_unique",
          "columns": [
            {
              "expression": "property_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "lang",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "property_translations_property_id_properties_id_fk": {
          "name": "property_translations_property_id_properties_id_fk",
          "tableFrom": "property_translations",
          "tableTo": "properties",
          "columnsFrom": [
            "property_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    }
  },
  "enums": {},
  "schemas": {},
  "sequences": {},
  "roles": {},
  "policies": {},
  "views": {},
  "_meta": {
    "columns": {},
    "schemas": {},
    "tables": {}
  }
}
```

---

## db/migrations/meta/0003_snapshot.json

```json
{
  "id": "12ca2264-fd63-4f6d-8e0e-e01cda60947d",
  "prevId": "d73d6116-c88c-4065-bb9c-49c8e70f9647",
  "version": "7",
  "dialect": "postgresql",
  "tables": {
    "public.feature_translations": {
      "name": "feature_translations",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "feature_id": {
          "name": "feature_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "lang": {
          "name": "lang",
          "type": "varchar(2)",
          "primaryKey": false,
          "notNull": true
        },
        "label": {
          "name": "label",
          "type": "varchar(120)",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "feature_translations_feature_lang_unique": {
          "name": "feature_translations_feature_lang_unique",
          "columns": [
            {
              "expression": "feature_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "lang",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "feature_translations_feature_id_features_id_fk": {
          "name": "feature_translations_feature_id_features_id_fk",
          "tableFrom": "feature_translations",
          "tableTo": "features",
          "columnsFrom": [
            "feature_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.features": {
      "name": "features",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "key": {
          "name": "key",
          "type": "varchar(80)",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "features_key_unique": {
          "name": "features_key_unique",
          "columns": [
            {
              "expression": "key",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.properties": {
      "name": "properties",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "slug": {
          "name": "slug",
          "type": "varchar(255)",
          "primaryKey": false,
          "notNull": true
        },
        "is_published": {
          "name": "is_published",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true,
          "default": false
        },
        "price": {
          "name": "price",
          "type": "numeric(12, 2)",
          "primaryKey": false,
          "notNull": false
        },
        "currency": {
          "name": "currency",
          "type": "varchar(3)",
          "primaryKey": false,
          "notNull": true,
          "default": "'EUR'"
        },
        "bedrooms": {
          "name": "bedrooms",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "bathrooms": {
          "name": "bathrooms",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "plot_area_m2": {
          "name": "plot_area_m2",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "built_area_m2": {
          "name": "built_area_m2",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "terrace_area_m2": {
          "name": "terrace_area_m2",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "location": {
          "name": "location",
          "type": "varchar(120)",
          "primaryKey": false,
          "notNull": false
        },
        "plans_url": {
          "name": "plans_url",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "property_type": {
          "name": "property_type",
          "type": "varchar(24)",
          "primaryKey": false,
          "notNull": false
        },
        "condition": {
          "name": "condition",
          "type": "varchar(24)",
          "primaryKey": false,
          "notNull": false
        },
        "status": {
          "name": "status",
          "type": "varchar(16)",
          "primaryKey": false,
          "notNull": true,
          "default": "'available'"
        },
        "city": {
          "name": "city",
          "type": "varchar(80)",
          "primaryKey": false,
          "notNull": false
        },
        "area": {
          "name": "area",
          "type": "varchar(80)",
          "primaryKey": false,
          "notNull": false
        },
        "subarea": {
          "name": "subarea",
          "type": "varchar(80)",
          "primaryKey": false,
          "notNull": false
        },
        "lat": {
          "name": "lat",
          "type": "numeric(9, 6)",
          "primaryKey": false,
          "notNull": false
        },
        "lng": {
          "name": "lng",
          "type": "numeric(9, 6)",
          "primaryKey": false,
          "notNull": false
        },
        "floor": {
          "name": "floor",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "total_floors": {
          "name": "total_floors",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "community_fees_month": {
          "name": "community_fees_month",
          "type": "numeric(10, 2)",
          "primaryKey": false,
          "notNull": false
        },
        "ibi_year": {
          "name": "ibi_year",
          "type": "numeric(10, 2)",
          "primaryKey": false,
          "notNull": false
        },
        "garbage_tax_year": {
          "name": "garbage_tax_year",
          "type": "numeric(10, 2)",
          "primaryKey": false,
          "notNull": false
        },
        "orientation": {
          "name": "orientation",
          "type": "varchar(2)",
          "primaryKey": false,
          "notNull": false
        },
        "energy_rating": {
          "name": "energy_rating",
          "type": "varchar(1)",
          "primaryKey": false,
          "notNull": false
        },
        "year_built": {
          "name": "year_built",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "properties_slug_unique": {
          "name": "properties_slug_unique",
          "columns": [
            {
              "expression": "slug",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.property_features": {
      "name": "property_features",
      "schema": "",
      "columns": {
        "property_id": {
          "name": "property_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "feature_id": {
          "name": "feature_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "property_features_property_id_properties_id_fk": {
          "name": "property_features_property_id_properties_id_fk",
          "tableFrom": "property_features",
          "tableTo": "properties",
          "columnsFrom": [
            "property_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        },
        "property_features_feature_id_features_id_fk": {
          "name": "property_features_feature_id_features_id_fk",
          "tableFrom": "property_features",
          "tableTo": "features",
          "columnsFrom": [
            "feature_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {
        "property_features_property_id_feature_id_pk": {
          "name": "property_features_property_id_feature_id_pk",
          "columns": [
            "property_id",
            "feature_id"
          ]
        }
      },
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.property_images": {
      "name": "property_images",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "property_id": {
          "name": "property_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "url": {
          "name": "url",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "alt": {
          "name": "alt",
          "type": "varchar(200)",
          "primaryKey": false,
          "notNull": false
        },
        "sort_order": {
          "name": "sort_order",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "is_cover": {
          "name": "is_cover",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true,
          "default": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "property_images_property_sort_unique": {
          "name": "property_images_property_sort_unique",
          "columns": [
            {
              "expression": "property_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "sort_order",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "property_images_property_id_properties_id_fk": {
          "name": "property_images_property_id_properties_id_fk",
          "tableFrom": "property_images",
          "tableTo": "properties",
          "columnsFrom": [
            "property_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.property_translations": {
      "name": "property_translations",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "property_id": {
          "name": "property_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "lang": {
          "name": "lang",
          "type": "varchar(2)",
          "primaryKey": false,
          "notNull": true
        },
        "title": {
          "name": "title",
          "type": "varchar(200)",
          "primaryKey": false,
          "notNull": true
        },
        "summary": {
          "name": "summary",
          "type": "varchar(300)",
          "primaryKey": false,
          "notNull": false
        },
        "description": {
          "name": "description",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "property_translations_property_lang_unique": {
          "name": "property_translations_property_lang_unique",
          "columns": [
            {
              "expression": "property_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "lang",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "property_translations_property_id_properties_id_fk": {
          "name": "property_translations_property_id_properties_id_fk",
          "tableFrom": "property_translations",
          "tableTo": "properties",
          "columnsFrom": [
            "property_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    }
  },
  "enums": {},
  "schemas": {},
  "sequences": {},
  "roles": {},
  "policies": {},
  "views": {},
  "_meta": {
    "columns": {},
    "schemas": {},
    "tables": {}
  }
}
```

---

## db/migrations/meta/0005_snapshot.json

```json
{
  "id": "a2e12d03-7f7e-4b2d-a850-e169b94810a8",
  "prevId": "836c0f31-16ca-449d-b096-5727e97c60b4",
  "version": "7",
  "dialect": "postgresql",
  "tables": {
    "public.feature_translations": {
      "name": "feature_translations",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "feature_id": {
          "name": "feature_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "lang": {
          "name": "lang",
          "type": "varchar(2)",
          "primaryKey": false,
          "notNull": true
        },
        "label": {
          "name": "label",
          "type": "varchar(120)",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "feature_translations_feature_lang_unique": {
          "name": "feature_translations_feature_lang_unique",
          "columns": [
            {
              "expression": "feature_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "lang",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "feature_translations_feature_id_features_id_fk": {
          "name": "feature_translations_feature_id_features_id_fk",
          "tableFrom": "feature_translations",
          "tableTo": "features",
          "columnsFrom": [
            "feature_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.features": {
      "name": "features",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "key": {
          "name": "key",
          "type": "varchar(80)",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "features_key_unique": {
          "name": "features_key_unique",
          "columns": [
            {
              "expression": "key",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.leads": {
      "name": "leads",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "varchar(120)",
          "primaryKey": false,
          "notNull": true
        },
        "phone": {
          "name": "phone",
          "type": "varchar(60)",
          "primaryKey": false,
          "notNull": true
        },
        "email": {
          "name": "email",
          "type": "varchar(160)",
          "primaryKey": false,
          "notNull": true
        },
        "message": {
          "name": "message",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "lang": {
          "name": "lang",
          "type": "varchar(2)",
          "primaryKey": false,
          "notNull": true
        },
        "page_url": {
          "name": "page_url",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "property_id": {
          "name": "property_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "property_slug": {
          "name": "property_slug",
          "type": "varchar(255)",
          "primaryKey": false,
          "notNull": false
        },
        "status": {
          "name": "status",
          "type": "varchar(20)",
          "primaryKey": false,
          "notNull": true,
          "default": "'new'"
        },
        "source": {
          "name": "source",
          "type": "varchar(80)",
          "primaryKey": false,
          "notNull": false
        },
        "processed_at": {
          "name": "processed_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {},
      "foreignKeys": {
        "leads_property_id_properties_id_fk": {
          "name": "leads_property_id_properties_id_fk",
          "tableFrom": "leads",
          "tableTo": "properties",
          "columnsFrom": [
            "property_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "set null",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.properties": {
      "name": "properties",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "slug": {
          "name": "slug",
          "type": "varchar(255)",
          "primaryKey": false,
          "notNull": true
        },
        "is_published": {
          "name": "is_published",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true,
          "default": false
        },
        "price": {
          "name": "price",
          "type": "numeric(12, 2)",
          "primaryKey": false,
          "notNull": false
        },
        "currency": {
          "name": "currency",
          "type": "varchar(3)",
          "primaryKey": false,
          "notNull": true,
          "default": "'EUR'"
        },
        "bedrooms": {
          "name": "bedrooms",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "bathrooms": {
          "name": "bathrooms",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "plot_area_m2": {
          "name": "plot_area_m2",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "built_area_m2": {
          "name": "built_area_m2",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "terrace_area_m2": {
          "name": "terrace_area_m2",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "location": {
          "name": "location",
          "type": "varchar(120)",
          "primaryKey": false,
          "notNull": false
        },
        "plans_url": {
          "name": "plans_url",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "description_en": {
          "name": "description_en",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "description_es": {
          "name": "description_es",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "property_type": {
          "name": "property_type",
          "type": "varchar(24)",
          "primaryKey": false,
          "notNull": false
        },
        "condition": {
          "name": "condition",
          "type": "varchar(24)",
          "primaryKey": false,
          "notNull": false
        },
        "status": {
          "name": "status",
          "type": "varchar(16)",
          "primaryKey": false,
          "notNull": true,
          "default": "'available'"
        },
        "city": {
          "name": "city",
          "type": "varchar(80)",
          "primaryKey": false,
          "notNull": false
        },
        "area": {
          "name": "area",
          "type": "varchar(80)",
          "primaryKey": false,
          "notNull": false
        },
        "subarea": {
          "name": "subarea",
          "type": "varchar(80)",
          "primaryKey": false,
          "notNull": false
        },
        "lat": {
          "name": "lat",
          "type": "numeric(9, 6)",
          "primaryKey": false,
          "notNull": false
        },
        "lng": {
          "name": "lng",
          "type": "numeric(9, 6)",
          "primaryKey": false,
          "notNull": false
        },
        "floor": {
          "name": "floor",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "total_floors": {
          "name": "total_floors",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "community_fees_month": {
          "name": "community_fees_month",
          "type": "numeric(10, 2)",
          "primaryKey": false,
          "notNull": false
        },
        "ibi_year": {
          "name": "ibi_year",
          "type": "numeric(10, 2)",
          "primaryKey": false,
          "notNull": false
        },
        "garbage_tax_year": {
          "name": "garbage_tax_year",
          "type": "numeric(10, 2)",
          "primaryKey": false,
          "notNull": false
        },
        "orientation": {
          "name": "orientation",
          "type": "varchar(2)",
          "primaryKey": false,
          "notNull": false
        },
        "energy_rating": {
          "name": "energy_rating",
          "type": "varchar(1)",
          "primaryKey": false,
          "notNull": false
        },
        "year_built": {
          "name": "year_built",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "properties_slug_unique": {
          "name": "properties_slug_unique",
          "columns": [
            {
              "expression": "slug",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.property_features": {
      "name": "property_features",
      "schema": "",
      "columns": {
        "property_id": {
          "name": "property_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "feature_id": {
          "name": "feature_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "property_features_property_id_properties_id_fk": {
          "name": "property_features_property_id_properties_id_fk",
          "tableFrom": "property_features",
          "tableTo": "properties",
          "columnsFrom": [
            "property_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        },
        "property_features_feature_id_features_id_fk": {
          "name": "property_features_feature_id_features_id_fk",
          "tableFrom": "property_features",
          "tableTo": "features",
          "columnsFrom": [
            "feature_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {
        "property_features_property_id_feature_id_pk": {
          "name": "property_features_property_id_feature_id_pk",
          "columns": [
            "property_id",
            "feature_id"
          ]
        }
      },
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.property_images": {
      "name": "property_images",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "property_id": {
          "name": "property_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "url": {
          "name": "url",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "alt": {
          "name": "alt",
          "type": "varchar(200)",
          "primaryKey": false,
          "notNull": false
        },
        "sort_order": {
          "name": "sort_order",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "is_cover": {
          "name": "is_cover",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true,
          "default": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "property_images_property_sort_unique": {
          "name": "property_images_property_sort_unique",
          "columns": [
            {
              "expression": "property_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "sort_order",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "property_images_property_id_properties_id_fk": {
          "name": "property_images_property_id_properties_id_fk",
          "tableFrom": "property_images",
          "tableTo": "properties",
          "columnsFrom": [
            "property_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.property_translations": {
      "name": "property_translations",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "property_id": {
          "name": "property_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "lang": {
          "name": "lang",
          "type": "varchar(2)",
          "primaryKey": false,
          "notNull": true
        },
        "title": {
          "name": "title",
          "type": "varchar(200)",
          "primaryKey": false,
          "notNull": true
        },
        "summary": {
          "name": "summary",
          "type": "varchar(300)",
          "primaryKey": false,
          "notNull": false
        },
        "description": {
          "name": "description",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "property_translations_property_lang_unique": {
          "name": "property_translations_property_lang_unique",
          "columns": [
            {
              "expression": "property_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "lang",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "property_translations_property_id_properties_id_fk": {
          "name": "property_translations_property_id_properties_id_fk",
          "tableFrom": "property_translations",
          "tableTo": "properties",
          "columnsFrom": [
            "property_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    }
  },
  "enums": {},
  "schemas": {},
  "sequences": {},
  "roles": {},
  "policies": {},
  "views": {},
  "_meta": {
    "columns": {},
    "schemas": {},
    "tables": {}
  }
}
```

---

## db/migrations/meta/0006_snapshot.json

```json
{
  "id": "c9e1d1e4-4ac6-44d9-a49c-14bcadeda2a7",
  "prevId": "a2e12d03-7f7e-4b2d-a850-e169b94810a8",
  "version": "7",
  "dialect": "postgresql",
  "tables": {
    "public.feature_translations": {
      "name": "feature_translations",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "feature_id": {
          "name": "feature_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "lang": {
          "name": "lang",
          "type": "varchar(2)",
          "primaryKey": false,
          "notNull": true
        },
        "label": {
          "name": "label",
          "type": "varchar(120)",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "feature_translations_feature_lang_unique": {
          "name": "feature_translations_feature_lang_unique",
          "columns": [
            {
              "expression": "feature_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "lang",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "feature_translations_feature_id_features_id_fk": {
          "name": "feature_translations_feature_id_features_id_fk",
          "tableFrom": "feature_translations",
          "tableTo": "features",
          "columnsFrom": [
            "feature_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.features": {
      "name": "features",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "key": {
          "name": "key",
          "type": "varchar(80)",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "features_key_unique": {
          "name": "features_key_unique",
          "columns": [
            {
              "expression": "key",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.lead_rate_limits": {
      "name": "lead_rate_limits",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "ip": {
          "name": "ip",
          "type": "varchar(64)",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "lead_rate_limits_ip_idx": {
          "name": "lead_rate_limits_ip_idx",
          "columns": [
            {
              "expression": "ip",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        },
        "lead_rate_limits_created_at_idx": {
          "name": "lead_rate_limits_created_at_idx",
          "columns": [
            {
              "expression": "created_at",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.leads": {
      "name": "leads",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "varchar(120)",
          "primaryKey": false,
          "notNull": true
        },
        "phone": {
          "name": "phone",
          "type": "varchar(60)",
          "primaryKey": false,
          "notNull": true
        },
        "email": {
          "name": "email",
          "type": "varchar(160)",
          "primaryKey": false,
          "notNull": true
        },
        "message": {
          "name": "message",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "lang": {
          "name": "lang",
          "type": "varchar(2)",
          "primaryKey": false,
          "notNull": true
        },
        "page_url": {
          "name": "page_url",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "property_id": {
          "name": "property_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "property_slug": {
          "name": "property_slug",
          "type": "varchar(255)",
          "primaryKey": false,
          "notNull": false
        },
        "status": {
          "name": "status",
          "type": "varchar(20)",
          "primaryKey": false,
          "notNull": true,
          "default": "'new'"
        },
        "source": {
          "name": "source",
          "type": "varchar(80)",
          "primaryKey": false,
          "notNull": false
        },
        "processed_at": {
          "name": "processed_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {},
      "foreignKeys": {
        "leads_property_id_properties_id_fk": {
          "name": "leads_property_id_properties_id_fk",
          "tableFrom": "leads",
          "tableTo": "properties",
          "columnsFrom": [
            "property_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "set null",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.properties": {
      "name": "properties",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "slug": {
          "name": "slug",
          "type": "varchar(255)",
          "primaryKey": false,
          "notNull": true
        },
        "is_published": {
          "name": "is_published",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true,
          "default": false
        },
        "price": {
          "name": "price",
          "type": "numeric(12, 2)",
          "primaryKey": false,
          "notNull": false
        },
        "currency": {
          "name": "currency",
          "type": "varchar(3)",
          "primaryKey": false,
          "notNull": true,
          "default": "'EUR'"
        },
        "bedrooms": {
          "name": "bedrooms",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "bathrooms": {
          "name": "bathrooms",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "plot_area_m2": {
          "name": "plot_area_m2",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "built_area_m2": {
          "name": "built_area_m2",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "terrace_area_m2": {
          "name": "terrace_area_m2",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "location": {
          "name": "location",
          "type": "varchar(120)",
          "primaryKey": false,
          "notNull": false
        },
        "plans_url": {
          "name": "plans_url",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "description_en": {
          "name": "description_en",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "description_es": {
          "name": "description_es",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "property_type": {
          "name": "property_type",
          "type": "varchar(24)",
          "primaryKey": false,
          "notNull": false
        },
        "condition": {
          "name": "condition",
          "type": "varchar(24)",
          "primaryKey": false,
          "notNull": false
        },
        "status": {
          "name": "status",
          "type": "varchar(16)",
          "primaryKey": false,
          "notNull": true,
          "default": "'available'"
        },
        "city": {
          "name": "city",
          "type": "varchar(80)",
          "primaryKey": false,
          "notNull": false
        },
        "area": {
          "name": "area",
          "type": "varchar(80)",
          "primaryKey": false,
          "notNull": false
        },
        "subarea": {
          "name": "subarea",
          "type": "varchar(80)",
          "primaryKey": false,
          "notNull": false
        },
        "lat": {
          "name": "lat",
          "type": "numeric(9, 6)",
          "primaryKey": false,
          "notNull": false
        },
        "lng": {
          "name": "lng",
          "type": "numeric(9, 6)",
          "primaryKey": false,
          "notNull": false
        },
        "floor": {
          "name": "floor",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "total_floors": {
          "name": "total_floors",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "community_fees_month": {
          "name": "community_fees_month",
          "type": "numeric(10, 2)",
          "primaryKey": false,
          "notNull": false
        },
        "ibi_year": {
          "name": "ibi_year",
          "type": "numeric(10, 2)",
          "primaryKey": false,
          "notNull": false
        },
        "garbage_tax_year": {
          "name": "garbage_tax_year",
          "type": "numeric(10, 2)",
          "primaryKey": false,
          "notNull": false
        },
        "orientation": {
          "name": "orientation",
          "type": "varchar(2)",
          "primaryKey": false,
          "notNull": false
        },
        "energy_rating": {
          "name": "energy_rating",
          "type": "varchar(1)",
          "primaryKey": false,
          "notNull": false
        },
        "year_built": {
          "name": "year_built",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "properties_slug_unique": {
          "name": "properties_slug_unique",
          "columns": [
            {
              "expression": "slug",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.property_features": {
      "name": "property_features",
      "schema": "",
      "columns": {
        "property_id": {
          "name": "property_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "feature_id": {
          "name": "feature_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "property_features_property_id_properties_id_fk": {
          "name": "property_features_property_id_properties_id_fk",
          "tableFrom": "property_features",
          "tableTo": "properties",
          "columnsFrom": [
            "property_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        },
        "property_features_feature_id_features_id_fk": {
          "name": "property_features_feature_id_features_id_fk",
          "tableFrom": "property_features",
          "tableTo": "features",
          "columnsFrom": [
            "feature_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {
        "property_features_property_id_feature_id_pk": {
          "name": "property_features_property_id_feature_id_pk",
          "columns": [
            "property_id",
            "feature_id"
          ]
        }
      },
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.property_images": {
      "name": "property_images",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "property_id": {
          "name": "property_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "url": {
          "name": "url",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "alt": {
          "name": "alt",
          "type": "varchar(200)",
          "primaryKey": false,
          "notNull": false
        },
        "sort_order": {
          "name": "sort_order",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "is_cover": {
          "name": "is_cover",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true,
          "default": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "property_images_property_sort_unique": {
          "name": "property_images_property_sort_unique",
          "columns": [
            {
              "expression": "property_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "sort_order",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "property_images_property_id_properties_id_fk": {
          "name": "property_images_property_id_properties_id_fk",
          "tableFrom": "property_images",
          "tableTo": "properties",
          "columnsFrom": [
            "property_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.property_translations": {
      "name": "property_translations",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "property_id": {
          "name": "property_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "lang": {
          "name": "lang",
          "type": "varchar(2)",
          "primaryKey": false,
          "notNull": true
        },
        "title": {
          "name": "title",
          "type": "varchar(200)",
          "primaryKey": false,
          "notNull": true
        },
        "summary": {
          "name": "summary",
          "type": "varchar(300)",
          "primaryKey": false,
          "notNull": false
        },
        "description": {
          "name": "description",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "property_translations_property_lang_unique": {
          "name": "property_translations_property_lang_unique",
          "columns": [
            {
              "expression": "property_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "lang",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "property_translations_property_id_properties_id_fk": {
          "name": "property_translations_property_id_properties_id_fk",
          "tableFrom": "property_translations",
          "tableTo": "properties",
          "columnsFrom": [
            "property_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    }
  },
  "enums": {},
  "schemas": {},
  "sequences": {},
  "roles": {},
  "policies": {},
  "views": {},
  "_meta": {
    "columns": {},
    "schemas": {},
    "tables": {}
  }
}
```

---

## db/migrations/meta/0007_snapshot.json

```json
{
  "id": "f64f81ab-91ce-469f-a7e7-33dc9a8997f0",
  "prevId": "c9e1d1e4-4ac6-44d9-a49c-14bcadeda2a7",
  "version": "7",
  "dialect": "postgresql",
  "tables": {
    "public.feature_translations": {
      "name": "feature_translations",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "feature_id": {
          "name": "feature_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "lang": {
          "name": "lang",
          "type": "varchar(2)",
          "primaryKey": false,
          "notNull": true
        },
        "label": {
          "name": "label",
          "type": "varchar(120)",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "feature_translations_feature_lang_unique": {
          "name": "feature_translations_feature_lang_unique",
          "columns": [
            {
              "expression": "feature_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "lang",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "feature_translations_feature_id_features_id_fk": {
          "name": "feature_translations_feature_id_features_id_fk",
          "tableFrom": "feature_translations",
          "tableTo": "features",
          "columnsFrom": [
            "feature_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.features": {
      "name": "features",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "key": {
          "name": "key",
          "type": "varchar(80)",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "features_key_unique": {
          "name": "features_key_unique",
          "columns": [
            {
              "expression": "key",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.lead_rate_limits": {
      "name": "lead_rate_limits",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "ip": {
          "name": "ip",
          "type": "varchar(64)",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "lead_rate_limits_ip_idx": {
          "name": "lead_rate_limits_ip_idx",
          "columns": [
            {
              "expression": "ip",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        },
        "lead_rate_limits_created_at_idx": {
          "name": "lead_rate_limits_created_at_idx",
          "columns": [
            {
              "expression": "created_at",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.leads": {
      "name": "leads",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "varchar(120)",
          "primaryKey": false,
          "notNull": true
        },
        "phone": {
          "name": "phone",
          "type": "varchar(60)",
          "primaryKey": false,
          "notNull": true
        },
        "email": {
          "name": "email",
          "type": "varchar(160)",
          "primaryKey": false,
          "notNull": true
        },
        "message": {
          "name": "message",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "lang": {
          "name": "lang",
          "type": "varchar(2)",
          "primaryKey": false,
          "notNull": true
        },
        "page_url": {
          "name": "page_url",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "property_id": {
          "name": "property_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "property_slug": {
          "name": "property_slug",
          "type": "varchar(255)",
          "primaryKey": false,
          "notNull": false
        },
        "status": {
          "name": "status",
          "type": "varchar(20)",
          "primaryKey": false,
          "notNull": true,
          "default": "'new'"
        },
        "source": {
          "name": "source",
          "type": "varchar(80)",
          "primaryKey": false,
          "notNull": false
        },
        "processed_at": {
          "name": "processed_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {},
      "foreignKeys": {
        "leads_property_id_properties_id_fk": {
          "name": "leads_property_id_properties_id_fk",
          "tableFrom": "leads",
          "tableTo": "properties",
          "columnsFrom": [
            "property_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "set null",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.properties": {
      "name": "properties",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "slug": {
          "name": "slug",
          "type": "varchar(255)",
          "primaryKey": false,
          "notNull": true
        },
        "is_published": {
          "name": "is_published",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true,
          "default": false
        },
        "price": {
          "name": "price",
          "type": "numeric(12, 2)",
          "primaryKey": false,
          "notNull": false
        },
        "currency": {
          "name": "currency",
          "type": "varchar(3)",
          "primaryKey": false,
          "notNull": true,
          "default": "'EUR'"
        },
        "bedrooms": {
          "name": "bedrooms",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "bathrooms": {
          "name": "bathrooms",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "plot_area_m2": {
          "name": "plot_area_m2",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "built_area_m2": {
          "name": "built_area_m2",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "terrace_area_m2": {
          "name": "terrace_area_m2",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "location": {
          "name": "location",
          "type": "varchar(120)",
          "primaryKey": false,
          "notNull": false
        },
        "plans_url": {
          "name": "plans_url",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "description_en": {
          "name": "description_en",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "description_es": {
          "name": "description_es",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "deal_type": {
          "name": "deal_type",
          "type": "varchar(8)",
          "primaryKey": false,
          "notNull": true,
          "default": "'sale'"
        },
        "property_type": {
          "name": "property_type",
          "type": "varchar(24)",
          "primaryKey": false,
          "notNull": false
        },
        "condition": {
          "name": "condition",
          "type": "varchar(24)",
          "primaryKey": false,
          "notNull": false
        },
        "status": {
          "name": "status",
          "type": "varchar(16)",
          "primaryKey": false,
          "notNull": true,
          "default": "'available'"
        },
        "city": {
          "name": "city",
          "type": "varchar(80)",
          "primaryKey": false,
          "notNull": false
        },
        "area": {
          "name": "area",
          "type": "varchar(80)",
          "primaryKey": false,
          "notNull": false
        },
        "subarea": {
          "name": "subarea",
          "type": "varchar(80)",
          "primaryKey": false,
          "notNull": false
        },
        "lat": {
          "name": "lat",
          "type": "numeric(9, 6)",
          "primaryKey": false,
          "notNull": false
        },
        "lng": {
          "name": "lng",
          "type": "numeric(9, 6)",
          "primaryKey": false,
          "notNull": false
        },
        "floor": {
          "name": "floor",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "total_floors": {
          "name": "total_floors",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "community_fees_month": {
          "name": "community_fees_month",
          "type": "numeric(10, 2)",
          "primaryKey": false,
          "notNull": false
        },
        "ibi_year": {
          "name": "ibi_year",
          "type": "numeric(10, 2)",
          "primaryKey": false,
          "notNull": false
        },
        "garbage_tax_year": {
          "name": "garbage_tax_year",
          "type": "numeric(10, 2)",
          "primaryKey": false,
          "notNull": false
        },
        "orientation": {
          "name": "orientation",
          "type": "varchar(2)",
          "primaryKey": false,
          "notNull": false
        },
        "energy_rating": {
          "name": "energy_rating",
          "type": "varchar(1)",
          "primaryKey": false,
          "notNull": false
        },
        "year_built": {
          "name": "year_built",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "properties_slug_unique": {
          "name": "properties_slug_unique",
          "columns": [
            {
              "expression": "slug",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.property_features": {
      "name": "property_features",
      "schema": "",
      "columns": {
        "property_id": {
          "name": "property_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "feature_id": {
          "name": "feature_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "property_features_property_id_properties_id_fk": {
          "name": "property_features_property_id_properties_id_fk",
          "tableFrom": "property_features",
          "tableTo": "properties",
          "columnsFrom": [
            "property_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        },
        "property_features_feature_id_features_id_fk": {
          "name": "property_features_feature_id_features_id_fk",
          "tableFrom": "property_features",
          "tableTo": "features",
          "columnsFrom": [
            "feature_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {
        "property_features_property_id_feature_id_pk": {
          "name": "property_features_property_id_feature_id_pk",
          "columns": [
            "property_id",
            "feature_id"
          ]
        }
      },
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.property_images": {
      "name": "property_images",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "property_id": {
          "name": "property_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "url": {
          "name": "url",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "alt": {
          "name": "alt",
          "type": "varchar(200)",
          "primaryKey": false,
          "notNull": false
        },
        "sort_order": {
          "name": "sort_order",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "is_cover": {
          "name": "is_cover",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true,
          "default": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "property_images_property_sort_unique": {
          "name": "property_images_property_sort_unique",
          "columns": [
            {
              "expression": "property_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "sort_order",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "property_images_property_id_properties_id_fk": {
          "name": "property_images_property_id_properties_id_fk",
          "tableFrom": "property_images",
          "tableTo": "properties",
          "columnsFrom": [
            "property_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.property_translations": {
      "name": "property_translations",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "property_id": {
          "name": "property_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "lang": {
          "name": "lang",
          "type": "varchar(2)",
          "primaryKey": false,
          "notNull": true
        },
        "title": {
          "name": "title",
          "type": "varchar(200)",
          "primaryKey": false,
          "notNull": true
        },
        "summary": {
          "name": "summary",
          "type": "varchar(300)",
          "primaryKey": false,
          "notNull": false
        },
        "description": {
          "name": "description",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "property_translations_property_lang_unique": {
          "name": "property_translations_property_lang_unique",
          "columns": [
            {
              "expression": "property_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "lang",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "property_translations_property_id_properties_id_fk": {
          "name": "property_translations_property_id_properties_id_fk",
          "tableFrom": "property_translations",
          "tableTo": "properties",
          "columnsFrom": [
            "property_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    }
  },
  "enums": {},
  "schemas": {},
  "sequences": {},
  "roles": {},
  "policies": {},
  "views": {},
  "_meta": {
    "columns": {},
    "schemas": {},
    "tables": {}
  }
}
```

---

## db/migrations/meta/0008_snapshot.json

```json
{
  "id": "5a8ef858-702b-49e2-961d-baca11182cf4",
  "prevId": "f64f81ab-91ce-469f-a7e7-33dc9a8997f0",
  "version": "7",
  "dialect": "postgresql",
  "tables": {
    "public.feature_translations": {
      "name": "feature_translations",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "feature_id": {
          "name": "feature_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "lang": {
          "name": "lang",
          "type": "varchar(2)",
          "primaryKey": false,
          "notNull": true
        },
        "label": {
          "name": "label",
          "type": "varchar(120)",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "feature_translations_feature_lang_unique": {
          "name": "feature_translations_feature_lang_unique",
          "columns": [
            {
              "expression": "feature_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "lang",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "feature_translations_feature_id_features_id_fk": {
          "name": "feature_translations_feature_id_features_id_fk",
          "tableFrom": "feature_translations",
          "tableTo": "features",
          "columnsFrom": [
            "feature_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.features": {
      "name": "features",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "key": {
          "name": "key",
          "type": "varchar(80)",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "features_key_unique": {
          "name": "features_key_unique",
          "columns": [
            {
              "expression": "key",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.lead_rate_limits": {
      "name": "lead_rate_limits",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "ip": {
          "name": "ip",
          "type": "varchar(64)",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "lead_rate_limits_ip_idx": {
          "name": "lead_rate_limits_ip_idx",
          "columns": [
            {
              "expression": "ip",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        },
        "lead_rate_limits_created_at_idx": {
          "name": "lead_rate_limits_created_at_idx",
          "columns": [
            {
              "expression": "created_at",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.leads": {
      "name": "leads",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "varchar(120)",
          "primaryKey": false,
          "notNull": true
        },
        "phone": {
          "name": "phone",
          "type": "varchar(60)",
          "primaryKey": false,
          "notNull": true
        },
        "email": {
          "name": "email",
          "type": "varchar(160)",
          "primaryKey": false,
          "notNull": true
        },
        "message": {
          "name": "message",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "lang": {
          "name": "lang",
          "type": "varchar(2)",
          "primaryKey": false,
          "notNull": true
        },
        "page_url": {
          "name": "page_url",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "property_id": {
          "name": "property_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "property_slug": {
          "name": "property_slug",
          "type": "varchar(255)",
          "primaryKey": false,
          "notNull": false
        },
        "status": {
          "name": "status",
          "type": "varchar(20)",
          "primaryKey": false,
          "notNull": true,
          "default": "'new'"
        },
        "source": {
          "name": "source",
          "type": "varchar(80)",
          "primaryKey": false,
          "notNull": false
        },
        "processed_at": {
          "name": "processed_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {},
      "foreignKeys": {
        "leads_property_id_properties_id_fk": {
          "name": "leads_property_id_properties_id_fk",
          "tableFrom": "leads",
          "tableTo": "properties",
          "columnsFrom": [
            "property_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "set null",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.properties": {
      "name": "properties",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "slug": {
          "name": "slug",
          "type": "varchar(255)",
          "primaryKey": false,
          "notNull": true
        },
        "public_id": {
          "name": "public_id",
          "type": "varchar(16)",
          "primaryKey": false,
          "notNull": true
        },
        "is_published": {
          "name": "is_published",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true,
          "default": false
        },
        "price": {
          "name": "price",
          "type": "numeric(12, 2)",
          "primaryKey": false,
          "notNull": false
        },
        "currency": {
          "name": "currency",
          "type": "varchar(3)",
          "primaryKey": false,
          "notNull": true,
          "default": "'EUR'"
        },
        "bedrooms": {
          "name": "bedrooms",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "bathrooms": {
          "name": "bathrooms",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "plot_area_m2": {
          "name": "plot_area_m2",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "built_area_m2": {
          "name": "built_area_m2",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "terrace_area_m2": {
          "name": "terrace_area_m2",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "location": {
          "name": "location",
          "type": "varchar(120)",
          "primaryKey": false,
          "notNull": false
        },
        "plans_url": {
          "name": "plans_url",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "description_en": {
          "name": "description_en",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "description_es": {
          "name": "description_es",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "deal_type": {
          "name": "deal_type",
          "type": "varchar(8)",
          "primaryKey": false,
          "notNull": true,
          "default": "'sale'"
        },
        "property_type": {
          "name": "property_type",
          "type": "varchar(24)",
          "primaryKey": false,
          "notNull": false
        },
        "condition": {
          "name": "condition",
          "type": "varchar(24)",
          "primaryKey": false,
          "notNull": false
        },
        "status": {
          "name": "status",
          "type": "varchar(16)",
          "primaryKey": false,
          "notNull": true,
          "default": "'available'"
        },
        "rent_type": {
          "name": "rent_type",
          "type": "rent_type",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": false
        },
        "rent_price": {
          "name": "rent_price",
          "type": "numeric(12, 2)",
          "primaryKey": false,
          "notNull": false
        },
        "rent_period": {
          "name": "rent_period",
          "type": "rent_period",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": false
        },
        "city": {
          "name": "city",
          "type": "varchar(80)",
          "primaryKey": false,
          "notNull": false
        },
        "area": {
          "name": "area",
          "type": "varchar(80)",
          "primaryKey": false,
          "notNull": false
        },
        "subarea": {
          "name": "subarea",
          "type": "varchar(80)",
          "primaryKey": false,
          "notNull": false
        },
        "lat": {
          "name": "lat",
          "type": "numeric(9, 6)",
          "primaryKey": false,
          "notNull": false
        },
        "lng": {
          "name": "lng",
          "type": "numeric(9, 6)",
          "primaryKey": false,
          "notNull": false
        },
        "floor": {
          "name": "floor",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "total_floors": {
          "name": "total_floors",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "community_fees_month": {
          "name": "community_fees_month",
          "type": "numeric(10, 2)",
          "primaryKey": false,
          "notNull": false
        },
        "ibi_year": {
          "name": "ibi_year",
          "type": "numeric(10, 2)",
          "primaryKey": false,
          "notNull": false
        },
        "garbage_tax_year": {
          "name": "garbage_tax_year",
          "type": "numeric(10, 2)",
          "primaryKey": false,
          "notNull": false
        },
        "orientation": {
          "name": "orientation",
          "type": "varchar(2)",
          "primaryKey": false,
          "notNull": false
        },
        "energy_rating": {
          "name": "energy_rating",
          "type": "varchar(1)",
          "primaryKey": false,
          "notNull": false
        },
        "year_built": {
          "name": "year_built",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "properties_slug_unique": {
          "name": "properties_slug_unique",
          "columns": [
            {
              "expression": "slug",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        },
        "properties_public_id_unique": {
          "name": "properties_public_id_unique",
          "columns": [
            {
              "expression": "public_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.property_features": {
      "name": "property_features",
      "schema": "",
      "columns": {
        "property_id": {
          "name": "property_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "feature_id": {
          "name": "feature_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "property_features_property_id_properties_id_fk": {
          "name": "property_features_property_id_properties_id_fk",
          "tableFrom": "property_features",
          "tableTo": "properties",
          "columnsFrom": [
            "property_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        },
        "property_features_feature_id_features_id_fk": {
          "name": "property_features_feature_id_features_id_fk",
          "tableFrom": "property_features",
          "tableTo": "features",
          "columnsFrom": [
            "feature_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {
        "property_features_property_id_feature_id_pk": {
          "name": "property_features_property_id_feature_id_pk",
          "columns": [
            "property_id",
            "feature_id"
          ]
        }
      },
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.property_images": {
      "name": "property_images",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "property_id": {
          "name": "property_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "url": {
          "name": "url",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "alt": {
          "name": "alt",
          "type": "varchar(200)",
          "primaryKey": false,
          "notNull": false
        },
        "sort_order": {
          "name": "sort_order",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "is_cover": {
          "name": "is_cover",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true,
          "default": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "property_images_property_sort_unique": {
          "name": "property_images_property_sort_unique",
          "columns": [
            {
              "expression": "property_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "sort_order",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "property_images_property_id_properties_id_fk": {
          "name": "property_images_property_id_properties_id_fk",
          "tableFrom": "property_images",
          "tableTo": "properties",
          "columnsFrom": [
            "property_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.property_translations": {
      "name": "property_translations",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "property_id": {
          "name": "property_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "lang": {
          "name": "lang",
          "type": "varchar(2)",
          "primaryKey": false,
          "notNull": true
        },
        "title": {
          "name": "title",
          "type": "varchar(200)",
          "primaryKey": false,
          "notNull": true
        },
        "summary": {
          "name": "summary",
          "type": "varchar(300)",
          "primaryKey": false,
          "notNull": false
        },
        "description": {
          "name": "description",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "property_translations_property_lang_unique": {
          "name": "property_translations_property_lang_unique",
          "columns": [
            {
              "expression": "property_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "lang",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "property_translations_property_id_properties_id_fk": {
          "name": "property_translations_property_id_properties_id_fk",
          "tableFrom": "property_translations",
          "tableTo": "properties",
          "columnsFrom": [
            "property_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    }
  },
  "enums": {
    "public.rent_period": {
      "name": "rent_period",
      "schema": "public",
      "values": [
        "month",
        "week",
        "day"
      ]
    },
    "public.rent_type": {
      "name": "rent_type",
      "schema": "public",
      "values": [
        "long_term",
        "short_term",
        "holiday"
      ]
    }
  },
  "schemas": {},
  "sequences": {},
  "roles": {},
  "policies": {},
  "views": {},
  "_meta": {
    "columns": {},
    "schemas": {},
    "tables": {}
  }
}
```

---

## db/migrations/meta/_journal.json

```json
{
  "version": "7",
  "dialect": "postgresql",
  "entries": [
    {
      "idx": 0,
      "version": "7",
      "when": 1768656408753,
      "tag": "0000_square_stark_industries",
      "breakpoints": true
    },
    {
      "idx": 1,
      "version": "7",
      "when": 1768660088691,
      "tag": "0001_sleepy_agent_brand",
      "breakpoints": true
    },
    {
      "idx": 2,
      "version": "7",
      "when": 1768677392854,
      "tag": "0002_steep_lady_vermin",
      "breakpoints": true
    },
    {
      "idx": 3,
      "version": "7",
      "when": 1768735739716,
      "tag": "0003_hot_doctor_spectrum",
      "breakpoints": true
    },
    {
      "idx": 4,
      "version": "7",
      "when": 1768756074651,
      "tag": "0005_add_leads",
      "breakpoints": true
    },
    {
      "idx": 5,
      "version": "7",
      "when": 1768940519752,
      "tag": "0005_rapid_union_jack",
      "breakpoints": true
    },
    {
      "idx": 6,
      "version": "7",
      "when": 1769025704135,
      "tag": "0006_large_kinsey_walden",
      "breakpoints": true
    },
    {
      "idx": 7,
      "version": "7",
      "when": 1769031417588,
      "tag": "0007_happy_carnage",
      "breakpoints": true
    },
    {
      "idx": 8,
      "version": "7",
      "when": 1769191604526,
      "tag": "0008_first_bucky",
      "breakpoints": true
    }
  ]
}
```

---

## db/schema.ts

```typescript
import {
  pgTable,
  pgEnum, // ‚úÖ –î–û–ë–ê–í–ò–¢–¨
  serial,
  integer,
  varchar,
  text,
  boolean,
  numeric,
  timestamp,
  primaryKey,
  uniqueIndex,
  index, // ‚úÖ –¥–æ–±–∞–≤–∏—Ç—å
} from "drizzle-orm/pg-core";

// 1) –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —è–∑—ã–∫–∏: —Ç–æ–ª—å–∫–æ —Ç–µ, —á—Ç–æ –µ—Å—Ç—å –≤ –ø—Ä–æ–µ–∫—Ç–µ
export const localeEnumValues = ["en", "es"] as const;
export type Locale = (typeof localeEnumValues)[number];

// --------------------
// RENT (—Ç–∏–ø—ã –∞—Ä–µ–Ω–¥—ã)
// --------------------
export const rentTypeEnum = pgEnum("rent_type", ["long_term", "short_term", "holiday"]);

export const rentPeriodEnum = pgEnum("rent_period", ["month", "week", "day"]);


// --------------------
// PROPERTIES (–æ—Å–Ω–æ–≤–∞)
// --------------------
export const properties = pgTable(
  "properties",
  {
    id: serial("id").primaryKey(),

    // slug –¥–ª—è URL: /[lang]/properties/[slug]
    slug: varchar("slug", { length: 255 }).notNull(),
    publicId: varchar("public_id", { length: 16 }).notNull(),

    // —Å—Ç–∞—Ç—É—Å –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
    isPublished: boolean("is_published").notNull().default(false),

    // —Ü–µ–Ω–∞
    price: numeric("price", { precision: 12, scale: 2 }),
    currency: varchar("currency", { length: 3 }).notNull().default("EUR"),

    // –±–∞–∑–æ–≤—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
    bedrooms: integer("bedrooms"),
    bathrooms: integer("bathrooms"),

    // –ü–ª–æ—â–∞–¥–∏ (–≤ –º2). –í—Å–µ nullable ‚Äî –µ—Å–ª–∏ –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ, –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞ —Å–∞–π—Ç–µ.
    // –û–±—â–∞—è –ø–ª–æ—â–∞–¥—å —É—á–∞—Å—Ç–∫–∞ (–¥–ª—è –¥–æ–º–æ–≤/–≤–∏–ª–ª)
    plotAreaM2: integer("plot_area_m2"),

    // –ü–ª–æ—â–∞–¥—å –∑–∞—Å—Ç—Ä–æ–π–∫–∏ (built area)
    builtAreaM2: integer("built_area_m2"),

    // –ü–ª–æ—â–∞–¥—å —Ç–µ—Ä—Ä–∞—Å
    terraceAreaM2: integer("terrace_area_m2"),

    // –õ–æ–∫–∞—Ü–∏—è (–Ω–∞ —Å—Ç–∞—Ä—Ç–µ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–æ–π)
    location: varchar("location", { length: 120 }),

    // –ü–ª–∞–Ω—ã –æ–±—ä–µ–∫—Ç–∞ (PDF –∏–ª–∏ –ø–æ—Ö–æ–∂–µ–µ) ‚Äî —Ö—Ä–∞–Ω–∏–º –ø—É—Ç—å/URL
    plansUrl: text("plans_url"),

    // –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞
    description_en: text("description_en"),
    description_es: text("description_es"),

    // --- NEW: —Ç–∏–ø/—Å—Ç–∞—Ç—É—Å/–ª–æ–∫–∞—Ü–∏—è ---
    dealType: varchar("deal_type", { length: 8 }).notNull().default("sale"), // sale|rent    
    propertyType: varchar("property_type", { length: 24 }), // villa/apartment/...
    condition: varchar("condition", { length: 24 }),        // new_build/resale/...
    status: varchar("status", { length: 16 }).notNull().default("available"),

    // --- NEW: –∞—Ä–µ–Ω–¥–∞ (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ deal_type = rent) ---
    // nullable —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ: —Å—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏ –Ω–µ –ª–æ–º–∞–µ–º, –≤–∞–ª–∏–¥–∞—Ü–∏—è –±—É–¥–µ—Ç –Ω–∞ —É—Ä–æ–≤–Ω–µ –∞–¥–º–∏–Ω–∫–∏
    rentType: rentTypeEnum("rent_type"),
    rentPrice: numeric("rent_price", { precision: 12, scale: 2 }),
    rentPeriod: rentPeriodEnum("rent_period"),

    // –ª–æ–∫–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ
    city: varchar("city", { length: 80 }),
    area: varchar("area", { length: 80 }),
    subarea: varchar("subarea", { length: 80 }),

    lat: numeric("lat", { precision: 9, scale: 6 }),
    lng: numeric("lng", { precision: 9, scale: 6 }),

    /** --- NEW: –∫–≤–∞—Ä—Ç–∏—Ä—ã --- **/
    floor: integer("floor"),
    totalFloors: integer("total_floors"),
    communityFeesMonth: numeric("community_fees_month", { precision: 10, scale: 2 }),
    ibiYear: numeric("ibi_year", { precision: 10, scale: 2 }),
    garbageTaxYear: numeric("garbage_tax_year", { precision: 10, scale: 2 }),

    /** --- NEW: –¥–æ–º–∞/–æ–±—â–∏–µ --- **/
    orientation: varchar("orientation", { length: 2 }), // N/NE/...
    energyRating: varchar("energy_rating", { length: 1 }), // A-G
    yearBuilt: integer("year_built"),

    createdAt: timestamp("created_at", { withTimezone: true }).notNull().defaultNow(),
    updatedAt: timestamp("updated_at", { withTimezone: true }).notNull().defaultNow(),
  },
  (t) => ({
    slugUnique: uniqueIndex("properties_slug_unique").on(t.slug),
    publicIdUnique: uniqueIndex("properties_public_id_unique").on(t.publicId),
  })
);

// -------------------------------
// PROPERTY TRANSLATIONS (i18n)
// -------------------------------
export const propertyTranslations = pgTable(
  "property_translations",
  {
    id: serial("id").primaryKey(),
    propertyId: integer("property_id")
      .notNull()
      .references(() => properties.id, { onDelete: "cascade" }),

    lang: varchar("lang", { length: 2 }).notNull(), // "en" | "es"

    title: varchar("title", { length: 200 }).notNull(),
    summary: varchar("summary", { length: 300 }), // –∫–æ—Ä–æ—Ç–∫–∏–π —Ç–µ–∫—Å—Ç –¥–ª—è –∫–∞—Ä—Ç–æ—á–∫–∏
    description: text("description"), // –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

    createdAt: timestamp("created_at", { withTimezone: true }).notNull().defaultNow(),
    updatedAt: timestamp("updated_at", { withTimezone: true }).notNull().defaultNow(),
  },
  (t) => ({
    // –æ–¥–Ω–æ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —è–∑—ã–∫ –¥–ª—è –æ–¥–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞
    uniqPerLang: uniqueIndex("property_translations_property_lang_unique").on(t.propertyId, t.lang),
  })
);

// --------------------
// FEATURES (—É–¥–æ–±—Å—Ç–≤–∞)
// --------------------
export const features = pgTable(
  "features",
  {
    id: serial("id").primaryKey(),

    // —Å–∏—Å—Ç–µ–º–Ω—ã–π –∫–ª—é—á (—É–¥–æ–±–Ω–æ –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏/–≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)
    key: varchar("key", { length: 80 }).notNull(),

    createdAt: timestamp("created_at", { withTimezone: true }).notNull().defaultNow(),
  },
  (t) => ({
    keyUnique: uniqueIndex("features_key_unique").on(t.key),
  })
);

export const featureTranslations = pgTable(
  "feature_translations",
  {
    id: serial("id").primaryKey(),
    featureId: integer("feature_id")
      .notNull()
      .references(() => features.id, { onDelete: "cascade" }),

    lang: varchar("lang", { length: 2 }).notNull(), // "en" | "es"
    label: varchar("label", { length: 120 }).notNull(),

    createdAt: timestamp("created_at", { withTimezone: true }).notNull().defaultNow(),
  },
  (t) => ({
    uniqPerLang: uniqueIndex("feature_translations_feature_lang_unique").on(t.featureId, t.lang),
  })
);

// —Å–≤—è–∑—å many-to-many: property <-> feature
export const propertyFeatures = pgTable(
  "property_features",
  {
    propertyId: integer("property_id")
      .notNull()
      .references(() => properties.id, { onDelete: "cascade" }),

    featureId: integer("feature_id")
      .notNull()
      .references(() => features.id, { onDelete: "cascade" }),
  },
  (t) => ({
    pk: primaryKey({ columns: [t.propertyId, t.featureId] }),
  })
);

// --------------------
// IMAGES (–≥–∞–ª–µ—Ä–µ—è)
// --------------------
export const propertyImages = pgTable(
  "property_images",
  {
    id: serial("id").primaryKey(),
    propertyId: integer("property_id")
      .notNull()
      .references(() => properties.id, { onDelete: "cascade" }),

    // –ø—É—Ç—å –∏–ª–∏ URL (–º—ã –±—É–¥–µ–º —Ö—Ä–∞–Ω–∏—Ç—å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å —Ç–∏–ø–∞ /uploads/...)
    url: text("url").notNull(),

    // alt –Ω–∞ –±—É–¥—É—â–µ–µ (–º–æ–∂–Ω–æ —Ç–æ–∂–µ —Å–¥–µ–ª–∞—Ç—å –ø–µ—Ä–µ–≤–æ–¥–∏–º—ã–º, –Ω–æ –ø–æ–∫–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ)
    alt: varchar("alt", { length: 200 }),

    // –ø–æ—Ä—è–¥–æ–∫ –≤ –≥–∞–ª–µ—Ä–µ–µ
    sortOrder: integer("sort_order").notNull().default(0),

    // –æ–±–ª–æ–∂–∫–∞ –¥–ª—è –∫–∞—Ä—Ç–æ—á–∫–∏
    isCover: boolean("is_cover").notNull().default(false),

    createdAt: timestamp("created_at", { withTimezone: true }).notNull().defaultNow(),
  },
  (t) => ({
    byProperty: uniqueIndex("property_images_property_sort_unique").on(t.propertyId, t.sortOrder),
  })
);

// --------------------
// LEADS (–∑–∞—è–≤–∫–∏/–æ–±—Ä–∞—â–µ–Ω–∏—è)
// --------------------
export const leads = pgTable("leads", {
  id: serial("id").primaryKey(),

  name: varchar("name", { length: 120 }).notNull(),
  phone: varchar("phone", { length: 60 }).notNull(),
  email: varchar("email", { length: 160 }).notNull(),

  message: text("message"),
  lang: varchar("lang", { length: 2 }).notNull(),
  pageUrl: text("page_url").notNull(),

  propertyId: integer("property_id").references(() => properties.id, { onDelete: "set null" }),
  propertySlug: varchar("property_slug", { length: 255 }),

  // NEW
  status: varchar("status", { length: 20 }).notNull().default("new"),
  source: varchar("source", { length: 80 }),
  processedAt: timestamp("processed_at", { withTimezone: true }),

  createdAt: timestamp("created_at", { withTimezone: true }).notNull().defaultNow(),
});

// --------------------
// LEAD RATE LIMITS (anti-spam)
// --------------------
export const leadRateLimits = pgTable(
  "lead_rate_limits",
  {
    id: serial("id").primaryKey(),
    ip: varchar("ip", { length: 64 }).notNull(),
    createdAt: timestamp("created_at", { withTimezone: true }).notNull().defaultNow(),
  },
  (t) => ({
    ipIdx: index("lead_rate_limits_ip_idx").on(t.ip),
    createdAtIdx: index("lead_rate_limits_created_at_idx").on(t.createdAt),
  })
);




```

---

## docker-compose.yml

```yaml
services:
  db:
    image: postgres:16
    container_name: grahalia_postgres
    restart: unless-stopped
    environment:
      POSTGRES_USER: grahalia
      POSTGRES_PASSWORD: grahalia_password
      POSTGRES_DB: grahalia_db
    ports:
      - "5433:5432"
    volumes:
      - grahalia_pgdata:/var/lib/postgresql/data

volumes:
  grahalia_pgdata:

```

---

## drizzle.config.ts

```typescript
import { defineConfig } from "drizzle-kit";

export default defineConfig({
  schema: "./db/schema.ts",
  out: "./db/migrations",
  dialect: "postgresql",
  dbCredentials: {
    url: process.env.DATABASE_URL!,
  },
});

```

---

## eslint.config.mjs

```javascript
import { defineConfig, globalIgnores } from "eslint/config";
import nextVitals from "eslint-config-next/core-web-vitals";
import nextTs from "eslint-config-next/typescript";

const eslintConfig = defineConfig([
  ...nextVitals,
  ...nextTs,
  // Override default ignores of eslint-config-next.
  globalIgnores([
    // Default ignores of eslint-config-next:
    ".next/**",
    "out/**",
    "build/**",
    "next-env.d.ts",
  ]),
]);

export default eslintConfig;

```

---

## i18n/dictionaries.ts

```typescript
export const locales = ["en", "es"] as const;
export type Locale = (typeof locales)[number];

export function isLocale(v: string): v is Locale {
  return (locales as readonly string[]).includes(v);
}

type Dict = Record<string, any>;

// –Ø–≤–Ω–∞—è –∫–∞—Ä—Ç–∞ –∏–º–ø–æ—Ä—Ç–æ–≤ ‚Äî Turbopack —ç—Ç–æ –ª—é–±–∏—Ç, –∏ –Ω–µ –≥–ª—é—á–∏—Ç
const loaders: Record<Locale, () => Promise<Dict>> = {
  en: async () => (await import("./en.json")).default,
  es: async () => (await import("./es.json")).default,
};

export async function getDictionary(locale: Locale) {
  return loaders[locale]();
}

```

---

## i18n/en.json

```json
{
  "header": {
    "nav": {
      "home": "Home",
      "properties": "Properties",
      "services": "Services",
      "about": "About",
      "contact": "Contact"
    },
    "menuTitle": "Menu",
    "whatsapp": "WhatsApp"
  },
  "hero": {
    "titleA": "Find Your Dream Home",
    "titleB": "in Spain",
    "subtitle": "Luxury Properties for Sale & Investment",
    "ctaPrimary": "View Properties",
    "ctaSecondary": "Contact Us"
  },
  "featured": {
    "title": "Featured Properties",
    "subtitle": "Explore our latest listings",
    "cta": "View All Properties",
    "card": {
      "beds": "Beds",
      "baths": "Baths",
      "details": "View Details"
    }
  },
  "services": {
    "title": "Our Services",
    "subtitle": "Personalized real estate solutions",
    "items": [
      {
        "title": "Property Sales",
        "text": "Helping you find the perfect home.",
        "icon": "üè°"
      },
      {
        "title": "Investment Consulting",
        "text": "Expert advice on profitable investments.",
        "icon": "üìà"
      },
      {
        "title": "Legal Assistance",
        "text": "Full support with legal and paperwork.",
        "icon": "üìÑ"
      }
    ]
  },
  "about": {
    "title": "About Us",
    "subtitle": "Your Trusted Real Estate Partner in Spain",
    "body": "We provide exceptional service and expert local knowledge to help you find your ideal property on the Costa del Sol. From selecting the right area to negotiating and paperwork, we guide you through every step ‚Äî clearly and professionally.",
    "cta": "Learn More"
  },
  "contact": {
    "title": "Get in Touch",
    "subtitle": "Ready to find your dream home?",
    "form": {
      "name": "Your Name",
      "phone": "Phone",
      "email": "Email",
      "message": "Message",
      "send": "Send Message",
      "namePlaceholder": "Name",
      "phonePlaceholder": "+34 ...",
      "emailPlaceholder": "you@email.com",
      "messagePlaceholder": "Tell us what you are looking for..."
    },
    "info": {
      "title": "Contact",
      "whatsapp": "WhatsApp Us",
      "note": "We typically reply within a few hours during business days."
    }
  },
  "footer": {
    "tagline": "Your Home, Clearly Guided",
    "locationLine": "Costa del Sol ‚Ä¢ Spain",
    "navTitle": "Links",
    "nav": {
      "home": "Home",
      "properties": "Properties",
      "services": "Services",
      "about": "About",
      "contact": "Contact"
    },
    "socialTitle": "Social",
    "socials": {
      "instagram": "Instagram (soon)",
      "facebook": "Facebook (soon)",
      "linkedin": "LinkedIn (soon)"
    },
    "legal": {
      "privacy": "Privacy",
      "cookies": "Cookies",
      "terms": "Terms",
      "manageCookies": "Manage cookies"
    },
    "rights": "All rights reserved"
  },
  "cookies": {
    "consent": {
      "bannerText": "We use cookies to improve your experience. You can accept all cookies, reject non-essential cookies, or manage your preferences.",
      "acceptAll": "Accept all",
      "rejectAll": "Reject non-essential",
      "manage": "Manage cookies",

      "modalTitle": "Cookie preferences",
      "modalText": "Choose which cookies you allow. Necessary cookies are always enabled.",

      "necessaryTitle": "Necessary",
      "necessaryDesc": "Required for the website to work properly.",

      "analyticsTitle": "Analytics",
      "analyticsDesc": "Helps us understand how the site is used.",

      "marketingTitle": "Marketing",
      "marketingDesc": "Helps us show relevant ads and measure campaigns.",

      "save": "Save",
      "close": "Close"
    }
  },
  "seo": {
    "siteName": "Grahalia Estates",
    "home": {
      "title": "Grahalia Estates ‚Äî Real Estate on Costa del Sol",
      "description": "Warm, minimal real estate agency landing. Find properties and request details.",
      "ogTitle": "Grahalia Estates ‚Äî Real Estate on Costa del Sol",
      "ogDescription": "Warm, minimal real estate agency landing. Find properties and request details."
    }
  }
}

```

---

## i18n/es.json

```json
{
  "header": {
    "nav": {
      "home": "Inicio",
      "properties": "Propiedades",
      "services": "Servicios",
      "about": "Sobre nosotros",
      "contact": "Contacto"
    },
    "menuTitle": "Men√∫",
    "whatsapp": "WhatsApp"
  },
  "hero": {
    "titleA": "Encuentra la casa de tus sue√±os",
    "titleB": "en Espa√±a",
    "subtitle": "Propiedades de lujo en venta e inversi√≥n",
    "ctaPrimary": "Ver propiedades",
    "ctaSecondary": "Cont√°ctanos"
  },
  "featured": {
    "title": "Propiedades destacadas",
    "subtitle": "Descubre nuestras √∫ltimas ofertas",
    "cta": "Ver todas las propiedades",
    "card": {
      "beds": "Dormitorios",
      "baths": "Ba√±os",
      "details": "Ver detalles"
    }
  },
  "services": {
    "title": "Nuestros servicios",
    "subtitle": "Soluciones inmobiliarias personalizadas",
    "items": [
      {
        "title": "Venta de propiedades",
        "text": "Te ayudamos a encontrar la vivienda perfecta.",
        "icon": "üè°"
      },
      {
        "title": "Asesoramiento en inversi√≥n",
        "text": "Consejos expertos para inversiones rentables.",
        "icon": "üìà"
      },
      {
        "title": "Asistencia legal",
        "text": "Apoyo completo con tr√°mites y documentaci√≥n.",
        "icon": "üìÑ"
      }
    ]
  },
  "about": {
    "title": "Sobre nosotros",
    "subtitle": "Tu socio inmobiliario de confianza en Espa√±a",
    "body": "Ofrecemos un servicio excepcional y un profundo conocimiento local para ayudarte a encontrar la propiedad ideal en la Costa del Sol. Desde la elecci√≥n de la zona adecuada hasta la negociaci√≥n y los tr√°mites legales, te acompa√±amos en cada paso con claridad y profesionalidad.",
    "cta": "Saber m√°s"
  },
  "contact": {
    "title": "Ponte en contacto",
    "subtitle": "¬øListo para encontrar la casa de tus sue√±os?",
    "form": {
      "name": "Tu nombre",
      "phone": "Tel√©fono",
      "email": "Correo electr√≥nico",
      "message": "Mensaje",
      "send": "Enviar mensaje",
      "namePlaceholder": "Nombre",
      "phonePlaceholder": "+34 ...",
      "emailPlaceholder": "tu@email.com",
      "messagePlaceholder": "Cu√©ntanos qu√© est√°s buscando..."
    },
    "info": {
      "title": "Contacto",
      "whatsapp": "Escr√≠benos por WhatsApp",
      "note": "Normalmente respondemos en pocas horas durante d√≠as laborables."
    }
  },
  "footer": {
    "tagline": "Tu hogar, con claridad",
    "locationLine": "Costa del Sol ‚Ä¢ Espa√±a",
    "navTitle": "Enlaces",
    "nav": {
      "home": "Inicio",
      "properties": "Propiedades",
      "services": "Servicios",
      "about": "Sobre nosotros",
      "contact": "Contacto"
    },
    "socialTitle": "Redes sociales",
    "socials": {
      "instagram": "Instagram (pr√≥ximamente)",
      "facebook": "Facebook (pr√≥ximamente)",
      "linkedin": "LinkedIn (pr√≥ximamente)"
    },
    "legal": {
      "privacy": "Privacidad",
      "cookies": "Cookies",
      "terms": "T√©rminos",
      "manageCookies": "Gestionar cookies"
    },
    "rights": "Todos los derechos reservados"
  },
  "cookies": {
    "consent": {
      "bannerText": "Utilizamos cookies para mejorar tu experiencia. Puedes aceptar todas las cookies, rechazar las no esenciales o gestionar tus preferencias.",
      "acceptAll": "Aceptar todas",
      "rejectAll": "Rechazar no esenciales",
      "manage": "Gestionar cookies",

      "modalTitle": "Preferencias de cookies",
      "modalText": "Elige qu√© cookies permites. Las cookies necesarias siempre est√°n activadas.",

      "necessaryTitle": "Necesarias",
      "necessaryDesc": "Son imprescindibles para que el sitio funcione correctamente.",

      "analyticsTitle": "Anal√≠tica",
      "analyticsDesc": "Nos ayuda a entender c√≥mo se utiliza el sitio.",

      "marketingTitle": "Marketing",
      "marketingDesc": "Nos ayuda a mostrar anuncios relevantes y medir campa√±as.",

      "save": "Guardar",
      "close": "Cerrar"
    }
  },
  "seo": {
    "siteName": "Grahalia Estates",
    "home": {
      "title": "Grahalia Estates ‚Äî Inmobiliaria en la Costa del Sol",
      "description": "Agencia inmobiliaria c√°lida y minimalista. Encuentra propiedades y solicita informaci√≥n.",
      "ogTitle": "Grahalia Estates ‚Äî Inmobiliaria en la Costa del Sol",
      "ogDescription": "Agencia inmobiliaria c√°lida y minimalista. Encuentra propiedades y solicita informaci√≥n."
    }
  }
}

```

---

## middleware.ts

```typescript
import { NextRequest, NextResponse } from "next/server";

const SUPPORTED = ["en", "es"] as const;
type Lang = (typeof SUPPORTED)[number];

const DEFAULT_LANG: Lang = "en";
const COOKIE_NAME = "lang";

function parseAcceptLanguage(header: string | null): Lang {
  if (!header) return DEFAULT_LANG;

  const first = header.split(",")[0]?.trim().toLowerCase();
  if (!first) return DEFAULT_LANG;

  const base = first.split("-")[0] as Lang;
  return (SUPPORTED as readonly string[]).includes(base) ? (base as Lang) : DEFAULT_LANG;
}

function isPublicFile(pathname: string) {
  return (
    pathname.startsWith("/_next") ||
    pathname.startsWith("/api") ||
    pathname.startsWith("/uploads") || // ‚úÖ –≤–∞–∂–Ω–æ: –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –≤—Å–µ–≥–¥–∞ –±–µ–∑ i18n
    pathname === "/favicon.ico" ||
    pathname === "/robots.txt" ||
    pathname === "/sitemap.xml" ||
    pathname.startsWith("/assets") ||
    pathname.match(/\.(png|jpg|jpeg|webp|svg|ico|pdf|txt|xml)$/) // ‚úÖ –¥–æ–±–∞–≤–∏–ª pdf –Ω–∞ –≤—Å—è–∫–∏–π
  );
}

export function middleware(req: NextRequest) {
  const { pathname } = req.nextUrl;

  if (isPublicFile(pathname)) return NextResponse.next();

  // ‚úÖ –ê–¥–º–∏–Ω–∫–∞ –ù–ï —É—á–∞—Å—Ç–≤—É–µ—Ç –≤ i18n —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞—Ö
  if (pathname === "/admin" || pathname.startsWith("/admin/")) {
    if (pathname.startsWith("/admin/login")) return NextResponse.next();

    const adminCookie = req.cookies.get("admin")?.value;
    if (adminCookie !== "1") {
      const url = req.nextUrl.clone();
      url.pathname = "/admin/login";
      return NextResponse.redirect(url);
    }

    return NextResponse.next();
  }

  // –£–∂–µ —Å –ª–æ–∫–∞–ª—å—é?
  const hasLocale = SUPPORTED.some((l) => pathname === `/${l}` || pathname.startsWith(`/${l}/`));
  if (hasLocale) {
    const current = pathname.split("/")[1] as Lang;
    const res = NextResponse.next();

    if ((SUPPORTED as readonly string[]).includes(current)) {
      res.cookies.set(COOKIE_NAME, current, {
        path: "/",
        sameSite: "lax",
        maxAge: 60 * 60 * 24 * 365,
      });
    }

    return res;
  }

  // –õ—é–±–æ–π –ø—É—Ç—å –±–µ–∑ –ª–æ–∫–∞–ª–∏ ‚Äî —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏–º –Ω–∞ /{lang}/...
  const cookieLang = req.cookies.get(COOKIE_NAME)?.value as Lang | undefined;
  const detected =
    cookieLang && (SUPPORTED as readonly string[]).includes(cookieLang)
      ? cookieLang
      : parseAcceptLanguage(req.headers.get("accept-language"));

  const url = req.nextUrl.clone();
  url.pathname = `/${detected}${pathname === "/" ? "" : pathname}`;
  return NextResponse.redirect(url);
}

export const config = {
  matcher: ["/((?!_next|api).*)"],
};

```

---

## next-env.d.ts

```typescript
/// <reference types="next" />
/// <reference types="next/image-types/global" />
import "./.next/dev/types/routes.d.ts";

// NOTE: This file should not be edited
// see https://nextjs.org/docs/app/api-reference/config/typescript for more information.

```

---

## next.config.ts

```typescript
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  experimental: {
    serverActions: {
      // ‚úÖ —á—Ç–æ–±—ã –Ω–µ –ø–∞–¥–∞–ª–æ –Ω–∞ —Ñ–æ—Ç–æ/–ø–¥—Ñ
      bodySizeLimit: "25mb",
    },
  },
};

export default nextConfig;

```

---

## package.json

```json
{
  "name": "grahalia-estate",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",

    "db:generate": "dotenv -e .env.local -- drizzle-kit generate",
    "db:migrate": "dotenv -e .env.local -- drizzle-kit migrate",

    "db:seed:features": "dotenv -e .env.local -- sh -lc 'psql \"$DATABASE_URL\" -v ON_ERROR_STOP=1 -f db/migrations/0004_seed_features.sql'",
    "db:seed": "npm run db:seed:features",

    "db:setup": "npm run db:migrate && npm run db:seed"
  },

  "dependencies": {
    "drizzle-orm": "^0.45.1",
    "next": "16.1.2",
    "nodemailer": "^7.0.12",
    "pg": "^8.17.1",
    "react": "19.2.3",
    "react-dom": "19.2.3"
  },
  "devDependencies": {
    "@tailwindcss/postcss": "^4",
    "@types/node": "^20",
    "@types/nodemailer": "^7.0.5",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "dotenv-cli": "^11.0.0",
    "drizzle-kit": "^0.31.8",
    "eslint": "^9",
    "eslint-config-next": "16.1.2",
    "tailwindcss": "^4",
    "typescript": "^5"
  }
}

```

---

## postcss.config.mjs

```javascript
const config = {
  plugins: {
    "@tailwindcss/postcss": {},
  },
};

export default config;

```

---

## scripts/seed.ts

```typescript
const fs = require("node:fs");
const path = require("node:path");
const { Client } = require("pg");

async function main() {
  const databaseUrl = process.env.DATABASE_URL;
  if (!databaseUrl) {
    throw new Error("DATABASE_URL is not set. Run with dotenv: npx dotenv -e .env.local -- npm run seed");
  }

  const sqlPath = path.resolve(process.cwd(), "db/migrations/0004_seed_features.sql");
  const sql = fs.readFileSync(sqlPath, "utf-8");

  const client = new Client({ connectionString: databaseUrl });
  await client.connect();

  try {
    await client.query(sql);
    console.log("‚úÖ Seed completed:", sqlPath);
  } finally {
    await client.end();
  }
}

main().catch((err) => {
  console.error("‚ùå Seed failed:", err);
  process.exit(1);
});

```

---

## tools/snapshot_repo.py

```py
#!/usr/bin/env python3
import argparse
import datetime as dt
from pathlib import Path

# ---------- –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ ----------
# –°—é–¥–∞ –¥–æ–±–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —Ç–æ, —á—Ç–æ –ù–ï –ù–ê–î–û —Å–æ—Ö—Ä–∞–Ω—è—Ç—å
EXCLUDE_DIRS = {
    ".git", ".idea", ".vscode", "__pycache__", "node_modules", "venv",
    ".mypy_cache", ".pytest_cache", ".DS_Store",
    ".next", "dist", "build", "out", ".turbo",
    ".cache", ".parcel-cache", "coverage",
}

EXCLUDE_FILES = {
    ".env", ".env.local", ".env.production", ".env.development",
    "pnpm-lock.yaml", "package-lock.json", 
    "PROJECT_TREE_", "CODE_SNAPSHOT_" # –ò—Å–∫–ª—é—á–∞–µ–º —Å–∞–º–∏ —Å–Ω–∞–ø—à–æ—Ç—ã, —á—Ç–æ–±—ã –Ω–µ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏—Ö –≤ —Å–∞–º–∏—Ö —Å–µ–±—è
}

# –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –∫–æ–¥–∞
INCLUDE_EXT = {
    ".ts", ".tsx", ".js", ".jsx", ".css", ".scss", ".html", 
    ".json", ".md", ".py", ".sql", ".mjs", ".yml", ".yaml", ".prisma"
}

# ---------- —É—Ç–∏–ª–∏—Ç—ã ----------
def project_root() -> Path:
    return Path(__file__).resolve().parents[1]

def is_ignored(path: Path) -> bool:
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞–ø–æ–∫-–∏—Å–∫–ª—é—á–µ–Ω–∏–π
    if any(part in EXCLUDE_DIRS for part in path.parts):
        return True
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–µ–Ω —Ñ–∞–π–ª–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, .env)
    if path.name in EXCLUDE_FILES or any(path.name.startswith(p) for p in ["PROJECT_TREE_", "CODE_SNAPSHOT_"]):
        return True
    return False

def build_tree(root: Path) -> str:
    lines = []
    def walk(base: Path, prefix=""):
        try:
            entries = sorted(
                [p for p in base.iterdir() if not is_ignored(p)],
                key=lambda p: (p.is_file(), p.name.lower())
            )
        except PermissionError:
            return

        for i, p in enumerate(entries):
            last = (i == len(entries) - 1)
            connector = "‚îî‚îÄ‚îÄ " if last else "‚îú‚îÄ‚îÄ "
            lines.append(prefix + connector + p.name)
            if p.is_dir():
                ext = "    " if last else "‚îÇ   "
                walk(p, prefix + ext)
    walk(root)
    return "\n".join(lines)

def get_all_code_files(root: Path):
    """–†–µ–∫—É—Ä—Å–∏–≤–Ω–æ –∏—â–µ—Ç –≤—Å–µ —Ñ–∞–π–ª—ã –∫–æ–¥–∞, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –≤ –∏–≥–Ω–æ—Ä–µ –∏ –∏–º–µ—é—Ç –Ω—É–∂–Ω–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ"""
    code_files = []
    for p in root.rglob("*"):
        if p.is_file() and not is_ignored(p):
            if p.suffix.lower() in INCLUDE_EXT or p.name in {"README.md", ".gitignore", "docker-compose.yml"}:
                code_files.append(p)
    return sorted(code_files)

def guess_lang(p: Path) -> str:
    ext = p.suffix.lower().lstrip(".")
    mapping = {
        "ts": "typescript", "tsx": "typescript",
        "js": "javascript", "jsx": "javascript",
        "mjs": "javascript", "sql": "sql",
        "yml": "yaml", "yaml": "yaml"
    }
    return mapping.get(ext, ext or "text")

# ---------- main ----------
def main():
    parser = argparse.ArgumentParser()
    parser.add_argument("--force", action="store_true", help="–ü–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç—å —Ñ–∞–π–ª—ã –∑–∞ —Å–µ–≥–æ–¥–Ω—è")
    args = parser.parse_args()

    ROOT = project_root()
    now = dt.datetime.now()
    date_str = now.strftime("%Y-%m-%d")
    time_str = now.strftime("%H-%M-%S")

    # –§–æ—Ä–º–∏—Ä—É–µ–º –∏–º–µ–Ω–∞ (–¥–æ–±–∞–≤–∏–ª –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –∏–º–µ–Ω)
    suffix = f"_{time_str}" if not args.force else ""
    tree_name = f"PROJECT_TREE_{date_str}{suffix}.txt"
    code_name = f"CODE_SNAPSHOT_{date_str}{suffix}.md"

    tree_path = ROOT / tree_name
    code_path = ROOT / code_name

    # 1. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –¥–µ—Ä–µ–≤–æ (–æ–Ω–æ –≤—Å–µ–≥–¥–∞ –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ)
    print("–°–∫–∞–Ω–∏—Ä—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞...")
    tree_text = build_tree(ROOT)
    tree_path.write_text(tree_text, encoding="utf-8")
    print(f"[OK] –î–µ—Ä–µ–≤–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ: {tree_path.name}")

    # 2. –°–æ–±–∏—Ä–∞–µ–º –≤–µ—Å—å –∫–æ–¥
    print("–°–æ–±–∏—Ä–∞—é –∫–æ–¥ –∏–∑ –≤—Å–µ—Ö –ø–∞–ø–æ–∫...")
    all_files = get_all_code_files(ROOT)
    
    with code_path.open("w", encoding="utf-8") as f:
        f.write(f"# Code snapshot ({now.isoformat(timespec='seconds')})\n")
        f.write(f"–í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤: {len(all_files)}\n\n")
        
        for p in all_files:
            try:
                rel = p.relative_to(ROOT)
                lang = guess_lang(p)
                content = p.read_text(encoding="utf-8")
                
                f.write(f"## {rel}\n\n")
                f.write(f"```{lang}\n")
                f.write(content)
                f.write("\n```\n\n---\n\n")
            except Exception as e:
                # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –±–∏–Ω–∞—Ä–Ω—ã–µ —Ñ–∞–π–ª—ã –∏–ª–∏ –æ—à–∏–±–∫–∏ –¥–æ—Å—Ç—É–ø–∞
                continue

    print(f"[OK] –°–Ω–∞–ø—à–æ—Ç –∫–æ–¥–∞ —Å–æ–∑–¥–∞–Ω: {code_path.name} ({len(all_files)} —Ñ–∞–π–ª–æ–≤)")

if __name__ == "__main__":
    main()
```

---

## tsconfig.json

```json
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "react-jsx",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "baseUrl": ".",
    "paths": {
      "@/*": ["./*"]
    }
  },
  "include": [
    "next-env.d.ts",
    "**/*.ts",
    "**/*.tsx",
    ".next/types/**/*.ts",
    ".next/dev/types/**/*.ts",
    "**/*.mts"
  ],
  "exclude": ["node_modules"]
}

```

---

## utils/scroll.ts

```typescript
export function clamp(n: number, min: number, max: number) {
  return Math.max(min, Math.min(max, n));
}

export function flyToHash(hash: string, headerOffset = 90) {
  const id = hash.replace("#", "");
  const el = document.getElementById(id);
  if (!el) return;

  flyToElement(el, headerOffset);
  history.pushState(null, "", `#${id}`);
}

export function flyToElement(target: HTMLElement, headerOffset = 90) {
  const targetY =
    target.getBoundingClientRect().top + window.scrollY - headerOffset;

  const startY = window.scrollY;
  const distance = targetY - startY;

  if (Math.abs(distance) < 2) return;

  const abs = Math.abs(distance);
  const duration = clamp(220 + abs * 0.35, 260, 780);

  const startTime = performance.now();

  const easeCruise = (t: number) => {
    if (t < 0.08) {
      const p = t / 0.08;
      return 0.12 * (p * p);
    }
    if (t > 0.82) {
      const p = (t - 0.82) / 0.18;
      return 0.82 + 0.18 * (1 - (1 - p) * (1 - p));
    }
    return 0.12 + (t - 0.08) * (0.70 / 0.74);
  };

  let raf = 0;

  // ‚Äú–º–æ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π –æ—Ç–∫–ª–∏–∫‚Äù –±–µ–∑ –ø–∞—É–∑—ã
  const nudge = clamp(distance * 0.02, -14, 14);
  window.scrollTo(0, startY + nudge);

  const step = (now: number) => {
    const t = clamp((now - startTime) / duration, 0, 1);
    const eased = easeCruise(t);
    window.scrollTo(0, startY + distance * eased);
    if (t < 1) raf = requestAnimationFrame(step);
  };

  raf = requestAnimationFrame(step);

  const cancel = () => cancelAnimationFrame(raf);
  window.addEventListener("wheel", cancel, { passive: true, once: true });
  window.addEventListener("touchstart", cancel, { passive: true, once: true });
}

```

---

## utils/smoothScroll.ts

```typescript
type Options = {
  duration?: number;
  offset?: number;
};

function clamp01(x: number) {
  return Math.min(1, Math.max(0, x));
}

// –†–∞–∑–≥–æ–Ω ‚Üí –±—ã—Å—Ç—Ä–æ ‚Üí —Ç–æ—Ä–º–æ–∂–µ–Ω–∏–µ
function easeInOutCubic(t: number) {
  t = clamp01(t);
  return t < 0.5 ? 4 * t * t * t : 1 - Math.pow(-2 * t + 2, 3) / 2;
}

export function smoothScrollToY(targetY: number, opts: Options = {}) {
  const startY = window.scrollY;
  const offset = opts.offset ?? 0;
  const finalY = targetY - offset;

  const distance = Math.abs(finalY - startY);
  const baseDuration = opts.duration ?? 800;
  const duration = Math.min(1400, Math.max(600, baseDuration + distance * 0.15));

  const start = performance.now();
  let cancelled = false;

  const cancel = () => (cancelled = true);
  window.addEventListener("wheel", cancel, { passive: true, once: true });
  window.addEventListener("touchstart", cancel, { passive: true, once: true });

  function step(now: number) {
    if (cancelled) return;

    const t = (now - start) / duration;
    const p = easeInOutCubic(t);

    window.scrollTo(0, startY + (finalY - startY) * p);

    if (t < 1) requestAnimationFrame(step);
  }

  requestAnimationFrame(step);
}

export function scrollToHash(hash: string, opts: Options = {}) {
  const id = hash.replace("#", "");
  const el = document.getElementById(id);
  if (!el) return;

  const top = el.getBoundingClientRect().top + window.scrollY;
  smoothScrollToY(top, opts);

  history.pushState(null, "", `#${id}`);
}

```

---

