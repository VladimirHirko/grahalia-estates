# Code snapshot (2026-01-17T20:37:32)
Всего файлов: 53

## .gitignore

```text
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.*
.yarn/*
!.yarn/patches
!.yarn/plugins
!.yarn/releases
!.yarn/versions

# testing
/coverage

# next.js
/.next/
/out/

# production
/build

# misc
.DS_Store
*.pem

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.pnpm-debug.log*

# env files (can opt-in for committing if needed)
.env*

# vercel
.vercel

# typescript
*.tsbuildinfo
next-env.d.ts

```

---

## README.md

```md
This is a [Next.js](https://nextjs.org) project bootstrapped with [`create-next-app`](https://nextjs.org/docs/app/api-reference/cli/create-next-app).

## Getting Started

First, run the development server:

```bash
npm run dev
# or
yarn dev
# or
pnpm dev
# or
bun dev
```

Open [http://localhost:3000](http://localhost:3000) with your browser to see the result.

You can start editing the page by modifying `app/page.tsx`. The page auto-updates as you edit the file.

This project uses [`next/font`](https://nextjs.org/docs/app/building-your-application/optimizing/fonts) to automatically optimize and load [Geist](https://vercel.com/font), a new font family for Vercel.

## Learn More

To learn more about Next.js, take a look at the following resources:

- [Next.js Documentation](https://nextjs.org/docs) - learn about Next.js features and API.
- [Learn Next.js](https://nextjs.org/learn) - an interactive Next.js tutorial.

You can check out [the Next.js GitHub repository](https://github.com/vercel/next.js) - your feedback and contributions are welcome!

## Deploy on Vercel

The easiest way to deploy your Next.js app is to use the [Vercel Platform](https://vercel.com/new?utm_medium=default-template&filter=next.js&utm_source=create-next-app&utm_campaign=create-next-app-readme) from the creators of Next.js.

Check out our [Next.js deployment documentation](https://nextjs.org/docs/app/building-your-application/deploying) for more details.

```

---

## app/[lang]/layout.tsx

```typescript
import "../globals.css";
import { Inter, Playfair_Display } from "next/font/google";
import { locales, isLocale, type Locale, getDictionary } from "@/i18n/dictionaries";
import type { Metadata } from "next";

const inter = Inter({
  subsets: ["latin"],
  variable: "--font-inter",
  display: "swap",
});

const playfair = Playfair_Display({
  subsets: ["latin"],
  variable: "--font-playfair",
  display: "swap",
});

export function generateStaticParams() {
  return locales.map((lang) => ({ lang }));
}

type LayoutProps = {
  children: React.ReactNode;
  params: { lang: string };
};

/**
 * SEO / metadata
 * полностью мультиязычно
 * тексты берём ТОЛЬКО из словарей
 */
export async function generateMetadata(
  { params }: { params: { lang: Locale } }
): Promise<Metadata> {
  const lang: Locale = isLocale(params.lang) ? params.lang : "en";
  const t = await getDictionary(lang);

  return {
    title: t.seo.home.title,
    description: t.seo.home.description,

    alternates: {
      canonical: `/${lang}`,
      languages: {
        en: "/en",
        es: "/es",
      },
    },

    openGraph: {
      title: t.seo.home.ogTitle ?? t.seo.home.title,
      description: t.seo.home.ogDescription ?? t.seo.home.description,
      locale: lang === "es" ? "es_ES" : "en_US",
      type: "website",
    },

    robots: {
      index: true,
      follow: true,
    },
  };
}

export default function RootLayout({ children, params }: LayoutProps) {
  const lang: Locale = isLocale(params.lang) ? params.lang : "en";

  return (
    <html lang={lang} className={`${inter.variable} ${playfair.variable}`}>
      <body>{children}</body>
    </html>
  );
}

```

---

## app/[lang]/page.tsx

```typescript
import Header from "@/components/Header/Header";
import Hero from "@/components/Hero/Hero";
import Featured from "@/components/Featured/Featured";
import Services from "@/components/Services/Services";
import About from "@/components/About/About";
import Contact from "@/components/Contact/Contact";

import { getDictionary, isLocale, type Locale } from "@/i18n/dictionaries";

export default async function Page({
  params,
}: {
  params: Promise<{ lang: string }>;
}) {
  const { lang: raw } = await params;
  const lang: Locale = isLocale(raw) ? (raw as Locale) : "en";
  const t = await getDictionary(lang);

  return (
    <>
      <Header lang={lang} t={t.header} />
      <main>
        <Hero t={t.hero} />
        <Featured t={t.featured} />
        <Services t={t.services} />
        <About t={t.about} />
        <Contact t={t.contact} />
      </main>
    </>
  );
}

```

---

## app/admin/layout.tsx

```typescript
import "../globals.css";
import { Inter, Playfair_Display } from "next/font/google";

const inter = Inter({
  subsets: ["latin"],
  variable: "--font-inter",
  display: "swap",
});

const playfair = Playfair_Display({
  subsets: ["latin"],
  variable: "--font-playfair",
  display: "swap",
});

export default function AdminLayout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="en" className={`${inter.variable} ${playfair.variable}`}>
      <body>{children}</body>
    </html>
  );
}

```

---

## app/admin/login/page.tsx

```typescript
import { cookies } from "next/headers";
import { redirect } from "next/navigation";

export const dynamic = "force-dynamic";

export default function AdminLoginPage() {
  async function login(formData: FormData) {
    "use server";

    const password = String(formData.get("password") || "");
    const expected = process.env.ADMIN_PASSWORD || "";

    if (!expected) {
      throw new Error("ADMIN_PASSWORD is not set in environment.");
    }

    if (password !== expected) {
      // просто возвращаемся на логин (можно позже добавить сообщение)
      redirect("/admin/login");
    }

    // В Next.js 15/16 cookies() — async
    const cookieStore = await cookies();
    cookieStore.set("admin", "1", {
      httpOnly: true,
      sameSite: "lax",
      path: "/",
      maxAge: 60 * 60 * 24 * 7, // 7 дней
    });

    redirect("/admin");
  }

  return (
    <main style={{ maxWidth: 420, margin: "80px auto", padding: 16 }}>
      <h1 style={{ fontSize: 28, marginBottom: 8 }}>Admin Login</h1>
      <p style={{ opacity: 0.7, marginBottom: 24 }}>
        Enter the admin password to continue.
      </p>

      <form action={login}>
        <label style={{ display: "block", marginBottom: 8 }}>Password</label>
        <input
          name="password"
          type="password"
          required
          style={{
            width: "100%",
            padding: 12,
            borderRadius: 10,
            border: "1px solid #ddd",
            marginBottom: 12,
          }}
        />

        <button
          type="submit"
          style={{
            width: "100%",
            padding: 12,
            borderRadius: 10,
            border: "1px solid #111",
            cursor: "pointer",
          }}
        >
          Sign in
        </button>
      </form>

      <p style={{ opacity: 0.6, marginTop: 16, fontSize: 13 }}>
        (Local dev simple auth. We’ll upgrade later if needed.)
      </p>
    </main>
  );
}

```

---

## app/admin/page.tsx

```typescript
import Link from "next/link";

export const dynamic = "force-dynamic";

export default function AdminHomePage() {
  return (
    <main style={{ maxWidth: 900, margin: "80px auto", padding: 16 }}>
      <h1 style={{ fontSize: 34, marginBottom: 8 }}>Admin</h1>
      <p style={{ marginTop: 0, opacity: 0.75 }}>✅ You are logged in. Next step: Properties CRUD.</p>

      <div style={{ marginTop: 18, display: "flex", gap: 10, flexWrap: "wrap" }}>
        <Link
          href="/admin/properties"
          style={{
            padding: "10px 14px",
            borderRadius: 12,
            border: "1px solid #0E5E56",
            textDecoration: "none",
            color: "#0E5E56",
            fontWeight: 600,
          }}
        >
          Go to Properties →
        </Link>
      </div>
    </main>
  );
}

```

---

## app/admin/properties/[id]/UploadForms.tsx

```typescript
"use client";

import { useState } from "react";

type Props = {
  propertyId: number;
};

export default function UploadForms({ propertyId }: Props) {
  const [imgLoading, setImgLoading] = useState(false);
  const [pdfLoading, setPdfLoading] = useState(false);
  const [msg, setMsg] = useState<string | null>(null);

  async function uploadImages(e: React.FormEvent<HTMLFormElement>) {
    e.preventDefault();
    setMsg(null);
    setImgLoading(true);

    const formEl = e.currentTarget;
    const input = formEl.elements.namedItem("files") as HTMLInputElement;
    if (!input.files || input.files.length === 0) {
      setMsg("Select at least one image");
      setImgLoading(false);
      return;
    }

    const fd = new FormData();
    for (const f of Array.from(input.files)) fd.append("files", f);

    const res = await fetch(`/api/admin/properties/${propertyId}/images`, {
      method: "POST",
      body: fd,
    });

    setImgLoading(false);

    if (!res.ok) {
      const text = await res.text().catch(() => "");
      setMsg(`Images upload failed (${res.status}). ${text}`);
      return;
    }

    // обновляем страницу, чтобы увидеть новые фото
    window.location.reload();
  }

  async function uploadPlans(e: React.FormEvent<HTMLFormElement>) {
    e.preventDefault();
    setMsg(null);
    setPdfLoading(true);

    const formEl = e.currentTarget;
    const input = formEl.elements.namedItem("file") as HTMLInputElement;
    const file = input.files?.[0];
    if (!file) {
      setMsg("Select a PDF file");
      setPdfLoading(false);
      return;
    }

    const fd = new FormData();
    fd.append("file", file);

    const res = await fetch(`/api/admin/properties/${propertyId}/plans`, {
      method: "POST",
      body: fd,
    });

    setPdfLoading(false);

    if (!res.ok) {
      const text = await res.text().catch(() => "");
      setMsg(`PDF upload failed (${res.status}). ${text}`);
      return;
    }

    window.location.reload();
  }

  return (
    <div style={{ display: "grid", gap: 18 }}>
      {msg ? (
        <div style={{ padding: 12, border: "1px solid #e2a3a3", borderRadius: 12, background: "#fff5f5" }}>
          {msg}
        </div>
      ) : null}

      <form onSubmit={uploadPlans} style={{ display: "flex", gap: 10, alignItems: "center", flexWrap: "wrap" }}>
        <input name="file" type="file" accept="application/pdf" />
        <button type="submit" disabled={pdfLoading} style={btnPrimary}>
          {pdfLoading ? "Uploading..." : "Upload PDF"}
        </button>
      </form>

      <form onSubmit={uploadImages} style={{ display: "flex", gap: 10, alignItems: "center", flexWrap: "wrap" }}>
        <input name="files" type="file" accept="image/*" multiple />
        <button type="submit" disabled={imgLoading} style={btnPrimary}>
          {imgLoading ? "Uploading..." : "Upload images"}
        </button>
      </form>
    </div>
  );
}

const btnPrimary: React.CSSProperties = {
  padding: "10px 14px",
  borderRadius: 12,
  border: "1px solid #0E5E56",
  background: "#0E5E56",
  color: "#fff",
  fontWeight: 600,
  cursor: "pointer",
};

```

---

## app/admin/properties/[id]/page.tsx

```typescript
import Link from "next/link";
import { redirect } from "next/navigation";
import { sql } from "drizzle-orm";
import { db } from "@/db";
import UploadForms from "./UploadForms";

export const dynamic = "force-dynamic";

function toInt(s: string) {
  const v = s.trim();
  if (!v) return null;
  const n = Number.parseInt(v, 10);
  return Number.isFinite(n) ? n : null;
}

function toDecimal(s: string) {
  const v = s.trim().replace(",", ".");
  if (!v) return null;
  const n = Number.parseFloat(v);
  return Number.isFinite(n) ? n : null;
}

function normalizePublicPath(p: unknown) {
  const s = String(p ?? "").trim();
  if (!s) return null;
  return s.startsWith("/") ? s : `/${s}`;
}

type PageProps = {
  params: Promise<{ id: string }>;
};

export default async function AdminPropertyEditPage({ params }: PageProps) {
  const resolved = await params;
  const id = Number(resolved.id);

  if (!Number.isFinite(id)) redirect("/admin/properties");

  const propRes = await db.execute(sql`SELECT * FROM properties WHERE id = ${id} LIMIT 1`);
  const prop = (propRes as any).rows?.[0];
  if (!prop) redirect("/admin/properties");

  const imagesRes = await db.execute(sql`
    SELECT id, url, alt, sort_order, is_cover
    FROM property_images
    WHERE property_id = ${id}
    ORDER BY sort_order ASC, id ASC
  `);
  const images = ((imagesRes as any).rows ?? []) as Array<any>;

  const plansHref = normalizePublicPath(prop.plans_url);

  async function updateBase(formData: FormData) {
    "use server";

    const slugRaw = String(formData.get("slug") || "").trim();
    const slug = slugRaw
      .toLowerCase()
      .replace(/\s+/g, "-")
      .replace(/[^a-z0-9-]/g, "")
      .replace(/-+/g, "-")
      .replace(/^-|-$/g, "")
      .slice(0, 255); // ✅ важное: не даём превысить varchar(120)

    if (!slug) redirect(`/admin/properties/${id}`);


    const isPublished = formData.get("isPublished") === "on";
    const price = toDecimal(String(formData.get("price") || ""));
    const currency =
      String(formData.get("currency") || "EUR")
        .trim()
        .toUpperCase()
        .slice(0, 3) || "EUR";
    const location = String(formData.get("location") || "").trim() || null;

    const bedrooms = toInt(String(formData.get("bedrooms") || ""));
    const bathrooms = toInt(String(formData.get("bathrooms") || ""));

    const plotAreaM2 = toInt(String(formData.get("plotAreaM2") || ""));
    const builtAreaM2 = toInt(String(formData.get("builtAreaM2") || ""));
    const terraceAreaM2 = toInt(String(formData.get("terraceAreaM2") || ""));

    await db.execute(sql`
      UPDATE properties
      SET
        slug = ${slug},
        is_published = ${isPublished},
        price = ${price},
        currency = ${currency},
        location = ${location},
        bedrooms = ${bedrooms},
        bathrooms = ${bathrooms},
        plot_area_m2 = ${plotAreaM2},
        built_area_m2 = ${builtAreaM2},
        terrace_area_m2 = ${terraceAreaM2},
        updated_at = NOW()
      WHERE id = ${id}
    `);

    redirect(`/admin/properties/${id}`);
  }

  return (
    <main style={{ maxWidth: 1100, margin: "60px auto", padding: 16 }}>
      <header style={{ display: "flex", alignItems: "center", justifyContent: "space-between", gap: 12 }}>
        <div>
          <h1 style={{ fontSize: 34, margin: 0 }}>Edit property #{prop.id}</h1>
          <p style={{ marginTop: 8, opacity: 0.75 }}>
            Slug: <code>{prop.slug}</code>
          </p>
        </div>

        <div style={{ display: "flex", gap: 10 }}>
          <Link href="/admin/properties" style={btnGhost}>
            ← Back
          </Link>
        </div>
      </header>

      {/* Base fields */}
      <section style={card}>
        <h2 style={h2}>Base fields</h2>

        <form action={updateBase}>
          <div style={grid2}>
            <Field label="Slug">
              <input name="slug" defaultValue={prop.slug} style={input} required />
            </Field>

            <Field label="Location">
              <input name="location" defaultValue={prop.location ?? ""} style={input} />
            </Field>
          </div>

          <div style={grid2}>
            <Field label="Price">
              <input name="price" defaultValue={prop.price ?? ""} style={input} />
            </Field>

            <Field label="Currency">
              <input name="currency" defaultValue={prop.currency ?? "EUR"} style={input} />
            </Field>
          </div>

          <div style={grid2}>
            <Field label="Bedrooms">
              <input name="bedrooms" defaultValue={prop.bedrooms ?? ""} style={input} />
            </Field>

            <Field label="Bathrooms">
              <input name="bathrooms" defaultValue={prop.bathrooms ?? ""} style={input} />
            </Field>
          </div>

          <div style={grid3}>
            <Field label="Plot area (m²)">
              <input name="plotAreaM2" defaultValue={prop.plot_area_m2 ?? ""} style={input} />
            </Field>
            <Field label="Built area (m²)">
              <input name="builtAreaM2" defaultValue={prop.built_area_m2 ?? ""} style={input} />
            </Field>
            <Field label="Terrace area (m²)">
              <input name="terraceAreaM2" defaultValue={prop.terrace_area_m2 ?? ""} style={input} />
            </Field>
          </div>

          <div style={{ marginTop: 10, display: "flex", alignItems: "center", gap: 10 }}>
            <input id="isPublished" name="isPublished" type="checkbox" defaultChecked={!!prop.is_published} />
            <label htmlFor="isPublished">Published</label>
          </div>

          <div style={{ marginTop: 14 }}>
            <button type="submit" style={btnPrimary}>
              Save changes
            </button>
          </div>
        </form>
      </section>

      {/* Plans PDF */}
      <section style={card}>
        <h2 style={h2}>Plans (PDF)</h2>

        {plansHref ? (
          <div style={{ marginTop: 8, display: "flex", alignItems: "center", gap: 10, flexWrap: "wrap" }}>
            <span>
              Current:{" "}
              <a href={plansHref} target="_blank" rel="noreferrer">
                {plansHref}
              </a>
            </span>

            {/* ✅ delete pdf (через POST + _method) */}
            <form action={`/api/admin/properties/${id}/plans`} method="post">
              <input type="hidden" name="_method" value="delete" />
              <button type="submit" style={btnDanger}>
                Delete PDF
              </button>
            </form>
          </div>
        ) : (
          <p style={{ marginTop: 8, opacity: 0.7 }}>No plans uploaded yet.</p>
        )}

        <div style={{ marginTop: 12 }}>
          <UploadForms propertyId={id} />
        </div>
      </section>

      {/* Images preview */}
      <section style={card}>
        <h2 style={h2}>Images</h2>

        {images.length === 0 ? (
          <p style={{ marginTop: 12, opacity: 0.7 }}>No images yet.</p>
        ) : (
          <div
            style={{
              marginTop: 14,
              display: "grid",
              gridTemplateColumns: "repeat(auto-fill, minmax(180px, 1fr))",
              gap: 12,
            }}
          >
            {images.map((img) => (
              <div key={img.id} style={{ border: "1px solid #E2E2DE", borderRadius: 14, overflow: "hidden" }}>
                <img src={img.url} alt={img.alt ?? ""} style={{ width: "100%", height: 140, objectFit: "cover" }} />

                <div style={{ padding: 10, fontSize: 13 }}>
                  <div style={{ display: "flex", justifyContent: "space-between", gap: 10, alignItems: "center" }}>
                    <span style={{ opacity: 0.75 }}>#{img.sort_order}</span>
                    {img.is_cover ? <strong>Cover</strong> : <span style={{ opacity: 0.5 }}>—</span>}
                  </div>

                  <div style={{ marginTop: 6, opacity: 0.7, wordBreak: "break-all" }}>{img.url}</div>

                  {/* ✅ delete image: через тот же endpoint /images */}
                  <div style={{ marginTop: 10, display: "flex", gap: 8, flexWrap: "wrap" }}>
                    <form action={`/api/admin/properties/${id}/images`} method="post">
                      <input type="hidden" name="_method" value="delete" />
                      <input type="hidden" name="imageId" value={String(img.id)} />
                      <button type="submit" style={btnMiniDanger}>
                        Delete
                      </button>
                    </form>
                  </div>
                </div>
              </div>
            ))}
          </div>
        )}
      </section>
    </main>
  );
}

function Field({ label, children }: { label: string; children: React.ReactNode }) {
  return (
    <div style={{ marginBottom: 12 }}>
      <label style={{ fontWeight: 600, display: "block", marginBottom: 6 }}>{label}</label>
      {children}
    </div>
  );
}

const card: React.CSSProperties = {
  marginTop: 18,
  border: "1px solid #E2E2DE",
  borderRadius: 16,
  padding: 16,
  background: "#fff",
};

const h2: React.CSSProperties = { fontSize: 18, margin: 0 };
const input: React.CSSProperties = { width: "100%", padding: 12, borderRadius: 12, border: "1px solid #E2E2DE" };
const grid2: React.CSSProperties = { display: "grid", gridTemplateColumns: "1fr 1fr", gap: 14 };
const grid3: React.CSSProperties = { display: "grid", gridTemplateColumns: "1fr 1fr 1fr", gap: 14 };

const btnGhost: React.CSSProperties = {
  padding: "10px 14px",
  borderRadius: 12,
  border: "1px solid #E2E2DE",
  textDecoration: "none",
  color: "inherit",
};

const btnPrimary: React.CSSProperties = {
  padding: "10px 14px",
  borderRadius: 12,
  border: "1px solid #0E5E56",
  background: "#0E5E56",
  color: "#fff",
  fontWeight: 600,
  cursor: "pointer",
};

const btnDanger: React.CSSProperties = {
  padding: "10px 14px",
  borderRadius: 12,
  border: "1px solid #C0392B",
  background: "#C0392B",
  color: "#fff",
  fontWeight: 600,
  cursor: "pointer",
};

const btnMiniDanger: React.CSSProperties = {
  padding: "8px 10px",
  borderRadius: 10,
  border: "1px solid #C0392B",
  background: "#C0392B",
  color: "#fff",
  fontWeight: 600,
  cursor: "pointer",
  fontSize: 12,
};

```

---

## app/admin/properties/new/page.tsx

```typescript
import Link from "next/link";
import { redirect } from "next/navigation";
import { sql } from "drizzle-orm";
import { db } from "@/db";

export const dynamic = "force-dynamic";

function toInt(v: FormDataEntryValue | null) {
  if (v === null) return null;
  const s = String(v).trim();
  if (!s) return null;
  const n = Number.parseInt(s, 10);
  return Number.isFinite(n) ? n : null;
}

function toDecimal(v: FormDataEntryValue | null) {
  if (v === null) return null;
  const s = String(v).trim().replace(",", ".");
  if (!s) return null;
  const n = Number.parseFloat(s);
  return Number.isFinite(n) ? n : null;
}

export default function AdminPropertyNewPage() {
  async function create(formData: FormData) {
    "use server";

    const slugRaw = String(formData.get("slug") || "").trim();
    const slug = slugRaw
      .toLowerCase()
      .replace(/\s+/g, "-")
      .replace(/[^a-z0-9-]/g, "");

    if (!slug) redirect("/admin/properties/new");

    const isPublished = formData.get("isPublished") === "on";

    const price = toDecimal(formData.get("price"));
    const currency =
      String(formData.get("currency") || "EUR").trim().toUpperCase().slice(0, 3) || "EUR";

    const location = String(formData.get("location") || "").trim() || null;

    const bedrooms = toInt(formData.get("bedrooms"));
    const bathrooms = toInt(formData.get("bathrooms"));

    // новые площади
    const plotAreaM2 = toInt(formData.get("plotAreaM2"));
    const builtAreaM2 = toInt(formData.get("builtAreaM2"));
    const terraceAreaM2 = toInt(formData.get("terraceAreaM2"));

    // планы (пока просто ссылка/путь)
    const plansUrl = String(formData.get("plansUrl") || "").trim() || null;

    try {
      await db.execute(sql`
        INSERT INTO properties
          (
            slug,
            is_published,
            price,
            currency,
            bedrooms,
            bathrooms,
            location,
            plot_area_m2,
            built_area_m2,
            terrace_area_m2,
            plans_url
          )
        VALUES
          (
            ${slug},
            ${isPublished},
            ${price},
            ${currency},
            ${bedrooms},
            ${bathrooms},
            ${location},
            ${plotAreaM2},
            ${builtAreaM2},
            ${terraceAreaM2},
            ${plansUrl}
          )
      `);
    } catch {
      redirect("/admin/properties/new");
    }

    redirect("/admin/properties");
  }

  return (
    <main style={{ maxWidth: 900, margin: "60px auto", padding: 16 }}>
      <header style={{ display: "flex", alignItems: "center", justifyContent: "space-between", gap: 12 }}>
        <div>
          <h1 style={{ fontSize: 34, margin: 0 }}>Create property</h1>
          <p style={{ marginTop: 8, opacity: 0.75 }}>
            Заполни только то, что известно. Пустые поля не будут показываться на сайте.
          </p>
        </div>

        <Link
          href="/admin/properties"
          style={{
            padding: "10px 14px",
            borderRadius: 12,
            border: "1px solid #E2E2DE",
            textDecoration: "none",
            color: "inherit",
          }}
        >
          ← Back to list
        </Link>
      </header>

      <form action={create} style={{ marginTop: 18 }}>
        <div
          style={{
            border: "1px solid #E2E2DE",
            borderRadius: 16,
            background: "#fff",
            padding: 18,
          }}
        >
          <Field label="Slug (required)" hint="URL id, например: modern-villa-marbella">
            <input name="slug" required placeholder="modern-villa-marbella" style={inputStyle} />
          </Field>

          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 14 }}>
            <Field label="Price" hint="например: 350000">
              <input name="price" inputMode="decimal" placeholder="350000" style={inputStyle} />
            </Field>

            <Field label="Currency" hint="EUR / USD ...">
              <input name="currency" defaultValue="EUR" style={inputStyle} />
            </Field>
          </div>

          <Field label="Location" hint="например: Marbella, Nueva Andalucía">
            <input name="location" placeholder="Marbella" style={inputStyle} />
          </Field>

          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 14 }}>
            <Field label="Bedrooms">
              <input name="bedrooms" inputMode="numeric" placeholder="3" style={inputStyle} />
            </Field>

            <Field label="Bathrooms">
              <input name="bathrooms" inputMode="numeric" placeholder="2" style={inputStyle} />
            </Field>
          </div>

          <h2 style={{ fontSize: 18, marginTop: 18, marginBottom: 10 }}>Areas (m²)</h2>

          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr 1fr", gap: 14 }}>
            <Field label="Plot area" hint="участок (для дома/виллы)">
              <input name="plotAreaM2" inputMode="numeric" placeholder="450" style={inputStyle} />
            </Field>

            <Field label="Built area" hint="площадь застройки">
              <input name="builtAreaM2" inputMode="numeric" placeholder="120" style={inputStyle} />
            </Field>

            <Field label="Terrace area" hint="террасы">
              <input name="terraceAreaM2" inputMode="numeric" placeholder="30" style={inputStyle} />
            </Field>
          </div>

          <h2 style={{ fontSize: 18, marginTop: 18, marginBottom: 10 }}>Plans</h2>

          <Field label="Plans URL / Path" hint="пока ссылка, позже сделаем upload PDF">
            <input name="plansUrl" placeholder="/uploads/plans/..." style={inputStyle} />
          </Field>

          <div style={{ marginTop: 14, display: "flex", alignItems: "center", gap: 10 }}>
            <input id="isPublished" name="isPublished" type="checkbox" />
            <label htmlFor="isPublished" style={{ userSelect: "none" }}>
              Published
            </label>
          </div>

          <div style={{ marginTop: 18, display: "flex", gap: 10 }}>
            <button
              type="submit"
              style={{
                padding: "10px 14px",
                borderRadius: 12,
                border: "1px solid #0E5E56",
                background: "#0E5E56",
                color: "#fff",
                fontWeight: 600,
                cursor: "pointer",
              }}
            >
              Save
            </button>

            <Link
              href="/admin/properties"
              style={{
                padding: "10px 14px",
                borderRadius: 12,
                border: "1px solid #E2E2DE",
                textDecoration: "none",
                color: "inherit",
              }}
            >
              Cancel
            </Link>
          </div>

          <p style={{ marginTop: 14, opacity: 0.65, fontSize: 13 }}>
            Если slug уже существует — форма откроется заново (позже добавим сообщение об ошибке).
          </p>
        </div>
      </form>
    </main>
  );
}

function Field({
  label,
  hint,
  children,
}: {
  label: string;
  hint?: string;
  children: React.ReactNode;
}) {
  return (
    <div style={{ marginBottom: 14 }}>
      <div style={{ display: "flex", alignItems: "baseline", justifyContent: "space-between", gap: 10 }}>
        <label style={{ fontWeight: 600 }}>{label}</label>
        {hint ? <span style={{ fontSize: 12, opacity: 0.6 }}>{hint}</span> : null}
      </div>
      <div style={{ marginTop: 6 }}>{children}</div>
    </div>
  );
}

const inputStyle: React.CSSProperties = {
  width: "100%",
  padding: 12,
  borderRadius: 12,
  border: "1px solid #E2E2DE",
};

```

---

## app/admin/properties/page.tsx

```typescript
import Link from "next/link";
import { sql } from "drizzle-orm";
import { db } from "@/db";

export const dynamic = "force-dynamic";

type PropertyRow = {
  id: number;
  slug: string;
  is_published: boolean;
  price: string | null;
  currency: string;
  location: string | null;
  created_at: string;
};

export default async function AdminPropertiesPage() {
  const result = await db.execute(sql`
    SELECT id, slug, is_published, price, currency, location, created_at
    FROM properties
    ORDER BY id DESC
    LIMIT 200
  `);

  const rows = (result as any).rows as PropertyRow[];

  return (
    <main style={{ maxWidth: 1100, margin: "60px auto", padding: 16 }}>
      <header style={{ display: "flex", alignItems: "center", justifyContent: "space-between", gap: 12 }}>
        <div>
          <h1 style={{ fontSize: 34, margin: 0 }}>Properties</h1>
          <p style={{ marginTop: 8, opacity: 0.75 }}>
            {rows.length} item(s)
          </p>
        </div>

        <div style={{ display: "flex", gap: 10 }}>
          <Link href="/admin" style={btnGhost}>← Admin</Link>
          <Link href="/admin/properties/new" style={btnPrimary}>+ Create</Link>
        </div>
      </header>

      <section style={card}>
        {rows.length === 0 ? (
          <div style={{ padding: 18 }}>
            <p style={{ margin: 0 }}>No properties yet.</p>
          </div>
        ) : (
          <div style={{ overflowX: "auto" }}>
            <table style={{ width: "100%", borderCollapse: "collapse" }}>
              <thead>
                <tr>
                  {["ID", "Slug", "Status", "Price", "Location", "Created", "Actions"].map((h) => (
                    <th key={h} style={th}>{h}</th>
                  ))}
                </tr>
              </thead>
              <tbody>
                {rows.map((p) => (
                  <tr key={p.id}>
                    <td style={td}>{p.id}</td>
                    <td style={td}><code>{p.slug}</code></td>
                    <td style={td}>{p.is_published ? "Published" : "Draft"}</td>
                    <td style={td}>
                      {p.price ? `${p.price} ${p.currency}` : <span style={{ opacity: 0.5 }}>—</span>}
                    </td>
                    <td style={td}>{p.location ?? <span style={{ opacity: 0.5 }}>—</span>}</td>
                    <td style={td}>{new Date(p.created_at).toLocaleString()}</td>
                    <td style={td}>
                      <Link href={`/admin/properties/${p.id}`} style={{ textDecoration: "none", fontWeight: 600 }}>
                        Edit →
                      </Link>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        )}
      </section>
    </main>
  );
}

const card: React.CSSProperties = {
  marginTop: 18,
  border: "1px solid #E2E2DE",
  borderRadius: 16,
  overflow: "hidden",
  background: "#fff",
};

const th: React.CSSProperties = {
  textAlign: "left",
  fontSize: 12,
  letterSpacing: 0.3,
  textTransform: "uppercase",
  padding: "12px 14px",
  borderBottom: "1px solid #E2E2DE",
  background: "#F6F5F2",
  whiteSpace: "nowrap",
};

const td: React.CSSProperties = {
  padding: "12px 14px",
  borderBottom: "1px solid #F0F0ED",
  verticalAlign: "top",
  whiteSpace: "nowrap",
};

const btnGhost: React.CSSProperties = {
  padding: "10px 14px",
  borderRadius: 12,
  border: "1px solid #E2E2DE",
  textDecoration: "none",
  color: "inherit",
};

const btnPrimary: React.CSSProperties = {
  padding: "10px 14px",
  borderRadius: 12,
  border: "1px solid #0E5E56",
  textDecoration: "none",
  color: "#0E5E56",
  fontWeight: 600,
};

```

---

## app/api/admin/properties/[id]/images/route.ts

```typescript
import { NextResponse } from "next/server";
import { sql } from "drizzle-orm";
import { db } from "@/db";
import path from "path";
import fs from "fs/promises";

export const runtime = "nodejs";
export const dynamic = "force-dynamic";

function safeName(name: string) {
  return name
    .toLowerCase()
    .replace(/\s+/g, "-")
    .replace(/[^a-z0-9.\-_]/g, "");
}

function toDiskPathFromPublicUrl(publicUrl: string) {
  // publicUrl вида "/uploads/properties/xxx.jpg"
  const clean = publicUrl.startsWith("/") ? publicUrl.slice(1) : publicUrl;
  return path.join(process.cwd(), "public", clean);
}

// ✅ upload images (multiple)
export async function POST(req: Request, ctx: { params: Promise<{ id: string }> }) {
  const { id } = await ctx.params;
  const propertyId = Number(id);
  if (!Number.isFinite(propertyId)) {
    return NextResponse.json({ error: "Bad id" }, { status: 400 });
  }

  const form = await req.formData();

  // ✅ поддержка "POST + _method=delete" (для удаления фото)
  const methodOverride = String(form.get("_method") || "").toLowerCase();
  if (methodOverride === "delete") {
    const imageId = Number(form.get("imageId"));
    if (!Number.isFinite(imageId)) {
      return NextResponse.json({ error: "Bad imageId" }, { status: 400 });
    }

    // найдём картинку и убедимся что она принадлежит объекту
    const imgRes = await db.execute(sql`
      SELECT id, property_id, url, is_cover
      FROM property_images
      WHERE id = ${imageId}
      LIMIT 1
    `);

    const img = (imgRes as any).rows?.[0];
    if (!img || Number(img.property_id) !== propertyId) {
      return NextResponse.json({ error: "Image not found" }, { status: 404 });
    }

    // удаляем файл с диска (если вдруг уже удалён — не падаем)
    const diskPath = toDiskPathFromPublicUrl(String(img.url));
    try {
      await fs.unlink(diskPath);
    } catch {
      // ignore
    }

    // удаляем запись из БД
    await db.execute(sql`DELETE FROM property_images WHERE id = ${imageId}`);

    // если удалили cover — назначим новый cover (первую по sort_order)
    if (img.is_cover) {
      const nextRes = await db.execute(sql`
        SELECT id
        FROM property_images
        WHERE property_id = ${propertyId}
        ORDER BY sort_order ASC, id ASC
        LIMIT 1
      `);
      const nextId = (nextRes as any).rows?.[0]?.id;
      if (nextId) {
        await db.execute(sql`
          UPDATE property_images
          SET is_cover = true
          WHERE id = ${nextId}
        `);
      }
    }

    return NextResponse.redirect(new URL(`/admin/properties/${propertyId}`, req.url), 303);
  }

  // --- обычная загрузка ---
  const files = form.getAll("files").filter((x) => x instanceof File) as File[];

  if (files.length === 0) {
    return NextResponse.json({ error: "No files (field name must be 'files')" }, { status: 400 });
  }

  // max sort_order
  const maxRes = await db.execute(sql`
    SELECT COALESCE(MAX(sort_order), 0) AS max
    FROM property_images
    WHERE property_id = ${propertyId}
  `);
  const maxSort = Number((maxRes as any).rows?.[0]?.max ?? 0);

  // already has cover?
  const coverRes = await db.execute(sql`
    SELECT id
    FROM property_images
    WHERE property_id = ${propertyId} AND is_cover = true
    LIMIT 1
  `);
  const hasCover = !!(coverRes as any).rows?.length;

  let i = 0;
  for (const file of files) {
    if (!file.type.startsWith("image/")) continue;

    const bytes = await file.arrayBuffer();
    const buffer = Buffer.from(bytes);

    const filename = `property-${propertyId}-${Date.now()}-${i}-${safeName(file.name || "image")}`;
    const diskPath = path.join(process.cwd(), "public", "uploads", "properties", filename);
    const publicUrl = `/uploads/properties/${filename}`;

    await fs.mkdir(path.dirname(diskPath), { recursive: true });
    await fs.writeFile(diskPath, buffer);

    const sortOrder = maxSort + i + 1;
    const isCover = !hasCover && i === 0;

    await db.execute(sql`
      INSERT INTO property_images (property_id, url, alt, sort_order, is_cover)
      VALUES (${propertyId}, ${publicUrl}, ${null}, ${sortOrder}, ${isCover})
    `);

    i++;
  }

  return NextResponse.redirect(new URL(`/admin/properties/${propertyId}`, req.url), 303);
}

```

---

## app/api/admin/properties/[id]/plans/route.ts

```typescript
import { NextResponse } from "next/server";
import { sql } from "drizzle-orm";
import { db } from "@/db";
import path from "node:path";
import fs from "node:fs/promises";

export const runtime = "nodejs";
export const dynamic = "force-dynamic";

function safeName(name: string) {
  return name
    .toLowerCase()
    .replace(/\s+/g, "-")
    .replace(/[^a-z0-9.\-_]/g, "");
}

async function ensureDir(dirPath: string) {
  await fs.mkdir(dirPath, { recursive: true });
}

async function deleteFileIfInUploads(plansUrl: string | null) {
  if (!plansUrl) return;
  const url = String(plansUrl).trim();
  if (!url.startsWith("/uploads/")) return;

  // url: /uploads/plans/xxx.pdf
  const filePath = path.join(process.cwd(), "public", url);
  try {
    await fs.unlink(filePath);
  } catch {
    // если файла нет — просто игнорируем
  }
}

async function getCurrentPlansUrl(propertyId: number) {
  const res = await db.execute(sql`
    SELECT plans_url
    FROM properties
    WHERE id = ${propertyId}
    LIMIT 1
  `);
  const row = (res as any).rows?.[0];
  return (row?.plans_url ?? null) as string | null;
}

/**
 * POST:
 * - обычная загрузка pdf (field: file)
 * - или "_method=delete" для удаления через HTML form
 */
export async function POST(req: Request, ctx: { params: Promise<{ id: string }> }) {
  const { id } = await ctx.params;
  const propertyId = Number(id);

  if (!Number.isFinite(propertyId)) {
    return NextResponse.json({ error: "Bad id" }, { status: 400 });
  }

  const form = await req.formData();

  // ✅ поддержка delete через hidden _method
  const override = String(form.get("_method") || "").toLowerCase();
  if (override === "delete") {
    return handleDelete(req, propertyId);
  }

  const file = form.get("file");

  if (!(file instanceof File)) {
    return NextResponse.json({ error: "No file (field name must be 'file')" }, { status: 400 });
  }

  if (file.type !== "application/pdf") {
    return NextResponse.json({ error: "Only PDF allowed" }, { status: 400 });
  }

  // ✅ читаем файл
  const bytes = await file.arrayBuffer();
  const buffer = Buffer.from(bytes);

  // ✅ гарантируем, что папка существует
  const plansDir = path.join(process.cwd(), "public", "uploads", "plans");
  await ensureDir(plansDir);

  // ✅ удаляем предыдущий pdf (если был)
  const oldUrl = await getCurrentPlansUrl(propertyId);

  const filename = `property-${propertyId}-${Date.now()}-${safeName(file.name || "plans.pdf")}`;
  const diskPath = path.join(plansDir, filename);
  const publicUrl = `/uploads/plans/${filename}`;

  await fs.writeFile(diskPath, buffer);

  await db.execute(sql`
    UPDATE properties
    SET plans_url = ${publicUrl}, updated_at = NOW()
    WHERE id = ${propertyId}
  `);

  // ✅ чистим старый файл после успешной записи нового
  await deleteFileIfInUploads(oldUrl);

  return NextResponse.redirect(new URL(`/admin/properties/${propertyId}`, req.url), 303);
}

/**
 * DELETE:
 * - удаляет plans_url из БД
 * - удаляет физический файл из public/uploads/...
 */
export async function DELETE(req: Request, ctx: { params: Promise<{ id: string }> }) {
  const { id } = await ctx.params;
  const propertyId = Number(id);

  if (!Number.isFinite(propertyId)) {
    return NextResponse.json({ error: "Bad id" }, { status: 400 });
  }

  return handleDelete(req, propertyId);
}

async function handleDelete(req: Request, propertyId: number) {
  const oldUrl = await getCurrentPlansUrl(propertyId);

  // убираем ссылку из БД
  await db.execute(sql`
    UPDATE properties
    SET plans_url = NULL, updated_at = NOW()
    WHERE id = ${propertyId}
  `);

  // удаляем файл
  await deleteFileIfInUploads(oldUrl);

  return NextResponse.redirect(new URL(`/admin/properties/${propertyId}`, req.url), 303);
}

```

---

## app/globals.css

```css
:root {
  --bg: #fcf8f2;
  --surface: #FFFFFF;
  --text: #1C1C1C;
  --muted: #6B6B6B;
  --border: #E2E2DE;
  --accent: #2B4537;
  --accentHover: #345945;
  --header-h: 15px;
  --radius: 6px;
  --shadow: 0 10px 26px rgba(0, 0, 0, 0.06);
}

/* --- Reset / base --- */
*,
*::before,
*::after {
  box-sizing: border-box;
}

html,
body {
  max-width: 100%;
  overflow-x: hidden;
  margin: 0;
  padding: 0;
  background: var(--bg);
  color: var(--text);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  
  padding-top: var(--header-h);
}

img {
  max-width: 100%;
  height: auto;
}

main {
  display: block;
}

/* Container used across components */
.container {
  width: min(1120px, calc(100% - 48px));
  margin: 0 auto;
}

@media (max-width: 520px) {
  .container {
    width: calc(100% - 28px);
  }
}

/* Make links look like design elements (not default browser links) */
a {
  color: inherit;
  text-decoration: none;
}

a:hover {
  text-decoration: none;
}

/* Improve section rhythm */
section {
  scroll-margin-top: 90px; /* anchor links won't hide under sticky header */
}

.section {
  padding: 72px 0;
}

.section--tight {
  padding: 56px 0;
}

.section__head {
  display: grid;
  gap: 8px;
  justify-items: center;
  text-align: center;
  margin-bottom: 28px;
}

.section__kicker {
  color: var(--muted);
  font-size: 14px;
}

/* ===== Centered title with side lines ===== */
.sectionTitle {
  width: 100%;
  display: flex;
  align-items: center;
  gap: 18px;
  justify-content: center;
  margin: 0;
}

.sectionTitle::before,
.sectionTitle::after {
  content: "";
  height: 1px;
  flex: 1;
  background: var(--border);
}

.sectionTitleText {
  font-size: 34px;
  letter-spacing: 0.2px;
  font-weight: 500;
}

/* optional: slightly smaller on mobile */
@media (max-width: 640px) {
  .sectionTitleText {
    font-size: 26px;
  }
  .section {
    padding: 56px 0;
  }
}

/* ===== Buttons alignment helpers ===== */
.section__actions {
  width: 100%;
  display: flex;
  justify-content: center;
  margin-top: 22px;
}

/* Softer typography defaults */
p {
  margin: 0;
}

/* --- Typography helpers used in page/components --- */
.h1 {
  font-family: var(--font-playfair), Georgia, "Times New Roman", serif;
  font-weight: 600;
  font-size: clamp(36px, 5vw, 56px);
  line-height: 1.08;
  margin: 0;
}

.h2 {
  font-family: var(--font-playfair), Georgia, "Times New Roman", serif;
  font-weight: 600;
  font-size: 28px;
  line-height: 1.15;
  margin: 0;
}

.p {
  color: rgba(28, 28, 28, 0.72);
  font-size: 15px;
  line-height: 1.6;
}

/* --- Buttons --- */
.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  padding: 12px 18px;
  border-radius: 3px;
  font-weight: 600;
  border: 1px solid transparent;
  cursor: pointer;
  transition: transform 0.12s ease, background 0.12s ease, border 0.12s ease;
  user-select: none;
}

.btn:active {
  transform: translateY(1px);
}

.btnPrimary {
  background: var(--accent);
  color: #fff;
}

.btnPrimary:hover {
  background: var(--accentHover);
}

.btnGhost {
  background: rgba(255, 255, 255, 0.78);
  border-color: var(--border);
  color: var(--text);
  backdrop-filter: blur(6px);
}

.btnGhost:hover {
  background: rgba(255, 255, 255, 0.92);
}

/* Make <button class="btn"> look same as <a class="btn"> */
button.btn {
  appearance: none;
  background: none;
}

/* --- Inputs baseline (so forms look consistent) --- */
input,
textarea,
select,
button {
  font: inherit;
}

input,
textarea,
select {
  outline: none;
}

::placeholder {
  color: rgba(28, 28, 28, 0.45);
}



```

---

## app/page.tsx

```typescript

```

---

## components/About/About.module.css

```css
.section {
  padding: 72px 0;
  border-top: 1px solid rgba(226, 226, 222, 0.8);
}

.grid {
  display: grid;
  grid-template-columns: 1.1fr 0.9fr;
  gap: 22px;
  align-items: center;
}

.text {
  background: rgba(255, 255, 255, 0.62);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 22px;
  box-shadow: var(--shadow);
}

.subtitle {
  margin-top: 10px;
  font-size: 15px;
}

.body {
  margin-top: 14px;
  font-size: 15px;
}

.btn {
  margin-top: 18px;
  width: fit-content;
  padding: 10px 14px;
}

.media {
  border-radius: var(--radius);
  overflow: hidden;
  border: 1px solid var(--border);
  box-shadow: var(--shadow);
  background: #eee;
  aspect-ratio: 4 / 3;
}

.image {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}

@media (max-width: 960px) {
  .grid {
    grid-template-columns: 1fr;
  }

  .media {
    aspect-ratio: 16 / 10;
  }
}

```

---

## components/About/About.tsx

```typescript
"use client";

import { scrollToHash } from "@/utils/smoothScroll";
import styles from "./About.module.css";

type AboutDict = {
  title: string;
  subtitle: string;
  body: string;
  cta: string;
};

export default function About({ t }: { t: AboutDict }) {
  const OFFSET = 90;

  return (
    <section id="about" className={`section ${styles.section}`}>
      <div className="container">
        {/* Заголовок секции как в макете: по центру + линии */}
        <div className="section__head">
          <h2 className="sectionTitle">
            <span className="sectionTitleText">{t.title}</span>
          </h2>
        </div>

        <div className={styles.grid}>
          <div className={styles.text}>
            <p className={`p ${styles.subtitle}`}>{t.subtitle}</p>

            <p className={`p ${styles.body}`}>{t.body}</p>

            <a
              className={`btn btnPrimary ${styles.btn}`}
              href="#contact"
              onClick={(e) => {
                e.preventDefault();
                scrollToHash("#contact", { offset: OFFSET });
              }}
            >
              {t.cta}
            </a>
          </div>

          <div className={styles.media}>
            <img
              className={styles.image}
              src="/about.jpg"
              alt={t.title}
              loading="lazy"
            />
          </div>
        </div>
      </div>
    </section>
  );
}

```

---

## components/Contact/Contact.module.css

```css
.section {
  padding: 72px 0 90px;
  border-top: 1px solid rgba(226, 226, 222, 0.8);
}

.head {
  margin-bottom: 18px;
}

.grid {
  display: grid;
  grid-template-columns: 1.2fr 0.8fr;
  gap: 18px;
  align-items: start;
  margin-top: 16px;
}

.form {
  background: rgba(255, 255, 255, 0.62);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 22px;
  box-shadow: var(--shadow);
}

.row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
}

.field {
  display: flex;
  flex-direction: column;
  gap: 6px;
  margin-top: 12px;
}

.field:first-child {
  margin-top: 0;
}

.label {
  font-size: 12px;
  color: rgba(28, 28, 28, 0.75);
  font-weight: 600;
}

.input,
.textarea {
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 12px 12px;
  font-size: 14px;
  outline: none;
  background: rgba(255, 255, 255, 0.85);
}

.input:focus,
.textarea:focus {
  border-color: rgba(14, 94, 86, 0.45);
  box-shadow: 0 0 0 4px rgba(14, 94, 86, 0.10);
}

.textarea {
  min-height: 120px;
  resize: vertical;
}

.infoCard {
  background: rgba(255, 255, 255, 0.62);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 22px;
  box-shadow: var(--shadow);
}

.infoTitle {
  font-family: var(--font-playfair), Georgia, "Times New Roman", serif;
  font-size: 18px;
  margin-bottom: 12px;
}

.infoItem {
  display: flex;
  gap: 10px;
  align-items: center;
  padding: 8px 0;
}

.infoIcon {
  width: 28px;
  height: 28px;
  border-radius: 10px;
  display: grid;
  place-items: center;
  background: rgba(14, 94, 86, 0.08);
}

.infoLink {
  color: var(--text);
  font-weight: 600;
}

.infoLink:hover {
  color: var(--accent);
}

.divider {
  height: 1px;
  background: rgba(226, 226, 222, 0.8);
  margin: 12px 0;
}

.waBtn {
  width: 100%;
  justify-content: center;
  margin-top: 6px;
  text-decoration: none;
}

.note {
  margin-top: 12px;
  font-size: 13px;
}

.footerLine {
  height: 1px;
  background: rgba(226, 226, 222, 0.8);
  margin-top: 28px;
}

.footerText {
  margin-top: 14px;
  color: rgba(28, 28, 28, 0.6);
  font-size: 12px;
}

@media (max-width: 960px) {
  .grid {
    grid-template-columns: 1fr;
  }

  .row {
    grid-template-columns: 1fr;
  }
}

```

---

## components/Contact/Contact.tsx

```typescript
"use client";

import styles from "./Contact.module.css";

type ContactDict = {
  title: string;
  subtitle: string;

  form: {
    name: string;
    phone: string;
    email: string;
    message: string;
    send: string;
    namePlaceholder: string;
    phonePlaceholder: string;
    emailPlaceholder: string;
    messagePlaceholder: string;
  };

  info: {
    title: string;
    whatsapp: string;
    note: string;
  };

  footerRights: string;
};

export default function Contact({ t }: { t: ContactDict }) {
  return (
    <section id="contact" className={`section ${styles.section}`}>
      <div className="container">
        {/* Заголовок секции */}
        <div className="section__head">
          <h2 className="sectionTitle">
            <span className="sectionTitleText">{t.title}</span>
          </h2>
          <p className="section__kicker">{t.subtitle}</p>
        </div>

        <div className={styles.grid}>
          {/* Form */}
          <form
            className={styles.form}
            onSubmit={(e) => e.preventDefault()}
          >
            <div className={styles.row}>
              <div className={styles.field}>
                <label className={styles.label} htmlFor="name">
                  {t.form.name}
                </label>
                <input
                  className={styles.input}
                  id="name"
                  name="name"
                  placeholder={t.form.namePlaceholder}
                />
              </div>

              <div className={styles.field}>
                <label className={styles.label} htmlFor="phone">
                  {t.form.phone}
                </label>
                <input
                  className={styles.input}
                  id="phone"
                  name="phone"
                  placeholder={t.form.phonePlaceholder}
                />
              </div>
            </div>

            <div className={styles.field}>
              <label className={styles.label} htmlFor="email">
                {t.form.email}
              </label>
              <input
                className={styles.input}
                id="email"
                name="email"
                placeholder={t.form.emailPlaceholder}
              />
            </div>

            <div className={styles.field}>
              <label className={styles.label} htmlFor="message">
                {t.form.message}
              </label>
              <textarea
                className={styles.textarea}
                id="message"
                name="message"
                placeholder={t.form.messagePlaceholder}
              />
            </div>

            <button className="btn btnPrimary" type="submit">
              {t.form.send}
            </button>
          </form>

          {/* Info */}
          <aside className={styles.info}>
            <div className={styles.infoCard}>
              <div className={styles.infoTitle}>{t.info.title}</div>

              <div className={styles.infoItem}>
                <span className={styles.infoIcon}>📞</span>
                <a
                  className={styles.infoLink}
                  href="tel:+34123456789"
                >
                  +34 123 456 789
                </a>
              </div>

              <div className={styles.infoItem}>
                <span className={styles.infoIcon}>✉️</span>
                <a
                  className={styles.infoLink}
                  href="mailto:info@grahaliaestates.com"
                >
                  info@grahaliaestates.com
                </a>
              </div>

              <div className={styles.divider} />

              <a
                className={`btn btnPrimary ${styles.waBtn}`}
                href="https://wa.me/34123456789"
                target="_blank"
                rel="noreferrer"
              >
                {t.info.whatsapp}
              </a>

              <p className={`p ${styles.note}`}>
                {t.info.note}
              </p>
            </div>
          </aside>
        </div>

        <div className={styles.footerLine} />
        <div className={styles.footerText}>
          © {new Date().getFullYear()} Grahalia Estates · {t.footerRights}
        </div>
      </div>
    </section>
  );
}

```

---

## components/Featured/Featured.module.css

```css
.section {
  padding: 72px 0;
}

.head {
  display: flex;
  align-items: flex-end;
  justify-content: space-between;
  gap: 16px;
  margin-bottom: 18px;
}

.allBtn {
  padding: 10px 14px;
  white-space: nowrap;
}

.grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 18px;
  margin-top: 16px;
}

@media (max-width: 960px) {
  .grid {
    grid-template-columns: 1fr;
  }

  .head {
    align-items: flex-start;
    flex-direction: column;
  }
}

```

---

## components/Featured/Featured.tsx

```typescript
"use client";

import { scrollToHash } from "@/utils/smoothScroll";
import PropertyCard from "../PropertyCard/PropertyCard";
import styles from "./Featured.module.css";

type FeaturedDict = {
  title: string;
  subtitle: string;
  cta: string;
};

const featured = [
  {
    title: "Modern Villa in Marbella",
    location: "Marbella · Costa del Sol",
    price: "€1,250,000",
    beds: 4,
    baths: 3,
    area: 250,
    image: "/properties/p1.jpg",
  },
  {
    title: "Seaside Apartment in Estepona",
    location: "Estepona · Costa del Sol",
    price: "€850,000",
    beds: 2,
    baths: 2,
    area: 120,
    image: "/properties/p2.jpg",
  },
  {
    title: "Luxury Villa in Benahavís",
    location: "Benahavís · Costa del Sol",
    price: "Price on Request",
    beds: 5,
    baths: 5,
    area: 450,
    image: "/properties/p3.jpg",
  },
];

export default function Featured({ t }: { t: FeaturedDict }) {
  const OFFSET = 90;

  return (
    <section id="properties" className={`section ${styles.section}`}>
      <div className="container">
        {/* Центрированный заголовок как в макете */}
        <div className="section__head">
          <h2 className="sectionTitle">
            <span className="sectionTitleText">{t.title}</span>
          </h2>
          <p className="section__kicker">{t.subtitle}</p>
        </div>

        <div className={styles.grid}>
          {featured.map((p) => (
            <PropertyCard key={p.title} property={p} t={t.card} />
          ))}
        </div>

        {/* CTA */}
        <div className="section__actions">
          <a
            className={`btn btnPrimary ${styles.allBtn}`}
            href="#contact"
            onClick={(e) => {
              e.preventDefault();
              scrollToHash("#contact", { offset: OFFSET });
            }}
          >
            {t.cta}
          </a>
        </div>
      </div>
    </section>
  );
}

```

---

## components/Header/Header.module.css

```css
.header {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: 1000;
  background: #fcf8f2;
  backdrop-filter: blur(10px);
  border-bottom: 1px solid rgba(226, 226, 222, 0.7);
  /* защита от горизонтального скролла */
  width: 100%;
  max-width: 100%;
}

/* row */
.row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  height: 72px;
  gap: 18px;
}

/* logo */
.logo {
  display: flex;
  align-items: baseline;
  gap: 10px;
  letter-spacing: 0.08em;
  white-space: nowrap;
  cursor: pointer;
}

.logo:focus-visible {
  outline: 2px solid rgba(14, 94, 86, 0.35);
  outline-offset: 4px;
  border-radius: 12px;
}

.logoMark {
  font-family: var(--font-playfair), Georgia, "Times New Roman", serif;
  font-weight: 600;
  font-size: 20px;
}

.logoSub {
  font-size: 12px;
  color: var(--muted);
  font-weight: 700;
}

/* desktop nav */
.nav {
  position: relative;
  display: flex;
  gap: 22px;
  align-items: center;
}

/* Плавающий индикатор */
.indicator {
  position: absolute;
  bottom: 6px;
  left: 0;
  height: 2px;
  background: rgba(14, 94, 86, 0.9);
  border-radius: 2px;
  transition: transform 320ms cubic-bezier(0.22, 1, 0.36, 1),
    width 320ms cubic-bezier(0.22, 1, 0.36, 1);
  will-change: transform, width;
  pointer-events: none;
}

.link {
  position: relative;
  font-size: 14px;
  color: rgba(28, 28, 28, 0.72);
  padding: 10px 10px;
  border-radius: 12px;
  transition: background 0.15s ease, color 0.15s ease;
}

.link:hover {
  color: var(--text);
  background: rgba(255, 255, 255, 0.65);
}

.active {
  color: var(--text);
}

/* ВАЖНО: убираем ::after, чтобы не было "двух линий" (и дерганья визуально) */
.active::after {
  content: none;
}

/* right */
.right {
  display: flex;
  align-items: center;
  gap: 14px;
}

.lang {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 13px;
  color: rgba(28, 28, 28, 0.75);
}

.langBtn {
  background: transparent;
  border: none;
  cursor: pointer;
  font-weight: 600;
  color: inherit;
  padding: 6px 6px;
  border-radius: 10px;
}

.langBtn:hover {
  background: rgba(255, 255, 255, 0.55);
  color: var(--text);
}

.sep {
  opacity: 0.5;
}

.wa {
  padding: 10px 16px;
  border-radius: 3px;
  text-decoration: none;
}

/* -------------------------
   Mobile burger + menu
-------------------------- */

.burger {
  display: none;
  height: 44px;
  width: auto;          /* <-- важно */
  padding: 0 12px;      /* <-- важно */

  border-radius: 12px;
  border: 1px solid rgba(226, 226, 222, 0.9);
  background: rgba(255, 255, 255, 0.55);
  backdrop-filter: blur(8px);

  align-items: center;
  justify-content: center;
  gap: 10px;            /* было 5px — увеличим, чтобы текст/иконка дышали */
  cursor: pointer;
  transition: transform 0.12s ease, background 0.12s ease, border 0.12s ease;
}

.burgerText {
  font-size: 13px;
  font-weight: 700;
  letter-spacing: 0.02em;
  color: rgba(28, 28, 28, 0.85);
  line-height: 1;
}

.burgerLines {
  width: 18px;
  height: 14px;
  display: inline-flex;
  flex-direction: column;
  justify-content: space-between;
}

.burger:hover {
  background: rgba(255, 255, 255, 0.75);
}

.burger:active {
  transform: translateY(1px);
}

.burgerLines span {
  display: block;
  width: 18px;
  height: 2px;
  background: rgba(28, 28, 28, 0.85);
  border-radius: 2px;
  transition: transform 220ms cubic-bezier(0.22, 1, 0.36, 1),
    opacity 180ms ease;
}

/* крестик */
.burgerOpen .burgerLines span:nth-child(1) {
  transform: translateY(6px) rotate(45deg);
}
.burgerOpen .burgerLines span:nth-child(2) {
  opacity: 0;
}
.burgerOpen .burgerLines span:nth-child(3) {
  transform: translateY(-6px) rotate(-45deg);
}

/* overlay */
.mobileOverlay {
  position: fixed;
  inset: 0;
  z-index: 60;
  background: rgba(18, 18, 18, 0.25);
  opacity: 0;
  pointer-events: none;
  transition: opacity 220ms ease;
  width: 100%;
  max-width: 100%;
}

.mobileOverlayOpen {
  opacity: 1;
  pointer-events: auto;
}

/* panel */
.mobilePanel {
  position: absolute;
  right: 12px;
  top: 12px;
  width: min(92vw, 360px);
  border-radius: 16px;
  background: rgba(252, 248, 242, 0.96);
  border: 1px solid rgba(226, 226, 222, 0.9);
  backdrop-filter: blur(10px);
  box-shadow: 0 18px 50px rgba(0, 0, 0, 0.18);

  transform: translateY(-8px) scale(0.98);
  opacity: 0;
  transition: transform 260ms cubic-bezier(0.22, 1, 0.36, 1),
    opacity 220ms ease;
}

.mobileOverlayOpen .mobilePanel {
  transform: translateY(0) scale(1);
  opacity: 1;
}

.mobileTop {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 14px 14px 10px;
  border-bottom: 1px solid rgba(226, 226, 222, 0.8);
}

.mobileTitle {
  font-weight: 700;
  letter-spacing: 0.06em;
  font-size: 12px;
  color: rgba(28, 28, 28, 0.7);
  text-transform: uppercase;
}

.mobileClose {
  width: 36px;
  height: 36px;
  border-radius: 12px;
  border: 1px solid rgba(226, 226, 222, 0.9);
  background: rgba(255, 255, 255, 0.55);
  cursor: pointer;
  transition: transform 0.12s ease, background 0.12s ease;
}

.mobileClose:hover {
  background: rgba(255, 255, 255, 0.78);
}

.mobileClose:active {
  transform: translateY(1px);
}

.mobileLinks {
  padding: 10px 10px 6px;
  display: grid;
  gap: 6px;
}

.mobileLink {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 12px;
  border-radius: 14px;
  color: rgba(28, 28, 28, 0.82);
  font-weight: 600;
  background: rgba(255, 255, 255, 0.45);
  border: 1px solid rgba(226, 226, 222, 0.75);
  transition: background 0.14s ease, transform 0.14s ease;
}

.mobileLink:hover {
  background: rgba(255, 255, 255, 0.7);
}

.mobileLink:active {
  transform: translateY(1px);
}

.mobileActive {
  background: rgba(14, 94, 86, 0.1);
  border-color: rgba(14, 94, 86, 0.25);
  color: var(--text);
}

.mobileBottom {
  padding: 12px 12px 14px;
  border-top: 1px solid rgba(226, 226, 222, 0.8);
  display: grid;
  gap: 10px;
}

.mobileWa {
  width: 100%;
  justify-content: center;
}

.mobileLang {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  font-size: 13px;
  color: rgba(28, 28, 28, 0.75);
}

/* -------------------------
   Responsive rules
-------------------------- */

@media (max-width: 860px) {
  .nav {
    display: none;
  }

  .burger {
    display: inline-flex;
  }

  /* чтобы не было горизонтального скролла из-за "правого блока" */
  .right {
    gap: 10px;
  }

  /* на очень узких экранах WhatsApp можно прятать, оставив в меню */
  .wa {
    display: none;
  }
}

@media (max-width: 420px) {
  .row {
    gap: 12px;
  }

  .logoMark {
    font-size: 18px;
  }

  .logoSub {
    font-size: 11px;
  }

  .lang {
    display: none; /* языки доступны в мобильном меню */
  }
}

```

---

## components/Header/Header.tsx

```typescript
"use client";

import { useEffect, useLayoutEffect, useMemo, useRef, useState } from "react";
import { usePathname, useRouter } from "next/navigation";
import styles from "./Header.module.css";
import { scrollToHash } from "@/utils/smoothScroll";

type NavItem = { id: string; label: string };

type HeaderProps = {
  lang: "en" | "es";
  t: {
    nav: Record<string, string>;
    menuTitle: string;
    whatsapp: string;
  };
};

export default function Header({ lang, t }: HeaderProps) {
  const router = useRouter();
  const pathname = usePathname();

  const nav: NavItem[] = useMemo(
    () => [
      { id: "home", label: t.nav.home },
      { id: "properties", label: t.nav.properties },
      { id: "services", label: t.nav.services },
      { id: "about", label: t.nav.about },
      { id: "contact", label: t.nav.contact },
    ],
    [t]
  );

  const HEADER_OFFSET = 90;

  const [activeId, setActiveId] = useState<string>("home");
  const [menuOpen, setMenuOpen] = useState(false);

  const navRef = useRef<HTMLElement | null>(null);
  const linkRefs = useRef<Record<string, HTMLAnchorElement | null>>({});
  const [indicator, setIndicator] = useState<{ left: number; width: number }>({
    left: 0,
    width: 0,
  });

  const closeMenu = () => setMenuOpen(false);

  const goTo = (id: string) => {
    setActiveId(id);
    closeMenu();
    scrollToHash(`#${id}`, { offset: HEADER_OFFSET });
  };

  // --- helpers for locale switch ---
  function buildLocalePath(nextLang: "en" | "es") {
    // pathname типа: /en или /es (и позже может быть /en/что-то)
    const parts = (pathname || "/").split("/");
    // ["", "en", ...]
    parts[1] = nextLang;
    const base = parts.join("/") || `/${nextLang}`;

    // сохраняем текущий hash секции (для one-page)
    const hash =
      typeof window !== "undefined"
        ? window.location.hash || `#${activeId}`
        : `#${activeId}`;

    return `${base}${hash}`;
  }

  function switchLang(nextLang: "en" | "es") {
    closeMenu();
    router.push(buildLocalePath(nextLang));
  }

  // 1) Active section picker
  useEffect(() => {
    const sections = nav
      .map((n) => document.getElementById(n.id))
      .filter(Boolean) as HTMLElement[];

    if (!sections.length) return;

    const PIVOT_PAD = 22;
    const MIN_SWITCH_MS = 260;

    let raf = 0;
    let lastId = activeId;
    let lastSwitchAt = 0;

    const pickActive = () => {
      const now = performance.now();
      const pivot = HEADER_OFFSET + PIVOT_PAD;

      let bestId = lastId;
      let bestScore = Number.POSITIVE_INFINITY;

      for (const el of sections) {
        const rect = el.getBoundingClientRect();
        const delta = rect.top - pivot;
        const score = delta < 0 ? Math.abs(delta) * 0.7 : Math.abs(delta) * 1.0;

        if (score < bestScore) {
          bestScore = score;
          bestId = el.id;
        }
      }

      if (bestId !== lastId && now - lastSwitchAt < MIN_SWITCH_MS) return;

      if (bestId !== lastId) {
        lastId = bestId;
        lastSwitchAt = now;
        setActiveId(bestId);
      }
    };

    const onScroll = () => {
      cancelAnimationFrame(raf);
      raf = requestAnimationFrame(pickActive);
    };

    window.addEventListener("scroll", onScroll, { passive: true });
    window.addEventListener("resize", onScroll);

    onScroll();

    return () => {
      cancelAnimationFrame(raf);
      window.removeEventListener("scroll", onScroll);
      window.removeEventListener("resize", onScroll);
    };
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [nav]);

  // 2) Desktop indicator
  const recalcIndicator = () => {
    const navEl = navRef.current;
    const linkEl = linkRefs.current[activeId];
    if (!navEl || !linkEl) return;

    const navBox = navEl.getBoundingClientRect();
    const linkBox = linkEl.getBoundingClientRect();

    const padding = 10;
    const left = linkBox.left - navBox.left + padding;
    const width = Math.max(18, linkBox.width - padding * 2);

    setIndicator({ left, width });
  };

  useLayoutEffect(() => {
    recalcIndicator();
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [activeId]);

  useEffect(() => {
    const onResize = () => recalcIndicator();
    window.addEventListener("resize", onResize);
    const tmr = window.setTimeout(recalcIndicator, 150);

    return () => {
      window.removeEventListener("resize", onResize);
      window.clearTimeout(tmr);
    };
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [activeId]);

  // 3) Lock body scroll when mobile menu open + close on ESC
  useEffect(() => {
    const onKeyDown = (e: KeyboardEvent) => {
      if (e.key === "Escape") closeMenu();
    };

    if (menuOpen) {
      document.body.style.overflow = "hidden";
      window.addEventListener("keydown", onKeyDown);
    } else {
      document.body.style.overflow = "";
      window.removeEventListener("keydown", onKeyDown);
    }

    return () => {
      document.body.style.overflow = "";
      window.removeEventListener("keydown", onKeyDown);
    };
  }, [menuOpen]);

  const onNavClick =
    (id: string) => (e: React.MouseEvent<HTMLAnchorElement>) => {
      e.preventDefault();
      goTo(id);
    };

  return (
    <header className={styles.header}>
      <div className={`container ${styles.row}`}>
        {/* Logo */}
        <div
          className={styles.logo}
          role="button"
          tabIndex={0}
          onClick={() => goTo("home")}
          onKeyDown={(e) => {
            if (e.key === "Enter" || e.key === " ") goTo("home");
          }}
        >
          <span className={styles.logoMark}>GRAHALIA</span>
          <span className={styles.logoSub}>ESTATES</span>
        </div>

        {/* Desktop nav */}
        <nav className={styles.nav} ref={(el) => (navRef.current = el)}>
          <span
            className={styles.indicator}
            style={{
              transform: `translateX(${indicator.left}px)`,
              width: `${indicator.width}px`,
            }}
            aria-hidden="true"
          />

          {nav.map((item) => (
            <a
              key={item.id}
              href={`#${item.id}`}
              onClick={onNavClick(item.id)}
              ref={(el) => {
                linkRefs.current[item.id] = el;
              }}
              className={`${styles.link} ${
                activeId === item.id ? styles.active : ""
              }`}
            >
              {item.label}
            </a>
          ))}
        </nav>

        {/* Right controls */}
        <div className={styles.right}>
          <div className={styles.lang}>
            <button
              className={styles.langBtn}
              type="button"
              aria-current={lang === "en" ? "page" : undefined}
              onClick={() => switchLang("en")}
            >
              EN
            </button>
            <span className={styles.sep}>|</span>
            <button
              className={styles.langBtn}
              type="button"
              aria-current={lang === "es" ? "page" : undefined}
              onClick={() => switchLang("es")}
            >
              ES
            </button>
          </div>

          <a
            className={`${styles.wa} btn btnPrimary`}
            href="https://wa.me/34123456789"
            target="_blank"
            rel="noreferrer"
          >
            {t.whatsapp}
          </a>

          {/* Burger (mobile) */}
          <button
            type="button"
            className={`${styles.burger} ${menuOpen ? styles.burgerOpen : ""}`}
            aria-label={menuOpen ? "Close menu" : "Open menu"}
            aria-expanded={menuOpen}
            aria-controls="mobile-menu"
            onClick={() => setMenuOpen((v) => !v)}
          >
            <span className={styles.burgerText}>
              {menuOpen ? "Close" : "Menu"}
            </span>

            <span className={styles.burgerLines} aria-hidden="true">
              <span />
              <span />
              <span />
            </span>
          </button>
        </div>
      </div>

      {/* Mobile menu overlay */}
      <div
        id="mobile-menu"
        className={`${styles.mobileOverlay} ${
          menuOpen ? styles.mobileOverlayOpen : ""
        }`}
        aria-hidden={!menuOpen}
        onClick={(e) => {
          if (e.target === e.currentTarget) closeMenu();
        }}
      >
        <div className={styles.mobilePanel}>
          <div className={styles.mobileTop}>
            <div className={styles.mobileTitle}>{t.menuTitle}</div>

            <button
              type="button"
              className={styles.mobileClose}
              aria-label="Close menu"
              onClick={closeMenu}
            >
              ✕
            </button>
          </div>

          <div className={styles.mobileLinks}>
            {nav.map((item) => (
              <a
                key={item.id}
                href={`#${item.id}`}
                className={`${styles.mobileLink} ${
                  activeId === item.id ? styles.mobileActive : ""
                }`}
                onClick={(e) => {
                  e.preventDefault();
                  goTo(item.id);
                }}
              >
                {item.label}
              </a>
            ))}
          </div>

          <div className={styles.mobileBottom}>
            <a
              className={`btn btnPrimary ${styles.mobileWa}`}
              href="https://wa.me/34123456789"
              target="_blank"
              rel="noreferrer"
              onClick={() => closeMenu()}
            >
              {t.whatsapp}
            </a>

            <div className={styles.mobileLang}>
              <button
                className={styles.langBtn}
                type="button"
                onClick={() => switchLang("en")}
              >
                EN
              </button>
              <span className={styles.sep}>|</span>
              <button
                className={styles.langBtn}
                type="button"
                onClick={() => switchLang("es")}
              >
                ES
              </button>
            </div>
          </div>
        </div>
      </div>
    </header>
  );
}

```

---

## components/Hero/Hero.module.css

```css
.hero {
  position: relative;
  overflow: hidden; /* важно */
  border-bottom: 1px solid rgba(226, 226, 222, 0.8);
  min-height: 520px;

  /* страховка против горизонтального скролла */
  width: 100%;
  max-width: 100%;
}

.inner {
  position: relative;
  z-index: 2;
  padding: 86px 0 78px;
}

.content {
  max-width: 720px;
}

.sub {
  margin-top: 14px;
  font-size: 16px;
}

.actions {
  display: flex;
  gap: 12px;
  margin-top: 26px;
  flex-wrap: wrap;
}

.ital {
  font-style: italic;
  font-weight: 500;
}

.bg {
  position: absolute;
  inset: 0;
  z-index: 1;

  /* важно: убираем transform: scale(1.02), он часто даёт вылезание */
  background-image:
    linear-gradient(
      90deg,
      rgba(246, 245, 242, 0.95) 0%,
      rgba(246, 245, 242, 0.72) 40%,
      rgba(246, 245, 242, 0.22) 72%,
      rgba(246, 245, 242, 0.06) 100%
    ),
    url("/hero.jpg");

  /* вместо scale — чуть “приблизим” через background-size */
  background-size: 102% auto;
  background-repeat: no-repeat;
  background-position: center;

  /* страховка */
  width: 100%;
  max-width: 100%;
}

.fade {
  position: absolute;
  left: 0;
  right: 0;
  bottom: 0;
  height: 120px;
  z-index: 2; /* чтобы лежало поверх фона */
  background: linear-gradient(to bottom, rgba(246, 245, 242, 0), var(--bg));
}

@media (max-width: 720px) {
  .inner {
    padding: 64px 0 56px;
  }

  .hero {
    min-height: 520px;
  }

  /* на мобилке фон лучше делать cover, чтобы не было артефактов */
  .bg {
    background-size: cover;
    background-position: 70% center; /* лёгкий сдвиг вправо, чтобы дом был виднее */
  }
}

```

---

## components/Hero/Hero.tsx

```typescript
"use client";

import styles from "./Hero.module.css";
import { scrollToHash } from "@/utils/smoothScroll";

type HeroDict = {
  titleA: string;
  titleB: string;
  subtitle: string;
  ctaPrimary: string;
  ctaSecondary: string;
};

export default function Hero({ t }: { t: HeroDict }) {
  const OFFSET = 90;

  return (
    <section id="home" className={styles.hero}>
      <div className={`container ${styles.inner}`}>
        <div className={styles.content}>
          <h1 className="h1">
            {t.titleA} <span className={styles.ital}>{t.titleB}</span>
          </h1>

          <p className={`p ${styles.sub}`}>{t.subtitle}</p>

          <div className={styles.actions}>
            <a
              className="btn btnPrimary"
              href="#properties"
              onClick={(e) => {
                e.preventDefault();
                scrollToHash("#properties", { offset: OFFSET });
              }}
            >
              {t.ctaPrimary}
            </a>

            <a
              className="btn btnGhost"
              href="#contact"
              onClick={(e) => {
                e.preventDefault();
                scrollToHash("#contact", { offset: OFFSET });
              }}
            >
              {t.ctaSecondary}
            </a>
          </div>
        </div>
      </div>

      <div className={styles.bg} aria-hidden="true" />
      <div className={styles.fade} aria-hidden="true" />
    </section>
  );
}

```

---

## components/PropertyCard/PropertyCard.module.css

```css
.card {
  background: rgba(255, 255, 255, 0.72);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  overflow: hidden;
  box-shadow: var(--shadow);
  display: flex;
  flex-direction: column;
  transition: transform 0.16s ease, box-shadow 0.16s ease;
}

.card:hover {
  transform: translateY(-2px);
  box-shadow: 0 14px 36px rgba(0, 0, 0, 0.08);
}

.imageWrap {
  position: relative;
  width: 100%;
  aspect-ratio: 16 / 10;
  overflow: hidden;
  background: #eee;
}

.image {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}

.body {
  padding: 18px 18px 16px;
}

.title {
  margin: 0;
  font-family: var(--font-playfair), Georgia, "Times New Roman", serif;
  font-size: 18px;
  line-height: 1.2;
}

.meta {
  margin-top: 6px;
  color: var(--muted);
  font-size: 13px;
}

.price {
  margin-top: 10px;
  font-weight: 700;
  color: var(--accent);
  font-size: 15px;
}

.specs {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: 8px;
  margin-top: 10px;
  color: rgba(28, 28, 28, 0.75);
  font-size: 13px;
}

.specItem {
  white-space: nowrap;
}

.dot {
  opacity: 0.4;
}

.btn {
  margin-top: 14px;
  width: fit-content;
  padding: 10px 14px;
  border-radius: 4px;
  text-decoration: none;
}


```

---

## components/PropertyCard/PropertyCard.tsx

```typescript
"use client";

import { scrollToHash } from "@/utils/smoothScroll";
import styles from "./PropertyCard.module.css";

type Property = {
  title: string;
  location: string;
  price: string;
  beds: number;
  baths: number;
  area: number;
  image: string;
};

type CardT = {
  beds: string;
  baths: string;
  details: string;
};

export default function PropertyCard({
  property,
  t,
}: {
  property: Property;
  t: CardT;
}) {
  return (
    <article className={styles.card}>
      <div className={styles.imageWrap}>
        <img
          className={styles.image}
          src={property.image}
          alt={property.title}
          loading="lazy"
        />
      </div>

      <div className={styles.body}>
        <h3 className={styles.title}>{property.title}</h3>
        <div className={styles.meta}>{property.location}</div>

        <div className={styles.price}>{property.price}</div>

        <div className={styles.specs}>
          <span className={styles.specItem}>
            🛏 {property.beds} {t.beds}
          </span>
          <span className={styles.dot}>•</span>
          <span className={styles.specItem}>
            🛁 {property.baths} {t.baths}
          </span>
          <span className={styles.dot}>•</span>
          <span className={styles.specItem}>📐 {property.area} m²</span>
        </div>

        <a
          className={`btn btnPrimary ${styles.btn}`}
          href="#contact"
          onClick={(e) => {
            e.preventDefault();
            scrollToHash("#contact", { offset: 90 });
          }}
        >
          {t.details}
        </a>
      </div>
    </article>
  );
}

```

---

## components/Services/Services.module.css

```css
.section {
  padding: 72px 0;
  border-top: 1px solid rgba(226, 226, 222, 0.8);
}

.head {
  margin-bottom: 18px;
}

.grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 18px;
  margin-top: 16px;
}

.card {
  background: rgba(255, 255, 255, 0.72);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  padding: 18px 18px;
  display: flex;
  gap: 12px;
  align-items: flex-start;
  transition: transform 0.16s ease, box-shadow 0.16s ease;
}

.card:hover {
  transform: translateY(-2px);
  box-shadow: 0 14px 36px rgba(0, 0, 0, 0.08);
}

.icon {
  width: 44px;
  height: 44px;
  border-radius: 12px;
  background: rgba(14, 94, 86, 0.08);
  display: grid;
  place-items: center;
  font-size: 20px;
  flex: 0 0 auto;
}

.title {
  font-weight: 700;
  font-size: 15px;
}

.text {
  margin-top: 6px;
  color: var(--muted);
  font-size: 13px;
  line-height: 1.5;
}

@media (max-width: 960px) {
  .grid {
    grid-template-columns: 1fr;
  }
}

```

---

## components/Services/Services.tsx

```typescript
"use client";

import styles from "./Services.module.css";

type ServicesDict = {
  title: string;
  subtitle: string;
  items: {
    title: string;
    text: string;
    icon: string;
  }[];
};

export default function Services({ t }: { t: ServicesDict }) {
  return (
    <section id="services" className={`section ${styles.section}`}>
      <div className="container">
        {/* Центрированный заголовок + линии, как в макете */}
        <div className="section__head">
          <h2 className="sectionTitle">
            <span className="sectionTitleText">{t.title}</span>
          </h2>
          <p className="section__kicker">{t.subtitle}</p>
        </div>

        <div className={styles.grid}>
          {t.items.map((s) => (
            <div key={s.title} className={styles.card}>
              <div className={styles.icon}>{s.icon}</div>

              <div className={styles.content}>
                <div className={styles.title}>{s.title}</div>
                <div className={styles.text}>{s.text}</div>
              </div>
            </div>
          ))}
        </div>
      </div>
    </section>
  );
}

```

---

## db/index.ts

```typescript
// db/index.ts
import { drizzle } from "drizzle-orm/node-postgres";
import { Pool } from "pg";

const connectionString = process.env.DATABASE_URL;
if (!connectionString) {
  throw new Error("DATABASE_URL is not set");
}

declare global {
  // eslint-disable-next-line no-var
  var __grahaliaPool: Pool | undefined;
}

const pool =
  global.__grahaliaPool ??
  new Pool({
    connectionString,
  });

global.__grahaliaPool = pool;

export const db = drizzle(pool);

```

---

## db/migrations/0000_square_stark_industries.sql

```sql
CREATE TABLE "feature_translations" (
	"id" serial PRIMARY KEY NOT NULL,
	"feature_id" integer NOT NULL,
	"lang" varchar(2) NOT NULL,
	"label" varchar(120) NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
CREATE TABLE "features" (
	"id" serial PRIMARY KEY NOT NULL,
	"key" varchar(80) NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
CREATE TABLE "properties" (
	"id" serial PRIMARY KEY NOT NULL,
	"slug" varchar(120) NOT NULL,
	"is_published" boolean DEFAULT false NOT NULL,
	"price" numeric(12, 2),
	"currency" varchar(3) DEFAULT 'EUR' NOT NULL,
	"bedrooms" integer,
	"bathrooms" integer,
	"area_m2" integer,
	"location" varchar(120),
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
CREATE TABLE "property_features" (
	"property_id" integer NOT NULL,
	"feature_id" integer NOT NULL,
	CONSTRAINT "property_features_property_id_feature_id_pk" PRIMARY KEY("property_id","feature_id")
);
--> statement-breakpoint
CREATE TABLE "property_images" (
	"id" serial PRIMARY KEY NOT NULL,
	"property_id" integer NOT NULL,
	"url" text NOT NULL,
	"alt" varchar(200),
	"sort_order" integer DEFAULT 0 NOT NULL,
	"is_cover" boolean DEFAULT false NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
CREATE TABLE "property_translations" (
	"id" serial PRIMARY KEY NOT NULL,
	"property_id" integer NOT NULL,
	"lang" varchar(2) NOT NULL,
	"title" varchar(200) NOT NULL,
	"summary" varchar(300),
	"description" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
ALTER TABLE "feature_translations" ADD CONSTRAINT "feature_translations_feature_id_features_id_fk" FOREIGN KEY ("feature_id") REFERENCES "public"."features"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "property_features" ADD CONSTRAINT "property_features_property_id_properties_id_fk" FOREIGN KEY ("property_id") REFERENCES "public"."properties"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "property_features" ADD CONSTRAINT "property_features_feature_id_features_id_fk" FOREIGN KEY ("feature_id") REFERENCES "public"."features"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "property_images" ADD CONSTRAINT "property_images_property_id_properties_id_fk" FOREIGN KEY ("property_id") REFERENCES "public"."properties"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "property_translations" ADD CONSTRAINT "property_translations_property_id_properties_id_fk" FOREIGN KEY ("property_id") REFERENCES "public"."properties"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
CREATE UNIQUE INDEX "feature_translations_feature_lang_unique" ON "feature_translations" USING btree ("feature_id","lang");--> statement-breakpoint
CREATE UNIQUE INDEX "features_key_unique" ON "features" USING btree ("key");--> statement-breakpoint
CREATE UNIQUE INDEX "properties_slug_unique" ON "properties" USING btree ("slug");--> statement-breakpoint
CREATE UNIQUE INDEX "property_images_property_sort_unique" ON "property_images" USING btree ("property_id","sort_order");--> statement-breakpoint
CREATE UNIQUE INDEX "property_translations_property_lang_unique" ON "property_translations" USING btree ("property_id","lang");
```

---

## db/migrations/0001_sleepy_agent_brand.sql

```sql
ALTER TABLE "properties" ADD COLUMN "plot_area_m2" integer;--> statement-breakpoint
ALTER TABLE "properties" ADD COLUMN "built_area_m2" integer;--> statement-breakpoint
ALTER TABLE "properties" ADD COLUMN "terrace_area_m2" integer;--> statement-breakpoint
ALTER TABLE "properties" ADD COLUMN "plans_url" text;--> statement-breakpoint
ALTER TABLE "properties" DROP COLUMN "area_m2";
```

---

## db/migrations/0002_steep_lady_vermin.sql

```sql
ALTER TABLE "properties" ALTER COLUMN "slug" SET DATA TYPE varchar(255);
```

---

## db/migrations/meta/0000_snapshot.json

```json
{
  "id": "ea2ff403-1244-4331-9472-6738058293de",
  "prevId": "00000000-0000-0000-0000-000000000000",
  "version": "7",
  "dialect": "postgresql",
  "tables": {
    "public.feature_translations": {
      "name": "feature_translations",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "feature_id": {
          "name": "feature_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "lang": {
          "name": "lang",
          "type": "varchar(2)",
          "primaryKey": false,
          "notNull": true
        },
        "label": {
          "name": "label",
          "type": "varchar(120)",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "feature_translations_feature_lang_unique": {
          "name": "feature_translations_feature_lang_unique",
          "columns": [
            {
              "expression": "feature_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "lang",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "feature_translations_feature_id_features_id_fk": {
          "name": "feature_translations_feature_id_features_id_fk",
          "tableFrom": "feature_translations",
          "tableTo": "features",
          "columnsFrom": [
            "feature_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.features": {
      "name": "features",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "key": {
          "name": "key",
          "type": "varchar(80)",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "features_key_unique": {
          "name": "features_key_unique",
          "columns": [
            {
              "expression": "key",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.properties": {
      "name": "properties",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "slug": {
          "name": "slug",
          "type": "varchar(120)",
          "primaryKey": false,
          "notNull": true
        },
        "is_published": {
          "name": "is_published",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true,
          "default": false
        },
        "price": {
          "name": "price",
          "type": "numeric(12, 2)",
          "primaryKey": false,
          "notNull": false
        },
        "currency": {
          "name": "currency",
          "type": "varchar(3)",
          "primaryKey": false,
          "notNull": true,
          "default": "'EUR'"
        },
        "bedrooms": {
          "name": "bedrooms",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "bathrooms": {
          "name": "bathrooms",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "area_m2": {
          "name": "area_m2",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "location": {
          "name": "location",
          "type": "varchar(120)",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "properties_slug_unique": {
          "name": "properties_slug_unique",
          "columns": [
            {
              "expression": "slug",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.property_features": {
      "name": "property_features",
      "schema": "",
      "columns": {
        "property_id": {
          "name": "property_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "feature_id": {
          "name": "feature_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "property_features_property_id_properties_id_fk": {
          "name": "property_features_property_id_properties_id_fk",
          "tableFrom": "property_features",
          "tableTo": "properties",
          "columnsFrom": [
            "property_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        },
        "property_features_feature_id_features_id_fk": {
          "name": "property_features_feature_id_features_id_fk",
          "tableFrom": "property_features",
          "tableTo": "features",
          "columnsFrom": [
            "feature_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {
        "property_features_property_id_feature_id_pk": {
          "name": "property_features_property_id_feature_id_pk",
          "columns": [
            "property_id",
            "feature_id"
          ]
        }
      },
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.property_images": {
      "name": "property_images",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "property_id": {
          "name": "property_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "url": {
          "name": "url",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "alt": {
          "name": "alt",
          "type": "varchar(200)",
          "primaryKey": false,
          "notNull": false
        },
        "sort_order": {
          "name": "sort_order",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "is_cover": {
          "name": "is_cover",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true,
          "default": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "property_images_property_sort_unique": {
          "name": "property_images_property_sort_unique",
          "columns": [
            {
              "expression": "property_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "sort_order",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "property_images_property_id_properties_id_fk": {
          "name": "property_images_property_id_properties_id_fk",
          "tableFrom": "property_images",
          "tableTo": "properties",
          "columnsFrom": [
            "property_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.property_translations": {
      "name": "property_translations",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "property_id": {
          "name": "property_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "lang": {
          "name": "lang",
          "type": "varchar(2)",
          "primaryKey": false,
          "notNull": true
        },
        "title": {
          "name": "title",
          "type": "varchar(200)",
          "primaryKey": false,
          "notNull": true
        },
        "summary": {
          "name": "summary",
          "type": "varchar(300)",
          "primaryKey": false,
          "notNull": false
        },
        "description": {
          "name": "description",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "property_translations_property_lang_unique": {
          "name": "property_translations_property_lang_unique",
          "columns": [
            {
              "expression": "property_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "lang",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "property_translations_property_id_properties_id_fk": {
          "name": "property_translations_property_id_properties_id_fk",
          "tableFrom": "property_translations",
          "tableTo": "properties",
          "columnsFrom": [
            "property_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    }
  },
  "enums": {},
  "schemas": {},
  "sequences": {},
  "roles": {},
  "policies": {},
  "views": {},
  "_meta": {
    "columns": {},
    "schemas": {},
    "tables": {}
  }
}
```

---

## db/migrations/meta/0001_snapshot.json

```json
{
  "id": "017fd64b-ec5e-4a5d-bfb5-cd11e2150473",
  "prevId": "ea2ff403-1244-4331-9472-6738058293de",
  "version": "7",
  "dialect": "postgresql",
  "tables": {
    "public.feature_translations": {
      "name": "feature_translations",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "feature_id": {
          "name": "feature_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "lang": {
          "name": "lang",
          "type": "varchar(2)",
          "primaryKey": false,
          "notNull": true
        },
        "label": {
          "name": "label",
          "type": "varchar(120)",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "feature_translations_feature_lang_unique": {
          "name": "feature_translations_feature_lang_unique",
          "columns": [
            {
              "expression": "feature_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "lang",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "feature_translations_feature_id_features_id_fk": {
          "name": "feature_translations_feature_id_features_id_fk",
          "tableFrom": "feature_translations",
          "tableTo": "features",
          "columnsFrom": [
            "feature_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.features": {
      "name": "features",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "key": {
          "name": "key",
          "type": "varchar(80)",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "features_key_unique": {
          "name": "features_key_unique",
          "columns": [
            {
              "expression": "key",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.properties": {
      "name": "properties",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "slug": {
          "name": "slug",
          "type": "varchar(120)",
          "primaryKey": false,
          "notNull": true
        },
        "is_published": {
          "name": "is_published",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true,
          "default": false
        },
        "price": {
          "name": "price",
          "type": "numeric(12, 2)",
          "primaryKey": false,
          "notNull": false
        },
        "currency": {
          "name": "currency",
          "type": "varchar(3)",
          "primaryKey": false,
          "notNull": true,
          "default": "'EUR'"
        },
        "bedrooms": {
          "name": "bedrooms",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "bathrooms": {
          "name": "bathrooms",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "plot_area_m2": {
          "name": "plot_area_m2",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "built_area_m2": {
          "name": "built_area_m2",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "terrace_area_m2": {
          "name": "terrace_area_m2",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "location": {
          "name": "location",
          "type": "varchar(120)",
          "primaryKey": false,
          "notNull": false
        },
        "plans_url": {
          "name": "plans_url",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "properties_slug_unique": {
          "name": "properties_slug_unique",
          "columns": [
            {
              "expression": "slug",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.property_features": {
      "name": "property_features",
      "schema": "",
      "columns": {
        "property_id": {
          "name": "property_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "feature_id": {
          "name": "feature_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "property_features_property_id_properties_id_fk": {
          "name": "property_features_property_id_properties_id_fk",
          "tableFrom": "property_features",
          "tableTo": "properties",
          "columnsFrom": [
            "property_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        },
        "property_features_feature_id_features_id_fk": {
          "name": "property_features_feature_id_features_id_fk",
          "tableFrom": "property_features",
          "tableTo": "features",
          "columnsFrom": [
            "feature_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {
        "property_features_property_id_feature_id_pk": {
          "name": "property_features_property_id_feature_id_pk",
          "columns": [
            "property_id",
            "feature_id"
          ]
        }
      },
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.property_images": {
      "name": "property_images",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "property_id": {
          "name": "property_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "url": {
          "name": "url",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "alt": {
          "name": "alt",
          "type": "varchar(200)",
          "primaryKey": false,
          "notNull": false
        },
        "sort_order": {
          "name": "sort_order",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "is_cover": {
          "name": "is_cover",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true,
          "default": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "property_images_property_sort_unique": {
          "name": "property_images_property_sort_unique",
          "columns": [
            {
              "expression": "property_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "sort_order",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "property_images_property_id_properties_id_fk": {
          "name": "property_images_property_id_properties_id_fk",
          "tableFrom": "property_images",
          "tableTo": "properties",
          "columnsFrom": [
            "property_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.property_translations": {
      "name": "property_translations",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "property_id": {
          "name": "property_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "lang": {
          "name": "lang",
          "type": "varchar(2)",
          "primaryKey": false,
          "notNull": true
        },
        "title": {
          "name": "title",
          "type": "varchar(200)",
          "primaryKey": false,
          "notNull": true
        },
        "summary": {
          "name": "summary",
          "type": "varchar(300)",
          "primaryKey": false,
          "notNull": false
        },
        "description": {
          "name": "description",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "property_translations_property_lang_unique": {
          "name": "property_translations_property_lang_unique",
          "columns": [
            {
              "expression": "property_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "lang",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "property_translations_property_id_properties_id_fk": {
          "name": "property_translations_property_id_properties_id_fk",
          "tableFrom": "property_translations",
          "tableTo": "properties",
          "columnsFrom": [
            "property_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    }
  },
  "enums": {},
  "schemas": {},
  "sequences": {},
  "roles": {},
  "policies": {},
  "views": {},
  "_meta": {
    "columns": {},
    "schemas": {},
    "tables": {}
  }
}
```

---

## db/migrations/meta/0002_snapshot.json

```json
{
  "id": "d73d6116-c88c-4065-bb9c-49c8e70f9647",
  "prevId": "017fd64b-ec5e-4a5d-bfb5-cd11e2150473",
  "version": "7",
  "dialect": "postgresql",
  "tables": {
    "public.feature_translations": {
      "name": "feature_translations",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "feature_id": {
          "name": "feature_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "lang": {
          "name": "lang",
          "type": "varchar(2)",
          "primaryKey": false,
          "notNull": true
        },
        "label": {
          "name": "label",
          "type": "varchar(120)",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "feature_translations_feature_lang_unique": {
          "name": "feature_translations_feature_lang_unique",
          "columns": [
            {
              "expression": "feature_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "lang",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "feature_translations_feature_id_features_id_fk": {
          "name": "feature_translations_feature_id_features_id_fk",
          "tableFrom": "feature_translations",
          "tableTo": "features",
          "columnsFrom": [
            "feature_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.features": {
      "name": "features",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "key": {
          "name": "key",
          "type": "varchar(80)",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "features_key_unique": {
          "name": "features_key_unique",
          "columns": [
            {
              "expression": "key",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.properties": {
      "name": "properties",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "slug": {
          "name": "slug",
          "type": "varchar(255)",
          "primaryKey": false,
          "notNull": true
        },
        "is_published": {
          "name": "is_published",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true,
          "default": false
        },
        "price": {
          "name": "price",
          "type": "numeric(12, 2)",
          "primaryKey": false,
          "notNull": false
        },
        "currency": {
          "name": "currency",
          "type": "varchar(3)",
          "primaryKey": false,
          "notNull": true,
          "default": "'EUR'"
        },
        "bedrooms": {
          "name": "bedrooms",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "bathrooms": {
          "name": "bathrooms",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "plot_area_m2": {
          "name": "plot_area_m2",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "built_area_m2": {
          "name": "built_area_m2",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "terrace_area_m2": {
          "name": "terrace_area_m2",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "location": {
          "name": "location",
          "type": "varchar(120)",
          "primaryKey": false,
          "notNull": false
        },
        "plans_url": {
          "name": "plans_url",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "properties_slug_unique": {
          "name": "properties_slug_unique",
          "columns": [
            {
              "expression": "slug",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.property_features": {
      "name": "property_features",
      "schema": "",
      "columns": {
        "property_id": {
          "name": "property_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "feature_id": {
          "name": "feature_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "property_features_property_id_properties_id_fk": {
          "name": "property_features_property_id_properties_id_fk",
          "tableFrom": "property_features",
          "tableTo": "properties",
          "columnsFrom": [
            "property_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        },
        "property_features_feature_id_features_id_fk": {
          "name": "property_features_feature_id_features_id_fk",
          "tableFrom": "property_features",
          "tableTo": "features",
          "columnsFrom": [
            "feature_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {
        "property_features_property_id_feature_id_pk": {
          "name": "property_features_property_id_feature_id_pk",
          "columns": [
            "property_id",
            "feature_id"
          ]
        }
      },
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.property_images": {
      "name": "property_images",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "property_id": {
          "name": "property_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "url": {
          "name": "url",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "alt": {
          "name": "alt",
          "type": "varchar(200)",
          "primaryKey": false,
          "notNull": false
        },
        "sort_order": {
          "name": "sort_order",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "is_cover": {
          "name": "is_cover",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true,
          "default": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "property_images_property_sort_unique": {
          "name": "property_images_property_sort_unique",
          "columns": [
            {
              "expression": "property_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "sort_order",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "property_images_property_id_properties_id_fk": {
          "name": "property_images_property_id_properties_id_fk",
          "tableFrom": "property_images",
          "tableTo": "properties",
          "columnsFrom": [
            "property_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.property_translations": {
      "name": "property_translations",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "property_id": {
          "name": "property_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "lang": {
          "name": "lang",
          "type": "varchar(2)",
          "primaryKey": false,
          "notNull": true
        },
        "title": {
          "name": "title",
          "type": "varchar(200)",
          "primaryKey": false,
          "notNull": true
        },
        "summary": {
          "name": "summary",
          "type": "varchar(300)",
          "primaryKey": false,
          "notNull": false
        },
        "description": {
          "name": "description",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "property_translations_property_lang_unique": {
          "name": "property_translations_property_lang_unique",
          "columns": [
            {
              "expression": "property_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "lang",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "property_translations_property_id_properties_id_fk": {
          "name": "property_translations_property_id_properties_id_fk",
          "tableFrom": "property_translations",
          "tableTo": "properties",
          "columnsFrom": [
            "property_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    }
  },
  "enums": {},
  "schemas": {},
  "sequences": {},
  "roles": {},
  "policies": {},
  "views": {},
  "_meta": {
    "columns": {},
    "schemas": {},
    "tables": {}
  }
}
```

---

## db/migrations/meta/_journal.json

```json
{
  "version": "7",
  "dialect": "postgresql",
  "entries": [
    {
      "idx": 0,
      "version": "7",
      "when": 1768656408753,
      "tag": "0000_square_stark_industries",
      "breakpoints": true
    },
    {
      "idx": 1,
      "version": "7",
      "when": 1768660088691,
      "tag": "0001_sleepy_agent_brand",
      "breakpoints": true
    },
    {
      "idx": 2,
      "version": "7",
      "when": 1768677392854,
      "tag": "0002_steep_lady_vermin",
      "breakpoints": true
    }
  ]
}
```

---

## db/schema.ts

```typescript
import {
  pgTable,
  serial,
  integer,
  varchar,
  text,
  boolean,
  numeric,
  timestamp,
  primaryKey,
  uniqueIndex,
} from "drizzle-orm/pg-core";

// 1) Ограничиваем языки: только те, что есть в проекте
export const localeEnumValues = ["en", "es"] as const;
export type Locale = (typeof localeEnumValues)[number];

// --------------------
// PROPERTIES (основа)
// --------------------
export const properties = pgTable(
  "properties",
  {
    id: serial("id").primaryKey(),

    // slug для URL: /[lang]/properties/[slug]
    slug: varchar("slug", { length: 255 }).notNull(),

    // статус публикации
    isPublished: boolean("is_published").notNull().default(false),

    // цена
    price: numeric("price", { precision: 12, scale: 2 }),
    currency: varchar("currency", { length: 3 }).notNull().default("EUR"),

    // базовые характеристики
    bedrooms: integer("bedrooms"),
    bathrooms: integer("bathrooms"),

    // Площади (в м2). Все nullable — если не заполнено, не показываем на сайте.
    // Общая площадь участка (для домов/вилл)
    plotAreaM2: integer("plot_area_m2"),

    // Площадь застройки (built area)
    builtAreaM2: integer("built_area_m2"),

    // Площадь террас
    terraceAreaM2: integer("terrace_area_m2"),

    // Локация (на старте одной строкой)
    location: varchar("location", { length: 120 }),

    // Планы объекта (PDF или похожее) — храним путь/URL
    plansUrl: text("plans_url"),

    createdAt: timestamp("created_at", { withTimezone: true }).notNull().defaultNow(),
    updatedAt: timestamp("updated_at", { withTimezone: true }).notNull().defaultNow(),
  },
  (t) => ({
    slugUnique: uniqueIndex("properties_slug_unique").on(t.slug),
  })
);

// -------------------------------
// PROPERTY TRANSLATIONS (i18n)
// -------------------------------
export const propertyTranslations = pgTable(
  "property_translations",
  {
    id: serial("id").primaryKey(),
    propertyId: integer("property_id")
      .notNull()
      .references(() => properties.id, { onDelete: "cascade" }),

    lang: varchar("lang", { length: 2 }).notNull(), // "en" | "es"

    title: varchar("title", { length: 200 }).notNull(),
    summary: varchar("summary", { length: 300 }), // короткий текст для карточки
    description: text("description"), // подробное описание

    createdAt: timestamp("created_at", { withTimezone: true }).notNull().defaultNow(),
    updatedAt: timestamp("updated_at", { withTimezone: true }).notNull().defaultNow(),
  },
  (t) => ({
    // одно описание на язык для одного объекта
    uniqPerLang: uniqueIndex("property_translations_property_lang_unique").on(t.propertyId, t.lang),
  })
);

// --------------------
// FEATURES (удобства)
// --------------------
export const features = pgTable(
  "features",
  {
    id: serial("id").primaryKey(),

    // системный ключ (удобно для сортировки/внутреннего использования)
    key: varchar("key", { length: 80 }).notNull(),

    createdAt: timestamp("created_at", { withTimezone: true }).notNull().defaultNow(),
  },
  (t) => ({
    keyUnique: uniqueIndex("features_key_unique").on(t.key),
  })
);

export const featureTranslations = pgTable(
  "feature_translations",
  {
    id: serial("id").primaryKey(),
    featureId: integer("feature_id")
      .notNull()
      .references(() => features.id, { onDelete: "cascade" }),

    lang: varchar("lang", { length: 2 }).notNull(), // "en" | "es"
    label: varchar("label", { length: 120 }).notNull(),

    createdAt: timestamp("created_at", { withTimezone: true }).notNull().defaultNow(),
  },
  (t) => ({
    uniqPerLang: uniqueIndex("feature_translations_feature_lang_unique").on(t.featureId, t.lang),
  })
);

// связь many-to-many: property <-> feature
export const propertyFeatures = pgTable(
  "property_features",
  {
    propertyId: integer("property_id")
      .notNull()
      .references(() => properties.id, { onDelete: "cascade" }),

    featureId: integer("feature_id")
      .notNull()
      .references(() => features.id, { onDelete: "cascade" }),
  },
  (t) => ({
    pk: primaryKey({ columns: [t.propertyId, t.featureId] }),
  })
);

// --------------------
// IMAGES (галерея)
// --------------------
export const propertyImages = pgTable(
  "property_images",
  {
    id: serial("id").primaryKey(),
    propertyId: integer("property_id")
      .notNull()
      .references(() => properties.id, { onDelete: "cascade" }),

    // путь или URL (мы будем хранить относительный путь типа /uploads/...)
    url: text("url").notNull(),

    // alt на будущее (можно тоже сделать переводимым, но пока достаточно)
    alt: varchar("alt", { length: 200 }),

    // порядок в галерее
    sortOrder: integer("sort_order").notNull().default(0),

    // обложка для карточки
    isCover: boolean("is_cover").notNull().default(false),

    createdAt: timestamp("created_at", { withTimezone: true }).notNull().defaultNow(),
  },
  (t) => ({
    byProperty: uniqueIndex("property_images_property_sort_unique").on(t.propertyId, t.sortOrder),
  })
);

```

---

## docker-compose.yml

```yaml
services:
  db:
    image: postgres:16
    container_name: grahalia_postgres
    restart: unless-stopped
    environment:
      POSTGRES_USER: grahalia
      POSTGRES_PASSWORD: grahalia_password
      POSTGRES_DB: grahalia_db
    ports:
      - "5433:5432"
    volumes:
      - grahalia_pgdata:/var/lib/postgresql/data

volumes:
  grahalia_pgdata:

```

---

## drizzle.config.ts

```typescript
import { defineConfig } from "drizzle-kit";

export default defineConfig({
  schema: "./db/schema.ts",
  out: "./db/migrations",
  dialect: "postgresql",
  dbCredentials: {
    url: process.env.DATABASE_URL!,
  },
});

```

---

## eslint.config.mjs

```javascript
import { defineConfig, globalIgnores } from "eslint/config";
import nextVitals from "eslint-config-next/core-web-vitals";
import nextTs from "eslint-config-next/typescript";

const eslintConfig = defineConfig([
  ...nextVitals,
  ...nextTs,
  // Override default ignores of eslint-config-next.
  globalIgnores([
    // Default ignores of eslint-config-next:
    ".next/**",
    "out/**",
    "build/**",
    "next-env.d.ts",
  ]),
]);

export default eslintConfig;

```

---

## i18n/dictionaries.ts

```typescript
export const locales = ["en", "es"] as const;
export type Locale = (typeof locales)[number];

export function isLocale(v: string): v is Locale {
  return (locales as readonly string[]).includes(v);
}

type Dict = Record<string, any>;

// Явная карта импортов — Turbopack это любит, и не глючит
const loaders: Record<Locale, () => Promise<Dict>> = {
  en: async () => (await import("./en.json")).default,
  es: async () => (await import("./es.json")).default,
};

export async function getDictionary(locale: Locale) {
  return loaders[locale]();
}

```

---

## i18n/en.json

```json
{
  "header": {
    "nav": {
      "home": "Home",
      "properties": "Properties",
      "services": "Services",
      "about": "About",
      "contact": "Contact"
    },
    "menuTitle": "Menu",
    "whatsapp": "WhatsApp"
  },
  "hero": {
    "titleA": "Find Your Dream Home",
    "titleB": "in Spain",
    "subtitle": "Luxury Properties for Sale & Investment",
    "ctaPrimary": "View Properties",
    "ctaSecondary": "Contact Us"
  },
  "featured": {
    "title": "Featured Properties",
    "subtitle": "Explore our latest listings",
    "cta": "View All Properties",
    "card": {
      "beds": "Beds",
      "baths": "Baths",
      "details": "View Details"
    }
  },
  "services": {
    "title": "Our Services",
    "subtitle": "Personalized real estate solutions",
    "items": [
      { "title": "Property Sales", "text": "Helping you find the perfect home.", "icon": "🏡" },
      { "title": "Investment Consulting", "text": "Expert advice on profitable investments.", "icon": "📈" },
      { "title": "Legal Assistance", "text": "Full support with legal and paperwork.", "icon": "📄" }
    ]
  },
  "about": {
    "title": "About Us",
    "subtitle": "Your Trusted Real Estate Partner in Spain",
    "body": "We provide exceptional service and expert local knowledge to help you find your ideal property on the Costa del Sol. From selecting the right area to negotiating and paperwork, we guide you through every step — clearly and professionally.",
    "cta": "Learn More"
  },
  "contact": {
    "title": "Get in Touch",
    "subtitle": "Ready to find your dream home?",
    "form": {
      "name": "Your Name",
      "phone": "Phone",
      "email": "Email",
      "message": "Message",
      "send": "Send Message",
      "namePlaceholder": "Name",
      "phonePlaceholder": "+34 ...",
      "emailPlaceholder": "you@email.com",
      "messagePlaceholder": "Tell us what you are looking for..."
    },
    "info": {
      "title": "Contact",
      "whatsapp": "WhatsApp Us",
      "note": "We typically reply within a few hours during business days."
    },
    "footerRights": "All rights reserved"
  },
  "seo": {
    "siteName": "Grahalia Estates",
    "home": {
      "title": "Grahalia Estates — Real Estate on Costa del Sol",
      "description": "Warm, minimal real estate agency landing. Find properties and request details.",
      "ogTitle": "Grahalia Estates — Real Estate on Costa del Sol",
      "ogDescription": "Warm, minimal real estate agency landing. Find properties and request details."
    }
  }
}

```

---

## i18n/es.json

```json
{
  "header": {
    "nav": {
      "home": "Inicio",
      "properties": "Propiedades",
      "services": "Servicios",
      "about": "Sobre nosotros",
      "contact": "Contacto"
    },
    "menuTitle": "Menú",
    "whatsapp": "WhatsApp"
  },
  "hero": {
    "titleA": "Encuentra tu casa soñada",
    "titleB": "en España",
    "subtitle": "Propiedades de lujo en venta e inversión",
    "ctaPrimary": "Ver propiedades",
    "ctaSecondary": "Contáctanos"
  },
  "featured": {
    "title": "Propiedades destacadas",
    "subtitle": "Descubre nuestras últimas novedades",
    "cta": "Ver todas las propiedades",
    "card": {
      "beds": "Habitaciones",
      "baths": "Baños",
      "details": "Ver detalles"
    }
  },
  "services": {
    "title": "Nuestros servicios",
    "subtitle": "Soluciones inmobiliarias personalizadas",
    "items": [
      { "title": "Venta de propiedades", "text": "Te ayudamos a encontrar la casa perfecta.", "icon": "🏡" },
      { "title": "Consultoría de inversión", "text": "Asesoramiento experto en inversiones rentables.", "icon": "📈" },
      { "title": "Asesoramiento legal", "text": "Gestión completa de trámites y documentación.", "icon": "📄" }
    ]
  },
  "about": {
    "title": "Sobre nosotros",
    "subtitle": "Tu agencia inmobiliaria de confianza en la Costa del Sol",
    "body": "Ofrecemos un servicio excepcional y un profundo conocimiento local para ayudarte a encontrar la propiedad ideal en la Costa del Sol. Desde la elección de la zona perfecta hasta la negociación y todos los trámites legales, te acompañamos en cada paso con claridad y profesionalidad.",
    "cta": "Saber más"
  },
  "contact": {
    "title": "Ponte en contacto",
    "subtitle": "¿Listo para encontrar tu casa soñada?",
    "form": {
      "name": "Tu nombre",
      "phone": "Teléfono",
      "email": "Correo electrónico",
      "message": "Mensaje",
      "send": "Enviar mensaje",
      "namePlaceholder": "Nombre",
      "phonePlaceholder": "+34 ...",
      "emailPlaceholder": "tu@email.com",
      "messagePlaceholder": "Cuéntanos qué estás buscando..."
    },
    "info": {
      "title": "Contacto",
      "whatsapp": "Escríbenos por WhatsApp",
      "note": "Normalmente respondemos en pocas horas en días laborables."
    },
    "footerRights": "Todos los derechos reservados"
  },
  "seo": {
    "siteName": "Grahalia Estates",
    "home": {
      "title": "Grahalia Estates — Inmobiliaria en la Costa del Sol",
      "description": "Agencia inmobiliaria cálida y minimalista. Encuentra propiedades y solicita información.",
      "ogTitle": "Grahalia Estates — Inmobiliaria en la Costa del Sol",
      "ogDescription": "Agencia inmobiliaria cálida y minimalista. Encuentra propiedades y solicita información."
    }
  }
}
```

---

## middleware.ts

```typescript
import { NextRequest, NextResponse } from "next/server";

const SUPPORTED = ["en", "es"] as const;
type Lang = (typeof SUPPORTED)[number];

const DEFAULT_LANG: Lang = "en";
const COOKIE_NAME = "lang";

function parseAcceptLanguage(header: string | null): Lang {
  if (!header) return DEFAULT_LANG;

  const first = header.split(",")[0]?.trim().toLowerCase();
  if (!first) return DEFAULT_LANG;

  const base = first.split("-")[0] as Lang;
  return (SUPPORTED as readonly string[]).includes(base) ? (base as Lang) : DEFAULT_LANG;
}

function isPublicFile(pathname: string) {
  return (
    pathname.startsWith("/_next") ||
    pathname.startsWith("/api") ||
    pathname.startsWith("/uploads") || // ✅ важно: загруженные файлы всегда без i18n
    pathname === "/favicon.ico" ||
    pathname === "/robots.txt" ||
    pathname === "/sitemap.xml" ||
    pathname.startsWith("/assets") ||
    pathname.match(/\.(png|jpg|jpeg|webp|svg|ico|pdf|txt|xml)$/) // ✅ добавил pdf на всякий
  );
}

export function middleware(req: NextRequest) {
  const { pathname } = req.nextUrl;

  if (isPublicFile(pathname)) return NextResponse.next();

  // ✅ Админка НЕ участвует в i18n редиректах
  if (pathname === "/admin" || pathname.startsWith("/admin/")) {
    if (pathname.startsWith("/admin/login")) return NextResponse.next();

    const adminCookie = req.cookies.get("admin")?.value;
    if (adminCookie !== "1") {
      const url = req.nextUrl.clone();
      url.pathname = "/admin/login";
      return NextResponse.redirect(url);
    }

    return NextResponse.next();
  }

  // Уже с локалью?
  const hasLocale = SUPPORTED.some((l) => pathname === `/${l}` || pathname.startsWith(`/${l}/`));
  if (hasLocale) {
    const current = pathname.split("/")[1] as Lang;
    const res = NextResponse.next();

    if ((SUPPORTED as readonly string[]).includes(current)) {
      res.cookies.set(COOKIE_NAME, current, {
        path: "/",
        sameSite: "lax",
        maxAge: 60 * 60 * 24 * 365,
      });
    }

    return res;
  }

  // Любой путь без локали — редиректим на /{lang}/...
  const cookieLang = req.cookies.get(COOKIE_NAME)?.value as Lang | undefined;
  const detected =
    cookieLang && (SUPPORTED as readonly string[]).includes(cookieLang)
      ? cookieLang
      : parseAcceptLanguage(req.headers.get("accept-language"));

  const url = req.nextUrl.clone();
  url.pathname = `/${detected}${pathname === "/" ? "" : pathname}`;
  return NextResponse.redirect(url);
}

export const config = {
  matcher: ["/((?!_next|api).*)"],
};

```

---

## next-env.d.ts

```typescript
/// <reference types="next" />
/// <reference types="next/image-types/global" />
import "./.next/dev/types/routes.d.ts";

// NOTE: This file should not be edited
// see https://nextjs.org/docs/app/api-reference/config/typescript for more information.

```

---

## next.config.ts

```typescript
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  experimental: {
    serverActions: {
      // ✅ чтобы не падало на фото/пдф
      bodySizeLimit: "25mb",
    },
  },
};

export default nextConfig;

```

---

## package.json

```json
{
  "name": "grahalia-estate",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "db:generate": "drizzle-kit generate",
    "db:migrate": "drizzle-kit migrate"
  },
  "dependencies": {
    "drizzle-orm": "^0.45.1",
    "next": "16.1.2",
    "pg": "^8.17.1",
    "react": "19.2.3",
    "react-dom": "19.2.3"
  },
  "devDependencies": {
    "@tailwindcss/postcss": "^4",
    "@types/node": "^20",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "dotenv-cli": "^11.0.0",
    "drizzle-kit": "^0.31.8",
    "eslint": "^9",
    "eslint-config-next": "16.1.2",
    "tailwindcss": "^4",
    "typescript": "^5"
  },
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "db:generate": "dotenv -e .env.local -- drizzle-kit generate",
    "db:migrate": "dotenv -e .env.local -- drizzle-kit migrate"
  }
}

```

---

## postcss.config.mjs

```javascript
const config = {
  plugins: {
    "@tailwindcss/postcss": {},
  },
};

export default config;

```

---

## tools/snapshot_repo.py

```py
#!/usr/bin/env python3
import argparse
import datetime as dt
from pathlib import Path

# ---------- настройки ----------
# Сюда добавляем только то, что НЕ НАДО сохранять
EXCLUDE_DIRS = {
    ".git", ".idea", ".vscode", "__pycache__", "node_modules", "venv",
    ".mypy_cache", ".pytest_cache", ".DS_Store",
    ".next", "dist", "build", "out", ".turbo",
    ".cache", ".parcel-cache", "coverage",
}

EXCLUDE_FILES = {
    ".env", ".env.local", ".env.production", ".env.development",
    "pnpm-lock.yaml", "package-lock.json", 
    "PROJECT_TREE_", "CODE_SNAPSHOT_" # Исключаем сами снапшоты, чтобы не копировать их в самих себя
}

# Сохраняем только текстовые форматы кода
INCLUDE_EXT = {
    ".ts", ".tsx", ".js", ".jsx", ".css", ".scss", ".html", 
    ".json", ".md", ".py", ".sql", ".mjs", ".yml", ".yaml", ".prisma"
}

# ---------- утилиты ----------
def project_root() -> Path:
    return Path(__file__).resolve().parents[1]

def is_ignored(path: Path) -> bool:
    # Проверка папок-исключений
    if any(part in EXCLUDE_DIRS for part in path.parts):
        return True
    # Проверка имен файлов (например, .env)
    if path.name in EXCLUDE_FILES or any(path.name.startswith(p) for p in ["PROJECT_TREE_", "CODE_SNAPSHOT_"]):
        return True
    return False

def build_tree(root: Path) -> str:
    lines = []
    def walk(base: Path, prefix=""):
        try:
            entries = sorted(
                [p for p in base.iterdir() if not is_ignored(p)],
                key=lambda p: (p.is_file(), p.name.lower())
            )
        except PermissionError:
            return

        for i, p in enumerate(entries):
            last = (i == len(entries) - 1)
            connector = "└── " if last else "├── "
            lines.append(prefix + connector + p.name)
            if p.is_dir():
                ext = "    " if last else "│   "
                walk(p, prefix + ext)
    walk(root)
    return "\n".join(lines)

def get_all_code_files(root: Path):
    """Рекурсивно ищет все файлы кода, которые не в игноре и имеют нужное расширение"""
    code_files = []
    for p in root.rglob("*"):
        if p.is_file() and not is_ignored(p):
            if p.suffix.lower() in INCLUDE_EXT or p.name in {"README.md", ".gitignore", "docker-compose.yml"}:
                code_files.append(p)
    return sorted(code_files)

def guess_lang(p: Path) -> str:
    ext = p.suffix.lower().lstrip(".")
    mapping = {
        "ts": "typescript", "tsx": "typescript",
        "js": "javascript", "jsx": "javascript",
        "mjs": "javascript", "sql": "sql",
        "yml": "yaml", "yaml": "yaml"
    }
    return mapping.get(ext, ext or "text")

# ---------- main ----------
def main():
    parser = argparse.ArgumentParser()
    parser.add_argument("--force", action="store_true", help="Перезаписать файлы за сегодня")
    args = parser.parse_args()

    ROOT = project_root()
    now = dt.datetime.now()
    date_str = now.strftime("%Y-%m-%d")
    time_str = now.strftime("%H-%M-%S")

    # Формируем имена (добавил проверку на конфликты имен)
    suffix = f"_{time_str}" if not args.force else ""
    tree_name = f"PROJECT_TREE_{date_str}{suffix}.txt"
    code_name = f"CODE_SNAPSHOT_{date_str}{suffix}.md"

    tree_path = ROOT / tree_name
    code_path = ROOT / code_name

    # 1. Генерируем дерево (оно всегда актуальное)
    print("Сканирую структуру проекта...")
    tree_text = build_tree(ROOT)
    tree_path.write_text(tree_text, encoding="utf-8")
    print(f"[OK] Дерево сохранено: {tree_path.name}")

    # 2. Собираем весь код
    print("Собираю код из всех папок...")
    all_files = get_all_code_files(ROOT)
    
    with code_path.open("w", encoding="utf-8") as f:
        f.write(f"# Code snapshot ({now.isoformat(timespec='seconds')})\n")
        f.write(f"Всего файлов: {len(all_files)}\n\n")
        
        for p in all_files:
            try:
                rel = p.relative_to(ROOT)
                lang = guess_lang(p)
                content = p.read_text(encoding="utf-8")
                
                f.write(f"## {rel}\n\n")
                f.write(f"```{lang}\n")
                f.write(content)
                f.write("\n```\n\n---\n\n")
            except Exception as e:
                # Пропускаем бинарные файлы или ошибки доступа
                continue

    print(f"[OK] Снапшот кода создан: {code_path.name} ({len(all_files)} файлов)")

if __name__ == "__main__":
    main()
```

---

## tsconfig.json

```json
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "react-jsx",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "baseUrl": ".",
    "paths": {
      "@/*": ["./*"]
    }
  },
  "include": [
    "next-env.d.ts",
    "**/*.ts",
    "**/*.tsx",
    ".next/types/**/*.ts",
    ".next/dev/types/**/*.ts",
    "**/*.mts"
  ],
  "exclude": ["node_modules"]
}

```

---

## utils/scroll.ts

```typescript
export function clamp(n: number, min: number, max: number) {
  return Math.max(min, Math.min(max, n));
}

export function flyToHash(hash: string, headerOffset = 90) {
  const id = hash.replace("#", "");
  const el = document.getElementById(id);
  if (!el) return;

  flyToElement(el, headerOffset);
  history.pushState(null, "", `#${id}`);
}

export function flyToElement(target: HTMLElement, headerOffset = 90) {
  const targetY =
    target.getBoundingClientRect().top + window.scrollY - headerOffset;

  const startY = window.scrollY;
  const distance = targetY - startY;

  if (Math.abs(distance) < 2) return;

  const abs = Math.abs(distance);
  const duration = clamp(220 + abs * 0.35, 260, 780);

  const startTime = performance.now();

  const easeCruise = (t: number) => {
    if (t < 0.08) {
      const p = t / 0.08;
      return 0.12 * (p * p);
    }
    if (t > 0.82) {
      const p = (t - 0.82) / 0.18;
      return 0.82 + 0.18 * (1 - (1 - p) * (1 - p));
    }
    return 0.12 + (t - 0.08) * (0.70 / 0.74);
  };

  let raf = 0;

  // “моментальный отклик” без паузы
  const nudge = clamp(distance * 0.02, -14, 14);
  window.scrollTo(0, startY + nudge);

  const step = (now: number) => {
    const t = clamp((now - startTime) / duration, 0, 1);
    const eased = easeCruise(t);
    window.scrollTo(0, startY + distance * eased);
    if (t < 1) raf = requestAnimationFrame(step);
  };

  raf = requestAnimationFrame(step);

  const cancel = () => cancelAnimationFrame(raf);
  window.addEventListener("wheel", cancel, { passive: true, once: true });
  window.addEventListener("touchstart", cancel, { passive: true, once: true });
}

```

---

## utils/smoothScroll.ts

```typescript
type Options = {
  duration?: number;
  offset?: number;
};

function clamp01(x: number) {
  return Math.min(1, Math.max(0, x));
}

// Разгон → быстро → торможение
function easeInOutCubic(t: number) {
  t = clamp01(t);
  return t < 0.5 ? 4 * t * t * t : 1 - Math.pow(-2 * t + 2, 3) / 2;
}

export function smoothScrollToY(targetY: number, opts: Options = {}) {
  const startY = window.scrollY;
  const offset = opts.offset ?? 0;
  const finalY = targetY - offset;

  const distance = Math.abs(finalY - startY);
  const baseDuration = opts.duration ?? 800;
  const duration = Math.min(1400, Math.max(600, baseDuration + distance * 0.15));

  const start = performance.now();
  let cancelled = false;

  const cancel = () => (cancelled = true);
  window.addEventListener("wheel", cancel, { passive: true, once: true });
  window.addEventListener("touchstart", cancel, { passive: true, once: true });

  function step(now: number) {
    if (cancelled) return;

    const t = (now - start) / duration;
    const p = easeInOutCubic(t);

    window.scrollTo(0, startY + (finalY - startY) * p);

    if (t < 1) requestAnimationFrame(step);
  }

  requestAnimationFrame(step);
}

export function scrollToHash(hash: string, opts: Options = {}) {
  const id = hash.replace("#", "");
  const el = document.getElementById(id);
  if (!el) return;

  const top = el.getBoundingClientRect().top + window.scrollY;
  smoothScrollToY(top, opts);

  history.pushState(null, "", `#${id}`);
}

```

---

