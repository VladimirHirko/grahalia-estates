# Code snapshot (2026-01-18T17:50:18)
–í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤: 87

## .gitignore

```text
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.*
.yarn/*
!.yarn/patches
!.yarn/plugins
!.yarn/releases
!.yarn/versions

# testing
/coverage

# next.js
/.next/
/out/

# production
/build

# misc
.DS_Store
*.pem

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.pnpm-debug.log*

# env files (can opt-in for committing if needed)
.env*

# vercel
.vercel

# typescript
*.tsbuildinfo
next-env.d.ts

```

---

## README.md

```md
This is a [Next.js](https://nextjs.org) project bootstrapped with [`create-next-app`](https://nextjs.org/docs/app/api-reference/cli/create-next-app).

## Getting Started

First, run the development server:

```bash
npm run dev
# or
yarn dev
# or
pnpm dev
# or
bun dev
```

Open [http://localhost:3000](http://localhost:3000) with your browser to see the result.

You can start editing the page by modifying `app/page.tsx`. The page auto-updates as you edit the file.

This project uses [`next/font`](https://nextjs.org/docs/app/building-your-application/optimizing/fonts) to automatically optimize and load [Geist](https://vercel.com/font), a new font family for Vercel.

## Learn More

To learn more about Next.js, take a look at the following resources:

- [Next.js Documentation](https://nextjs.org/docs) - learn about Next.js features and API.
- [Learn Next.js](https://nextjs.org/learn) - an interactive Next.js tutorial.

You can check out [the Next.js GitHub repository](https://github.com/vercel/next.js) - your feedback and contributions are welcome!

## Deploy on Vercel

The easiest way to deploy your Next.js app is to use the [Vercel Platform](https://vercel.com/new?utm_medium=default-template&filter=next.js&utm_source=create-next-app&utm_campaign=create-next-app-readme) from the creators of Next.js.

Check out our [Next.js deployment documentation](https://nextjs.org/docs/app/building-your-application/deploying) for more details.

```

---

## app/.gitignore

```text
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.*
.yarn/*
!.yarn/patches
!.yarn/plugins
!.yarn/releases
!.yarn/versions

# testing
/coverage

# next.js
/.next/
/out/

# production
/build

# misc
.DS_Store
*.pem

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.pnpm-debug.log*

# env files (can opt-in for committing if needed)
.env*

# vercel
.vercel

# typescript
*.tsbuildinfo
next-env.d.ts

```

---

## app/README.md

```md
This is a [Next.js](https://nextjs.org) project bootstrapped with [`create-next-app`](https://nextjs.org/docs/app/api-reference/cli/create-next-app).

## Getting Started

First, run the development server:

```bash
npm run dev
# or
yarn dev
# or
pnpm dev
# or
bun dev
```

Open [http://localhost:3000](http://localhost:3000) with your browser to see the result.

You can start editing the page by modifying `app/page.tsx`. The page auto-updates as you edit the file.

This project uses [`next/font`](https://nextjs.org/docs/app/building-your-application/optimizing/fonts) to automatically optimize and load [Geist](https://vercel.com/font), a new font family for Vercel.

## Learn More

To learn more about Next.js, take a look at the following resources:

- [Next.js Documentation](https://nextjs.org/docs) - learn about Next.js features and API.
- [Learn Next.js](https://nextjs.org/learn) - an interactive Next.js tutorial.

You can check out [the Next.js GitHub repository](https://github.com/vercel/next.js) - your feedback and contributions are welcome!

## Deploy on Vercel

The easiest way to deploy your Next.js app is to use the [Vercel Platform](https://vercel.com/new?utm_medium=default-template&filter=next.js&utm_source=create-next-app&utm_campaign=create-next-app-readme) from the creators of Next.js.

Check out our [Next.js deployment documentation](https://nextjs.org/docs/app/building-your-application/deploying) for more details.

```

---

## app/[lang]/layout.tsx

```typescript
import "../globals.css";
import { Inter, Playfair_Display } from "next/font/google";
import { locales, isLocale, type Locale, getDictionary } from "@/i18n/dictionaries";
import type { Metadata } from "next";

const inter = Inter({
  subsets: ["latin"],
  variable: "--font-inter",
  display: "swap",
});

const playfair = Playfair_Display({
  subsets: ["latin"],
  variable: "--font-playfair",
  display: "swap",
});

export function generateStaticParams() {
  return locales.map((lang) => ({ lang }));
}

type LayoutProps = {
  children: React.ReactNode;
  params: Promise<{ lang: string }>;
};

/**
 * SEO / metadata
 * –ø–æ–ª–Ω–æ—Å—Ç—å—é –º—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ
 * —Ç–µ–∫—Å—Ç—ã –±–µ—Ä—ë–º –¢–û–õ–¨–ö–û –∏–∑ —Å–ª–æ–≤–∞—Ä–µ–π
 */
export async function generateMetadata(
  { params }: { params: Promise<{ lang: string }> }
): Promise<Metadata> {
  const { lang: raw } = await params;
  const lang: Locale = isLocale(raw) ? (raw as Locale) : "en";
  const t = await getDictionary(lang);

  return {
    title: t.seo.home.title,
    description: t.seo.home.description,

    alternates: {
      canonical: `/${lang}`,
      languages: {
        en: "/en",
        es: "/es",
      },
    },

    openGraph: {
      title: t.seo.home.ogTitle ?? t.seo.home.title,
      description: t.seo.home.ogDescription ?? t.seo.home.description,
      locale: lang === "es" ? "es_ES" : "en_US",
      type: "website",
    },

    robots: {
      index: true,
      follow: true,
    },
  };
}

export default async function RootLayout({ children, params }: LayoutProps) {
  const { lang: raw } = await params;
  const lang: Locale = isLocale(raw) ? (raw as Locale) : "en";

  return (
    <html lang={lang} className={`${inter.variable} ${playfair.variable}`}>
      <body>{children}</body>
    </html>
  );
}

```

---

## app/[lang]/page.tsx

```typescript
import Header from "@/components/Header/Header";
import Hero from "@/components/Hero/Hero";
import Featured from "@/components/Featured/Featured";
import Services from "@/components/Services/Services";
import About from "@/components/About/About";
import Contact from "@/components/Contact/Contact";

import { getDictionary, isLocale, type Locale } from "@/i18n/dictionaries";
import { getFeaturedItems } from "@/app/lib/publicFeatured";

export default async function Page({
  params,
}: {
  params: Promise<{ lang: string }>;
}) {
  const { lang: raw } = await params;
  const lang: Locale = isLocale(raw) ? (raw as Locale) : "en";
  const t = await getDictionary(lang);

  // ‚úÖ –†–µ–∞–ª—å–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã –∏–∑ –ë–î (—Ç–æ–ª—å–∫–æ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã–µ)
  const featuredItems = await getFeaturedItems(lang === "es" ? "es" : "en", 12);

  return (
    <>
      <Header lang={lang} t={t.header} />
      <main>
        <Hero t={t.hero} />
        <Featured lang={lang === "es" ? "es" : "en"} t={t.featured} items={featuredItems} />
        <Services t={t.services} />
        <About t={t.about} />
        <Contact t={t.contact} />
      </main>
    </>
  );
}

```

---

## app/[lang]/properties/Filters.tsx

```typescript
"use client";

import { useMemo, useState } from "react";
import { usePathname, useRouter, useSearchParams } from "next/navigation";
import styles from "./properties.module.css";

type FeatureOption = { key: string; label: string };

function parseFeaturesParam(value: string) {
  return new Set(
    (value || "")
      .split(",")
      .map((x) => x.trim().toLowerCase())
      .filter(Boolean)
  );
}

export default function Filters({
  lang,
  features,
}: {
  lang: "en" | "es";
  features: FeatureOption[];
}) {
  const router = useRouter();
  const pathname = usePathname();
  const sp = useSearchParams();

  // ‚úÖ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–≤–µ—Ä–Ω—É—Ç–æ
  const [open, setOpen] = useState(false);

  const selectedType = (sp.get("type") || "").trim();

  const selectedFeatures = useMemo(() => {
    return parseFeaturesParam(sp.get("features") || "");
  }, [sp]);

  const hasActiveFilters =
    Boolean(selectedType) || selectedFeatures.size > 0;

  function push(next: URLSearchParams) {
    next.set("page", "1");

    // —á–∏—Å—Ç–∏–º –ø—É—Å—Ç—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
    for (const [k, v] of next.entries()) {
      if (!String(v).trim()) next.delete(k);
    }

    const qs = next.toString();
    router.push(qs ? `${pathname}?${qs}` : pathname);
  }

  function setType(value: string) {
    const v = (value || "").trim().toLowerCase();
    const next = new URLSearchParams(sp.toString());

    if (!v) next.delete("type");
    else next.set("type", v);

    push(next);
  }

  function toggleFeature(key: string) {
    const k = String(key || "").trim().toLowerCase();
    if (!k) return;

    const next = new URLSearchParams(sp.toString());
    const cur = parseFeaturesParam(next.get("features") || "");

    if (cur.has(k)) cur.delete(k);
    else cur.add(k);

    const arr = Array.from(cur).sort();
    if (arr.length === 0) next.delete("features");
    else next.set("features", arr.join(","));

    push(next);
  }

  function clearAll() {
    const next = new URLSearchParams(sp.toString());
    next.delete("type");
    next.delete("features");
    next.set("page", "1");

    const qs = next.toString();
    router.push(qs ? `${pathname}?${qs}` : pathname);
  }

  return (
    <div className={styles.filters}>
      <div className={styles.filtersTop}>
        <button
          type="button"
          className={styles.filtersToggle}
          onClick={() => setOpen((v) => !v)}
          aria-expanded={open}
        >
          <span className={styles.filtersTitle}>
            {lang === "es" ? "Filtros" : "Filters"}
          </span>

          {/* –º–∞–ª–µ–Ω—å–∫–∏–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä, —á—Ç–æ —Ñ–∏–ª—å—Ç—Ä—ã –∞–∫—Ç–∏–≤–Ω—ã */}
          {hasActiveFilters && (
            <span className={styles.filtersBadge}>
              {lang === "es" ? "Activos" : "Active"}
            </span>
          )}

          <span className={styles.filtersChevron} aria-hidden>
            {open ? "‚ñ≤" : "‚ñº"}
          </span>
        </button>

        <button
          className={`btn btnGhost ${styles.clearBtn}`}
          type="button"
          onClick={clearAll}
          disabled={!hasActiveFilters}
          title={hasActiveFilters ? "" : (lang === "es" ? "Nada que limpiar" : "Nothing to clear")}
        >
          {lang === "es" ? "Limpiar" : "Clear"}
        </button>
      </div>

      {open && (
        <div className={styles.filtersGrid}>
          <label className={styles.field}>
            <span className={styles.label}>
              {lang === "es" ? "Tipo" : "Type"}
            </span>

            {/* —Ç–∏–ø –ø–æ–∫–∞ UI; –∫–æ–≥–¥–∞ –¥–æ–±–∞–≤–∏—à—å property_type –≤ –ë–î ‚Äî –≤–∫–ª—é—á–∏–º –≤ –∑–∞–ø—Ä–æ—Å */}
            <select
              className={styles.select}
              value={selectedType}
              onChange={(e) => setType(e.target.value)}
            >
              <option value="">{lang === "es" ? "Todos" : "All"}</option>
              <option value="apartment">
                {lang === "es" ? "Apartamento" : "Apartment"}
              </option>
              <option value="villa">Villa</option>
              <option value="townhouse">
                {lang === "es" ? "Adosado" : "Townhouse"}
              </option>
              <option value="land">{lang === "es" ? "Terreno" : "Land"}</option>
            </select>
          </label>

          <div className={styles.field}>
            <span className={styles.label}>
              {lang === "es" ? "Comodidades" : "Amenities"}
            </span>

            <div className={styles.features}>
              {features.map((f) => {
                const key = String(f.key || "").trim().toLowerCase();
                const checked = selectedFeatures.has(key);

                return (
                  <label key={f.key} className={styles.featureItem}>
                    <input
                      type="checkbox"
                      checked={checked}
                      onChange={() => toggleFeature(key)}
                    />
                    <span>{f.label}</span>
                  </label>
                );
              })}
            </div>
          </div>
        </div>
      )}
    </div>
  );
}

```

---

## app/[lang]/properties/[slug]/page.tsx

```typescript
// app/[lang]/properties/[slug]/page.tsx
import Header from "@/components/Header/Header";
import PropertyGallery from "@/components/PropertyGallery/PropertyGallery";
import { getDictionary, isLocale, type Locale } from "@/i18n/dictionaries";
import { getPropertyBySlug } from "@/app/lib/publicProperties";
import styles from "./property.module.css";

export const dynamic = "force-dynamic";

export default async function PropertyDetailPage({
  params,
}: {
  params: Promise<{ lang: string; slug: string }>;
}) {
  const { lang: raw, slug } = await params;
  const lang: Locale = isLocale(raw) ? (raw as Locale) : "en";
  const t = await getDictionary(lang);

  const uiLang = lang === "es" ? "es" : "en";
  const property = await getPropertyBySlug({ lang: uiLang, slug });

  if (!property) {
    return (
      <>
        <Header lang={lang} t={t.header} />
        <main>
          <section className="section">
            <div className="container">
              <h1 className={styles.title}>
                {lang === "es" ? "Propiedad no encontrada" : "Property not found"}
              </h1>
              <p className={styles.muted}>
                {lang === "es"
                  ? "Puede que no est√© publicada o el enlace sea incorrecto."
                  : "It may be unpublished or the link is incorrect."}
              </p>
            </div>
          </section>
        </main>
      </>
    );
  }

  return (
    <>
      <Header lang={lang} t={t.header} />
      <main>
        <section className="section">
          <div className="container">
            <div className={styles.head}>
              <div>
                <h1 className={styles.title}>{property.title}</h1>
                <div className={styles.location}>{property.location}</div>
              </div>

              <div className={styles.price}>{property.priceText}</div>
            </div>

            {/* ‚úÖ Gallery (with modal) */}
            {property.images?.length ? (
              <PropertyGallery images={property.images} />
            ) : (
              <div className={styles.coverPlaceholder} />
            )}

            {/* Specs */}
            <div className={styles.specs}>
              <div className={styles.specItem}>
                üõè {property.beds} {t.featured.card.beds}
              </div>
              <div className={styles.specItem}>
                üõÅ {property.baths} {t.featured.card.baths}
              </div>
              <div className={styles.specItem}>üìê {property.builtArea} m¬≤</div>
            </div>

            {/* Description */}
            {property.description?.trim() ? (
              <div className={styles.block}>
                <div className={styles.blockTitle}>
                  {lang === "es" ? "Descripci√≥n" : "Description"}
                </div>
                <p className={styles.description}>{property.description}</p>
              </div>
            ) : null}

            {/* Amenities */}
            {property.features.length > 0 ? (
              <div className={styles.block}>
                <div className={styles.blockTitle}>
                  {lang === "es" ? "Comodidades" : "Amenities"}
                </div>
                <div className={styles.amenities}>
                  {property.features.map((f) => (
                    <span key={f.key} className={styles.amenity}>
                      {f.label}
                    </span>
                  ))}
                </div>
              </div>
            ) : null}

            {/* Plans */}
            {property.plansUrl ? (
              <div className={styles.block}>
                <div className={styles.blockTitle}>
                  {lang === "es" ? "Planos (PDF)" : "Plans (PDF)"}
                </div>
                <a
                  className={`btn btnGhost ${styles.planBtn}`}
                  href={property.plansUrl}
                  target="_blank"
                  rel="noreferrer"
                >
                  {lang === "es" ? "Abrir PDF" : "Open PDF"}
                </a>
              </div>
            ) : null}

            {/* CTA */}
            <div className={styles.cta}>
              <div className={styles.ctaText}>
                {lang === "es"
                  ? "¬øTe interesa esta propiedad? Escr√≠benos y te ayudamos."
                  : "Interested in this property? Message us and we‚Äôll help."}
              </div>
              <a className="btn btnPrimary" href={`/${lang}#contact`}>
                {lang === "es" ? "Contactar" : "Contact"}
              </a>
            </div>
          </div>
        </section>
      </main>
    </>
  );
}

```

---

## app/[lang]/properties/[slug]/property.module.css

```css
.title {
  margin: 0;
}

.muted {
  color: var(--muted);
}

.head {
  display: flex;
  align-items: flex-end;
  justify-content: space-between;
  gap: 16px;
  margin-bottom: 18px;
}

.location {
  margin-top: 6px;
  color: rgba(28, 28, 28, 0.62);
}

.price {
  font-size: 22px;
  font-weight: 700;
  white-space: nowrap;
}

.gallery {
  display: grid;
  grid-template-columns: 1.6fr 1fr;
  gap: 14px;
  margin: 16px 0 18px;

  align-items: start; /* ‚úÖ –≤–∞–∂–Ω–æ: —É–±–∏—Ä–∞–µ—Ç —Ä–∞—Å—Ç—è–≥–∏–≤–∞–Ω–∏–µ coverWrap */
}

.coverWrap {
  border-radius: var(--radius);
  overflow: hidden;
  border: 1px solid var(--border);
  background: #fff;
}

.cover {
  display: block;
  width: 100%;
  height: 420px;
  object-fit: cover;
}

.coverPlaceholder {
  height: 420px;
  border-radius: var(--radius);
  border: 1px solid var(--border);
  background: rgba(0,0,0,0.03);
}

.thumbs {
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 10px;

  max-height: 420px;      /* ‚úÖ –≤—ã—Å–æ—Ç–∞ –∫–∞–∫ —É cover */
  overflow-y: auto;       /* ‚úÖ –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ */
  padding-right: 4px;     /* —á—Ç–æ–±—ã —Å–∫—Ä–æ–ª–ª –Ω–µ –ø—Ä–∏–ª–∏–ø–∞–ª */
}

.thumb {
  width: 100%;
  height: 205px;
  object-fit: cover;
  border-radius: 12px;
  border: 1px solid var(--border);
  background: #fff;
}

.specs {
  display: flex;
  gap: 14px;
  flex-wrap: wrap;
  margin: 10px 0 18px;
}

.specItem {
  padding: 10px 12px;
  border: 1px solid var(--border);
  border-radius: 12px;
  background: rgba(255,255,255,0.75);
}

.block {
  margin-top: 18px;
}

.blockTitle {
  font-weight: 700;
  margin-bottom: 10px;
}

.amenities {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
}

.amenity {
  padding: 8px 12px;
  border: 1px solid var(--border);
  border-radius: 999px;
  background: rgba(255,255,255,0.75);
  font-size: 13px;
  color: rgba(28, 28, 28, 0.78);
}

.planBtn {
  padding: 10px 14px;
}

.cta {
  margin-top: 24px;
  padding: 16px;
  border: 1px solid var(--border);
  border-radius: var(--radius);
  background: rgba(255,255,255,0.75);
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 14px;
}

.ctaText {
  color: rgba(28, 28, 28, 0.75);
}

@media (max-width: 980px) {
  .head {
    flex-direction: column;
    align-items: flex-start;
  }

  .gallery {
    grid-template-columns: 1fr;
    align-items: start;
  }

  .cover {
    height: 340px;
  }

  .thumb {
    height: 160px;
  }

  .cta {
    flex-direction: column;
    align-items: flex-start;
  }
}

.description {
  color: rgba(28, 28, 28, 0.78);
  line-height: 1.7;
  white-space: pre-line;
  max-width: 900px;
}

```

---

## app/[lang]/properties/page.tsx

```typescript
import Header from "@/components/Header/Header";
import PropertyCard from "@/components/PropertyCard/PropertyCard";
import { getDictionary, isLocale, type Locale } from "@/i18n/dictionaries";
import styles from "./properties.module.css";

import Filters from "./Filters";
import { getAllFeaturesForFilters, getCatalogItems } from "@/app/lib/publicProperties";

export const dynamic = "force-dynamic";

function parseFeaturesParam(v: string | undefined): string[] {
  if (!v) return [];
  return v
    .split(",")
    .map((x) => x.trim().toLowerCase())
    .filter(Boolean);
}

export default async function PropertiesPage({
  params,
  searchParams,
}: {
  params: Promise<{ lang: string }>;
  searchParams: Promise<Record<string, string | string[] | undefined>>;
}) {
  const { lang: raw } = await params;
  const lang: Locale = isLocale(raw) ? (raw as Locale) : "en";
  const t = await getDictionary(lang);

  const uiLang = lang === "es" ? "es" : "en";

  const sp = await searchParams;
  const page = Number(Array.isArray(sp.page) ? sp.page[0] : sp.page) || 1;
  const type = String(Array.isArray(sp.type) ? sp.type[0] : sp.type || "").trim() || null;
  const features = parseFeaturesParam(
    String(Array.isArray(sp.features) ? sp.features[0] : sp.features || "")
  );

  const [featuresForFilters, result] = await Promise.all([
    getAllFeaturesForFilters(uiLang),
    getCatalogItems({
      lang: uiLang,
      page,
      pageSize: 12,
      filters: { type, featureKeys: features },
    }),
  ]);

  return (
    <>
      <Header lang={lang} t={t.header} />
      <main>
        <section className="section">
          <div className="container">
            <div className="section__head">
              <h1 className="sectionTitle">
                <span className="sectionTitleText">
                  {lang === "es" ? "Cat√°logo" : "Properties Catalog"}
                </span>
              </h1>
              <p className="section__kicker">
                {lang === "es"
                  ? "Todas las propiedades publicadas"
                  : "All published properties"}
              </p>
            </div>

            {/* ‚úÖ –§–∏–ª—å—Ç—Ä—ã */}
            <Filters lang={uiLang} features={featuresForFilters} />

            {result.items.length === 0 ? (
              <div className={styles.empty}>
                {lang === "es"
                  ? "No hay propiedades con estos filtros."
                  : "No properties match these filters."}
              </div>
            ) : (
              <>
                <div className={styles.grid}>
                  {result.items.map((p) => (
                    <PropertyCard
                      key={String(p.id)}
                      property={{
                        title: p.title,
                        location: p.location,
                        price: p.priceText,
                        beds: p.beds,
                        baths: p.baths,
                        area: p.area,
                        image: p.image,

                        // ‚úÖ amenities –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–µ
                        features: p.features,

                        // —á—Ç–æ–±—ã –∫–Ω–æ–ø–∫–∞ "Details" –≤–µ–¥–µ—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ–±—ä–µ–∫—Ç–∞
                        href: `/${lang}/properties/${p.slug}`,
                      }}
                      t={t.featured.card}
                    />
                  ))}
                </div>

                {/* ‚úÖ –ü–∞–≥–∏–Ω–∞—Ü–∏—è */}
                <div className={styles.pager}>
                  <div className={styles.pagerInfo}>
                    {lang === "es"
                      ? `P√°gina ${result.page} de ${result.totalPages}`
                      : `Page ${result.page} of ${result.totalPages}`}
                  </div>

                  <div className={styles.pagerBtns}>
                    {result.page > 1 && (
                      <a
                        className={`btn btnGhost ${styles.pagerBtn}`}
                        href={buildPageHref(sp, result.page - 1)}
                      >
                        ‚Üê {lang === "es" ? "Anterior" : "Prev"}
                      </a>
                    )}

                    {result.page < result.totalPages && (
                      <a
                        className={`btn btnPrimary ${styles.pagerBtn}`}
                        href={buildPageHref(sp, result.page + 1)}
                      >
                        {lang === "es" ? "Siguiente" : "Next"} ‚Üí
                      </a>
                    )}
                  </div>
                </div>
              </>
            )}
          </div>
        </section>
      </main>
    </>
  );
}

function buildPageHref(
  sp: Record<string, string | string[] | undefined>,
  nextPage: number
) {
  const u = new URLSearchParams();

  for (const [k, v] of Object.entries(sp)) {
    if (v === undefined) continue;
    if (k === "page") continue;

    const value = Array.isArray(v) ? v[0] : v;
    if (value !== undefined && String(value).trim() !== "") {
      u.set(k, String(value));
    }
  }

  u.set("page", String(nextPage));
  const qs = u.toString();
  return qs ? `?${qs}` : "?page=1";
}

```

---

## app/[lang]/properties/properties.module.css

```css
.grid {
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 22px;
  align-items: stretch;
}

.empty {
  padding: 24px 0;
  color: var(--muted);
}

/* --- Filters --- */
.filters {
  margin: 18px 0 18px;
  border: 1px solid var(--border);
  background: rgba(255, 255, 255, 0.75);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  padding: 14px;
}

.filtersTop {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  margin-bottom: 12px;
}

.filtersToggle {
  display: inline-flex;
  align-items: center;
  gap: 10px;
  border: none;
  background: transparent;
  padding: 6px 0;
  cursor: pointer;
  font: inherit;
  color: inherit;
}

.filtersToggle:focus-visible {
  outline: 2px solid rgba(0,0,0,0.2);
  outline-offset: 4px;
  border-radius: 10px;
}

.filtersBadge {
  font-size: 12px;
  padding: 4px 8px;
  border: 1px solid var(--border);
  border-radius: 999px;
  background: rgba(255,255,255,0.75);
  color: rgba(28, 28, 28, 0.7);
}

.filtersChevron {
  font-size: 12px;
  opacity: 0.7;
}

.filtersTitle {
  font-weight: 700;
  letter-spacing: 0.2px;
}

.clearBtn {
  padding: 10px 14px;
  white-space: nowrap;
}

.filtersGrid {
  display: grid;
  grid-template-columns: 240px 1fr;
  gap: 14px;
}

.field {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.label {
  font-size: 12px;
  text-transform: uppercase;
  letter-spacing: 0.35px;
  color: rgba(28, 28, 28, 0.62);
}

.select {
  width: 100%;
  padding: 12px 12px;
  border: 1px solid var(--border);
  border-radius: 10px;
  background: rgba(255, 255, 255, 0.9);
}

.features {
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 10px;
}

.featureItem {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 10px 10px;
  border: 1px solid var(--border);
  border-radius: 12px;
  background: rgba(255, 255, 255, 0.85);
  font-size: 13px;
  color: rgba(28, 28, 28, 0.78);
}

.featureItem input {
  transform: translateY(1px);
}

/* --- Pager --- */
.pager {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 14px;
  margin-top: 22px;
  padding-top: 14px;
  border-top: 1px solid var(--border);
}

.pagerInfo {
  color: var(--muted);
  font-size: 13px;
}

.pagerBtns {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
}

.pagerBtn {
  padding: 10px 14px;
  white-space: nowrap;
}

@media (max-width: 980px) {
  .grid {
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }

  .filtersGrid {
    grid-template-columns: 1fr;
  }

  .features {
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }

  .pager {
    flex-direction: column;
    align-items: flex-start;
  }
}

@media (max-width: 640px) {
  .grid {
    grid-template-columns: 1fr;
  }

  .features {
    grid-template-columns: 1fr;
  }
}

```

---

## app/admin/layout.tsx

```typescript
import "../globals.css";
import { Inter, Playfair_Display } from "next/font/google";

const inter = Inter({
  subsets: ["latin"],
  variable: "--font-inter",
  display: "swap",
});

const playfair = Playfair_Display({
  subsets: ["latin"],
  variable: "--font-playfair",
  display: "swap",
});

export default function AdminLayout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="en" className={`${inter.variable} ${playfair.variable}`}>
      <body>{children}</body>
    </html>
  );
}

```

---

## app/admin/login/page.tsx

```typescript
import { cookies } from "next/headers";
import { redirect } from "next/navigation";

export const dynamic = "force-dynamic";

export default function AdminLoginPage() {
  async function login(formData: FormData) {
    "use server";

    const password = String(formData.get("password") || "");
    const expected = process.env.ADMIN_PASSWORD || "";

    if (!expected) {
      throw new Error("ADMIN_PASSWORD is not set in environment.");
    }

    if (password !== expected) {
      // –ø—Ä–æ—Å—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞ –ª–æ–≥–∏–Ω (–º–æ–∂–Ω–æ –ø–æ–∑–∂–µ –¥–æ–±–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ)
      redirect("/admin/login");
    }

    // –í Next.js 15/16 cookies() ‚Äî async
    const cookieStore = await cookies();
    cookieStore.set("admin", "1", {
      httpOnly: true,
      sameSite: "lax",
      path: "/",
      maxAge: 60 * 60 * 24 * 7, // 7 –¥–Ω–µ–π
    });

    redirect("/admin");
  }

  return (
    <main style={{ maxWidth: 420, margin: "80px auto", padding: 16 }}>
      <h1 style={{ fontSize: 28, marginBottom: 8 }}>Admin Login</h1>
      <p style={{ opacity: 0.7, marginBottom: 24 }}>
        Enter the admin password to continue.
      </p>

      <form action={login}>
        <label style={{ display: "block", marginBottom: 8 }}>Password</label>
        <input
          name="password"
          type="password"
          required
          style={{
            width: "100%",
            padding: 12,
            borderRadius: 10,
            border: "1px solid #ddd",
            marginBottom: 12,
          }}
        />

        <button
          type="submit"
          style={{
            width: "100%",
            padding: 12,
            borderRadius: 10,
            border: "1px solid #111",
            cursor: "pointer",
          }}
        >
          Sign in
        </button>
      </form>

      <p style={{ opacity: 0.6, marginTop: 16, fontSize: 13 }}>
        (Local dev simple auth. We‚Äôll upgrade later if needed.)
      </p>
    </main>
  );
}

```

---

## app/admin/page.tsx

```typescript
import Link from "next/link";

export const dynamic = "force-dynamic";

export default function AdminHomePage() {
  return (
    <main style={{ maxWidth: 900, margin: "80px auto", padding: 16 }}>
      <h1 style={{ fontSize: 34, marginBottom: 8 }}>Admin</h1>
      <p style={{ marginTop: 0, opacity: 0.75 }}>‚úÖ You are logged in. Next step: Properties CRUD.</p>

      <div style={{ marginTop: 18, display: "flex", gap: 10, flexWrap: "wrap" }}>
        <Link
          href="/admin/properties"
          style={{
            padding: "10px 14px",
            borderRadius: 12,
            border: "1px solid #0E5E56",
            textDecoration: "none",
            color: "#0E5E56",
            fontWeight: 600,
          }}
        >
          Go to Properties ‚Üí
        </Link>
      </div>
    </main>
  );
}

```

---

## app/admin/properties/[id]/UploadForms.tsx

```typescript
"use client";

import { useState } from "react";

type Props = {
  propertyId: number;
};

export default function UploadForms({ propertyId }: Props) {
  const [imgLoading, setImgLoading] = useState(false);
  const [pdfLoading, setPdfLoading] = useState(false);
  const [msg, setMsg] = useState<string | null>(null);

  async function uploadImages(e: React.FormEvent<HTMLFormElement>) {
    e.preventDefault();
    setMsg(null);
    setImgLoading(true);

    const formEl = e.currentTarget;
    const input = formEl.elements.namedItem("files") as HTMLInputElement;
    if (!input.files || input.files.length === 0) {
      setMsg("Select at least one image");
      setImgLoading(false);
      return;
    }

    const fd = new FormData();
    for (const f of Array.from(input.files)) fd.append("files", f);

    const res = await fetch(`/api/admin/properties/${propertyId}/images`, {
      method: "POST",
      body: fd,
    });

    setImgLoading(false);

    if (!res.ok) {
      const text = await res.text().catch(() => "");
      setMsg(`Images upload failed (${res.status}). ${text}`);
      return;
    }

    // –æ–±–Ω–æ–≤–ª—è–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –Ω–æ–≤—ã–µ —Ñ–æ—Ç–æ
    window.location.reload();
  }

  async function uploadPlans(e: React.FormEvent<HTMLFormElement>) {
    e.preventDefault();
    setMsg(null);
    setPdfLoading(true);

    const formEl = e.currentTarget;
    const input = formEl.elements.namedItem("file") as HTMLInputElement;
    const file = input.files?.[0];
    if (!file) {
      setMsg("Select a PDF file");
      setPdfLoading(false);
      return;
    }

    const fd = new FormData();
    fd.append("file", file);

    const res = await fetch(`/api/admin/properties/${propertyId}/plans`, {
      method: "POST",
      body: fd,
    });

    setPdfLoading(false);

    if (!res.ok) {
      const text = await res.text().catch(() => "");
      setMsg(`PDF upload failed (${res.status}). ${text}`);
      return;
    }

    window.location.reload();
  }

  return (
    <div style={{ display: "grid", gap: 18 }}>
      {msg ? (
        <div style={{ padding: 12, border: "1px solid #e2a3a3", borderRadius: 12, background: "#fff5f5" }}>
          {msg}
        </div>
      ) : null}

      <form onSubmit={uploadPlans} style={{ display: "flex", gap: 10, alignItems: "center", flexWrap: "wrap" }}>
        <input name="file" type="file" accept="application/pdf" />
        <button type="submit" disabled={pdfLoading} style={btnPrimary}>
          {pdfLoading ? "Uploading..." : "Upload PDF"}
        </button>
      </form>

      <form onSubmit={uploadImages} style={{ display: "flex", gap: 10, alignItems: "center", flexWrap: "wrap" }}>
        <input name="files" type="file" accept="image/*" multiple />
        <button type="submit" disabled={imgLoading} style={btnPrimary}>
          {imgLoading ? "Uploading..." : "Upload images"}
        </button>
      </form>
    </div>
  );
}

const btnPrimary: React.CSSProperties = {
  padding: "10px 14px",
  borderRadius: 12,
  border: "1px solid #0E5E56",
  background: "#0E5E56",
  color: "#fff",
  fontWeight: 600,
  cursor: "pointer",
};

```

---

## app/admin/properties/[id]/page.tsx

```typescript
// app/admin/properties/[id]/page.tsx
import Link from "next/link";
import { redirect } from "next/navigation";
import { sql } from "drizzle-orm";
import { db } from "@/db";
import UploadForms from "./UploadForms";

export const dynamic = "force-dynamic";

function toInt(s: string) {
  const v = s.trim();
  if (!v) return null;
  const n = Number.parseInt(v, 10);
  return Number.isFinite(n) ? n : null;
}

function toDecimal(s: string) {
  const v = s.trim().replace(",", ".");
  if (!v) return null;
  const n = Number.parseFloat(v);
  return Number.isFinite(n) ? n : null;
}

function normalizePublicPath(p: unknown) {
  const s = String(p ?? "").trim();
  if (!s) return null;
  return s.startsWith("/") ? s : `/${s}`;
}

type PageProps = {
  params: Promise<{ id: string }>;
};

export default async function AdminPropertyEditPage({ params }: PageProps) {
  const resolved = await params;
  const id = Number(resolved.id);

  if (!Number.isFinite(id)) redirect("/admin/properties");

  const propRes = await db.execute(sql`SELECT * FROM properties WHERE id = ${id} LIMIT 1`);
  const prop = (propRes as any).rows?.[0];
  if (!prop) redirect("/admin/properties");

  const imagesRes = await db.execute(sql`
    SELECT id, url, alt, sort_order, is_cover
    FROM property_images
    WHERE property_id = ${id}
    ORDER BY sort_order ASC, id ASC
  `);
  const images = ((imagesRes as any).rows ?? []) as Array<any>;

  const plansHref = normalizePublicPath(prop.plans_url);

  // ‚úÖ 1) –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —Ñ–∏—á–∏ (–ø–æ–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º EN-–ª–µ–π–±–ª—ã; –º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å –ø–æ–∑–∂–µ)
  const featuresRes = await db.execute(sql`
    SELECT
      f.id,
      f.key,
      COALESCE(ft.label, f.key) AS label
    FROM features f
    LEFT JOIN feature_translations ft
      ON ft.feature_id = f.id AND ft.lang = 'en'
    ORDER BY COALESCE(ft.label, f.key) ASC
  `);
  const features = ((featuresRes as any).rows ?? []) as Array<{ id: number; key: string; label: string }>;

  // ‚úÖ 2) –¢–µ–∫—É—â–∏–µ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Ñ–∏—á–∏ –¥–ª—è –æ–±—ä–µ–∫—Ç–∞
  const selectedRes = await db.execute(sql`
    SELECT feature_id
    FROM property_features
    WHERE property_id = ${id}
  `);
  const selectedRows = ((selectedRes as any).rows ?? []) as Array<{ feature_id: number }>;
  const selectedSet = new Set<number>(selectedRows.map((r) => Number(r.feature_id)));

  async function updateBase(formData: FormData) {
    "use server";

    const slugRaw = String(formData.get("slug") || "").trim();
    const slug = slugRaw
      .toLowerCase()
      .replace(/\s+/g, "-")
      .replace(/[^a-z0-9-]/g, "")
      .replace(/-+/g, "-")
      .replace(/^-|-$/g, "")
      .slice(0, 255);

    if (!slug) redirect(`/admin/properties/${id}`);

    const isPublished = formData.get("isPublished") === "on";
    const price = toDecimal(String(formData.get("price") || ""));
    const currency =
      String(formData.get("currency") || "EUR")
        .trim()
        .toUpperCase()
        .slice(0, 3) || "EUR";
    const location = String(formData.get("location") || "").trim() || null;

    const descriptionEn = String(formData.get("descriptionEn") || "").trim() || null;
    const descriptionEs = String(formData.get("descriptionEs") || "").trim() || null;

    const bedrooms = toInt(String(formData.get("bedrooms") || ""));
    const bathrooms = toInt(String(formData.get("bathrooms") || ""));

    const plotArea = toDecimal(String(formData.get("plotAreaM2") || ""));
    const builtArea = toDecimal(String(formData.get("builtAreaM2") || ""));
    const terraceArea = toDecimal(String(formData.get("terraceAreaM2") || ""));

    // ‚úÖ Amenities (features) –∏–∑ —á–µ–∫–±–æ–∫—Å–æ–≤
    const rawFeatureIds = formData.getAll("features");
    const featureIds = rawFeatureIds
      .map((v) => Number(String(v)))
      .filter((n) => Number.isFinite(n)) as number[];

    // 1) update –±–∞–∑–æ–≤—ã—Ö –ø–æ–ª–µ–π
    await db.execute(sql`
      UPDATE properties
      SET
        slug = ${slug},
        is_published = ${isPublished},
        price = ${price},
        currency = ${currency},
        location = ${location},
        description_en = ${descriptionEn},
        description_es = ${descriptionEs},
        bedrooms = ${bedrooms},
        bathrooms = ${bathrooms},
        plot_area_m2 = ${plotArea},
        built_area_m2 = ${builtArea},
        terrace_area_m2 = ${terraceArea},
        updated_at = NOW()
      WHERE id = ${id}
    `);

    // 2) sync amenities (property_features)
    //    - —É–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ —Å–≤—è–∑–∏
    //    - –≤—Å—Ç–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ (–µ—Å–ª–∏ –µ—Å—Ç—å)
    await db.execute(sql`
      DELETE FROM property_features
      WHERE property_id = ${id}
    `);

    if (featureIds.length > 0) {
      const valuesSql = sql.join(
        featureIds.map((fid) => sql`(${id}, ${fid})`),
        sql`, `
      );

      // –ï—Å–ª–∏ —É —Ç–µ–±—è –µ—Å—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å/PK (property_id, feature_id), —ç—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ
      await db.execute(sql`
        INSERT INTO property_features (property_id, feature_id)
        VALUES ${valuesSql}
        ON CONFLICT DO NOTHING
      `);
    }

    redirect(`/admin/properties/${id}`);
  }

  return (
    <main style={{ padding: 18 }}>
      <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", gap: 12, flexWrap: "wrap" }}>
        <h1 style={{ margin: 0 }}>Edit property #{id}</h1>
        <div style={{ display: "flex", gap: 10, flexWrap: "wrap" }}>
          <Link href="/admin/properties" style={btnGhost}>
            ‚Üê Back
          </Link>
          <a href={`/properties/${prop.slug ?? ""}`} style={btnGhost} target="_blank" rel="noreferrer">
            Public page
          </a>
        </div>
      </div>

      {/* Base fields + Amenities */}
      <section style={card}>
        <form action={updateBase}>
          <div style={grid2}>
            <Field label="Slug">
              <input name="slug" defaultValue={prop.slug ?? ""} style={input} />
            </Field>
            <Field label="Currency">
              <input name="currency" defaultValue={prop.currency ?? "EUR"} style={input} />
            </Field>
          </div>

          <div style={grid3}>
            <Field label="Price">
              <input name="price" defaultValue={prop.price ?? ""} style={input} />
            </Field>
            <Field label="Bedrooms">
              <input name="bedrooms" defaultValue={prop.bedrooms ?? ""} style={input} />
            </Field>
            <Field label="Bathrooms">
              <input name="bathrooms" defaultValue={prop.bathrooms ?? ""} style={input} />
            </Field>
          </div>

          <Field label="Location">
            <input name="location" defaultValue={prop.location ?? ""} style={input} />
          </Field>
          <Field label="Description (EN)">
            <textarea
              name="descriptionEn"
              defaultValue={prop.description_en ?? ""}
              rows={6}
              style={textarea}
              placeholder="Short description in English..."
            />
          </Field>

          <Field label="Description (ES)">
            <textarea
              name="descriptionEs"
              defaultValue={prop.description_es ?? ""}
              rows={6}
              style={textarea}
              placeholder="Descripci√≥n en espa√±ol..."
            />
          </Field>


          <div style={grid3}>
            <Field label="Plot area (m¬≤)">
              <input name="plotAreaM2" defaultValue={prop.plot_area_m2 ?? ""} style={input} />
            </Field>
            <Field label="Built area (m¬≤)">
              <input name="builtAreaM2" defaultValue={prop.built_area_m2 ?? ""} style={input} />
            </Field>
            <Field label="Terrace area (m¬≤)">
              <input name="terraceAreaM2" defaultValue={prop.terrace_area_m2 ?? ""} style={input} />
            </Field>
          </div>

          {/* ‚úÖ Amenities */}
          <div style={{ marginTop: 10, borderTop: "1px solid #E2E2DE", paddingTop: 12 }}>
            <div style={{ fontWeight: 700, marginBottom: 8 }}>Amenities</div>

            {features.length === 0 ? (
              <div style={{ opacity: 0.7 }}>No features found. (Seed features first.)</div>
            ) : (
              <div style={amenitiesGrid}>
                {features.map((f) => {
                  const checked = selectedSet.has(Number(f.id));
                  return (
                    <label key={f.id} style={amenityItem}>
                      <input
                        type="checkbox"
                        name="features"
                        value={String(f.id)}
                        defaultChecked={checked}
                      />
                      <span style={{ marginLeft: 8 }}>{f.label}</span>
                    </label>
                  );
                })}
              </div>
            )}
          </div>

          <div style={{ marginTop: 10, display: "flex", alignItems: "center", gap: 10 }}>
            <input id="isPublished" name="isPublished" type="checkbox" defaultChecked={!!prop.is_published} />
            <label htmlFor="isPublished">Published</label>
          </div>

          <div style={{ marginTop: 14 }}>
            <button type="submit" style={btnPrimaryFill}>
              Save changes
            </button>
          </div>
        </form>
      </section>

      {/* Plans PDF */}
      <section style={card}>
        <h2 style={h2}>Plans (PDF)</h2>

        {plansHref ? (
          <div style={{ marginTop: 8, display: "flex", alignItems: "center", gap: 10, flexWrap: "wrap" }}>
            <span>
              Current:{" "}
              <a href={plansHref} target="_blank" rel="noreferrer">
                {plansHref}
              </a>
            </span>

            <form action={`/api/admin/properties/${id}/plans`} method="post">
              <input type="hidden" name="_method" value="delete" />
              <button type="submit" style={btnDanger}>
                Delete PDF
              </button>
            </form>
          </div>
        ) : (
          <p style={{ marginTop: 8, opacity: 0.7 }}>No plans uploaded yet.</p>
        )}

        <div style={{ marginTop: 12 }}>
          <UploadForms propertyId={id} />
        </div>
      </section>

      {/* Images preview */}
      <section style={card}>
        <h2 style={h2}>Images</h2>

        {images.length === 0 ? (
          <p style={{ marginTop: 12, opacity: 0.7 }}>No images yet.</p>
        ) : (
          <div
            style={{
              marginTop: 14,
              display: "grid",
              gridTemplateColumns: "repeat(auto-fill, minmax(200px, 1fr))",
              gap: 12,
            }}
          >
            {images.map((img, idx) => {
              const isFirst = idx === 0;
              const isLast = idx === images.length - 1;

              return (
                <div key={img.id} style={{ border: "1px solid #E2E2DE", borderRadius: 14, overflow: "hidden" }}>
                  <img src={img.url} alt={img.alt ?? ""} style={{ width: "100%", height: 150, objectFit: "cover" }} />

                  <div style={{ padding: 10, fontSize: 13 }}>
                    <div style={{ display: "flex", justifyContent: "space-between", gap: 10, alignItems: "center" }}>
                      <span style={{ opacity: 0.75 }}>#{img.sort_order}</span>
                      {img.is_cover ? <strong>Cover</strong> : <span style={{ opacity: 0.5 }}>‚Äî</span>}
                    </div>

                    <div style={{ marginTop: 6, opacity: 0.7, wordBreak: "break-all" }}>{img.url}</div>

                    <div style={{ marginTop: 10, display: "flex", gap: 8, flexWrap: "wrap" }}>
                      {/* Set cover */}
                      <form action={`/api/admin/properties/${id}/images`} method="post">
                        <input type="hidden" name="_method" value="setCover" />
                        <input type="hidden" name="imageId" value={String(img.id)} />
                        <button type="submit" style={btnMini} disabled={!!img.is_cover}>
                          {img.is_cover ? "Cover" : "Set cover"}
                        </button>
                      </form>

                      {/* Move up */}
                      <form action={`/api/admin/properties/${id}/images`} method="post">
                        <input type="hidden" name="_method" value="move" />
                        <input type="hidden" name="dir" value="up" />
                        <input type="hidden" name="imageId" value={String(img.id)} />
                        <button type="submit" style={btnMini} disabled={isFirst}>
                          ‚Üë Up
                        </button>
                      </form>

                      {/* Move down */}
                      <form action={`/api/admin/properties/${id}/images`} method="post">
                        <input type="hidden" name="_method" value="move" />
                        <input type="hidden" name="dir" value="down" />
                        <input type="hidden" name="imageId" value={String(img.id)} />
                        <button type="submit" style={btnMini} disabled={isLast}>
                          ‚Üì Down
                        </button>
                      </form>

                      {/* Delete */}
                      <form action={`/api/admin/properties/${id}/images`} method="post">
                        <input type="hidden" name="_method" value="delete" />
                        <input type="hidden" name="imageId" value={String(img.id)} />
                        <button type="submit" style={btnMiniDanger}>
                          Delete
                        </button>
                      </form>
                    </div>
                  </div>
                </div>
              );
            })}
          </div>
        )}
      </section>
    </main>
  );
}

function Field({ label, children }: { label: string; children: React.ReactNode }) {
  return (
    <div style={{ marginBottom: 12 }}>
      <label style={{ fontWeight: 600, display: "block", marginBottom: 6 }}>{label}</label>
      {children}
    </div>
  );
}

const card: React.CSSProperties = {
  marginTop: 18,
  border: "1px solid #E2E2DE",
  borderRadius: 16,
  padding: 16,
  background: "#fff",
};

const h2: React.CSSProperties = { fontSize: 18, margin: 0 };
const input: React.CSSProperties = { width: "100%", padding: 12, borderRadius: 12, border: "1px solid #E2E2DE" };
const grid2: React.CSSProperties = { display: "grid", gridTemplateColumns: "1fr 1fr", gap: 14 };
const grid3: React.CSSProperties = { display: "grid", gridTemplateColumns: "1fr 1fr 1fr", gap: 14 };

const amenitiesGrid: React.CSSProperties = {
  display: "grid",
  gridTemplateColumns: "repeat(auto-fill, minmax(220px, 1fr))",
  gap: 10,
};

const amenityItem: React.CSSProperties = {
  display: "flex",
  alignItems: "center",
  gap: 8,
  padding: "10px 12px",
  borderRadius: 12,
  border: "1px solid #E2E2DE",
  background: "#fafafa",
};

const btnGhost: React.CSSProperties = {
  padding: "10px 14px",
  borderRadius: 12,
  border: "1px solid #E2E2DE",
  textDecoration: "none",
  color: "inherit",
};

const btnPrimaryFill: React.CSSProperties = {
  padding: "10px 14px",
  borderRadius: 12,
  border: "1px solid #0E5E56",
  background: "#0E5E56",
  color: "#fff",
  fontWeight: 600,
  cursor: "pointer",
};

const btnDanger: React.CSSProperties = {
  padding: "10px 14px",
  borderRadius: 12,
  border: "1px solid #d95555",
  background: "#d95555",
  color: "#fff",
  fontWeight: 600,
  cursor: "pointer",
};

const btnMini: React.CSSProperties = {
  padding: "8px 10px",
  borderRadius: 10,
  border: "1px solid #E2E2DE",
  background: "#fff",
  cursor: "pointer",
  fontWeight: 600,
};

const btnMiniDanger: React.CSSProperties = {
  padding: "8px 10px",
  borderRadius: 10,
  border: "1px solid #d95555",
  background: "#fff5f5",
  cursor: "pointer",
  fontWeight: 600,
  color: "#a11d1d",
};

const textarea: React.CSSProperties = {
  width: "100%",
  padding: 12,
  borderRadius: 12,
  border: "1px solid #E2E2DE",
  resize: "vertical",
  minHeight: 120,
};

```

---

## app/admin/properties/new/page.tsx

```typescript
import Link from "next/link";
import { redirect } from "next/navigation";
import { sql } from "drizzle-orm";
import { db } from "@/db";

export const dynamic = "force-dynamic";

function toInt(v: FormDataEntryValue | null) {
  if (v === null) return null;
  const s = String(v).trim();
  if (!s) return null;
  const n = Number.parseInt(s, 10);
  return Number.isFinite(n) ? n : null;
}

function toDecimal(v: FormDataEntryValue | null) {
  if (v === null) return null;
  const s = String(v).trim().replace(",", ".");
  if (!s) return null;
  const n = Number.parseFloat(s);
  return Number.isFinite(n) ? n : null;
}

export default async function AdminPropertyNewPage() {
  // ‚úÖ features –¥–ª—è —á–µ–∫–±–æ–∫—Å–æ–≤ (EN labels, –∞–¥–º–∏–Ω–∫–∞ –±–µ–∑ i18n)
  const featuresRes = await db.execute(sql`
    SELECT
      f.id,
      f.key,
      COALESCE(ft.label, f.key) AS label
    FROM features f
    LEFT JOIN feature_translations ft
      ON ft.feature_id = f.id AND ft.lang = 'en'
    ORDER BY COALESCE(ft.label, f.key) ASC
  `);
  const features = ((featuresRes as any).rows ?? []) as Array<{ id: number; key: string; label: string }>;

  async function create(formData: FormData) {
    "use server";

    const slugRaw = String(formData.get("slug") || "").trim();
    const slug = slugRaw
      .toLowerCase()
      .replace(/\s+/g, "-")
      .replace(/[^a-z0-9-]/g, "");

    if (!slug) redirect("/admin/properties/new");

    const isPublished = formData.get("isPublished") === "on";

    const price = toDecimal(formData.get("price"));
    const currency =
      String(formData.get("currency") || "EUR").trim().toUpperCase().slice(0, 3) || "EUR";

    const location = String(formData.get("location") || "").trim() || null;

    const bedrooms = toInt(formData.get("bedrooms"));
    const bathrooms = toInt(formData.get("bathrooms"));

    // –ø–ª–æ—â–∞–¥–∏ (–æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –±—ã–ª–æ)
    const plotAreaM2 = toInt(formData.get("plotAreaM2"));
    const builtAreaM2 = toInt(formData.get("builtAreaM2"));
    const terraceAreaM2 = toInt(formData.get("terraceAreaM2"));

    // –æ–ø–∏—Å–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞
    const descriptionEn = String(formData.get("descriptionEn") || "").trim() || null;
    const descriptionEs = String(formData.get("descriptionEs") || "").trim() || null;

    // –ø–ª–∞–Ω—ã (–ø–æ–∫–∞ –ø—Ä–æ—Å—Ç–æ —Å—Å—ã–ª–∫–∞/–ø—É—Ç—å)
    const plansUrl = String(formData.get("plansUrl") || "").trim() || null;

    // ‚úÖ Amenities (features) –∏–∑ —á–µ–∫–±–æ–∫—Å–æ–≤
    const rawFeatureIds = formData.getAll("features");
    const featureIds = rawFeatureIds
      .map((v) => Number(String(v)))
      .filter((n) => Number.isFinite(n)) as number[];

    try {
      // 1) —Å–æ–∑–¥–∞—ë–º property –∏ –ø–æ–ª—É—á–∞–µ–º id
      const inserted = await db.execute(sql`
        INSERT INTO properties
          (
            slug,
            is_published,
            price,
            currency,
            bedrooms,
            bathrooms,
            location,
            description_en,
            description_es,
            plot_area_m2,
            built_area_m2,
            terrace_area_m2,
            plans_url
          )
        VALUES
          (
            ${slug},
            ${isPublished},
            ${price},
            ${currency},
            ${bedrooms},
            ${bathrooms},
            ${location},
            ${descriptionEn},
            ${descriptionEs},
            ${plotAreaM2},
            ${builtAreaM2},
            ${terraceAreaM2},
            ${plansUrl}
          )
        RETURNING id
      `);

      const newId = Number((inserted as any).rows?.[0]?.id);
      if (!Number.isFinite(newId)) redirect("/admin/properties/new");

      // 2) –∑–∞–ø–∏—Å—ã–≤–∞–µ–º amenities –≤ property_features
      if (featureIds.length > 0) {
        const valuesSql = sql.join(
          featureIds.map((fid) => sql`(${newId}, ${fid})`),
          sql`, `
        );

        await db.execute(sql`
          INSERT INTO property_features (property_id, feature_id)
          VALUES ${valuesSql}
          ON CONFLICT DO NOTHING
        `);
      }
    } catch {
      redirect("/admin/properties/new");
    }

    redirect("/admin/properties");
  }

  return (
    <main style={{ maxWidth: 900, margin: "60px auto", padding: 16 }}>
      <header style={{ display: "flex", alignItems: "center", justifyContent: "space-between", gap: 12 }}>
        <div>
          <h1 style={{ fontSize: 34, margin: 0 }}>Create property</h1>
          <p style={{ marginTop: 8, opacity: 0.75 }}>
            –ó–∞–ø–æ–ª–Ω–∏ —Ç–æ–ª—å–∫–æ —Ç–æ, —á—Ç–æ –∏–∑–≤–µ—Å—Ç–Ω–æ. –ü—É—Å—Ç—ã–µ –ø–æ–ª—è –Ω–µ –±—É–¥—É—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å—Å—è –Ω–∞ —Å–∞–π—Ç–µ.
          </p>
        </div>

        <Link
          href="/admin/properties"
          style={{
            padding: "10px 14px",
            borderRadius: 12,
            border: "1px solid #E2E2DE",
            textDecoration: "none",
            color: "inherit",
          }}
        >
          ‚Üê Back to list
        </Link>
      </header>

      <form action={create} style={{ marginTop: 18 }}>
        <div
          style={{
            border: "1px solid #E2E2DE",
            borderRadius: 16,
            background: "#fff",
            padding: 18,
          }}
        >
          <Field label="Slug (required)" hint="URL id, –Ω–∞–ø—Ä–∏–º–µ—Ä: modern-villa-marbella">
            <input name="slug" required placeholder="modern-villa-marbella" style={inputStyle} />
          </Field>

          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 14 }}>
            <Field label="Price" hint="–Ω–∞–ø—Ä–∏–º–µ—Ä: 350000">
              <input name="price" inputMode="decimal" placeholder="350000" style={inputStyle} />
            </Field>

            <Field label="Currency" hint="EUR / USD ...">
              <input name="currency" defaultValue="EUR" style={inputStyle} />
            </Field>
          </div>

          <Field label="Location" hint="–Ω–∞–ø—Ä–∏–º–µ—Ä: Marbella, Nueva Andaluc√≠a">
            <input name="location" placeholder="Marbella" style={inputStyle} />
          </Field>

          <Field label="Description (EN)" hint="–ö–æ—Ä–æ—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º">
            <textarea
              name="descriptionEn"
              rows={6}
              placeholder="Short description in English..."
              style={textarea}
            />
          </Field>

          <Field label="Description (ES)" hint="Descripci√≥n en espa√±ol">
            <textarea
              name="descriptionEs"
              rows={6}
              placeholder="Descripci√≥n en espa√±ol..."
              style={textarea}
            />
          </Field>

          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 14 }}>
            <Field label="Bedrooms">
              <input name="bedrooms" inputMode="numeric" placeholder="3" style={inputStyle} />
            </Field>

            <Field label="Bathrooms">
              <input name="bathrooms" inputMode="numeric" placeholder="2" style={inputStyle} />
            </Field>
          </div>

          <h2 style={{ fontSize: 18, marginTop: 18, marginBottom: 10 }}>Areas (m¬≤)</h2>

          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr 1fr", gap: 14 }}>
            <Field label="Plot area" hint="—É—á–∞—Å—Ç–æ–∫ (–¥–ª—è –¥–æ–º–∞/–≤–∏–ª–ª—ã)">
              <input name="plotAreaM2" inputMode="numeric" placeholder="450" style={inputStyle} />
            </Field>

            <Field label="Built area" hint="–ø–ª–æ—â–∞–¥—å –∑–∞—Å—Ç—Ä–æ–π–∫–∏">
              <input name="builtAreaM2" inputMode="numeric" placeholder="120" style={inputStyle} />
            </Field>

            <Field label="Terrace area" hint="—Ç–µ—Ä—Ä–∞—Å—ã">
              <input name="terraceAreaM2" inputMode="numeric" placeholder="30" style={inputStyle} />
            </Field>
          </div>

          {/* ‚úÖ Amenities */}
          <h2 style={{ fontSize: 18, marginTop: 18, marginBottom: 10 }}>Amenities</h2>

          {features.length === 0 ? (
            <p style={{ marginTop: 6, opacity: 0.7 }}>No features found. (Seed features first.)</p>
          ) : (
            <div style={amenitiesGrid}>
              {features.map((f) => (
                <label key={f.id} style={amenityItem}>
                  <input type="checkbox" name="features" value={String(f.id)} />
                  <span style={{ marginLeft: 8 }}>{f.label}</span>
                </label>
              ))}
            </div>
          )}

          <h2 style={{ fontSize: 18, marginTop: 18, marginBottom: 10 }}>Plans</h2>

          <Field label="Plans URL / Path" hint="–ø–æ–∫–∞ —Å—Å—ã–ª–∫–∞, –ø–æ–∑–∂–µ —Å–¥–µ–ª–∞–µ–º upload PDF">
            <input name="plansUrl" placeholder="/uploads/plans/..." style={inputStyle} />
          </Field>

          <div style={{ marginTop: 14, display: "flex", alignItems: "center", gap: 10 }}>
            <input id="isPublished" name="isPublished" type="checkbox" />
            <label htmlFor="isPublished" style={{ userSelect: "none" }}>
              Published
            </label>
          </div>

          <div style={{ marginTop: 18, display: "flex", gap: 10 }}>
            <button
              type="submit"
              style={{
                padding: "10px 14px",
                borderRadius: 12,
                border: "1px solid #0E5E56",
                background: "#0E5E56",
                color: "#fff",
                fontWeight: 600,
                cursor: "pointer",
              }}
            >
              Save
            </button>

            <Link
              href="/admin/properties"
              style={{
                padding: "10px 14px",
                borderRadius: 12,
                border: "1px solid #E2E2DE",
                textDecoration: "none",
                color: "inherit",
              }}
            >
              Cancel
            </Link>
          </div>

          <p style={{ marginTop: 14, opacity: 0.65, fontSize: 13 }}>
            –ï—Å–ª–∏ slug —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç ‚Äî —Ñ–æ—Ä–º–∞ –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –∑–∞–Ω–æ–≤–æ (–ø–æ–∑–∂–µ –¥–æ–±–∞–≤–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ).
          </p>
        </div>
      </form>
    </main>
  );
}

function Field({
  label,
  hint,
  children,
}: {
  label: string;
  hint?: string;
  children: React.ReactNode;
}) {
  return (
    <div style={{ marginBottom: 14 }}>
      <div style={{ display: "flex", alignItems: "baseline", justifyContent: "space-between", gap: 10 }}>
        <label style={{ fontWeight: 600 }}>{label}</label>
        {hint ? <span style={{ fontSize: 12, opacity: 0.6 }}>{hint}</span> : null}
      </div>
      <div style={{ marginTop: 6 }}>{children}</div>
    </div>
  );
}

const inputStyle: React.CSSProperties = {
  width: "100%",
  padding: 12,
  borderRadius: 12,
  border: "1px solid #E2E2DE",
};

const textarea: React.CSSProperties = {
  width: "100%",
  padding: 12,
  borderRadius: 12,
  border: "1px solid #E2E2DE",
  resize: "vertical",
  minHeight: 120,
};

const amenitiesGrid: React.CSSProperties = {
  display: "grid",
  gridTemplateColumns: "repeat(auto-fill, minmax(220px, 1fr))",
  gap: 10,
};

const amenityItem: React.CSSProperties = {
  display: "flex",
  alignItems: "center",
  gap: 8,
  padding: "10px 12px",
  borderRadius: 12,
  border: "1px solid #E2E2DE",
  background: "#fafafa",
};

```

---

## app/admin/properties/page.tsx

```typescript
import Link from "next/link";
import { sql } from "drizzle-orm";
import { db } from "@/db";

export const dynamic = "force-dynamic";

type PropertyRow = {
  id: number;
  slug: string;
  is_published: boolean;
  price: string | null;
  currency: string;
  location: string | null;
  created_at: string;
};

export default async function AdminPropertiesPage() {
  const result = await db.execute(sql`
    SELECT id, slug, is_published, price, currency, location, created_at
    FROM properties
    ORDER BY id DESC
    LIMIT 200
  `);

  const rows = (result as any).rows as PropertyRow[];

  return (
    <main style={{ maxWidth: 1100, margin: "60px auto", padding: 16 }}>
      <header style={{ display: "flex", alignItems: "center", justifyContent: "space-between", gap: 12 }}>
        <div>
          <h1 style={{ fontSize: 34, margin: 0 }}>Properties</h1>
          <p style={{ marginTop: 8, opacity: 0.75 }}>
            {rows.length} item(s)
          </p>
        </div>

        <div style={{ display: "flex", gap: 10 }}>
          <Link href="/admin" style={btnGhost}>‚Üê Admin</Link>
          <Link href="/admin/properties/new" style={btnPrimary}>+ Create</Link>
        </div>
      </header>

      <section style={card}>
        {rows.length === 0 ? (
          <div style={{ padding: 18 }}>
            <p style={{ margin: 0 }}>No properties yet.</p>
          </div>
        ) : (
          <div style={{ overflowX: "auto" }}>
            <table style={{ width: "100%", borderCollapse: "collapse" }}>
              <thead>
                <tr>
                  {["ID", "Slug", "Status", "Price", "Location", "Created", "Actions"].map((h) => (
                    <th key={h} style={th}>{h}</th>
                  ))}
                </tr>
              </thead>
              <tbody>
                {rows.map((p) => (
                  <tr key={p.id}>
                    <td style={td}>{p.id}</td>
                    <td style={td}><code>{p.slug}</code></td>
                    <td style={td}>{p.is_published ? "Published" : "Draft"}</td>
                    <td style={td}>
                      {p.price ? `${p.price} ${p.currency}` : <span style={{ opacity: 0.5 }}>‚Äî</span>}
                    </td>
                    <td style={td}>{p.location ?? <span style={{ opacity: 0.5 }}>‚Äî</span>}</td>
                    <td style={td}>{new Date(p.created_at).toLocaleString()}</td>
                    <td style={td}>
                      <Link href={`/admin/properties/${p.id}`} style={{ textDecoration: "none", fontWeight: 600 }}>
                        Edit ‚Üí
                      </Link>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        )}
      </section>
    </main>
  );
}

const card: React.CSSProperties = {
  marginTop: 18,
  border: "1px solid #E2E2DE",
  borderRadius: 16,
  overflow: "hidden",
  background: "#fff",
};

const th: React.CSSProperties = {
  textAlign: "left",
  fontSize: 12,
  letterSpacing: 0.3,
  textTransform: "uppercase",
  padding: "12px 14px",
  borderBottom: "1px solid #E2E2DE",
  background: "#F6F5F2",
  whiteSpace: "nowrap",
};

const td: React.CSSProperties = {
  padding: "12px 14px",
  borderBottom: "1px solid #F0F0ED",
  verticalAlign: "top",
  whiteSpace: "nowrap",
};

const btnGhost: React.CSSProperties = {
  padding: "10px 14px",
  borderRadius: 12,
  border: "1px solid #E2E2DE",
  textDecoration: "none",
  color: "inherit",
};

const btnPrimary: React.CSSProperties = {
  padding: "10px 14px",
  borderRadius: 12,
  border: "1px solid #0E5E56",
  textDecoration: "none",
  color: "#0E5E56",
  fontWeight: 600,
};

```

---

## app/api/admin/properties/[id]/images/route.ts

```typescript
// app/api/admin/properties/[id]/images/route.ts
import { NextResponse } from "next/server";
import { sql } from "drizzle-orm";
import { db } from "@/db";
import path from "path";
import fs from "fs/promises";

export const runtime = "nodejs";
export const dynamic = "force-dynamic";

function safeName(name: string) {
  return name
    .toLowerCase()
    .replace(/\s+/g, "-")
    .replace(/[^a-z0-9.\-_]/g, "");
}

function toDiskPathFromPublicUrl(publicUrl: string) {
  // publicUrl –≤–∏–¥–∞ "/uploads/properties/xxx.jpg"
  const clean = publicUrl.startsWith("/") ? publicUrl.slice(1) : publicUrl;
  return path.join(process.cwd(), "public", clean);
}

async function ensureBelongsToProperty(imageId: number, propertyId: number) {
  const res = await db.execute(sql`
    SELECT id, property_id, url, is_cover, sort_order
    FROM property_images
    WHERE id = ${imageId}
    LIMIT 1
  `);

  const img = (res as any).rows?.[0];
  if (!img || Number(img.property_id) !== propertyId) return null;
  return img as { id: number; property_id: number; url: string; is_cover: boolean; sort_order: number };
}

async function setCover(imageId: number, propertyId: number) {
  // 1) —Å–Ω—è—Ç—å cover —Å–æ –≤—Å–µ—Ö
  await db.execute(sql`
    UPDATE property_images
    SET is_cover = false
    WHERE property_id = ${propertyId}
  `);

  // 2) –ø–æ—Å—Ç–∞–≤–∏—Ç—å cover –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É
  await db.execute(sql`
    UPDATE property_images
    SET is_cover = true
    WHERE id = ${imageId}
  `);
}

async function moveImage(imageId: number, propertyId: number, dir: "up" | "down") {
  const current = await ensureBelongsToProperty(imageId, propertyId);
  if (!current) return { ok: false, status: 404 as const, error: "Image not found" };

  const curSort = Number(current.sort_order);

  // –ù–∞—Ö–æ–¥–∏–º "—Å–æ—Å–µ–¥–∞" –ø–æ sort_order
  const neighborRes =
    dir === "up"
      ? await db.execute(sql`
          SELECT id, sort_order
          FROM property_images
          WHERE property_id = ${propertyId}
            AND (sort_order < ${curSort} OR (sort_order = ${curSort} AND id < ${imageId}))
          ORDER BY sort_order DESC, id DESC
          LIMIT 1
        `)
      : await db.execute(sql`
          SELECT id, sort_order
          FROM property_images
          WHERE property_id = ${propertyId}
            AND (sort_order > ${curSort} OR (sort_order = ${curSort} AND id > ${imageId}))
          ORDER BY sort_order ASC, id ASC
          LIMIT 1
        `);

  const neighbor = (neighborRes as any).rows?.[0];
  if (!neighbor) {
    // —É–∂–µ –∫—Ä–∞–π–Ω–∏–π
    return { ok: true as const };
  }

  const neighborId = Number(neighbor.id);
  const neighborSort = Number(neighbor.sort_order);

  // swap sort_order –º–µ—Å—Ç–∞–º–∏
  await db.execute(sql`
    UPDATE property_images
    SET sort_order = ${neighborSort}
    WHERE id = ${imageId}
  `);

  await db.execute(sql`
    UPDATE property_images
    SET sort_order = ${curSort}
    WHERE id = ${neighborId}
  `);

  return { ok: true as const };
}

// ‚úÖ upload images (multiple) + delete + setCover + move
export async function POST(req: Request, ctx: { params: Promise<{ id: string }> }) {
  const { id } = await ctx.params;
  const propertyId = Number(id);
  if (!Number.isFinite(propertyId)) {
    return NextResponse.json({ error: "Bad id" }, { status: 400 });
  }

  const form = await req.formData();

  // ‚úÖ –º–µ—Ç–æ–¥-–æ–≤–µ—Ä—Ä–∞–π–¥ (–∫–∞–∫ —É —Ç–µ–±—è —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ –¥–ª—è delete)
  const methodOverride = String(form.get("_method") || "").toLowerCase();

  // 1) delete image
  if (methodOverride === "delete") {
    const imageId = Number(form.get("imageId"));
    if (!Number.isFinite(imageId)) {
      return NextResponse.json({ error: "Bad imageId" }, { status: 400 });
    }

    const img = await ensureBelongsToProperty(imageId, propertyId);
    if (!img) {
      return NextResponse.json({ error: "Image not found" }, { status: 404 });
    }

    // —É–¥–∞–ª—è–µ–º —Ñ–∞–π–ª —Å –¥–∏—Å–∫–∞ (–µ—Å–ª–∏ –≤–¥—Ä—É–≥ —É–∂–µ —É–¥–∞–ª—ë–Ω ‚Äî –Ω–µ –ø–∞–¥–∞–µ–º)
    const diskPath = toDiskPathFromPublicUrl(String(img.url));
    try {
      await fs.unlink(diskPath);
    } catch {
      // ignore
    }

    // —É–¥–∞–ª—è–µ–º –∑–∞–ø–∏—Å—å –∏–∑ –ë–î
    await db.execute(sql`DELETE FROM property_images WHERE id = ${imageId}`);

    // –µ—Å–ª–∏ —É–¥–∞–ª–∏–ª–∏ cover ‚Äî –Ω–∞–∑–Ω–∞—á–∏–º –Ω–æ–≤—ã–π cover (–ø–µ—Ä–≤—É—é –ø–æ sort_order)
    if (img.is_cover) {
      const nextRes = await db.execute(sql`
        SELECT id
        FROM property_images
        WHERE property_id = ${propertyId}
        ORDER BY sort_order ASC, id ASC
        LIMIT 1
      `);
      const nextId = (nextRes as any).rows?.[0]?.id;
      if (nextId) {
        await setCover(Number(nextId), propertyId);
      }
    }

    return NextResponse.redirect(new URL(`/admin/properties/${propertyId}`, req.url), 303);
  }

  // 2) set cover
  if (methodOverride === "setcover") {
    const imageId = Number(form.get("imageId"));
    if (!Number.isFinite(imageId)) {
      return NextResponse.json({ error: "Bad imageId" }, { status: 400 });
    }

    const img = await ensureBelongsToProperty(imageId, propertyId);
    if (!img) {
      return NextResponse.json({ error: "Image not found" }, { status: 404 });
    }

    await setCover(imageId, propertyId);
    return NextResponse.redirect(new URL(`/admin/properties/${propertyId}`, req.url), 303);
  }

  // 3) move up/down
  if (methodOverride === "move") {
    const imageId = Number(form.get("imageId"));
    const dirRaw = String(form.get("dir") || "").toLowerCase();
    const dir = dirRaw === "up" ? "up" : dirRaw === "down" ? "down" : null;

    if (!Number.isFinite(imageId) || !dir) {
      return NextResponse.json({ error: "Bad move params" }, { status: 400 });
    }

    const res = await moveImage(imageId, propertyId, dir);
    if (!res.ok) return NextResponse.json({ error: res.error }, { status: res.status });

    return NextResponse.redirect(new URL(`/admin/properties/${propertyId}`, req.url), 303);
  }

  // 4) –æ–±—ã—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ (–∫–∞–∫ —É —Ç–µ–±—è —Å–µ–π—á–∞—Å)
  const files = form.getAll("files").filter((x) => x instanceof File) as File[];

  if (files.length === 0) {
    return NextResponse.json({ error: "No files (field name must be 'files')" }, { status: 400 });
  }

  // max sort_order
  const maxRes = await db.execute(sql`
    SELECT COALESCE(MAX(sort_order), 0) AS max
    FROM property_images
    WHERE property_id = ${propertyId}
  `);
  const maxSort = Number((maxRes as any).rows?.[0]?.max ?? 0);

  // already has cover?
  const coverRes = await db.execute(sql`
    SELECT id
    FROM property_images
    WHERE property_id = ${propertyId} AND is_cover = true
    LIMIT 1
  `);
  const hasCover = !!(coverRes as any).rows?.length;

  let i = 0;
  for (const file of files) {
    if (!file.type.startsWith("image/")) continue;

    const bytes = await file.arrayBuffer();
    const buffer = Buffer.from(bytes);

    const filename = `property-${propertyId}-${Date.now()}-${i}-${safeName(file.name || "image")}`;
    const diskPath = path.join(process.cwd(), "public", "uploads", "properties", filename);
    const publicUrl = `/uploads/properties/${filename}`;

    await fs.mkdir(path.dirname(diskPath), { recursive: true });
    await fs.writeFile(diskPath, buffer);

    const sortOrder = maxSort + i + 1;
    const isCover = !hasCover && i === 0;

    await db.execute(sql`
      INSERT INTO property_images (property_id, url, alt, sort_order, is_cover)
      VALUES (${propertyId}, ${publicUrl}, ${null}, ${sortOrder}, ${isCover})
    `);

    i++;
  }

  return NextResponse.redirect(new URL(`/admin/properties/${propertyId}`, req.url), 303);
}

```

---

## app/api/admin/properties/[id]/plans/route.ts

```typescript
import { NextResponse } from "next/server";
import { sql } from "drizzle-orm";
import { db } from "@/db";
import path from "node:path";
import fs from "node:fs/promises";

export const runtime = "nodejs";
export const dynamic = "force-dynamic";

function safeName(name: string) {
  return name
    .toLowerCase()
    .replace(/\s+/g, "-")
    .replace(/[^a-z0-9.\-_]/g, "");
}

async function ensureDir(dirPath: string) {
  await fs.mkdir(dirPath, { recursive: true });
}

async function deleteFileIfInUploads(plansUrl: string | null) {
  if (!plansUrl) return;
  const url = String(plansUrl).trim();
  if (!url.startsWith("/uploads/")) return;

  // url: /uploads/plans/xxx.pdf
  const filePath = path.join(process.cwd(), "public", url);
  try {
    await fs.unlink(filePath);
  } catch {
    // –µ—Å–ª–∏ —Ñ–∞–π–ª–∞ –Ω–µ—Ç ‚Äî –ø—Ä–æ—Å—Ç–æ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º
  }
}

async function getCurrentPlansUrl(propertyId: number) {
  const res = await db.execute(sql`
    SELECT plans_url
    FROM properties
    WHERE id = ${propertyId}
    LIMIT 1
  `);
  const row = (res as any).rows?.[0];
  return (row?.plans_url ?? null) as string | null;
}

/**
 * POST:
 * - –æ–±—ã—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ pdf (field: file)
 * - –∏–ª–∏ "_method=delete" –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ HTML form
 */
export async function POST(req: Request, ctx: { params: Promise<{ id: string }> }) {
  const { id } = await ctx.params;
  const propertyId = Number(id);

  if (!Number.isFinite(propertyId)) {
    return NextResponse.json({ error: "Bad id" }, { status: 400 });
  }

  const form = await req.formData();

  // ‚úÖ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ delete —á–µ—Ä–µ–∑ hidden _method
  const override = String(form.get("_method") || "").toLowerCase();
  if (override === "delete") {
    return handleDelete(req, propertyId);
  }

  const file = form.get("file");

  if (!(file instanceof File)) {
    return NextResponse.json({ error: "No file (field name must be 'file')" }, { status: 400 });
  }

  if (file.type !== "application/pdf") {
    return NextResponse.json({ error: "Only PDF allowed" }, { status: 400 });
  }

  // ‚úÖ —á–∏—Ç–∞–µ–º —Ñ–∞–π–ª
  const bytes = await file.arrayBuffer();
  const buffer = Buffer.from(bytes);

  // ‚úÖ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º, —á—Ç–æ –ø–∞–ø–∫–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
  const plansDir = path.join(process.cwd(), "public", "uploads", "plans");
  await ensureDir(plansDir);

  // ‚úÖ —É–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π pdf (–µ—Å–ª–∏ –±—ã–ª)
  const oldUrl = await getCurrentPlansUrl(propertyId);

  const filename = `property-${propertyId}-${Date.now()}-${safeName(file.name || "plans.pdf")}`;
  const diskPath = path.join(plansDir, filename);
  const publicUrl = `/uploads/plans/${filename}`;

  await fs.writeFile(diskPath, buffer);

  await db.execute(sql`
    UPDATE properties
    SET plans_url = ${publicUrl}, updated_at = NOW()
    WHERE id = ${propertyId}
  `);

  // ‚úÖ —á–∏—Å—Ç–∏–º —Å—Ç–∞—Ä—ã–π —Ñ–∞–π–ª –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∑–∞–ø–∏—Å–∏ –Ω–æ–≤–æ–≥–æ
  await deleteFileIfInUploads(oldUrl);

  return NextResponse.redirect(new URL(`/admin/properties/${propertyId}`, req.url), 303);
}

/**
 * DELETE:
 * - —É–¥–∞–ª—è–µ—Ç plans_url –∏–∑ –ë–î
 * - —É–¥–∞–ª—è–µ—Ç —Ñ–∏–∑–∏—á–µ—Å–∫–∏–π —Ñ–∞–π–ª –∏–∑ public/uploads/...
 */
export async function DELETE(req: Request, ctx: { params: Promise<{ id: string }> }) {
  const { id } = await ctx.params;
  const propertyId = Number(id);

  if (!Number.isFinite(propertyId)) {
    return NextResponse.json({ error: "Bad id" }, { status: 400 });
  }

  return handleDelete(req, propertyId);
}

async function handleDelete(req: Request, propertyId: number) {
  const oldUrl = await getCurrentPlansUrl(propertyId);

  // —É–±–∏—Ä–∞–µ–º —Å—Å—ã–ª–∫—É –∏–∑ –ë–î
  await db.execute(sql`
    UPDATE properties
    SET plans_url = NULL, updated_at = NOW()
    WHERE id = ${propertyId}
  `);

  // —É–¥–∞–ª—è–µ–º —Ñ–∞–π–ª
  await deleteFileIfInUploads(oldUrl);

  return NextResponse.redirect(new URL(`/admin/properties/${propertyId}`, req.url), 303);
}

```

---

## app/eslint.config.mjs

```javascript
import { defineConfig, globalIgnores } from "eslint/config";
import nextVitals from "eslint-config-next/core-web-vitals";
import nextTs from "eslint-config-next/typescript";

const eslintConfig = defineConfig([
  ...nextVitals,
  ...nextTs,
  // Override default ignores of eslint-config-next.
  globalIgnores([
    // Default ignores of eslint-config-next:
    ".next/**",
    "out/**",
    "build/**",
    "next-env.d.ts",
  ]),
]);

export default eslintConfig;

```

---

## app/globals.css

```css
:root {
  --bg: #fcf8f2;
  --surface: #FFFFFF;
  --text: #1C1C1C;
  --muted: #6B6B6B;
  --border: #E2E2DE;
  --accent: #2B4537;
  --accentHover: #345945;
  --header-h: 15px;
  --radius: 6px;
  --shadow: 0 10px 26px rgba(0, 0, 0, 0.06);
  --container-pad: 14px;
}

/* --- Reset / base --- */
*,
*::before,
*::after {
  box-sizing: border-box;
}

html,
body {
  max-width: 100%;
  overflow-x: hidden;
  margin: 0;
  padding: 0;
  background: var(--bg);
  color: var(--text);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  
  padding-top: var(--header-h);
}

img {
  max-width: 100%;
  height: auto;
}

main {
  display: block;
}

/* Container used across components */
.container {
  width: min(1120px, calc(100% - 48px));
  margin: 0 auto;
}

@media (max-width: 520px) {
  .container {
    width: calc(100% - 28px);
  }
}

/* Make links look like design elements (not default browser links) */
a {
  color: inherit;
  text-decoration: none;
}

a:hover {
  text-decoration: none;
}

/* Improve section rhythm */
section {
  scroll-margin-top: 90px; /* anchor links won't hide under sticky header */
}

.section {
  padding: 72px 0;
}

.section--tight {
  padding: 56px 0;
}

.section__head {
  display: grid;
  gap: 8px;
  justify-items: center;
  text-align: center;
  margin-bottom: 28px;
}

.section__kicker {
  color: var(--muted);
  font-size: 14px;
}

/* ===== Centered title with side lines ===== */
.sectionTitle {
  width: 100%;
  display: flex;
  align-items: center;
  gap: 18px;
  justify-content: center;
  margin: 0;
}

.sectionTitle::before,
.sectionTitle::after {
  content: "";
  height: 1px;
  flex: 1;
  background: var(--border);
}

.sectionTitleText {
  font-size: 34px;
  letter-spacing: 0.2px;
  font-weight: 500;
}

/* optional: slightly smaller on mobile */
@media (max-width: 640px) {
  .sectionTitleText {
    font-size: 26px;
  }
  .section {
    padding: 56px 0;
  }
}

/* ===== Buttons alignment helpers ===== */
.section__actions {
  width: 100%;
  display: flex;
  justify-content: center;
  margin-top: 22px;
}

/* Softer typography defaults */
p {
  margin: 0;
}

/* --- Typography helpers used in page/components --- */
.h1 {
  font-family: var(--font-playfair), Georgia, "Times New Roman", serif;
  font-weight: 600;
  font-size: clamp(36px, 5vw, 56px);
  line-height: 1.08;
  margin: 0;
}

.h2 {
  font-family: var(--font-playfair), Georgia, "Times New Roman", serif;
  font-weight: 600;
  font-size: 28px;
  line-height: 1.15;
  margin: 0;
}

.p {
  color: rgba(28, 28, 28, 0.72);
  font-size: 15px;
  line-height: 1.6;
}

/* --- Buttons --- */
.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  padding: 12px 18px;
  border-radius: 3px;
  font-weight: 600;
  border: 1px solid transparent;
  cursor: pointer;
  transition: transform 0.12s ease, background 0.12s ease, border 0.12s ease;
  user-select: none;
}

.btn:active {
  transform: translateY(1px);
}

.btnPrimary {
  background: var(--accent);
  color: #fff;
}

.btnPrimary:hover {
  background: var(--accentHover);
}

.btnGhost {
  background: rgba(255, 255, 255, 0.78);
  border-color: var(--border);
  color: var(--text);
  backdrop-filter: blur(6px);
}

.btnGhost:hover {
  background: rgba(255, 255, 255, 0.92);
}

/* Make <button class="btn"> look same as <a class="btn"> */
button.btn {
  appearance: none;
  background: none;
}

/* --- Inputs baseline (so forms look consistent) --- */
input,
textarea,
select,
button {
  font: inherit;
}

input,
textarea,
select {
  outline: none;
}

::placeholder {
  color: rgba(28, 28, 28, 0.45);
}



```

---

## app/lib/publicFeatured.ts

```typescript
// app/lib/publicFeatured.ts
import { sql } from "drizzle-orm";
import { db } from "@/db";

export type FeaturedItem = {
  id: number;
  slug: string;
  title: string;
  location: string;
  price: string; // formatted for UI
  beds: number;
  baths: number;
  area: number;
  image: string;
};

function titleFromSlug(slug: string) {
  if (!slug) return "Property";
  return slug
    .split("-")
    .filter(Boolean)
    .map((w) => w.charAt(0).toUpperCase() + w.slice(1))
    .join(" ");
}

function formatPrice(opts: { lang: "en" | "es"; value: number | null; currency: string | null }) {
  const { lang, value, currency } = opts;

  if (value === null || value === undefined) {
    return lang === "es" ? "Precio bajo consulta" : "Price on Request";
  }

  const cur = (currency || "EUR").toUpperCase();

  try {
    return new Intl.NumberFormat(lang === "es" ? "es-ES" : "en-GB", {
      style: "currency",
      currency: cur,
      maximumFractionDigits: 0,
    }).format(value);
  } catch {
    const n = new Intl.NumberFormat(lang === "es" ? "es-ES" : "en-GB", {
      maximumFractionDigits: 0,
    }).format(value);
    return cur === "EUR" ? `‚Ç¨${n}` : `${n} ${cur}`;
  }
}

export async function getFeaturedItems(lang: "en" | "es", limit = 6): Promise<FeaturedItem[]> {
  // 1) Published properties
  const propsRes = await db.execute(sql`
    SELECT
      id,
      slug,
      location,
      price,
      currency,
      bedrooms,
      bathrooms,
      built_area_m2
    FROM properties
    WHERE is_published = true
    ORDER BY created_at DESC
    LIMIT ${limit}
  `);

  const props = ((propsRes as any).rows ?? []) as Array<any>;
  if (props.length === 0) return [];

  const ids = props.map((p) => Number(p.id)).filter((n) => Number.isFinite(n));

  // 2) One image per property: cover first, else first by sort_order
  // ‚úÖ –í–º–µ—Å—Ç–æ ANY(int[]) –∏—Å–ø–æ–ª—å–∑—É–µ–º IN (...)
  const idSqlList = sql.join(ids.map((id) => sql`${id}`), sql`, `);

  const imagesRes = await db.execute(sql`
    SELECT DISTINCT ON (property_id)
      property_id,
      url
    FROM property_images
    WHERE property_id IN (${idSqlList})
    ORDER BY property_id, is_cover DESC, sort_order ASC, id ASC
  `);

  const images = ((imagesRes as any).rows ?? []) as Array<any>;
  const coverMap = new Map<number, string>();
  for (const row of images) {
    coverMap.set(Number(row.property_id), String(row.url));
  }

  return props.map((p) => {
    const id = Number(p.id);
    const slug = String(p.slug || "");
    const image = coverMap.get(id) ?? "/properties/p1.jpg";

    return {
      id,
      slug,
      title: titleFromSlug(slug) || `Property #${id}`,
      location: p.location ? String(p.location) : "",
      price: formatPrice({
        lang,
        value: p.price !== null && p.price !== undefined ? Number(p.price) : null,
        currency: p.currency ? String(p.currency) : null,
      }),
      beds: p.bedrooms !== null && p.bedrooms !== undefined ? Number(p.bedrooms) : 0,
      baths: p.bathrooms !== null && p.bathrooms !== undefined ? Number(p.bathrooms) : 0,
      area: p.built_area_m2 !== null && p.built_area_m2 !== undefined ? Number(p.built_area_m2) : 0,
      image,
    };
  });
}

```

---

## app/lib/publicProperties.ts

```typescript
// app/lib/publicProperties.ts
import { sql } from "drizzle-orm";
import { db } from "@/db";

/* -----------------------------
   Shared helpers
------------------------------ */

function titleFromSlug(slug: string) {
  // "modern-villa-marbella" -> "Modern Villa Marbella"
  return slug
    .split("-")
    .filter(Boolean)
    .map((w) => w.charAt(0).toUpperCase() + w.slice(1))
    .join(" ");
}

function formatPrice(opts: { lang: "en" | "es"; value: number | null; currency: string | null }) {
  const { lang, value, currency } = opts;

  if (value === null || value === undefined) {
    return lang === "es" ? "Precio bajo consulta" : "Price on Request";
  }

  const cur = (currency || "EUR").toUpperCase();

  try {
    return new Intl.NumberFormat(lang === "es" ? "es-ES" : "en-GB", {
      style: "currency",
      currency: cur,
      maximumFractionDigits: 0,
    }).format(value);
  } catch {
    const n = new Intl.NumberFormat(lang === "es" ? "es-ES" : "en-GB", {
      maximumFractionDigits: 0,
    }).format(value);
    return cur === "EUR" ? `‚Ç¨${n}` : `${n} ${cur}`;
  }
}

/* -----------------------------
   Featured (home page) - keep as is
------------------------------ */

export type FeaturedProperty = {
  id: number;
  slug: string;
  title: string;
  location: string | null;
  price: number | null;
  currency: string | null;
  bedrooms: number | null;
  bathrooms: number | null;
  built_area_m2: number | null;
  cover_url: string | null;
};

export async function getFeaturedProperties(limit = 6): Promise<FeaturedProperty[]> {
  const propsRes = await db.execute(sql`
    SELECT
      id,
      slug,
      location,
      price,
      currency,
      bedrooms,
      bathrooms,
      built_area_m2
    FROM properties
    WHERE is_published = true
    ORDER BY created_at DESC
    LIMIT ${limit}
  `);

  const props = ((propsRes as any).rows ?? []) as Array<any>;
  if (props.length === 0) return [];

  const ids = props.map((p) => Number(p.id));

  const imagesRes = await db.execute(sql`
    SELECT DISTINCT ON (property_id)
      property_id,
      url
    FROM property_images
    WHERE property_id = ANY(${ids}::int[])
    ORDER BY property_id, is_cover DESC, sort_order ASC, id ASC
  `);

  const images = ((imagesRes as any).rows ?? []) as Array<any>;
  const coverMap = new Map<number, string>();
  for (const row of images) {
    coverMap.set(Number(row.property_id), String(row.url));
  }

  return props.map((p) => {
    const slug = String(p.slug ?? "");
    return {
      id: Number(p.id),
      slug,
      title: titleFromSlug(slug || `property-${p.id}`),
      location: p.location ? String(p.location) : null,
      price: p.price !== null && p.price !== undefined ? Number(p.price) : null,
      currency: p.currency ? String(p.currency) : null,
      bedrooms: p.bedrooms !== null && p.bedrooms !== undefined ? Number(p.bedrooms) : null,
      bathrooms: p.bathrooms !== null && p.bathrooms !== undefined ? Number(p.bathrooms) : null,
      built_area_m2:
        p.built_area_m2 !== null && p.built_area_m2 !== undefined ? Number(p.built_area_m2) : null,
      cover_url: coverMap.get(Number(p.id)) ?? null,
    };
  });
}

/* -----------------------------
   Catalog + filters + amenities
------------------------------ */

export type CatalogFeature = {
  key: string;
  label: string;
};

export type CatalogItem = {
  id: number;
  slug: string;

  title: string;
  location: string;
  priceText: string;

  beds: number;
  baths: number;
  area: number;

  image: string;
  features: CatalogFeature[];
};

export type CatalogFilters = {
  type?: string | null;
  featureKeys?: string[] | null; // –æ–±—ä–µ–∫—Ç –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –í–°–ï –≤—ã–±—Ä–∞–Ω–Ω—ã–µ keys
};

// ‚úÖ –ü–æ—Å—Ç–∞–≤—å true, –∫–æ–≥–¥–∞ —Ä–µ–∞–ª—å–Ω–æ –¥–æ–±–∞–≤–∏—à—å —ç—Ç–∏ –≤–µ—â–∏ –≤ –ë–î
const HAS_PROPERTY_TYPE = false;
const HAS_PROPERTY_TRANSLATIONS = false;

function normalizeFeatureKeys(v: unknown): string[] {
  if (!Array.isArray(v)) return [];
  return v
    .map((x) => String(x || "").trim().toLowerCase())
    .filter(Boolean);
}

export async function getCatalogItems(opts: {
  lang: "en" | "es";
  page: number;
  pageSize: number;
  filters?: CatalogFilters;
}): Promise<{ items: CatalogItem[]; total: number; page: number; pageSize: number; totalPages: number }> {
  const { lang, pageSize } = opts;

  const page = Number.isFinite(opts.page) && opts.page > 0 ? Math.floor(opts.page) : 1;

  const type = (opts.filters?.type || "").trim() || null;
  const featureKeys = normalizeFeatureKeys(opts.filters?.featureKeys);
  const needFeatures = featureKeys.length > 0;

  // WHERE
  const whereParts: any[] = [sql`p.is_published = true`];
  if (HAS_PROPERTY_TYPE && type) whereParts.push(sql`p.property_type = ${type}`);
  const whereSql = sql.join(whereParts, sql` AND `);

  // TOTAL
  let total = 0;

  if (!needFeatures) {
    const totalRes = await db.execute(sql`
      SELECT COUNT(*)::int AS total
      FROM properties p
      WHERE ${whereSql}
    `);
    total = Number((totalRes as any).rows?.[0]?.total ?? 0);
  } else {
    const keysList = sql.join(featureKeys.map((k) => sql`${k}`), sql`, `);

    const totalRes = await db.execute(sql`
      SELECT COUNT(*)::int AS total
      FROM (
        SELECT p.id
        FROM properties p
        JOIN property_features pf ON pf.property_id = p.id
        JOIN features f ON f.id = pf.feature_id
        WHERE ${whereSql}
          AND f.key IN (${keysList})
        GROUP BY p.id
        HAVING COUNT(DISTINCT f.key) = ${featureKeys.length}
      ) x
    `);
    total = Number((totalRes as any).rows?.[0]?.total ?? 0);
  }

  const totalPages = Math.max(1, Math.ceil(total / pageSize));
  const safePage = Math.min(page, totalPages);
  const offset = (safePage - 1) * pageSize;

  // IDS
  let ids: number[] = [];

  if (!needFeatures) {
    const idsRes = await db.execute(sql`
      SELECT p.id
      FROM properties p
      WHERE ${whereSql}
      ORDER BY p.created_at DESC
      LIMIT ${pageSize}
      OFFSET ${offset}
    `);

    ids = ((idsRes as any).rows ?? [])
      .map((r: any) => Number(r.id))
      .filter((n: any) => Number.isFinite(n));
  } else {
    const keysList = sql.join(featureKeys.map((k) => sql`${k}`), sql`, `);

    const idsRes = await db.execute(sql`
      SELECT p.id
      FROM properties p
      JOIN property_features pf ON pf.property_id = p.id
      JOIN features f ON f.id = pf.feature_id
      WHERE ${whereSql}
        AND f.key IN (${keysList})
      GROUP BY p.id
      HAVING COUNT(DISTINCT f.key) = ${featureKeys.length}
      ORDER BY MAX(p.created_at) DESC
      LIMIT ${pageSize}
      OFFSET ${offset}
    `);

    ids = ((idsRes as any).rows ?? [])
      .map((r: any) => Number(r.id))
      .filter((n: any) => Number.isFinite(n));
  }

  if (ids.length === 0) {
    return { items: [], total, page: safePage, pageSize, totalPages };
  }

  const idSqlList = sql.join(ids.map((id) => sql`${id}`), sql`, `);

  // PROPS (–±–µ–∑ translations ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω–æ)
  // –ï—Å–ª–∏ –ø–æ–∑–∂–µ –¥–æ–±–∞–≤–∏—à—å property_translations ‚Äî –ø–µ—Ä–µ–∫–ª—é—á–∏—à—å —Ñ–ª–∞–≥ –∏ JOIN –≤–∫–ª—é—á–∏—Ç—Å—è
  let propsRows: any[] = [];
  if (!HAS_PROPERTY_TRANSLATIONS) {
    const res = await db.execute(sql`
      SELECT
        p.id,
        p.slug,
        p.location,
        p.price,
        p.currency,
        p.bedrooms,
        p.bathrooms,
        p.built_area_m2
      FROM properties p
      WHERE p.id IN (${idSqlList})
    `);
    propsRows = ((res as any).rows ?? []) as any[];
  } else {
    const res = await db.execute(sql`
      SELECT
        p.id,
        p.slug,
        p.location,
        p.price,
        p.currency,
        p.bedrooms,
        p.bathrooms,
        p.built_area_m2,
        COALESCE(pt.title, NULL) AS title
      FROM properties p
      LEFT JOIN property_translations pt
        ON pt.property_id = p.id AND pt.lang = ${lang}
      WHERE p.id IN (${idSqlList})
    `);
    propsRows = ((res as any).rows ?? []) as any[];
  }

  // COVER
  const imagesRes = await db.execute(sql`
    SELECT DISTINCT ON (pi.property_id)
      pi.property_id,
      pi.url
    FROM property_images pi
    WHERE pi.property_id IN (${idSqlList})
    ORDER BY pi.property_id, pi.is_cover DESC, pi.sort_order ASC, pi.id ASC
  `);

  const coverMap = new Map<number, string>();
  for (const row of ((imagesRes as any).rows ?? []) as any[]) {
    coverMap.set(Number(row.property_id), String(row.url));
  }

  // FEATURES
  const featsRes = await db.execute(sql`
    SELECT
      pf.property_id,
      f.key,
      COALESCE(ft.label, f.key) AS label
    FROM property_features pf
    JOIN features f ON f.id = pf.feature_id
    LEFT JOIN feature_translations ft
      ON ft.feature_id = f.id AND ft.lang = ${lang}
    WHERE pf.property_id IN (${idSqlList})
    ORDER BY pf.property_id, f.key ASC
  `);

  const featMap = new Map<number, CatalogFeature[]>();
  for (const row of ((featsRes as any).rows ?? []) as any[]) {
    const pid = Number(row.property_id);
    const arr = featMap.get(pid) ?? [];
    arr.push({ key: String(row.key), label: String(row.label) });
    featMap.set(pid, arr);
  }

  // Keep same order as ids
  const rowById = new Map<number, any>();
  for (const r of propsRows) rowById.set(Number(r.id), r);

  const items: CatalogItem[] = ids.map((id) => {
    const p = rowById.get(id);

    const slug = String(p?.slug ?? "");
    const title =
      HAS_PROPERTY_TRANSLATIONS && p?.title ? String(p.title) : titleFromSlug(slug || `property-${id}`);

    const priceValue = p?.price !== null && p?.price !== undefined ? Number(p.price) : null;
    const currency = p?.currency ? String(p.currency) : null;

    return {
      id,
      slug,
      title,
      location: p?.location ? String(p.location) : "",
      priceText: formatPrice({ lang, value: priceValue, currency }),
      beds: p?.bedrooms !== null && p?.bedrooms !== undefined ? Number(p.bedrooms) : 0,
      baths: p?.bathrooms !== null && p?.bathrooms !== undefined ? Number(p.bathrooms) : 0,
      area: p?.built_area_m2 !== null && p?.built_area_m2 !== undefined ? Number(p.built_area_m2) : 0,
      image: coverMap.get(id) ?? "/properties/p1.jpg",
      features: featMap.get(id) ?? [],
    };
  });

  return { items, total, page: safePage, pageSize, totalPages };
}

export async function getAllFeaturesForFilters(lang: "en" | "es") {
  const res = await db.execute(sql`
    SELECT f.key, COALESCE(ft.label, f.key) AS label
    FROM features f
    LEFT JOIN feature_translations ft
      ON ft.feature_id = f.id AND ft.lang = ${lang}
    ORDER BY f.key ASC
  `);

  return ((res as any).rows ?? []).map((r: any) => ({
    key: String(r.key),
    label: String(r.label),
  }));
}

export type PropertyDetail = {
  id: number;
  slug: string;
  title: string;

  location: string;
  description: string;

  priceText: string;

  beds: number;
  baths: number;
  builtArea: number;

  plansUrl: string | null;

  images: Array<{ url: string; isCover: boolean; sortOrder: number }>;
  features: Array<{ key: string; label: string }>;
};

export async function getPropertyBySlug(opts: { lang: "en" | "es"; slug: string }) {
  const { lang, slug } = opts;

  // 1) property
  const propRes = await db.execute(sql`
    SELECT
      p.id,
      p.slug,
      p.location,
      p.description_en,
      p.description_es,
      p.price,
      p.currency,
      p.bedrooms,
      p.bathrooms,
      p.built_area_m2,
      p.plans_url
    FROM properties p
    WHERE p.is_published = true AND p.slug = ${slug}
    LIMIT 1
  `);

  const p = (propRes as any).rows?.[0];
  if (!p) return null;

  const id = Number(p.id);

  const description =
    lang === "es"
      ? (p.description_es ? String(p.description_es) : "")
      : (p.description_en ? String(p.description_en) : "");


  // title –ø–æ–∫–∞ —Å—Ç—Ä–æ–∏–º –∏–∑ slug (–±–µ–∑ translations, —á—Ç–æ–±—ã –Ω–∏—á–µ–≥–æ –Ω–µ –ø–∞–¥–∞–ª–æ)
  const title = titleFromSlug(String(p.slug || slug));

  const priceValue = p.price !== null && p.price !== undefined ? Number(p.price) : null;
  const currency = p.currency ? String(p.currency) : null;

  // 2) images
  const imagesRes = await db.execute(sql`
    SELECT
      url,
      is_cover,
      sort_order
    FROM property_images
    WHERE property_id = ${id}
    ORDER BY is_cover DESC, sort_order ASC, id ASC
  `);

  const images = ((imagesRes as any).rows ?? []).map((r: any) => ({
    url: String(r.url),
    isCover: Boolean(r.is_cover),
    sortOrder: r.sort_order !== null && r.sort_order !== undefined ? Number(r.sort_order) : 0,
  }));

  // 3) features
  const featsRes = await db.execute(sql`
    SELECT
      f.key,
      COALESCE(ft.label, f.key) AS label
    FROM property_features pf
    JOIN features f ON f.id = pf.feature_id
    LEFT JOIN feature_translations ft
      ON ft.feature_id = f.id AND ft.lang = ${lang}
    WHERE pf.property_id = ${id}
    ORDER BY f.key ASC
  `);

  const features = ((featsRes as any).rows ?? []).map((r: any) => ({
    key: String(r.key),
    label: String(r.label),
  }));

  const plansUrlRaw = p.plans_url ? String(p.plans_url).trim() : "";
  const plansUrl = plansUrlRaw
    ? (plansUrlRaw.startsWith("/") ? plansUrlRaw : `/${plansUrlRaw}`)
    : null;

  return {
    id,
    slug: String(p.slug),
    title,
    location: p.location ? String(p.location) : "",
    description,
    priceText: formatPrice({ lang, value: priceValue, currency }),

    beds: p.bedrooms !== null && p.bedrooms !== undefined ? Number(p.bedrooms) : 0,
    baths: p.bathrooms !== null && p.bathrooms !== undefined ? Number(p.bathrooms) : 0,
    builtArea:
      p.built_area_m2 !== null && p.built_area_m2 !== undefined
        ? Number(p.built_area_m2)
        : 0,

    plansUrl, // ‚úÖ –í–û–¢ –ó–î–ï–°–¨ ‚Äî –≤–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ p.plans_url

    images,
    features,
  } satisfies PropertyDetail;
}

```

---

## app/next.config.ts

```typescript
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  /* config options here */
  reactCompiler: true,
};

export default nextConfig;

```

---

## app/package.json

```json
{
  "name": "app",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "eslint"
  },
  "dependencies": {
    "next": "16.1.1",
    "react": "19.2.3",
    "react-dom": "19.2.3"
  },
  "devDependencies": {
    "@types/node": "^20",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "babel-plugin-react-compiler": "1.0.0",
    "eslint": "^9",
    "eslint-config-next": "16.1.1",
    "typescript": "^5"
  }
}

```

---

## app/page.tsx

```typescript

```

---

## app/src/app/globals.css

```css
@import "../styles/tokens.css";

:root {
  --background: #ffffff;
  --foreground: #171717;
}

@media (prefers-color-scheme: dark) {
  :root {
    --background: #0a0a0a;
    --foreground: #ededed;
  }
}

html,
body {
  max-width: 100vw;
  overflow-x: hidden;
}

body {
  color: var(--foreground);
  background: var(--background);
  font-family: Arial, Helvetica, sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

* {
  box-sizing: border-box;
  padding: 0;
  margin: 0;
}

a {
  color: inherit;
  text-decoration: none;
}

@media (prefers-color-scheme: dark) {
  html {
    color-scheme: dark;
  }
}

```

---

## app/src/app/layout.tsx

```typescript
import type { Metadata } from "next";
import "./globals.css";
import { Inter, Cormorant_Garamond } from "next/font/google";

const inter = Inter({
  subsets: ["latin", "cyrillic"],
  variable: "--font-sans",
  display: "swap",
});

const cormorant = Cormorant_Garamond({
  subsets: ["latin", "cyrillic"],
  weight: ["400", "500", "600"],
  variable: "--font-serif",
  display: "swap",
});

export const metadata: Metadata = {
  title: "Grahalia Estates",
  description: "Real estate on Costa del Sol",
};

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="ru" className={`${inter.variable} ${cormorant.variable}`}>
      <body>{children}</body>
    </html>
  );
}

```

---

## app/src/app/page.module.css

```css
.page {
  --background: #fafafa;
  --foreground: #fff;

  --text-primary: #000;
  --text-secondary: #666;

  --button-primary-hover: #383838;
  --button-secondary-hover: #f2f2f2;
  --button-secondary-border: #ebebeb;

  display: flex;
  min-height: 100vh;
  align-items: center;
  justify-content: center;
  font-family: var(--font-geist-sans);
  background-color: var(--background);
}

.main {
  display: flex;
  min-height: 100vh;
  width: 100%;
  max-width: 800px;
  flex-direction: column;
  align-items: flex-start;
  justify-content: space-between;
  background-color: var(--foreground);
  padding: 120px 60px;
}

.intro {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  text-align: left;
  gap: 24px;
}

.intro h1 {
  max-width: 320px;
  font-size: 40px;
  font-weight: 600;
  line-height: 48px;
  letter-spacing: -2.4px;
  text-wrap: balance;
  color: var(--text-primary);
}

.intro p {
  max-width: 440px;
  font-size: 18px;
  line-height: 32px;
  text-wrap: balance;
  color: var(--text-secondary);
}

.intro a {
  font-weight: 500;
  color: var(--text-primary);
}

.ctas {
  display: flex;
  flex-direction: row;
  width: 100%;
  max-width: 440px;
  gap: 16px;
  font-size: 14px;
}

.ctas a {
  display: flex;
  justify-content: center;
  align-items: center;
  height: 40px;
  padding: 0 16px;
  border-radius: 128px;
  border: 1px solid transparent;
  transition: 0.2s;
  cursor: pointer;
  width: fit-content;
  font-weight: 500;
}

a.primary {
  background: var(--text-primary);
  color: var(--background);
  gap: 8px;
}

a.secondary {
  border-color: var(--button-secondary-border);
}

/* Enable hover only on non-touch devices */
@media (hover: hover) and (pointer: fine) {
  a.primary:hover {
    background: var(--button-primary-hover);
    border-color: transparent;
  }

  a.secondary:hover {
    background: var(--button-secondary-hover);
    border-color: transparent;
  }
}

@media (max-width: 600px) {
  .main {
    padding: 48px 24px;
  }

  .intro {
    gap: 16px;
  }

  .intro h1 {
    font-size: 32px;
    line-height: 40px;
    letter-spacing: -1.92px;
  }
}

@media (prefers-color-scheme: dark) {
  .logo {
    filter: invert();
  }

  .page {
    --background: #000;
    --foreground: #000;

    --text-primary: #ededed;
    --text-secondary: #999;

    --button-primary-hover: #ccc;
    --button-secondary-hover: #1a1a1a;
    --button-secondary-border: #1a1a1a;
  }
}

```

---

## app/src/app/page.tsx

```typescript
import { Header } from "@/components/Header/Header";
import { Hero } from "@/components/Hero/Hero";

function Section({ id, title, children }: { id: string; title: string; children: React.ReactNode }) {
  return (
    <section id={id} style={{ padding: "84px 0" }}>
      <div className="container">
        <p style={{ color: "var(--accent)", fontSize: 12, letterSpacing: 1.2, textTransform: "uppercase" }}>
          Grahalia Estates
        </p>
        <h2 style={{ fontFamily: "var(--font-serif)", margin: "10px 0 12px" }}>{title}</h2>
        <div style={{ color: "var(--text-muted)", maxWidth: 820 }}>{children}</div>
      </div>
    </section>
  );
}

export default function HomePage() {
  return (
    <>
      <Header />

      <main>
        <Section id="home" title="–ù–∞–π–¥–∏—Ç–µ —Å–≤–æ–π –∏–¥–µ–∞–ª—å–Ω—ã–π –¥–æ–º –Ω–∞ –ö–æ—Å—Ç–∞-–¥–µ–ª—å-–°–æ–ª—å">
          –ó–¥–µ—Å—å –±—É–¥–µ—Ç hero-–±–ª–æ–∫: –∫—Ä—É–ø–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫, –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –∫–Ω–æ–ø–∫–∞ ‚Äú–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –æ–±—ä–µ–∫—Ç—ã‚Äù.
        </Section>

        <Section id="about" title="–í–∞—à –Ω–∞–¥—ë–∂–Ω—ã–π –ø–∞—Ä—Ç–Ω—ë—Ä –≤ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏">
          –ö–æ—Ä–æ—Ç–∫–æ –ø—Ä–æ –∫–æ–º–ø–∞–Ω–∏—é, –≥–µ–æ–≥—Ä–∞—Ñ–∏—é (Costa del Sol), —Å—Ç–∏–ª—å —Ä–∞–±–æ—Ç—ã –∏ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ —Å–¥–µ–ª–∫–∏.
        </Section>

        <Section id="services" title="–£—Å–ª—É–≥–∏">
          –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ ¬∑ –ü—Ä–æ–¥–∞–∂–∞ ¬∑ –ê—Ä–µ–Ω–¥–∞ ‚Äî –≤ –≤–∏–¥–µ –∫–∞—Ä—Ç–æ—á–µ–∫ (–∫–ª–∏–∫ ‚Üí –æ—Ç–¥–µ–ª—å–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞).
        </Section>

        <Section id="gallery" title="–ì–∞–ª–µ—Ä–µ—è">
          –¢—É—Ç –±—É–¥–µ—Ç —Å–µ—Ç–∫–∞ —Ñ–æ—Ç–æ + –º–æ–¥–∞–ª–∫–∞ —Å –∑–∞—Ç–µ–º–Ω–µ–Ω–∏–µ–º (–∫–∞–∫ –≤ —à–∞–±–ª–æ–Ω–µ).
        </Section>

        <Section id="contact" title="–°–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞–º–∏">
          –ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è —Ñ–æ—Ä–º–∞ + –∫–æ–Ω—Ç–∞–∫—Ç—ã + —Ä–∞–±–æ—á–∏–µ —á–∞—Å—ã.
        </Section>
      </main>
    </>
  );
}

```

---

## app/src/components/Header/Header.tsx

```typescript
"use client";

import styles from "./header.module.css";
import { NAV } from "@/lib/nav";
import { useActiveSection } from "@/lib/useActiveSection";

export function Header() {
  const activeId = useActiveSection(NAV.map((n) => n.id));

  return (
    <header className={styles.header}>
      <div className={`${styles.inner} container`}>
        <div className={styles.brand}>
          {/* –ø–æ—Ç–æ–º –∑–∞–º–µ–Ω–∏–º –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π –ª–æ–≥–æ—Ç–∏–ø –∏–∑ /public */}
          <span className={styles.logoMark}>G</span>
          <span className={styles.brandText}>Grahalia Estates</span>
        </div>

        <nav className={styles.nav}>
          {NAV.map((item) => (
            <a
              key={item.id}
              href={`#${item.id}`}
              className={`${styles.link} ${activeId === item.id ? styles.active : ""}`}
            >
              {item.label}
            </a>
          ))}
        </nav>

        <a href="#contact" className={styles.cta}>
          –ö–æ–Ω—Ç–∞–∫—Ç
        </a>
      </div>
    </header>
  );
}

```

---

## app/src/components/Header/header.module.css

```css
.header {
  position: sticky;
  top: 0;
  z-index: 50;
  height: var(--header-h);
  background: color-mix(in srgb, var(--bg) 85%, white 15%);
  border-bottom: 1px solid var(--border);
  backdrop-filter: blur(10px);
}

.inner {
  height: 100%;
  display: flex;
  align-items: center;
  gap: 18px;
}

.brand {
  display: flex;
  align-items: center;
  gap: 10px;
  min-width: 240px;
}

.logoMark {
  width: 34px;
  height: 34px;
  border: 1px solid var(--border);
  border-radius: 999px;
  display: grid;
  place-items: center;
  font-weight: 600;
}

.brandText {
  font-family: var(--font-serif);
  letter-spacing: 0.2px;
}

.nav {
  display: flex;
  gap: 18px;
  margin-left: auto;
}

.link {
  color: var(--text-muted);
  font-size: 14px;
  padding: 8px 2px;
  transition: color var(--dur-2) var(--ease);
}

.active {
  color: var(--text);
  position: relative;
}

.active::after {
  content: "";
  position: absolute;
  left: 0;
  right: 0;
  bottom: -12px;
  height: 2px;
  background: var(--accent);
}

.cta {
  margin-left: 10px;
  padding: 10px 14px;
  border: 1px solid var(--border);
  border-radius: 999px;
  font-size: 14px;
  transition: background var(--dur-2) var(--ease), border-color var(--dur-2) var(--ease);
}

.cta:hover {
  border-color: color-mix(in srgb, var(--accent) 40%, var(--border) 60%);
  background: color-mix(in srgb, var(--accent) 10%, transparent 90%);
}

/* –º–æ–±–∏–ª–∫–∞: –º–µ–Ω—é –ø–æ—Ç–æ–º —Å–¥–µ–ª–∞–µ–º –±—É—Ä–≥–µ—Ä–æ–º */
@media (max-width: 860px) {
  .nav {
    display: none;
  }
  .brand {
    min-width: auto;
  }
}

```

---

## app/src/components/Hero/Hero.tsx

```typescript
import Image from "next/image";
import styles from "./hero.module.css";
import { Button } from "@/components/ui/Button";

export function Hero() {
  return (
    <section id="home" className={styles.hero}>
      <div className={`${styles.inner} container`}>
        <div className={styles.copy}>
          <p className={styles.kicker}>–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å –Ω–∞ –ö–æ—Å—Ç–∞-–¥–µ–ª—å-–°–æ–ª—å</p>
          <h1 className={styles.title}>–ù–∞–π–¥–∏—Ç–µ —Å–≤–æ–π –∏–¥–µ–∞–ª—å–Ω—ã–π –¥–æ–º —Å–µ–≥–æ–¥–Ω—è</h1>
          <p className={styles.subtitle}>
            –ü–æ–¥–±–æ—Ä –æ–±—ä–µ–∫—Ç–æ–≤, —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ —Å–¥–µ–ª–∫–∏ –∏ –∞—Ä–µ–Ω–¥–∞. –ú–∏–Ω–∏–º–∞–ª–∏–∑–º –≤ —Å–∞–π—Ç–µ ‚Äî –º–∞–∫—Å–∏–º—É–º –ø–æ–ª—å–∑—ã –≤ —Ä–∞–±–æ—Ç–µ.
          </p>

          <div className={styles.actions}>
            <Button href="#services" variant="primary">
              –°–º–æ—Ç—Ä–µ—Ç—å —É—Å–ª—É–≥–∏
            </Button>
            <Button href="#contact" variant="ghost">
              –°–≤—è–∑–∞—Ç—å—Å—è
            </Button>
          </div>
        </div>

        <div className={styles.visual}>
          <div className={styles.imageWrap}>
            <Image
              src="/hero/house.jpg"
              alt="Modern villa on Costa del Sol"
              fill
              priority
              sizes="(max-width: 900px) 92vw, 980px"
              style={{ objectFit: "cover" }}
            />
          </div>
        </div>
      </div>
    </section>
  );
}

```

---

## app/src/components/Hero/hero.module.css

```css
.hero {
  padding: 42px 0 22px;
}

.inner {
  display: grid;
  grid-template-columns: 1.05fr 1fr;
  gap: 34px;
  align-items: center;
}

.copy {
  animation: rise var(--dur-3) var(--ease) both;
}

.kicker {
  color: var(--accent);
  font-size: 12px;
  letter-spacing: 1.2px;
  text-transform: uppercase;
  margin: 0 0 10px;
}

.title {
  font-family: var(--font-serif);
  font-size: var(--hero-title);
  line-height: 1.05;
  letter-spacing: 0.2px;
  margin: 0 0 14px;
}

.subtitle {
  color: var(--text-muted);
  font-size: var(--hero-subtitle);
  margin: 0 0 20px;
  max-width: 52ch;
}

.actions {
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
}

.visual {
  animation: fade var(--dur-3) var(--ease) both;
}

.imageWrap {
  position: relative;
  width: 100%;
  aspect-ratio: 16 / 10;
  border-radius: var(--radius);
  overflow: hidden;
  box-shadow: var(--shadow);
  border: 1px solid var(--border);
}

/* –º–æ–±–∏–ª–∫–∞ */
@media (max-width: 900px) {
  .inner {
    grid-template-columns: 1fr;
  }
  .hero {
    padding: 26px 0 10px;
  }
}

@keyframes rise {
  from { opacity: 0; transform: translateY(8px); }
  to { opacity: 1; transform: translateY(0); }
}

@keyframes fade {
  from { opacity: 0; }
  to { opacity: 1; }
}

```

---

## app/src/components/ui/Button.tsx

```typescript
import styles from "./button.module.css";

type Props = {
  href?: string;
  children: React.ReactNode;
  variant?: "primary" | "ghost";
  className?: string;
};

export function Button({ href, children, variant = "primary", className = "" }: Props) {
  const cls = `${styles.btn} ${styles[variant]} ${className}`;

  if (href) {
    return (
      <a className={cls} href={href}>
        {children}
      </a>
    );
  }

  return <button className={cls}>{children}</button>;
}

```

---

## app/src/components/ui/button.module.css

```css
.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  padding: 12px 18px;
  border-radius: 999px;
  font-size: 14px;
  letter-spacing: 0.2px;
  transition: transform var(--dur-2) var(--ease),
              background var(--dur-2) var(--ease),
              border-color var(--dur-2) var(--ease),
              color var(--dur-2) var(--ease);
  user-select: none;
}

.btn:hover { transform: translateY(-1px); }
.btn:active { transform: translateY(0px); }

.primary {
  background: var(--accent);
  color: white;
  border: 1px solid color-mix(in srgb, var(--accent) 70%, black 30%);
}

.primary:hover {
  background: var(--accent-hover);
}

.ghost {
  background: transparent;
  color: var(--text);
  border: 1px solid var(--border);
}

.ghost:hover {
  border-color: color-mix(in srgb, var(--accent) 35%, var(--border) 65%);
  background: color-mix(in srgb, var(--accent) 8%, transparent 92%);
}

```

---

## app/src/lib/nav.ts

```typescript
export type NavItem = {
  id: string;
  label: string;
};

export const NAV: NavItem[] = [
  { id: "home", label: "–ì–ª–∞–≤–Ω–∞—è" },
  { id: "about", label: "–û –Ω–∞—Å" },
  { id: "services", label: "–£—Å–ª—É–≥–∏" },
  { id: "gallery", label: "–ì–∞–ª–µ—Ä–µ—è" },
  { id: "contact", label: "–ö–æ–Ω—Ç–∞–∫—Ç" },
];

```

---

## app/src/lib/useActiveSection.ts

```typescript
"use client";

import { useEffect, useState } from "react";

export function useActiveSection(ids: string[]) {
  const [activeId, setActiveId] = useState(ids[0] ?? "");

  useEffect(() => {
    const els = ids
      .map((id) => document.getElementById(id))
      .filter(Boolean) as HTMLElement[];

    if (!els.length) return;

    const obs = new IntersectionObserver(
      (entries) => {
        const visible = entries
          .filter((e) => e.isIntersecting)
          .sort((a, b) => (b.intersectionRatio ?? 0) - (a.intersectionRatio ?? 0))[0];

        if (visible?.target?.id) setActiveId(visible.target.id);
      },
      {
        root: null,
        rootMargin: "-40% 0px -55% 0px",
        threshold: [0.1, 0.2, 0.35, 0.5],
      }
    );

    els.forEach((el) => obs.observe(el));
    return () => obs.disconnect();
  }, [ids.join("|")]);

  return activeId;
}

```

---

## app/src/styles/globals.css

```css
@import "./tokens.css";

* { box-sizing: border-box; }
html { scroll-behavior: smooth; scroll-padding-top: var(--header-h); }
body {
  margin: 0;
  font-family: var(--font-sans);
  font-size: var(--text-base);
  line-height: var(--line-height);
  color: var(--text);
  background: var(--bg);
}

a { color: inherit; text-decoration: none; }
.container { width: min(var(--container), calc(100% - 32px)); margin: 0 auto; }

```

---

## app/src/styles/tokens.css

```css
:root {
  /* Colors */
  --bg: #f7f7f5;
  --surface: #ffffff;
  --text: #111214;
  --text-muted: #5b6068;
  --border: #e6e7ea;

  --accent: #0b5d63;
  --accent-hover: #094b50;

    /* Typography */
  --font-sans: var(--font-sans), ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial, "Noto Sans", "Helvetica Neue", sans-serif;
  --font-serif: var(--font-serif), ui-serif, "Georgia", "Times New Roman", serif;

  --text-base: 16px;
  --line-height: 1.6;

  /* Hero */
  --hero-title: clamp(34px, 5vw, 56px);
  --hero-subtitle: clamp(16px, 2vw, 18px);

  /* Radius / Shadows */
  --radius: 14px;
  --radius-sm: 10px;
  --shadow: 0 10px 30px rgba(0,0,0,0.08);

  /* Layout */
  --container: 1120px;
  --header-h: 78px;

  /* Motion */
  --ease: cubic-bezier(.2,.8,.2,1);
  --dur-1: 150ms;
  --dur-2: 250ms;
  --dur-3: 350ms;
}

```

---

## app/tsconfig.json

```json
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "react-jsx",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": [
    "next-env.d.ts",
    "**/*.ts",
    "**/*.tsx",
    ".next/types/**/*.ts",
    ".next/dev/types/**/*.ts",
    "**/*.mts"
  ],
  "exclude": ["node_modules"]
}

```

---

## components/About/About.module.css

```css
.section {
  padding: 72px 0;
  border-top: 1px solid rgba(226, 226, 222, 0.8);
}

.grid {
  display: grid;
  grid-template-columns: 1.1fr 0.9fr;
  gap: 22px;
  align-items: center;
}

.text {
  background: rgba(255, 255, 255, 0.62);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 22px;
  box-shadow: var(--shadow);
}

.subtitle {
  margin-top: 10px;
  font-size: 15px;
}

.body {
  margin-top: 14px;
  font-size: 15px;
}

.btn {
  margin-top: 18px;
  width: fit-content;
  padding: 10px 14px;
}

.media {
  border-radius: var(--radius);
  overflow: hidden;
  border: 1px solid var(--border);
  box-shadow: var(--shadow);
  background: #eee;
  aspect-ratio: 4 / 3;
}

.image {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}

@media (max-width: 960px) {
  .grid {
    grid-template-columns: 1fr;
  }

  .media {
    aspect-ratio: 16 / 10;
  }
}

```

---

## components/About/About.tsx

```typescript
"use client";

import { scrollToHash } from "@/utils/smoothScroll";
import styles from "./About.module.css";

type AboutDict = {
  title: string;
  subtitle: string;
  body: string;
  cta: string;
};

export default function About({ t }: { t: AboutDict }) {
  const OFFSET = 90;

  return (
    <section id="about" className={`section ${styles.section}`}>
      <div className="container">
        {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å–µ–∫—Ü–∏–∏ –∫–∞–∫ –≤ –º–∞–∫–µ—Ç–µ: –ø–æ —Ü–µ–Ω—Ç—Ä—É + –ª–∏–Ω–∏–∏ */}
        <div className="section__head">
          <h2 className="sectionTitle">
            <span className="sectionTitleText">{t.title}</span>
          </h2>
        </div>

        <div className={styles.grid}>
          <div className={styles.text}>
            <p className={`p ${styles.subtitle}`}>{t.subtitle}</p>

            <p className={`p ${styles.body}`}>{t.body}</p>

            <a
              className={`btn btnPrimary ${styles.btn}`}
              href="#contact"
              onClick={(e) => {
                e.preventDefault();
                scrollToHash("#contact", { offset: OFFSET });
              }}
            >
              {t.cta}
            </a>
          </div>

          <div className={styles.media}>
            <img
              className={styles.image}
              src="/about.jpg"
              alt={t.title}
              loading="lazy"
            />
          </div>
        </div>
      </div>
    </section>
  );
}

```

---

## components/Contact/Contact.module.css

```css
.section {
  padding: 72px 0 90px;
  border-top: 1px solid rgba(226, 226, 222, 0.8);
}

.head {
  margin-bottom: 18px;
}

.grid {
  display: grid;
  grid-template-columns: 1.2fr 0.8fr;
  gap: 18px;
  align-items: start;
  margin-top: 16px;
}

.form {
  background: rgba(255, 255, 255, 0.62);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 22px;
  box-shadow: var(--shadow);
}

.row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
}

.field {
  display: flex;
  flex-direction: column;
  gap: 6px;
  margin-top: 12px;
}

.field:first-child {
  margin-top: 0;
}

.label {
  font-size: 12px;
  color: rgba(28, 28, 28, 0.75);
  font-weight: 600;
}

.input,
.textarea {
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 12px 12px;
  font-size: 14px;
  outline: none;
  background: rgba(255, 255, 255, 0.85);
}

.input:focus,
.textarea:focus {
  border-color: rgba(14, 94, 86, 0.45);
  box-shadow: 0 0 0 4px rgba(14, 94, 86, 0.10);
}

.textarea {
  min-height: 120px;
  resize: vertical;
}

.infoCard {
  background: rgba(255, 255, 255, 0.62);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 22px;
  box-shadow: var(--shadow);
}

.infoTitle {
  font-family: var(--font-playfair), Georgia, "Times New Roman", serif;
  font-size: 18px;
  margin-bottom: 12px;
}

.infoItem {
  display: flex;
  gap: 10px;
  align-items: center;
  padding: 8px 0;
}

.infoIcon {
  width: 28px;
  height: 28px;
  border-radius: 10px;
  display: grid;
  place-items: center;
  background: rgba(14, 94, 86, 0.08);
}

.infoLink {
  color: var(--text);
  font-weight: 600;
}

.infoLink:hover {
  color: var(--accent);
}

.divider {
  height: 1px;
  background: rgba(226, 226, 222, 0.8);
  margin: 12px 0;
}

.waBtn {
  width: 100%;
  justify-content: center;
  margin-top: 6px;
  text-decoration: none;
}

.note {
  margin-top: 12px;
  font-size: 13px;
}

.footerLine {
  height: 1px;
  background: rgba(226, 226, 222, 0.8);
  margin-top: 28px;
}

.footerText {
  margin-top: 14px;
  color: rgba(28, 28, 28, 0.6);
  font-size: 12px;
}

@media (max-width: 960px) {
  .grid {
    grid-template-columns: 1fr;
  }

  .row {
    grid-template-columns: 1fr;
  }
}

```

---

## components/Contact/Contact.tsx

```typescript
"use client";

import styles from "./Contact.module.css";

type ContactDict = {
  title: string;
  subtitle: string;

  form: {
    name: string;
    phone: string;
    email: string;
    message: string;
    send: string;
    namePlaceholder: string;
    phonePlaceholder: string;
    emailPlaceholder: string;
    messagePlaceholder: string;
  };

  info: {
    title: string;
    whatsapp: string;
    note: string;
  };

  footerRights: string;
};

export default function Contact({ t }: { t: ContactDict }) {
  return (
    <section id="contact" className={`section ${styles.section}`}>
      <div className="container">
        {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å–µ–∫—Ü–∏–∏ */}
        <div className="section__head">
          <h2 className="sectionTitle">
            <span className="sectionTitleText">{t.title}</span>
          </h2>
          <p className="section__kicker">{t.subtitle}</p>
        </div>

        <div className={styles.grid}>
          {/* Form */}
          <form
            className={styles.form}
            onSubmit={(e) => e.preventDefault()}
          >
            <div className={styles.row}>
              <div className={styles.field}>
                <label className={styles.label} htmlFor="name">
                  {t.form.name}
                </label>
                <input
                  className={styles.input}
                  id="name"
                  name="name"
                  placeholder={t.form.namePlaceholder}
                />
              </div>

              <div className={styles.field}>
                <label className={styles.label} htmlFor="phone">
                  {t.form.phone}
                </label>
                <input
                  className={styles.input}
                  id="phone"
                  name="phone"
                  placeholder={t.form.phonePlaceholder}
                />
              </div>
            </div>

            <div className={styles.field}>
              <label className={styles.label} htmlFor="email">
                {t.form.email}
              </label>
              <input
                className={styles.input}
                id="email"
                name="email"
                placeholder={t.form.emailPlaceholder}
              />
            </div>

            <div className={styles.field}>
              <label className={styles.label} htmlFor="message">
                {t.form.message}
              </label>
              <textarea
                className={styles.textarea}
                id="message"
                name="message"
                placeholder={t.form.messagePlaceholder}
              />
            </div>

            <button className="btn btnPrimary" type="submit">
              {t.form.send}
            </button>
          </form>

          {/* Info */}
          <aside className={styles.info}>
            <div className={styles.infoCard}>
              <div className={styles.infoTitle}>{t.info.title}</div>

              <div className={styles.infoItem}>
                <span className={styles.infoIcon}>üìû</span>
                <a
                  className={styles.infoLink}
                  href="tel:+34123456789"
                >
                  +34 123 456 789
                </a>
              </div>

              <div className={styles.infoItem}>
                <span className={styles.infoIcon}>‚úâÔ∏è</span>
                <a
                  className={styles.infoLink}
                  href="mailto:info@grahaliaestates.com"
                >
                  info@grahaliaestates.com
                </a>
              </div>

              <div className={styles.divider} />

              <a
                className={`btn btnPrimary ${styles.waBtn}`}
                href="https://wa.me/34123456789"
                target="_blank"
                rel="noreferrer"
              >
                {t.info.whatsapp}
              </a>

              <p className={`p ${styles.note}`}>
                {t.info.note}
              </p>
            </div>
          </aside>
        </div>

        <div className={styles.footerLine} />
        <div className={styles.footerText}>
          ¬© {new Date().getFullYear()} Grahalia Estates ¬∑ {t.footerRights}
        </div>
      </div>
    </section>
  );
}

```

---

## components/Featured/Featured.module.css

```css
.section {
  padding: 72px 0;
}

.head {
  display: flex;
  align-items: flex-end;
  justify-content: space-between;
  gap: 16px;
  margin-bottom: 18px;
}

.allBtn {
  padding: 10px 14px;
  white-space: nowrap;
}

.grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 18px;
  margin-top: 16px;
}

.fadeWrap {
  will-change: opacity, transform;
}

/* –ú–Ø–ì–ö–û–ï –ü–û–Ø–í–õ–ï–ù–ò–ï */
.fadeIn {
  opacity: 1;
  transform: translateY(0);
  transition:
    opacity var(--fade-ms, 800ms)
      cubic-bezier(0.2, 0.8, 0.2, 1),
    transform var(--fade-ms, 800ms)
      cubic-bezier(0.2, 0.8, 0.2, 1);
}

/* –ú–Ø–ì–ö–û–ï –ò–°–ß–ï–ó–ù–û–í–ï–ù–ò–ï */
.fadeOut {
  opacity: 0;
  transform: translateY(6px);
  transition:
    opacity var(--fade-ms, 500ms)
      cubic-bezier(0.4, 0.0, 0.2, 1),
    transform var(--fade-ms, 500ms)
      cubic-bezier(0.4, 0.0, 0.2, 1);
}


@media (max-width: 960px) {
  .grid {
    grid-template-columns: 1fr;
  }

  .head {
    align-items: flex-start;
    flex-direction: column;
  }
}

```

---

## components/Featured/Featured.tsx

```typescript
"use client";

import { useEffect, useMemo, useRef, useState } from "react";
import Link from "next/link";
import PropertyCard from "../PropertyCard/PropertyCard";
import styles from "./Featured.module.css";

type FeaturedDict = {
  title: string;
  subtitle: string;
  cta: string;
  card: any;
};

export type FeaturedItem = {
  id?: number | string;
  title: string;
  location: string;
  price: string;
  beds: number;
  baths: number;
  area: number;
  image: string;
  slug?: string;
};

const fallbackFeatured: FeaturedItem[] = [
  {
    title: "Modern Villa in Marbella",
    location: "Marbella ¬∑ Costa del Sol",
    price: "‚Ç¨1,250,000",
    beds: 4,
    baths: 3,
    area: 250,
    image: "/properties/p1.jpg",
  },
  {
    title: "Seaside Apartment in Estepona",
    location: "Estepona ¬∑ Costa del Sol",
    price: "‚Ç¨850,000",
    beds: 2,
    baths: 2,
    area: 120,
    image: "/properties/p2.jpg",
  },
  {
    title: "Luxury Villa in Benahav√≠s",
    location: "Benahav√≠s ¬∑ Costa del Sol",
    price: "Price on Request",
    beds: 5,
    baths: 5,
    area: 450,
    image: "/properties/p3.jpg",
  },
];

type Props = {
  lang: "en" | "es";
  t: FeaturedDict;
  items?: FeaturedItem[];

  itemsPerView?: number;
  intervalMs?: number;
  randomStart?: boolean;
  fadeMs?: number;
};

export default function Featured({
  lang,
  t,
  items,
  itemsPerView = 3,
  intervalMs = 6000,
  randomStart = true,
  fadeMs = 1000,
}: Props) {
  const pool: FeaturedItem[] = useMemo(() => {
    return Array.isArray(items) && items.length > 0 ? items : fallbackFeatured;
  }, [items]);

  const pageCount = Math.max(1, Math.ceil(pool.length / itemsPerView));

  const [page, setPage] = useState(0);
  const [isFading, setIsFading] = useState(false);

  const intervalRef = useRef<number | null>(null);
  const fadeTimeoutRef = useRef<number | null>(null);

  useEffect(() => {
    return () => {
      if (intervalRef.current) window.clearInterval(intervalRef.current);
      if (fadeTimeoutRef.current) window.clearTimeout(fadeTimeoutRef.current);
    };
  }, []);

  useEffect(() => {
    if (page >= pageCount) setPage(0);
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [pageCount]);

  useEffect(() => {
    if (!randomStart) return;
    if (pageCount <= 1) return;

    setPage((current) => {
      if (current !== 0) return current;
      return Math.floor(Math.random() * pageCount);
    });
  }, [randomStart, pageCount]);

  const goNext = () => {
    if (pageCount <= 1) return;

    setIsFading(true);

    if (fadeTimeoutRef.current) window.clearTimeout(fadeTimeoutRef.current);

    fadeTimeoutRef.current = window.setTimeout(() => {
      setPage((p) => (p + 1) % pageCount);
      setIsFading(false);
    }, fadeMs);
  };

  useEffect(() => {
    if (pageCount <= 1) return;

    if (intervalRef.current) window.clearInterval(intervalRef.current);

    intervalRef.current = window.setInterval(() => {
      goNext();
    }, intervalMs);

    return () => {
      if (intervalRef.current) window.clearInterval(intervalRef.current);
      intervalRef.current = null;
    };
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [pageCount, intervalMs, fadeMs]);

  const visible = useMemo(() => {
    const start = page * itemsPerView;
    const slice = pool.slice(start, start + itemsPerView);

    if (slice.length < itemsPerView && pool.length > slice.length) {
      return slice.concat(pool.slice(0, itemsPerView - slice.length));
    }

    return slice;
  }, [pool, page, itemsPerView]);

  return (
    <section id="properties" className={`section ${styles.section}`}>
      <div className="container">
        <div className="section__head">
          <h2 className="sectionTitle">
            <span className="sectionTitleText">{t.title}</span>
          </h2>
          <p className="section__kicker">{t.subtitle}</p>
        </div>

        <div
          className={`${styles.fadeWrap} ${isFading ? styles.fadeOut : styles.fadeIn}`}
          style={{ ["--fade-ms" as any]: `${fadeMs}ms` }}
        >
          <div className={styles.grid}>
            {visible.map((p) => (
              <PropertyCard
                key={String(p.id ?? p.title)}
                property={{
                  ...p,
                  // ‚úÖ —Ç–µ–ø–µ—Ä—å "View Details" –≤–µ–¥—ë—Ç –Ω–∞ –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ–±—ä–µ–∫—Ç–∞
                  href: p.slug ? `/${lang}/properties/${p.slug}` : `/${lang}#contact`,
                }}
                t={t.card}
              />
            ))}
          </div>
        </div>

        <div className="section__actions">
          <Link className={`btn btnPrimary ${styles.allBtn}`} href={`/${lang}/properties`}>
            {t.cta}
          </Link>
        </div>
      </div>
    </section>
  );
}

```

---

## components/GalleryModal/GalleryModal.module.css

```css
.overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.85);
  z-index: 1000;
  display: flex;
  align-items: center;
  justify-content: center;
}

.modal {
  position: relative;
  max-width: 92vw;
  max-height: 92vh;
}

.image {
  max-width: 92vw;
  max-height: 92vh;
  object-fit: contain;
  user-select: none;
}

.close {
  position: absolute;
  top: -40px;
  right: 0;
  background: none;
  border: none;
  color: #fff;
  font-size: 28px;
  cursor: pointer;
}

.prev,
.next {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  background: none;
  border: none;
  color: #fff;
  font-size: 48px;
  cursor: pointer;
  padding: 10px;
  user-select: none;
}

.prev { left: -60px; }
.next { right: -60px; }

.counter {
  position: absolute;
  bottom: -32px;
  right: 0;
  color: rgba(255,255,255,0.75);
  font-size: 14px;
}

@media (max-width: 768px) {
  .prev { left: 10px; }
  .next { right: 10px; }
}

```

---

## components/GalleryModal/GalleryModal.tsx

```typescript
"use client";

import { useEffect } from "react";
import styles from "./GalleryModal.module.css";

type ImageItem = {
  url: string;
};

type Props = {
  images: ImageItem[];
  index: number;
  onClose: () => void;
  onPrev: () => void;
  onNext: () => void;
};

export default function GalleryModal({
  images,
  index,
  onClose,
  onPrev,
  onNext,
}: Props) {
  const img = images[index];

  // ‚å®Ô∏è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞
  useEffect(() => {
    function onKey(e: KeyboardEvent) {
      if (e.key === "Escape") onClose();
      if (e.key === "ArrowLeft") onPrev();
      if (e.key === "ArrowRight") onNext();
    }
    window.addEventListener("keydown", onKey);
    return () => window.removeEventListener("keydown", onKey);
  }, [onClose, onPrev, onNext]);

  return (
    <div className={styles.overlay} onClick={onClose}>
      <div className={styles.modal} onClick={(e) => e.stopPropagation()}>
        <button className={styles.close} onClick={onClose}>‚úï</button>

        <button className={styles.prev} onClick={onPrev}>‚Äπ</button>
        <button className={styles.next} onClick={onNext}>‚Ä∫</button>

        <img
          src={img.url}
          alt=""
          className={styles.image}
          draggable={false}
        />

        <div className={styles.counter}>
          {index + 1} / {images.length}
        </div>
      </div>
    </div>
  );
}

```

---

## components/Header/Header.module.css

```css
.header {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: 1000;
  background: #fcf8f2;
  backdrop-filter: blur(10px);
  border-bottom: 1px solid rgba(226, 226, 222, 0.7);
  /* –∑–∞—â–∏—Ç–∞ –æ—Ç –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ —Å–∫—Ä–æ–ª–ª–∞ */
  width: 100%;
  max-width: 100%;
}

/* row */
.row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  height: 72px;
  gap: 18px;
}

/* logo */
.logo {
  display: flex;
  align-items: baseline;
  gap: 10px;
  letter-spacing: 0.08em;
  white-space: nowrap;
  cursor: pointer;
}

.logo:focus-visible {
  outline: 2px solid rgba(14, 94, 86, 0.35);
  outline-offset: 4px;
  border-radius: 12px;
}

.logoMark {
  font-family: var(--font-playfair), Georgia, "Times New Roman", serif;
  font-weight: 600;
  font-size: 20px;
}

.logoSub {
  font-size: 12px;
  color: var(--muted);
  font-weight: 700;
}

/* desktop nav */
.nav {
  position: relative;
  display: flex;
  gap: 22px;
  align-items: center;
}

/* –ü–ª–∞–≤–∞—é—â–∏–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä */
.indicator {
  position: absolute;
  bottom: 6px;
  left: 0;
  height: 2px;
  background: rgba(14, 94, 86, 0.9);
  border-radius: 2px;
  transition: transform 320ms cubic-bezier(0.22, 1, 0.36, 1),
    width 320ms cubic-bezier(0.22, 1, 0.36, 1);
  will-change: transform, width;
  pointer-events: none;
}

.link {
  position: relative;
  font-size: 14px;
  color: rgba(28, 28, 28, 0.72);
  padding: 10px 10px;
  border-radius: 12px;
  transition: background 0.15s ease, color 0.15s ease;
}

.link:hover {
  color: var(--text);
  background: rgba(255, 255, 255, 0.65);
}

.active {
  color: var(--text);
}

/* –í–ê–ñ–ù–û: —É–±–∏—Ä–∞–µ–º ::after, —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ "–¥–≤—É—Ö –ª–∏–Ω–∏–π" (–∏ –¥–µ—Ä–≥–∞–Ω—å—è –≤–∏–∑—É–∞–ª—å–Ω–æ) */
.active::after {
  content: none;
}

/* right */
.right {
  display: flex;
  align-items: center;
  gap: 14px;
}

.lang {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 13px;
  color: rgba(28, 28, 28, 0.75);
}

.langBtn {
  background: transparent;
  border: none;
  cursor: pointer;
  font-weight: 600;
  color: inherit;
  padding: 6px 6px;
  border-radius: 10px;
}

.langBtn:hover {
  background: rgba(255, 255, 255, 0.55);
  color: var(--text);
}

.sep {
  opacity: 0.5;
}

.wa {
  padding: 10px 16px;
  border-radius: 3px;
  text-decoration: none;
}

/* -------------------------
   Mobile burger + menu
-------------------------- */

.burger {
  display: none;
  height: 44px;
  width: auto;          /* <-- –≤–∞–∂–Ω–æ */
  padding: 0 12px;      /* <-- –≤–∞–∂–Ω–æ */

  border-radius: 12px;
  border: 1px solid rgba(226, 226, 222, 0.9);
  background: rgba(255, 255, 255, 0.55);
  backdrop-filter: blur(8px);

  align-items: center;
  justify-content: center;
  gap: 10px;            /* –±—ã–ª–æ 5px ‚Äî —É–≤–µ–ª–∏—á–∏–º, —á—Ç–æ–±—ã —Ç–µ–∫—Å—Ç/–∏–∫–æ–Ω–∫–∞ –¥—ã—à–∞–ª–∏ */
  cursor: pointer;
  transition: transform 0.12s ease, background 0.12s ease, border 0.12s ease;
}

.burgerText {
  font-size: 13px;
  font-weight: 700;
  letter-spacing: 0.02em;
  color: rgba(28, 28, 28, 0.85);
  line-height: 1;
}

.burgerLines {
  width: 18px;
  height: 14px;
  display: inline-flex;
  flex-direction: column;
  justify-content: space-between;
}

.burger:hover {
  background: rgba(255, 255, 255, 0.75);
}

.burger:active {
  transform: translateY(1px);
}

.burgerLines span {
  display: block;
  width: 18px;
  height: 2px;
  background: rgba(28, 28, 28, 0.85);
  border-radius: 2px;
  transition: transform 220ms cubic-bezier(0.22, 1, 0.36, 1),
    opacity 180ms ease;
}

/* –∫—Ä–µ—Å—Ç–∏–∫ */
.burgerOpen .burgerLines span:nth-child(1) {
  transform: translateY(6px) rotate(45deg);
}
.burgerOpen .burgerLines span:nth-child(2) {
  opacity: 0;
}
.burgerOpen .burgerLines span:nth-child(3) {
  transform: translateY(-6px) rotate(-45deg);
}

/* overlay */
.mobileOverlay {
  position: fixed;
  inset: 0;
  z-index: 60;
  background: rgba(18, 18, 18, 0.25);
  opacity: 0;
  pointer-events: none;
  transition: opacity 220ms ease;
  width: 100%;
  max-width: 100%;
}

.mobileOverlayOpen {
  opacity: 1;
  pointer-events: auto;
}

/* panel */
.mobilePanel {
  position: absolute;
  right: 12px;
  top: 12px;
  width: min(92vw, 360px);
  border-radius: 16px;
  background: rgba(252, 248, 242, 0.96);
  border: 1px solid rgba(226, 226, 222, 0.9);
  backdrop-filter: blur(10px);
  box-shadow: 0 18px 50px rgba(0, 0, 0, 0.18);

  transform: translateY(-8px) scale(0.98);
  opacity: 0;
  transition: transform 260ms cubic-bezier(0.22, 1, 0.36, 1),
    opacity 220ms ease;
}

.mobileOverlayOpen .mobilePanel {
  transform: translateY(0) scale(1);
  opacity: 1;
}

.mobileTop {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 14px 14px 10px;
  border-bottom: 1px solid rgba(226, 226, 222, 0.8);
}

.mobileTitle {
  font-weight: 700;
  letter-spacing: 0.06em;
  font-size: 12px;
  color: rgba(28, 28, 28, 0.7);
  text-transform: uppercase;
}

.mobileClose {
  width: 36px;
  height: 36px;
  border-radius: 12px;
  border: 1px solid rgba(226, 226, 222, 0.9);
  background: rgba(255, 255, 255, 0.55);
  cursor: pointer;
  transition: transform 0.12s ease, background 0.12s ease;
}

.mobileClose:hover {
  background: rgba(255, 255, 255, 0.78);
}

.mobileClose:active {
  transform: translateY(1px);
}

.mobileLinks {
  padding: 10px 10px 6px;
  display: grid;
  gap: 6px;
}

.mobileLink {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 12px;
  border-radius: 14px;
  color: rgba(28, 28, 28, 0.82);
  font-weight: 600;
  background: rgba(255, 255, 255, 0.45);
  border: 1px solid rgba(226, 226, 222, 0.75);
  transition: background 0.14s ease, transform 0.14s ease;
}

.mobileLink:hover {
  background: rgba(255, 255, 255, 0.7);
}

.mobileLink:active {
  transform: translateY(1px);
}

.mobileActive {
  background: rgba(14, 94, 86, 0.1);
  border-color: rgba(14, 94, 86, 0.25);
  color: var(--text);
}

.mobileBottom {
  padding: 12px 12px 14px;
  border-top: 1px solid rgba(226, 226, 222, 0.8);
  display: grid;
  gap: 10px;
}

.mobileWa {
  width: 100%;
  justify-content: center;
}

.mobileLang {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  font-size: 13px;
  color: rgba(28, 28, 28, 0.75);
}

/* -------------------------
   Responsive rules
-------------------------- */

@media (max-width: 860px) {
  .nav {
    display: none;
  }

  .burger {
    display: inline-flex;
  }

  /* —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ —Å–∫—Ä–æ–ª–ª–∞ –∏–∑-–∑–∞ "–ø—Ä–∞–≤–æ–≥–æ –±–ª–æ–∫–∞" */
  .right {
    gap: 10px;
  }

  /* –Ω–∞ –æ—á–µ–Ω—å —É–∑–∫–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö WhatsApp –º–æ–∂–Ω–æ –ø—Ä—è—Ç–∞—Ç—å, –æ—Å—Ç–∞–≤–∏–≤ –≤ –º–µ–Ω—é */
  .wa {
    display: none;
  }
}

@media (max-width: 420px) {
  .row {
    gap: 12px;
  }

  .logoMark {
    font-size: 18px;
  }

  .logoSub {
    font-size: 11px;
  }

  .lang {
    display: none; /* —è–∑—ã–∫–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ –º–æ–±–∏–ª—å–Ω–æ–º –º–µ–Ω—é */
  }
}

```

---

## components/Header/Header.tsx

```typescript
"use client";

import { useEffect, useLayoutEffect, useMemo, useRef, useState } from "react";
import { usePathname, useRouter } from "next/navigation";
import styles from "./Header.module.css";
import { scrollToHash } from "@/utils/smoothScroll";

type NavItem = { id: string; label: string };

type HeaderProps = {
  lang: "en" | "es";
  t: {
    nav: Record<string, string>;
    menuTitle: string;
    whatsapp: string;
  };
};

export default function Header({ lang, t }: HeaderProps) {
  const router = useRouter();
  const pathname = usePathname();

  const nav: NavItem[] = useMemo(
    () => [
      { id: "home", label: t.nav.home },
      { id: "properties", label: t.nav.properties },
      { id: "services", label: t.nav.services },
      { id: "about", label: t.nav.about },
      { id: "contact", label: t.nav.contact },
    ],
    [t]
  );

  const HEADER_OFFSET = 90;

  const isHome = pathname === `/${lang}` || pathname === `/${lang}/`;

  // ‚úÖ –ª—é–±—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã properties: –∫–∞—Ç–∞–ª–æ–≥ + –¥–µ—Ç–∞–ª—å–Ω–∞—è
  const isProperties = pathname?.startsWith(`/${lang}/properties`);
  const isCatalog = pathname === `/${lang}/properties`;

  const [activeId, setActiveId] = useState<string>("home");
  const [menuOpen, setMenuOpen] = useState(false);

  const navRef = useRef<HTMLElement | null>(null);
  const linkRefs = useRef<Record<string, HTMLAnchorElement | null>>({});
  const [indicator, setIndicator] = useState<{ left: number; width: number }>({
    left: 0,
    width: 0,
  });

  const closeMenu = () => setMenuOpen(false);

  const goTo = (id: string) => {
    setActiveId(id);
    closeMenu();

    // –ù–∞ –≥–ª–∞–≤–Ω–æ–π ‚Äî –≤—Å–µ–≥–¥–∞ –ø–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ–ª—ë—Ç –ø–æ —è–∫–æ—Ä—é
    if (isHome) {
      scrollToHash(`#${id}`, { offset: HEADER_OFFSET });
      return;
    }

    // ‚úÖ –µ—Å–ª–∏ –∫–ª–∏–∫–Ω—É–ª–∏ "Properties" –ù–ï –Ω–∞ –≥–ª–∞–≤–Ω–æ–π ‚Äî –≤–µ–¥—ë–º –≤ –∫–∞—Ç–∞–ª–æ–≥
    if (id === "properties") {
      router.push(`/${lang}/properties`);
      return;
    }

    // –ù–∞ –¥—Ä—É–≥–∏—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö ‚Äî —É–≤–æ–¥–∏–º –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å hash
    router.push(`/${lang}#${id}`);
  };

  // --- helpers for locale switch ---
  function buildLocalePath(nextLang: "en" | "es") {
    // pathname —Ç–∏–ø–∞: /en –∏–ª–∏ /es (–∏ –ø–æ–∑–∂–µ –º–æ–∂–µ—Ç –±—ã—Ç—å /en/—á—Ç–æ-—Ç–æ)
    const parts = (pathname || "/").split("/");
    // ["", "en", ...]
    parts[1] = nextLang;
    const base = parts.join("/") || `/${nextLang}`;

    // —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–π hash —Å–µ–∫—Ü–∏–∏ (–¥–ª—è one-page)
    const hash =
      typeof window !== "undefined"
        ? window.location.hash || `#${activeId}`
        : `#${activeId}`;

    return `${base}${hash}`;
  }

  function switchLang(nextLang: "en" | "es") {
    closeMenu();
    router.push(buildLocalePath(nextLang));
  }

  useEffect(() => {
    if (!isHome) return;

    const hash = typeof window !== "undefined" ? window.location.hash : "";
    if (!hash) return;

    const id = hash.replace("#", "");
    if (!id) return;

    // –¥–∞—ë–º DOM –ø—Ä–æ–≥—Ä—É–∑–∏—Ç—å —Å–µ–∫—Ü–∏–∏, –ø–æ—Ç–æ–º —Å–∫—Ä–æ–ª–ª–∏–º –º—è–≥–∫–æ
    const tmr = window.setTimeout(() => {
      scrollToHash(`#${id}`, { offset: HEADER_OFFSET });
    }, 50);

    return () => window.clearTimeout(tmr);
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [pathname, lang]);

  useEffect(() => {
    // ‚úÖ –Ω–∞ –∫–∞—Ç–∞–ª–æ–≥–µ –∏ –Ω–∞ –¥–µ—Ç–∞–ª—å–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º Properties
    if (isProperties) {
      setActiveId("properties");
    }
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [pathname]);

  // 1) Active section picker
  useEffect(() => {
    // –ï—Å–ª–∏ –º—ã –Ω–∞ –∫–∞—Ç–∞–ª–æ–≥–µ ‚Äî —Å–µ–∫—Ü–∏–π –Ω–µ—Ç, –ø–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º Properties –≤—Ä—É—á–Ω—É—é
    if (isCatalog) {
      setActiveId("properties");
      return;
    }

    const sections = nav
      .map((n) => document.getElementById(n.id))
      .filter(Boolean) as HTMLElement[];

    if (!sections.length) return;

    const PIVOT_PAD = 22;
    const MIN_SWITCH_MS = 260;

    let raf = 0;
    let lastId = activeId;
    let lastSwitchAt = 0;

    const pickActive = () => {
      const now = performance.now();
      const pivot = HEADER_OFFSET + PIVOT_PAD;

      let bestId = lastId;
      let bestScore = Number.POSITIVE_INFINITY;

      for (const el of sections) {
        const rect = el.getBoundingClientRect();
        const delta = rect.top - pivot;
        const score = delta < 0 ? Math.abs(delta) * 0.7 : Math.abs(delta) * 1.0;

        if (score < bestScore) {
          bestScore = score;
          bestId = el.id;
        }
      }

      if (bestId !== lastId && now - lastSwitchAt < MIN_SWITCH_MS) return;

      if (bestId !== lastId) {
        lastId = bestId;
        lastSwitchAt = now;
        setActiveId(bestId);
      }
    };

    const onScroll = () => {
      cancelAnimationFrame(raf);
      raf = requestAnimationFrame(pickActive);
    };

    window.addEventListener("scroll", onScroll, { passive: true });
    window.addEventListener("resize", onScroll);

    onScroll();

    return () => {
      cancelAnimationFrame(raf);
      window.removeEventListener("scroll", onScroll);
      window.removeEventListener("resize", onScroll);
    };
  }, [nav, isCatalog, activeId, HEADER_OFFSET]);


  // 2) Desktop indicator
  const recalcIndicator = () => {
    const navEl = navRef.current;
    const linkEl = linkRefs.current[activeId];
    if (!navEl || !linkEl) return;

    const navBox = navEl.getBoundingClientRect();
    const linkBox = linkEl.getBoundingClientRect();

    const padding = 10;
    const left = linkBox.left - navBox.left + padding;
    const width = Math.max(18, linkBox.width - padding * 2);

    setIndicator({ left, width });
  };

  useLayoutEffect(() => {
    recalcIndicator();
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [activeId]);

  useEffect(() => {
    const onResize = () => recalcIndicator();
    window.addEventListener("resize", onResize);
    const tmr = window.setTimeout(recalcIndicator, 150);

    return () => {
      window.removeEventListener("resize", onResize);
      window.clearTimeout(tmr);
    };
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [activeId]);

  // 3) Lock body scroll when mobile menu open + close on ESC
  useEffect(() => {
    const onKeyDown = (e: KeyboardEvent) => {
      if (e.key === "Escape") closeMenu();
    };

    if (menuOpen) {
      document.body.style.overflow = "hidden";
      window.addEventListener("keydown", onKeyDown);
    } else {
      document.body.style.overflow = "";
      window.removeEventListener("keydown", onKeyDown);
    }

    return () => {
      document.body.style.overflow = "";
      window.removeEventListener("keydown", onKeyDown);
    };
  }, [menuOpen]);

  const onNavClick =
    (id: string) => (e: React.MouseEvent<HTMLAnchorElement>) => {
      e.preventDefault();
      goTo(id);
    };

  return (
    <header className={styles.header}>
      <div className={`container ${styles.row}`}>
        {/* Logo */}
        <div
          className={styles.logo}
          role="button"
          tabIndex={0}
          onClick={() => goTo("home")}
          onKeyDown={(e) => {
            if (e.key === "Enter" || e.key === " ") goTo("home");
          }}
        >
          <span className={styles.logoMark}>GRAHALIA</span>
          <span className={styles.logoSub}>ESTATES</span>
        </div>

        {/* Desktop nav */}
        <nav className={styles.nav} ref={(el) => (navRef.current = el)}>
          <span
            className={styles.indicator}
            style={{
              transform: `translateX(${indicator.left}px)`,
              width: `${indicator.width}px`,
            }}
            aria-hidden="true"
          />

          {nav.map((item) => (
            <a
              key={item.id}
              href={`#${item.id}`}
              onClick={onNavClick(item.id)}
              ref={(el) => {
                linkRefs.current[item.id] = el;
              }}
              className={`${styles.link} ${
                activeId === item.id ? styles.active : ""
              }`}
            >
              {item.label}
            </a>
          ))}
        </nav>

        {/* Right controls */}
        <div className={styles.right}>
          <div className={styles.lang}>
            <button
              className={styles.langBtn}
              type="button"
              aria-current={lang === "en" ? "page" : undefined}
              onClick={() => switchLang("en")}
            >
              EN
            </button>
            <span className={styles.sep}>|</span>
            <button
              className={styles.langBtn}
              type="button"
              aria-current={lang === "es" ? "page" : undefined}
              onClick={() => switchLang("es")}
            >
              ES
            </button>
          </div>

          <a
            className={`${styles.wa} btn btnPrimary`}
            href="https://wa.me/34123456789"
            target="_blank"
            rel="noreferrer"
          >
            {t.whatsapp}
          </a>

          {/* Burger (mobile) */}
          <button
            type="button"
            className={`${styles.burger} ${menuOpen ? styles.burgerOpen : ""}`}
            aria-label={menuOpen ? "Close menu" : "Open menu"}
            aria-expanded={menuOpen}
            aria-controls="mobile-menu"
            onClick={() => setMenuOpen((v) => !v)}
          >
            <span className={styles.burgerText}>
              {menuOpen ? "Close" : "Menu"}
            </span>

            <span className={styles.burgerLines} aria-hidden="true">
              <span />
              <span />
              <span />
            </span>
          </button>
        </div>
      </div>

      {/* Mobile menu overlay */}
      <div
        id="mobile-menu"
        className={`${styles.mobileOverlay} ${
          menuOpen ? styles.mobileOverlayOpen : ""
        }`}
        aria-hidden={!menuOpen}
        onClick={(e) => {
          if (e.target === e.currentTarget) closeMenu();
        }}
      >
        <div className={styles.mobilePanel}>
          <div className={styles.mobileTop}>
            <div className={styles.mobileTitle}>{t.menuTitle}</div>

            <button
              type="button"
              className={styles.mobileClose}
              aria-label="Close menu"
              onClick={closeMenu}
            >
              ‚úï
            </button>
          </div>

          <div className={styles.mobileLinks}>
            {nav.map((item) => (
              <a
                key={item.id}
                href={`#${item.id}`}
                className={`${styles.mobileLink} ${
                  activeId === item.id ? styles.mobileActive : ""
                }`}
                onClick={(e) => {
                  e.preventDefault();
                  goTo(item.id);
                }}
              >
                {item.label}
              </a>
            ))}
          </div>

          <div className={styles.mobileBottom}>
            <a
              className={`btn btnPrimary ${styles.mobileWa}`}
              href="https://wa.me/34123456789"
              target="_blank"
              rel="noreferrer"
              onClick={() => closeMenu()}
            >
              {t.whatsapp}
            </a>

            <div className={styles.mobileLang}>
              <button
                className={styles.langBtn}
                type="button"
                onClick={() => switchLang("en")}
              >
                EN
              </button>
              <span className={styles.sep}>|</span>
              <button
                className={styles.langBtn}
                type="button"
                onClick={() => switchLang("es")}
              >
                ES
              </button>
            </div>
          </div>
        </div>
      </div>
    </header>
  );
}

```

---

## components/Hero/Hero.module.css

```css
.hero {
  position: relative;
  overflow: hidden; /* –≤–∞–∂–Ω–æ */
  border-bottom: 1px solid rgba(226, 226, 222, 0.8);
  min-height: 520px;

  /* —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞ –ø—Ä–æ—Ç–∏–≤ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ —Å–∫—Ä–æ–ª–ª–∞ */
  width: 100%;
  max-width: 100%;
}

.inner {
  position: relative;
  z-index: 2;
  padding: 86px 0 78px;
}

.content {
  max-width: 720px;
}

.sub {
  margin-top: 14px;
  font-size: 16px;
}

.actions {
  display: flex;
  gap: 12px;
  margin-top: 26px;
  flex-wrap: wrap;
}

.ital {
  font-style: italic;
  font-weight: 500;
}

.bg {
  position: absolute;
  inset: 0;
  z-index: 1;

  /* –≤–∞–∂–Ω–æ: —É–±–∏—Ä–∞–µ–º transform: scale(1.02), –æ–Ω —á–∞—Å—Ç–æ –¥–∞—ë—Ç –≤—ã–ª–µ–∑–∞–Ω–∏–µ */
  background-image:
    linear-gradient(
      90deg,
      rgba(246, 245, 242, 0.95) 0%,
      rgba(246, 245, 242, 0.72) 40%,
      rgba(246, 245, 242, 0.22) 72%,
      rgba(246, 245, 242, 0.06) 100%
    ),
    url("/hero.jpg");

  /* –≤–º–µ—Å—Ç–æ scale ‚Äî —á—É—Ç—å ‚Äú–ø—Ä–∏–±–ª–∏–∑–∏–º‚Äù —á–µ—Ä–µ–∑ background-size */
  background-size: 102% auto;
  background-repeat: no-repeat;
  background-position: center;

  /* —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞ */
  width: 100%;
  max-width: 100%;
}

.fade {
  position: absolute;
  left: 0;
  right: 0;
  bottom: 0;
  height: 120px;
  z-index: 2; /* —á—Ç–æ–±—ã –ª–µ–∂–∞–ª–æ –ø–æ–≤–µ—Ä—Ö —Ñ–æ–Ω–∞ */
  background: linear-gradient(to bottom, rgba(246, 245, 242, 0), var(--bg));
}

@media (max-width: 720px) {
  .inner {
    padding: 64px 0 56px;
  }

  .hero {
    min-height: 520px;
  }

  /* –Ω–∞ –º–æ–±–∏–ª–∫–µ —Ñ–æ–Ω –ª—É—á—à–µ –¥–µ–ª–∞—Ç—å cover, —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ */
  .bg {
    background-size: cover;
    background-position: 70% center; /* –ª—ë–≥–∫–∏–π —Å–¥–≤–∏–≥ –≤–ø—Ä–∞–≤–æ, —á—Ç–æ–±—ã –¥–æ–º –±—ã–ª –≤–∏–¥–Ω–µ–µ */
  }
}

```

---

## components/Hero/Hero.tsx

```typescript
"use client";

import styles from "./Hero.module.css";
import { scrollToHash } from "@/utils/smoothScroll";

type HeroDict = {
  titleA: string;
  titleB: string;
  subtitle: string;
  ctaPrimary: string;
  ctaSecondary: string;
};

export default function Hero({ t }: { t: HeroDict }) {
  const OFFSET = 90;

  return (
    <section id="home" className={styles.hero}>
      <div className={`container ${styles.inner}`}>
        <div className={styles.content}>
          <h1 className="h1">
            {t.titleA} <span className={styles.ital}>{t.titleB}</span>
          </h1>

          <p className={`p ${styles.sub}`}>{t.subtitle}</p>

          <div className={styles.actions}>
            <a
              className="btn btnPrimary"
              href="#properties"
              onClick={(e) => {
                e.preventDefault();
                scrollToHash("#properties", { offset: OFFSET });
              }}
            >
              {t.ctaPrimary}
            </a>

            <a
              className="btn btnGhost"
              href="#contact"
              onClick={(e) => {
                e.preventDefault();
                scrollToHash("#contact", { offset: OFFSET });
              }}
            >
              {t.ctaSecondary}
            </a>
          </div>
        </div>
      </div>

      <div className={styles.bg} aria-hidden="true" />
      <div className={styles.fade} aria-hidden="true" />
    </section>
  );
}

```

---

## components/PropertyCard/PropertyCard.module.css

```css
.card {
  background: rgba(255, 255, 255, 0.72);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  overflow: hidden;
  box-shadow: var(--shadow);
  display: flex;
  flex-direction: column;
  height: 100%; /* ‚úÖ –≤–∞–∂–Ω–æ: –∫–∞—Ä—Ç–æ—á–∫–∞ —Ç—è–Ω–µ—Ç—Å—è –ø–æ –≤—ã—Å–æ—Ç–µ —è—á–µ–π–∫–∏ */
  transition: transform 0.16s ease, box-shadow 0.16s ease;
}

.card:hover {
  transform: translateY(-2px);
  box-shadow: 0 14px 36px rgba(0, 0, 0, 0.08);
}

.imageWrap {
  position: relative;
  width: 100%;
  aspect-ratio: 16 / 10;
  overflow: hidden;
  background: #eee;
}

.image {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}

.body {
  padding: 18px 18px 16px;

  /* ‚úÖ –∫–ª—é—á–µ–≤–æ–π —Ñ–∏–∫—Å: —Ç–µ–ª–æ –∫–∞—Ä—Ç–æ—á–∫–∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–π —Ä–∞—Å–∫–ª–∞–¥–∫–æ–π */
  display: flex;
  flex-direction: column;
  flex: 1;        /* –∑–∞–Ω–∏–º–∞–µ—Ç –≤—Å—ë –æ—Å—Ç–∞–≤—à–µ–µ—Å—è –º–µ—Å—Ç–æ */
  min-height: 0;

  /* ‚úÖ –¥–æ–±–∞–≤–ª—è–µ–º "—Ä–∏—Ç–º" –º–µ–∂–¥—É –±–ª–æ–∫–∞–º–∏ */
  gap: 6px;
}

.spacer {
  flex: 1;
  min-height: 14px; /* ‚úÖ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π "–≤–æ–∑–¥—É—Ö" –ø–µ—Ä–µ–¥ –∫–Ω–æ–ø–∫–æ–π */
}

.title {
  margin: 0;
  font-family: var(--font-playfair), Georgia, "Times New Roman", serif;
  font-size: 18px;
  line-height: 1.2;
}

.meta {
  margin-top: 6px;
  color: var(--muted);
  font-size: 13px;
}

.price {
  margin-top: 10px;
  font-weight: 700;
  color: var(--accent);
  font-size: 15px;
}

.specs {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: 8px;
  margin-top: 10px;
  color: rgba(28, 28, 28, 0.75);
  font-size: 13px;
}

.specItem {
  white-space: nowrap;
}

.dot {
  opacity: 0.4;
}

.btn {
  /* ‚úÖ –Ω–æ –º—ã –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º "–≤–æ–∑–¥—É—Ö" –Ω–∞–¥ –∫–Ω–æ–ø–∫–æ–π */
  padding-top: 14px;

  align-self: flex-start;

  width: fit-content;
  padding: 10px 14px;
  border-radius: 4px;
  text-decoration: none;
}

.badges {
  margin-top: 10px;
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  align-items: center;
}

.badge {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 6px 10px;
  border: 1px solid var(--border);
  border-radius: 999px;
  background: rgba(255, 255, 255, 0.75);
  font-size: 12px;
  color: rgba(28, 28, 28, 0.78);
  max-width: 100%;
}

.badgeIcon {
  opacity: 0.9;
}

.badgeText {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 160px;
}

.more {
  font-size: 12px;
  color: var(--muted);
}

```

---

## components/PropertyCard/PropertyCard.tsx

```typescript
"use client";

import Link from "next/link";
import { scrollToHash } from "@/utils/smoothScroll";
import styles from "./PropertyCard.module.css";

type Feature = {
  key: string;   // parking, pool...
  label: string; // translated label
};

type Property = {
  title: string;
  location: string;
  price: string;
  beds: number;
  baths: number;
  area: number;
  image: string;

  // ‚úÖ –ù–æ–≤–æ–µ (–Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ)
  href?: string;              // –µ—Å–ª–∏ –µ—Å—Ç—å ‚Äî –∫–Ω–æ–ø–∫–∞ –≤–µ–¥—ë—Ç –ø–æ —Å—Å—ã–ª–∫–µ, –∞ –Ω–µ —Å–∫—Ä–æ–ª–ª–∏—Ç
  features?: Feature[];       // amenities –¥–ª—è –±–µ–π–¥–∂–µ–π
  showFeatures?: boolean;     // –º–æ–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä –Ω–∞ –≥–ª–∞–≤–Ω–æ–π)
};

type CardT = {
  beds: string;
  baths: string;
  details: string;
};

const ICON: Record<string, string> = {
  parking: "üÖøÔ∏è",
  garage: "üöó",
  pool: "üèä",
  gym: "üèãÔ∏è",
  lift: "üõó",
  terrace: "üå§Ô∏è",
  garden: "üåø",
  sea_view: "üåä",
  storage: "üì¶",
  aircon: "‚ùÑÔ∏è",
  heating: "üî•",
  gated: "üîí",
};

export default function PropertyCard({
  property,
  t,
}: {
  property: Property;
  t: CardT;
}) {
  const feats = Array.isArray(property.features) ? property.features : [];
  const showFeatures = property.showFeatures !== false; // –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–æ–∫–∞–∑—ã–≤–∞–µ–º

  return (
    <article className={styles.card}>
      <div className={styles.imageWrap}>
        <img
          className={styles.image}
          src={property.image}
          alt={property.title}
          loading="lazy"
        />
      </div>

      <div className={styles.body}>
        <h3 className={styles.title}>{property.title}</h3>
        <div className={styles.meta}>{property.location}</div>

        <div className={styles.price}>{property.price}</div>

        <div className={styles.specs}>
          <span className={styles.specItem}>
            üõè {property.beds} {t.beds}
          </span>
          <span className={styles.dot}>‚Ä¢</span>
          <span className={styles.specItem}>
            üõÅ {property.baths} {t.baths}
          </span>
          <span className={styles.dot}>‚Ä¢</span>
          <span className={styles.specItem}>üìê {property.area} m¬≤</span>
        </div>

        {/* ‚úÖ Amenities / Features (–±–µ–π–¥–∂–∏) */}
        {showFeatures && feats.length > 0 && (
          <div className={styles.badges} aria-label="Amenities">
            {feats.slice(0, 5).map((f) => (
              <span key={f.key} className={styles.badge} title={f.label}>
                <span className={styles.badgeIcon}>{ICON[f.key] ?? "‚Ä¢"}</span>
                <span className={styles.badgeText}>{f.label}</span>
              </span>
            ))}
            {feats.length > 5 && (
              <span className={styles.more}>+{feats.length - 5}</span>
            )}
          </div>
        )}

        {/* ‚úÖ spacer */}
        <div className={styles.spacer} />

        {/* ‚úÖ –í–ê–ñ–ù–û: –µ—Å–ª–∏ href –µ—Å—Ç—å ‚Äî –æ–±—ã—á–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è, –∏–Ω–∞—á–µ —è–∫–æ—Ä—å */}
        {property.href ? (
          <Link className={`btn btnPrimary ${styles.btn}`} href={property.href}>
            {t.details}
          </Link>
        ) : (
          <a
            className={`btn btnPrimary ${styles.btn}`}
            href="#contact"
            onClick={(e) => {
              e.preventDefault();
              scrollToHash("#contact", { offset: 90 });
            }}
          >
            {t.details}
          </a>
        )}
      </div>
    </article>
  );
}

```

---

## components/PropertyGallery/PropertyGallery.module.css

```css
/* components/PropertyGallery/PropertyGallery.module.css */

.gallery {
  --cover-h: 520px;

  display: grid;
  grid-template-columns: 2fr 1fr;
  gap: 14px;
  align-items: start;
}

/* Cover */
.coverBtn {
  border: 0;
  padding: 0;
  margin: 0;
  background: transparent;
  cursor: pointer;
  border-radius: 18px;
  overflow: hidden;
  display: block;
  width: 100%;
}

.cover {
  width: 100%;
  height: var(--cover-h);
  object-fit: cover;
  display: block;
}

/* Thumbs (desktop) */
.thumbs {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;

  /* ‚úÖ –∫–ª—é—á–µ–≤–æ–µ: –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –≤—ã—Å–æ—Ç—É –ø—Ä–∞–≤–æ–π –∫–æ–ª–æ–Ω–∫–∏ –∏ –≤–∫–ª—é—á–∞–µ–º —Å–∫—Ä–æ–ª–ª */
  height: var(--cover-h);
  overflow-y: auto;
  overflow-x: hidden;

  align-content: start;
  align-items: start;

  /* —á—Ç–æ–±—ã —Å–∫—Ä–æ–ª–ª –Ω–µ "—Å—ä–µ–¥–∞–ª" —à–∏—Ä–∏–Ω—É –∏ —Å–µ—Ç–∫–∞ –Ω–µ –ø—Ä—ã–≥–∞–ª–∞ */
  scrollbar-gutter: stable;
  padding-right: 6px;
}

.thumbBtn {
  border: 0;
  padding: 0;
  margin: 0;
  background: transparent;
  cursor: pointer;
  border-radius: 16px;
  overflow: hidden;
  display: block;
  width: 100%;
}

.thumb {
  width: 100%;
  height: 120px;
  object-fit: cover;
  display: block;
}

/* -----------------------------
   Mobile layout: cover top, thumbs below (2 rows, horizontal scroll)
------------------------------ */
@media (max-width: 720px) {
  .gallery {
    --cover-h: 320px;

    grid-template-columns: 1fr;
    gap: 12px;
  }

  /* 2 rows, horizontal scroll */
  .thumbs {
    height: auto;                 /* ‚úÖ —É–±–∏—Ä–∞–µ–º –¥–µ—Å–∫—Ç–æ–ø-–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ */
    overflow-y: hidden;
    overflow-x: auto;

    display: grid;
    grid-auto-flow: column;
    grid-template-rows: repeat(2, 1fr);
    grid-auto-columns: 140px;
    gap: 10px;

    padding: 0 0 6px 0;
    margin: 0;

    -webkit-overflow-scrolling: touch;
    scroll-snap-type: x mandatory;

    justify-content: start;
    justify-items: start;
    align-content: start;
  }

  .thumbBtn {
    scroll-snap-align: start;
    width: 140px;
    display: block;
  }

  .thumb {
    height: 95px;
  }
}

/* -----------------------------
   Modal
------------------------------ */
.overlay {
  position: fixed;
  inset: 0;
  background: rgba(10, 10, 10, 0.75);
  z-index: 9999;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 18px;
}

.modal {
  width: min(1100px, 100%);
  height: min(720px, 100%);
  display: grid;
  grid-template-rows: auto 1fr auto;
  gap: 12px;
}

.modalTop {
  display: flex;
  justify-content: flex-end;
}

.closeBtn {
  border: 1px solid rgba(255, 255, 255, 0.25);
  background: rgba(255, 255, 255, 0.08);
  color: #fff;
  padding: 10px 14px;
  border-radius: 12px;
  cursor: pointer;
  font-weight: 600;
}

.stage {
  position: relative;
  border-radius: 16px;
  overflow: hidden;
  background: rgba(255, 255, 255, 0.06);
}

.stageImg {
  width: 100%;
  height: 100%;
  object-fit: contain;
  display: block;
}

.navBtn {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  border: 1px solid rgba(255, 255, 255, 0.25);
  background: rgba(0, 0, 0, 0.35);
  color: #fff;
  width: 46px;
  height: 46px;
  border-radius: 999px;
  cursor: pointer;
  font-size: 22px;
  line-height: 46px;
}

.prev {
  left: 12px;
}
.next {
  right: 12px;
}

.modalBottom {
  display: flex;
  justify-content: center;
  color: rgba(255, 255, 255, 0.85);
  font-size: 14px;
}

```

---

## components/PropertyGallery/PropertyGallery.tsx

```typescript
"use client";

import { useState } from "react";
import GalleryModal from "@/components/GalleryModal/GalleryModal";
import styles from "./PropertyGallery.module.css";

type ImageItem = {
  url: string;
  isCover?: boolean;
};

export default function PropertyGallery({ images }: { images: ImageItem[] }) {
  const [open, setOpen] = useState(false);
  const [index, setIndex] = useState(0);

  function openAt(i: number) {
    setIndex(i);
    setOpen(true);
  }

  function prev() {
    setIndex((i) => (i - 1 + images.length) % images.length);
  }

  function next() {
    setIndex((i) => (i + 1) % images.length);
  }

  const coverIndex = images.findIndex((i) => i.isCover);
  const cover = coverIndex >= 0 ? images[coverIndex] : images[0];

  return (
    <>
      <div className={styles.gallery}>
        <div className={styles.coverWrap}>
          <img
            src={cover.url}
            className={styles.cover}
            onClick={() => openAt(coverIndex >= 0 ? coverIndex : 0)}
          />
        </div>

        <div className={styles.thumbs}>
          {images.map((img, i) => (
            <img
              key={`${img.url}-${i}`}
              src={img.url}
              className={styles.thumb}
              onClick={() => openAt(i)}
            />
          ))}
        </div>
      </div>

      {open && (
        <GalleryModal
          images={images}
          index={index}
          onClose={() => setOpen(false)}
          onPrev={prev}
          onNext={next}
        />
      )}
    </>
  );
}

```

---

## components/Services/Services.module.css

```css
.section {
  padding: 72px 0;
  border-top: 1px solid rgba(226, 226, 222, 0.8);
}

.head {
  margin-bottom: 18px;
}

.grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 18px;
  margin-top: 16px;
}

.card {
  background: rgba(255, 255, 255, 0.72);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  padding: 18px 18px;
  display: flex;
  gap: 12px;
  align-items: flex-start;
  transition: transform 0.16s ease, box-shadow 0.16s ease;
}

.card:hover {
  transform: translateY(-2px);
  box-shadow: 0 14px 36px rgba(0, 0, 0, 0.08);
}

.icon {
  width: 44px;
  height: 44px;
  border-radius: 12px;
  background: rgba(14, 94, 86, 0.08);
  display: grid;
  place-items: center;
  font-size: 20px;
  flex: 0 0 auto;
}

.title {
  font-weight: 700;
  font-size: 15px;
}

.text {
  margin-top: 6px;
  color: var(--muted);
  font-size: 13px;
  line-height: 1.5;
}

@media (max-width: 960px) {
  .grid {
    grid-template-columns: 1fr;
  }
}

```

---

## components/Services/Services.tsx

```typescript
"use client";

import styles from "./Services.module.css";

type ServicesDict = {
  title: string;
  subtitle: string;
  items: {
    title: string;
    text: string;
    icon: string;
  }[];
};

export default function Services({ t }: { t: ServicesDict }) {
  return (
    <section id="services" className={`section ${styles.section}`}>
      <div className="container">
        {/* –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ + –ª–∏–Ω–∏–∏, –∫–∞–∫ –≤ –º–∞–∫–µ—Ç–µ */}
        <div className="section__head">
          <h2 className="sectionTitle">
            <span className="sectionTitleText">{t.title}</span>
          </h2>
          <p className="section__kicker">{t.subtitle}</p>
        </div>

        <div className={styles.grid}>
          {t.items.map((s) => (
            <div key={s.title} className={styles.card}>
              <div className={styles.icon}>{s.icon}</div>

              <div className={styles.content}>
                <div className={styles.title}>{s.title}</div>
                <div className={styles.text}>{s.text}</div>
              </div>
            </div>
          ))}
        </div>
      </div>
    </section>
  );
}

```

---

## db/index.ts

```typescript
// db/index.ts
import { drizzle } from "drizzle-orm/node-postgres";
import { Pool } from "pg";

const connectionString = process.env.DATABASE_URL;
if (!connectionString) {
  throw new Error("DATABASE_URL is not set");
}

declare global {
  // eslint-disable-next-line no-var
  var __grahaliaPool: Pool | undefined;
}

const pool =
  global.__grahaliaPool ??
  new Pool({
    connectionString,
  });

global.__grahaliaPool = pool;

export const db = drizzle(pool);

```

---

## db/migrations/0000_square_stark_industries.sql

```sql
CREATE TABLE "feature_translations" (
	"id" serial PRIMARY KEY NOT NULL,
	"feature_id" integer NOT NULL,
	"lang" varchar(2) NOT NULL,
	"label" varchar(120) NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
CREATE TABLE "features" (
	"id" serial PRIMARY KEY NOT NULL,
	"key" varchar(80) NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
CREATE TABLE "properties" (
	"id" serial PRIMARY KEY NOT NULL,
	"slug" varchar(120) NOT NULL,
	"is_published" boolean DEFAULT false NOT NULL,
	"price" numeric(12, 2),
	"currency" varchar(3) DEFAULT 'EUR' NOT NULL,
	"bedrooms" integer,
	"bathrooms" integer,
	"area_m2" integer,
	"location" varchar(120),
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
CREATE TABLE "property_features" (
	"property_id" integer NOT NULL,
	"feature_id" integer NOT NULL,
	CONSTRAINT "property_features_property_id_feature_id_pk" PRIMARY KEY("property_id","feature_id")
);
--> statement-breakpoint
CREATE TABLE "property_images" (
	"id" serial PRIMARY KEY NOT NULL,
	"property_id" integer NOT NULL,
	"url" text NOT NULL,
	"alt" varchar(200),
	"sort_order" integer DEFAULT 0 NOT NULL,
	"is_cover" boolean DEFAULT false NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
CREATE TABLE "property_translations" (
	"id" serial PRIMARY KEY NOT NULL,
	"property_id" integer NOT NULL,
	"lang" varchar(2) NOT NULL,
	"title" varchar(200) NOT NULL,
	"summary" varchar(300),
	"description" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
ALTER TABLE "feature_translations" ADD CONSTRAINT "feature_translations_feature_id_features_id_fk" FOREIGN KEY ("feature_id") REFERENCES "public"."features"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "property_features" ADD CONSTRAINT "property_features_property_id_properties_id_fk" FOREIGN KEY ("property_id") REFERENCES "public"."properties"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "property_features" ADD CONSTRAINT "property_features_feature_id_features_id_fk" FOREIGN KEY ("feature_id") REFERENCES "public"."features"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "property_images" ADD CONSTRAINT "property_images_property_id_properties_id_fk" FOREIGN KEY ("property_id") REFERENCES "public"."properties"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "property_translations" ADD CONSTRAINT "property_translations_property_id_properties_id_fk" FOREIGN KEY ("property_id") REFERENCES "public"."properties"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
CREATE UNIQUE INDEX "feature_translations_feature_lang_unique" ON "feature_translations" USING btree ("feature_id","lang");--> statement-breakpoint
CREATE UNIQUE INDEX "features_key_unique" ON "features" USING btree ("key");--> statement-breakpoint
CREATE UNIQUE INDEX "properties_slug_unique" ON "properties" USING btree ("slug");--> statement-breakpoint
CREATE UNIQUE INDEX "property_images_property_sort_unique" ON "property_images" USING btree ("property_id","sort_order");--> statement-breakpoint
CREATE UNIQUE INDEX "property_translations_property_lang_unique" ON "property_translations" USING btree ("property_id","lang");
```

---

## db/migrations/0001_sleepy_agent_brand.sql

```sql
ALTER TABLE "properties" ADD COLUMN "plot_area_m2" integer;--> statement-breakpoint
ALTER TABLE "properties" ADD COLUMN "built_area_m2" integer;--> statement-breakpoint
ALTER TABLE "properties" ADD COLUMN "terrace_area_m2" integer;--> statement-breakpoint
ALTER TABLE "properties" ADD COLUMN "plans_url" text;--> statement-breakpoint
ALTER TABLE "properties" DROP COLUMN "area_m2";
```

---

## db/migrations/0002_steep_lady_vermin.sql

```sql
ALTER TABLE "properties" ALTER COLUMN "slug" SET DATA TYPE varchar(255);
```

---

## db/migrations/0003_hot_doctor_spectrum.sql

```sql
ALTER TABLE "properties" ADD COLUMN "property_type" varchar(24);--> statement-breakpoint
ALTER TABLE "properties" ADD COLUMN "condition" varchar(24);--> statement-breakpoint
ALTER TABLE "properties" ADD COLUMN "status" varchar(16) DEFAULT 'available' NOT NULL;--> statement-breakpoint
ALTER TABLE "properties" ADD COLUMN "city" varchar(80);--> statement-breakpoint
ALTER TABLE "properties" ADD COLUMN "area" varchar(80);--> statement-breakpoint
ALTER TABLE "properties" ADD COLUMN "subarea" varchar(80);--> statement-breakpoint
ALTER TABLE "properties" ADD COLUMN "lat" numeric(9, 6);--> statement-breakpoint
ALTER TABLE "properties" ADD COLUMN "lng" numeric(9, 6);--> statement-breakpoint
ALTER TABLE "properties" ADD COLUMN "floor" integer;--> statement-breakpoint
ALTER TABLE "properties" ADD COLUMN "total_floors" integer;--> statement-breakpoint
ALTER TABLE "properties" ADD COLUMN "community_fees_month" numeric(10, 2);--> statement-breakpoint
ALTER TABLE "properties" ADD COLUMN "ibi_year" numeric(10, 2);--> statement-breakpoint
ALTER TABLE "properties" ADD COLUMN "garbage_tax_year" numeric(10, 2);--> statement-breakpoint
ALTER TABLE "properties" ADD COLUMN "orientation" varchar(2);--> statement-breakpoint
ALTER TABLE "properties" ADD COLUMN "energy_rating" varchar(1);--> statement-breakpoint
ALTER TABLE "properties" ADD COLUMN "year_built" integer;
```

---

## db/migrations/0004_seed_features.sql

```sql
-- Seed features (amenities) for Grahalia Estates
-- Safe to re-run: uses ON CONFLICT DO NOTHING

-- 1) features
INSERT INTO features (key)
VALUES
  ('parking'),
  ('garage'),
  ('pool'),
  ('gym'),
  ('lift'),
  ('terrace'),
  ('garden'),
  ('sea_view'),
  ('storage'),
  ('aircon'),
  ('heating'),
  ('gated')
ON CONFLICT (key) DO NOTHING;

-- 2) translations (EN)
INSERT INTO feature_translations (feature_id, lang, label)
SELECT
  f.id,
  'en',
  CASE f.key
    WHEN 'parking' THEN 'Parking'
    WHEN 'garage' THEN 'Garage'
    WHEN 'pool' THEN 'Pool'
    WHEN 'gym' THEN 'Gym'
    WHEN 'lift' THEN 'Lift'
    WHEN 'terrace' THEN 'Terrace'
    WHEN 'garden' THEN 'Garden'
    WHEN 'sea_view' THEN 'Sea view'
    WHEN 'storage' THEN 'Storage room'
    WHEN 'aircon' THEN 'Air conditioning'
    WHEN 'heating' THEN 'Heating'
    WHEN 'gated' THEN 'Gated community'
    ELSE f.key
  END AS label
FROM features f
WHERE f.key IN (
  'parking','garage','pool','gym','lift','terrace','garden','sea_view','storage','aircon','heating','gated'
)
ON CONFLICT DO NOTHING;

-- 3) translations (ES)
INSERT INTO feature_translations (feature_id, lang, label)
SELECT
  f.id,
  'es',
  CASE f.key
    WHEN 'parking' THEN 'Aparcamiento'
    WHEN 'garage' THEN 'Garaje'
    WHEN 'pool' THEN 'Piscina'
    WHEN 'gym' THEN 'Gimnasio'
    WHEN 'lift' THEN 'Ascensor'
    WHEN 'terrace' THEN 'Terraza'
    WHEN 'garden' THEN 'Jard√≠n'
    WHEN 'sea_view' THEN 'Vistas al mar'
    WHEN 'storage' THEN 'Trastero'
    WHEN 'aircon' THEN 'Aire acondicionado'
    WHEN 'heating' THEN 'Calefacci√≥n'
    WHEN 'gated' THEN 'Urbanizaci√≥n cerrada'
    ELSE f.key
  END AS label
FROM features f
WHERE f.key IN (
  'parking','garage','pool','gym','lift','terrace','garden','sea_view','storage','aircon','heating','gated'
)
ON CONFLICT DO NOTHING;

```

---

## db/migrations/meta/0000_snapshot.json

```json
{
  "id": "ea2ff403-1244-4331-9472-6738058293de",
  "prevId": "00000000-0000-0000-0000-000000000000",
  "version": "7",
  "dialect": "postgresql",
  "tables": {
    "public.feature_translations": {
      "name": "feature_translations",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "feature_id": {
          "name": "feature_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "lang": {
          "name": "lang",
          "type": "varchar(2)",
          "primaryKey": false,
          "notNull": true
        },
        "label": {
          "name": "label",
          "type": "varchar(120)",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "feature_translations_feature_lang_unique": {
          "name": "feature_translations_feature_lang_unique",
          "columns": [
            {
              "expression": "feature_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "lang",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "feature_translations_feature_id_features_id_fk": {
          "name": "feature_translations_feature_id_features_id_fk",
          "tableFrom": "feature_translations",
          "tableTo": "features",
          "columnsFrom": [
            "feature_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.features": {
      "name": "features",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "key": {
          "name": "key",
          "type": "varchar(80)",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "features_key_unique": {
          "name": "features_key_unique",
          "columns": [
            {
              "expression": "key",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.properties": {
      "name": "properties",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "slug": {
          "name": "slug",
          "type": "varchar(120)",
          "primaryKey": false,
          "notNull": true
        },
        "is_published": {
          "name": "is_published",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true,
          "default": false
        },
        "price": {
          "name": "price",
          "type": "numeric(12, 2)",
          "primaryKey": false,
          "notNull": false
        },
        "currency": {
          "name": "currency",
          "type": "varchar(3)",
          "primaryKey": false,
          "notNull": true,
          "default": "'EUR'"
        },
        "bedrooms": {
          "name": "bedrooms",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "bathrooms": {
          "name": "bathrooms",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "area_m2": {
          "name": "area_m2",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "location": {
          "name": "location",
          "type": "varchar(120)",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "properties_slug_unique": {
          "name": "properties_slug_unique",
          "columns": [
            {
              "expression": "slug",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.property_features": {
      "name": "property_features",
      "schema": "",
      "columns": {
        "property_id": {
          "name": "property_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "feature_id": {
          "name": "feature_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "property_features_property_id_properties_id_fk": {
          "name": "property_features_property_id_properties_id_fk",
          "tableFrom": "property_features",
          "tableTo": "properties",
          "columnsFrom": [
            "property_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        },
        "property_features_feature_id_features_id_fk": {
          "name": "property_features_feature_id_features_id_fk",
          "tableFrom": "property_features",
          "tableTo": "features",
          "columnsFrom": [
            "feature_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {
        "property_features_property_id_feature_id_pk": {
          "name": "property_features_property_id_feature_id_pk",
          "columns": [
            "property_id",
            "feature_id"
          ]
        }
      },
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.property_images": {
      "name": "property_images",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "property_id": {
          "name": "property_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "url": {
          "name": "url",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "alt": {
          "name": "alt",
          "type": "varchar(200)",
          "primaryKey": false,
          "notNull": false
        },
        "sort_order": {
          "name": "sort_order",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "is_cover": {
          "name": "is_cover",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true,
          "default": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "property_images_property_sort_unique": {
          "name": "property_images_property_sort_unique",
          "columns": [
            {
              "expression": "property_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "sort_order",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "property_images_property_id_properties_id_fk": {
          "name": "property_images_property_id_properties_id_fk",
          "tableFrom": "property_images",
          "tableTo": "properties",
          "columnsFrom": [
            "property_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.property_translations": {
      "name": "property_translations",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "property_id": {
          "name": "property_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "lang": {
          "name": "lang",
          "type": "varchar(2)",
          "primaryKey": false,
          "notNull": true
        },
        "title": {
          "name": "title",
          "type": "varchar(200)",
          "primaryKey": false,
          "notNull": true
        },
        "summary": {
          "name": "summary",
          "type": "varchar(300)",
          "primaryKey": false,
          "notNull": false
        },
        "description": {
          "name": "description",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "property_translations_property_lang_unique": {
          "name": "property_translations_property_lang_unique",
          "columns": [
            {
              "expression": "property_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "lang",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "property_translations_property_id_properties_id_fk": {
          "name": "property_translations_property_id_properties_id_fk",
          "tableFrom": "property_translations",
          "tableTo": "properties",
          "columnsFrom": [
            "property_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    }
  },
  "enums": {},
  "schemas": {},
  "sequences": {},
  "roles": {},
  "policies": {},
  "views": {},
  "_meta": {
    "columns": {},
    "schemas": {},
    "tables": {}
  }
}
```

---

## db/migrations/meta/0001_snapshot.json

```json
{
  "id": "017fd64b-ec5e-4a5d-bfb5-cd11e2150473",
  "prevId": "ea2ff403-1244-4331-9472-6738058293de",
  "version": "7",
  "dialect": "postgresql",
  "tables": {
    "public.feature_translations": {
      "name": "feature_translations",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "feature_id": {
          "name": "feature_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "lang": {
          "name": "lang",
          "type": "varchar(2)",
          "primaryKey": false,
          "notNull": true
        },
        "label": {
          "name": "label",
          "type": "varchar(120)",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "feature_translations_feature_lang_unique": {
          "name": "feature_translations_feature_lang_unique",
          "columns": [
            {
              "expression": "feature_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "lang",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "feature_translations_feature_id_features_id_fk": {
          "name": "feature_translations_feature_id_features_id_fk",
          "tableFrom": "feature_translations",
          "tableTo": "features",
          "columnsFrom": [
            "feature_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.features": {
      "name": "features",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "key": {
          "name": "key",
          "type": "varchar(80)",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "features_key_unique": {
          "name": "features_key_unique",
          "columns": [
            {
              "expression": "key",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.properties": {
      "name": "properties",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "slug": {
          "name": "slug",
          "type": "varchar(120)",
          "primaryKey": false,
          "notNull": true
        },
        "is_published": {
          "name": "is_published",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true,
          "default": false
        },
        "price": {
          "name": "price",
          "type": "numeric(12, 2)",
          "primaryKey": false,
          "notNull": false
        },
        "currency": {
          "name": "currency",
          "type": "varchar(3)",
          "primaryKey": false,
          "notNull": true,
          "default": "'EUR'"
        },
        "bedrooms": {
          "name": "bedrooms",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "bathrooms": {
          "name": "bathrooms",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "plot_area_m2": {
          "name": "plot_area_m2",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "built_area_m2": {
          "name": "built_area_m2",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "terrace_area_m2": {
          "name": "terrace_area_m2",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "location": {
          "name": "location",
          "type": "varchar(120)",
          "primaryKey": false,
          "notNull": false
        },
        "plans_url": {
          "name": "plans_url",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "properties_slug_unique": {
          "name": "properties_slug_unique",
          "columns": [
            {
              "expression": "slug",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.property_features": {
      "name": "property_features",
      "schema": "",
      "columns": {
        "property_id": {
          "name": "property_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "feature_id": {
          "name": "feature_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "property_features_property_id_properties_id_fk": {
          "name": "property_features_property_id_properties_id_fk",
          "tableFrom": "property_features",
          "tableTo": "properties",
          "columnsFrom": [
            "property_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        },
        "property_features_feature_id_features_id_fk": {
          "name": "property_features_feature_id_features_id_fk",
          "tableFrom": "property_features",
          "tableTo": "features",
          "columnsFrom": [
            "feature_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {
        "property_features_property_id_feature_id_pk": {
          "name": "property_features_property_id_feature_id_pk",
          "columns": [
            "property_id",
            "feature_id"
          ]
        }
      },
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.property_images": {
      "name": "property_images",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "property_id": {
          "name": "property_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "url": {
          "name": "url",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "alt": {
          "name": "alt",
          "type": "varchar(200)",
          "primaryKey": false,
          "notNull": false
        },
        "sort_order": {
          "name": "sort_order",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "is_cover": {
          "name": "is_cover",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true,
          "default": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "property_images_property_sort_unique": {
          "name": "property_images_property_sort_unique",
          "columns": [
            {
              "expression": "property_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "sort_order",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "property_images_property_id_properties_id_fk": {
          "name": "property_images_property_id_properties_id_fk",
          "tableFrom": "property_images",
          "tableTo": "properties",
          "columnsFrom": [
            "property_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.property_translations": {
      "name": "property_translations",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "property_id": {
          "name": "property_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "lang": {
          "name": "lang",
          "type": "varchar(2)",
          "primaryKey": false,
          "notNull": true
        },
        "title": {
          "name": "title",
          "type": "varchar(200)",
          "primaryKey": false,
          "notNull": true
        },
        "summary": {
          "name": "summary",
          "type": "varchar(300)",
          "primaryKey": false,
          "notNull": false
        },
        "description": {
          "name": "description",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "property_translations_property_lang_unique": {
          "name": "property_translations_property_lang_unique",
          "columns": [
            {
              "expression": "property_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "lang",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "property_translations_property_id_properties_id_fk": {
          "name": "property_translations_property_id_properties_id_fk",
          "tableFrom": "property_translations",
          "tableTo": "properties",
          "columnsFrom": [
            "property_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    }
  },
  "enums": {},
  "schemas": {},
  "sequences": {},
  "roles": {},
  "policies": {},
  "views": {},
  "_meta": {
    "columns": {},
    "schemas": {},
    "tables": {}
  }
}
```

---

## db/migrations/meta/0002_snapshot.json

```json
{
  "id": "d73d6116-c88c-4065-bb9c-49c8e70f9647",
  "prevId": "017fd64b-ec5e-4a5d-bfb5-cd11e2150473",
  "version": "7",
  "dialect": "postgresql",
  "tables": {
    "public.feature_translations": {
      "name": "feature_translations",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "feature_id": {
          "name": "feature_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "lang": {
          "name": "lang",
          "type": "varchar(2)",
          "primaryKey": false,
          "notNull": true
        },
        "label": {
          "name": "label",
          "type": "varchar(120)",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "feature_translations_feature_lang_unique": {
          "name": "feature_translations_feature_lang_unique",
          "columns": [
            {
              "expression": "feature_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "lang",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "feature_translations_feature_id_features_id_fk": {
          "name": "feature_translations_feature_id_features_id_fk",
          "tableFrom": "feature_translations",
          "tableTo": "features",
          "columnsFrom": [
            "feature_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.features": {
      "name": "features",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "key": {
          "name": "key",
          "type": "varchar(80)",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "features_key_unique": {
          "name": "features_key_unique",
          "columns": [
            {
              "expression": "key",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.properties": {
      "name": "properties",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "slug": {
          "name": "slug",
          "type": "varchar(255)",
          "primaryKey": false,
          "notNull": true
        },
        "is_published": {
          "name": "is_published",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true,
          "default": false
        },
        "price": {
          "name": "price",
          "type": "numeric(12, 2)",
          "primaryKey": false,
          "notNull": false
        },
        "currency": {
          "name": "currency",
          "type": "varchar(3)",
          "primaryKey": false,
          "notNull": true,
          "default": "'EUR'"
        },
        "bedrooms": {
          "name": "bedrooms",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "bathrooms": {
          "name": "bathrooms",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "plot_area_m2": {
          "name": "plot_area_m2",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "built_area_m2": {
          "name": "built_area_m2",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "terrace_area_m2": {
          "name": "terrace_area_m2",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "location": {
          "name": "location",
          "type": "varchar(120)",
          "primaryKey": false,
          "notNull": false
        },
        "plans_url": {
          "name": "plans_url",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "properties_slug_unique": {
          "name": "properties_slug_unique",
          "columns": [
            {
              "expression": "slug",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.property_features": {
      "name": "property_features",
      "schema": "",
      "columns": {
        "property_id": {
          "name": "property_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "feature_id": {
          "name": "feature_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "property_features_property_id_properties_id_fk": {
          "name": "property_features_property_id_properties_id_fk",
          "tableFrom": "property_features",
          "tableTo": "properties",
          "columnsFrom": [
            "property_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        },
        "property_features_feature_id_features_id_fk": {
          "name": "property_features_feature_id_features_id_fk",
          "tableFrom": "property_features",
          "tableTo": "features",
          "columnsFrom": [
            "feature_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {
        "property_features_property_id_feature_id_pk": {
          "name": "property_features_property_id_feature_id_pk",
          "columns": [
            "property_id",
            "feature_id"
          ]
        }
      },
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.property_images": {
      "name": "property_images",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "property_id": {
          "name": "property_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "url": {
          "name": "url",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "alt": {
          "name": "alt",
          "type": "varchar(200)",
          "primaryKey": false,
          "notNull": false
        },
        "sort_order": {
          "name": "sort_order",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "is_cover": {
          "name": "is_cover",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true,
          "default": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "property_images_property_sort_unique": {
          "name": "property_images_property_sort_unique",
          "columns": [
            {
              "expression": "property_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "sort_order",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "property_images_property_id_properties_id_fk": {
          "name": "property_images_property_id_properties_id_fk",
          "tableFrom": "property_images",
          "tableTo": "properties",
          "columnsFrom": [
            "property_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.property_translations": {
      "name": "property_translations",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "property_id": {
          "name": "property_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "lang": {
          "name": "lang",
          "type": "varchar(2)",
          "primaryKey": false,
          "notNull": true
        },
        "title": {
          "name": "title",
          "type": "varchar(200)",
          "primaryKey": false,
          "notNull": true
        },
        "summary": {
          "name": "summary",
          "type": "varchar(300)",
          "primaryKey": false,
          "notNull": false
        },
        "description": {
          "name": "description",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "property_translations_property_lang_unique": {
          "name": "property_translations_property_lang_unique",
          "columns": [
            {
              "expression": "property_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "lang",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "property_translations_property_id_properties_id_fk": {
          "name": "property_translations_property_id_properties_id_fk",
          "tableFrom": "property_translations",
          "tableTo": "properties",
          "columnsFrom": [
            "property_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    }
  },
  "enums": {},
  "schemas": {},
  "sequences": {},
  "roles": {},
  "policies": {},
  "views": {},
  "_meta": {
    "columns": {},
    "schemas": {},
    "tables": {}
  }
}
```

---

## db/migrations/meta/0003_snapshot.json

```json
{
  "id": "12ca2264-fd63-4f6d-8e0e-e01cda60947d",
  "prevId": "d73d6116-c88c-4065-bb9c-49c8e70f9647",
  "version": "7",
  "dialect": "postgresql",
  "tables": {
    "public.feature_translations": {
      "name": "feature_translations",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "feature_id": {
          "name": "feature_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "lang": {
          "name": "lang",
          "type": "varchar(2)",
          "primaryKey": false,
          "notNull": true
        },
        "label": {
          "name": "label",
          "type": "varchar(120)",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "feature_translations_feature_lang_unique": {
          "name": "feature_translations_feature_lang_unique",
          "columns": [
            {
              "expression": "feature_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "lang",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "feature_translations_feature_id_features_id_fk": {
          "name": "feature_translations_feature_id_features_id_fk",
          "tableFrom": "feature_translations",
          "tableTo": "features",
          "columnsFrom": [
            "feature_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.features": {
      "name": "features",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "key": {
          "name": "key",
          "type": "varchar(80)",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "features_key_unique": {
          "name": "features_key_unique",
          "columns": [
            {
              "expression": "key",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.properties": {
      "name": "properties",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "slug": {
          "name": "slug",
          "type": "varchar(255)",
          "primaryKey": false,
          "notNull": true
        },
        "is_published": {
          "name": "is_published",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true,
          "default": false
        },
        "price": {
          "name": "price",
          "type": "numeric(12, 2)",
          "primaryKey": false,
          "notNull": false
        },
        "currency": {
          "name": "currency",
          "type": "varchar(3)",
          "primaryKey": false,
          "notNull": true,
          "default": "'EUR'"
        },
        "bedrooms": {
          "name": "bedrooms",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "bathrooms": {
          "name": "bathrooms",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "plot_area_m2": {
          "name": "plot_area_m2",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "built_area_m2": {
          "name": "built_area_m2",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "terrace_area_m2": {
          "name": "terrace_area_m2",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "location": {
          "name": "location",
          "type": "varchar(120)",
          "primaryKey": false,
          "notNull": false
        },
        "plans_url": {
          "name": "plans_url",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "property_type": {
          "name": "property_type",
          "type": "varchar(24)",
          "primaryKey": false,
          "notNull": false
        },
        "condition": {
          "name": "condition",
          "type": "varchar(24)",
          "primaryKey": false,
          "notNull": false
        },
        "status": {
          "name": "status",
          "type": "varchar(16)",
          "primaryKey": false,
          "notNull": true,
          "default": "'available'"
        },
        "city": {
          "name": "city",
          "type": "varchar(80)",
          "primaryKey": false,
          "notNull": false
        },
        "area": {
          "name": "area",
          "type": "varchar(80)",
          "primaryKey": false,
          "notNull": false
        },
        "subarea": {
          "name": "subarea",
          "type": "varchar(80)",
          "primaryKey": false,
          "notNull": false
        },
        "lat": {
          "name": "lat",
          "type": "numeric(9, 6)",
          "primaryKey": false,
          "notNull": false
        },
        "lng": {
          "name": "lng",
          "type": "numeric(9, 6)",
          "primaryKey": false,
          "notNull": false
        },
        "floor": {
          "name": "floor",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "total_floors": {
          "name": "total_floors",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "community_fees_month": {
          "name": "community_fees_month",
          "type": "numeric(10, 2)",
          "primaryKey": false,
          "notNull": false
        },
        "ibi_year": {
          "name": "ibi_year",
          "type": "numeric(10, 2)",
          "primaryKey": false,
          "notNull": false
        },
        "garbage_tax_year": {
          "name": "garbage_tax_year",
          "type": "numeric(10, 2)",
          "primaryKey": false,
          "notNull": false
        },
        "orientation": {
          "name": "orientation",
          "type": "varchar(2)",
          "primaryKey": false,
          "notNull": false
        },
        "energy_rating": {
          "name": "energy_rating",
          "type": "varchar(1)",
          "primaryKey": false,
          "notNull": false
        },
        "year_built": {
          "name": "year_built",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "properties_slug_unique": {
          "name": "properties_slug_unique",
          "columns": [
            {
              "expression": "slug",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.property_features": {
      "name": "property_features",
      "schema": "",
      "columns": {
        "property_id": {
          "name": "property_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "feature_id": {
          "name": "feature_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "property_features_property_id_properties_id_fk": {
          "name": "property_features_property_id_properties_id_fk",
          "tableFrom": "property_features",
          "tableTo": "properties",
          "columnsFrom": [
            "property_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        },
        "property_features_feature_id_features_id_fk": {
          "name": "property_features_feature_id_features_id_fk",
          "tableFrom": "property_features",
          "tableTo": "features",
          "columnsFrom": [
            "feature_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {
        "property_features_property_id_feature_id_pk": {
          "name": "property_features_property_id_feature_id_pk",
          "columns": [
            "property_id",
            "feature_id"
          ]
        }
      },
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.property_images": {
      "name": "property_images",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "property_id": {
          "name": "property_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "url": {
          "name": "url",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "alt": {
          "name": "alt",
          "type": "varchar(200)",
          "primaryKey": false,
          "notNull": false
        },
        "sort_order": {
          "name": "sort_order",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "is_cover": {
          "name": "is_cover",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true,
          "default": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "property_images_property_sort_unique": {
          "name": "property_images_property_sort_unique",
          "columns": [
            {
              "expression": "property_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "sort_order",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "property_images_property_id_properties_id_fk": {
          "name": "property_images_property_id_properties_id_fk",
          "tableFrom": "property_images",
          "tableTo": "properties",
          "columnsFrom": [
            "property_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.property_translations": {
      "name": "property_translations",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "property_id": {
          "name": "property_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "lang": {
          "name": "lang",
          "type": "varchar(2)",
          "primaryKey": false,
          "notNull": true
        },
        "title": {
          "name": "title",
          "type": "varchar(200)",
          "primaryKey": false,
          "notNull": true
        },
        "summary": {
          "name": "summary",
          "type": "varchar(300)",
          "primaryKey": false,
          "notNull": false
        },
        "description": {
          "name": "description",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "property_translations_property_lang_unique": {
          "name": "property_translations_property_lang_unique",
          "columns": [
            {
              "expression": "property_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "lang",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "property_translations_property_id_properties_id_fk": {
          "name": "property_translations_property_id_properties_id_fk",
          "tableFrom": "property_translations",
          "tableTo": "properties",
          "columnsFrom": [
            "property_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    }
  },
  "enums": {},
  "schemas": {},
  "sequences": {},
  "roles": {},
  "policies": {},
  "views": {},
  "_meta": {
    "columns": {},
    "schemas": {},
    "tables": {}
  }
}
```

---

## db/migrations/meta/_journal.json

```json
{
  "version": "7",
  "dialect": "postgresql",
  "entries": [
    {
      "idx": 0,
      "version": "7",
      "when": 1768656408753,
      "tag": "0000_square_stark_industries",
      "breakpoints": true
    },
    {
      "idx": 1,
      "version": "7",
      "when": 1768660088691,
      "tag": "0001_sleepy_agent_brand",
      "breakpoints": true
    },
    {
      "idx": 2,
      "version": "7",
      "when": 1768677392854,
      "tag": "0002_steep_lady_vermin",
      "breakpoints": true
    },
    {
      "idx": 3,
      "version": "7",
      "when": 1768735739716,
      "tag": "0003_hot_doctor_spectrum",
      "breakpoints": true
    }
  ]
}
```

---

## db/schema.ts

```typescript
import {
  pgTable,
  serial,
  integer,
  varchar,
  text,
  boolean,
  numeric,
  timestamp,
  primaryKey,
  uniqueIndex,
} from "drizzle-orm/pg-core";

// 1) –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —è–∑—ã–∫–∏: —Ç–æ–ª—å–∫–æ —Ç–µ, —á—Ç–æ –µ—Å—Ç—å –≤ –ø—Ä–æ–µ–∫—Ç–µ
export const localeEnumValues = ["en", "es"] as const;
export type Locale = (typeof localeEnumValues)[number];

// --------------------
// PROPERTIES (–æ—Å–Ω–æ–≤–∞)
// --------------------
export const properties = pgTable(
  "properties",
  {
    id: serial("id").primaryKey(),

    // slug –¥–ª—è URL: /[lang]/properties/[slug]
    slug: varchar("slug", { length: 255 }).notNull(),

    // —Å—Ç–∞—Ç—É—Å –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
    isPublished: boolean("is_published").notNull().default(false),

    // —Ü–µ–Ω–∞
    price: numeric("price", { precision: 12, scale: 2 }),
    currency: varchar("currency", { length: 3 }).notNull().default("EUR"),

    // –±–∞–∑–æ–≤—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
    bedrooms: integer("bedrooms"),
    bathrooms: integer("bathrooms"),

    // –ü–ª–æ—â–∞–¥–∏ (–≤ –º2). –í—Å–µ nullable ‚Äî –µ—Å–ª–∏ –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ, –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞ —Å–∞–π—Ç–µ.
    // –û–±—â–∞—è –ø–ª–æ—â–∞–¥—å —É—á–∞—Å—Ç–∫–∞ (–¥–ª—è –¥–æ–º–æ–≤/–≤–∏–ª–ª)
    plotAreaM2: integer("plot_area_m2"),

    // –ü–ª–æ—â–∞–¥—å –∑–∞—Å—Ç—Ä–æ–π–∫–∏ (built area)
    builtAreaM2: integer("built_area_m2"),

    // –ü–ª–æ—â–∞–¥—å —Ç–µ—Ä—Ä–∞—Å
    terraceAreaM2: integer("terrace_area_m2"),

    // –õ–æ–∫–∞—Ü–∏—è (–Ω–∞ —Å—Ç–∞—Ä—Ç–µ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–æ–π)
    location: varchar("location", { length: 120 }),

    // –ü–ª–∞–Ω—ã –æ–±—ä–µ–∫—Ç–∞ (PDF –∏–ª–∏ –ø–æ—Ö–æ–∂–µ–µ) ‚Äî —Ö—Ä–∞–Ω–∏–º –ø—É—Ç—å/URL
    plansUrl: text("plans_url"),

    // –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞
    description_en: text("description_en"),
    description_es: text("description_es"),

    // --- NEW: —Ç–∏–ø/—Å—Ç–∞—Ç—É—Å/–ª–æ–∫–∞—Ü–∏—è ---
    propertyType: varchar("property_type", { length: 24 }), // villa/apartment/...
    condition: varchar("condition", { length: 24 }),        // new_build/resale/...
    status: varchar("status", { length: 16 }).notNull().default("available"),

    // –ª–æ–∫–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ
    city: varchar("city", { length: 80 }),
    area: varchar("area", { length: 80 }),
    subarea: varchar("subarea", { length: 80 }),

    lat: numeric("lat", { precision: 9, scale: 6 }),
    lng: numeric("lng", { precision: 9, scale: 6 }),

    /** --- NEW: –∫–≤–∞—Ä—Ç–∏—Ä—ã --- **/
    floor: integer("floor"),
    totalFloors: integer("total_floors"),
    communityFeesMonth: numeric("community_fees_month", { precision: 10, scale: 2 }),
    ibiYear: numeric("ibi_year", { precision: 10, scale: 2 }),
    garbageTaxYear: numeric("garbage_tax_year", { precision: 10, scale: 2 }),

    /** --- NEW: –¥–æ–º–∞/–æ–±—â–∏–µ --- **/
    orientation: varchar("orientation", { length: 2 }), // N/NE/...
    energyRating: varchar("energy_rating", { length: 1 }), // A-G
    yearBuilt: integer("year_built"),

    createdAt: timestamp("created_at", { withTimezone: true }).notNull().defaultNow(),
    updatedAt: timestamp("updated_at", { withTimezone: true }).notNull().defaultNow(),
  },
  (t) => ({
    slugUnique: uniqueIndex("properties_slug_unique").on(t.slug),
  })
);

// -------------------------------
// PROPERTY TRANSLATIONS (i18n)
// -------------------------------
export const propertyTranslations = pgTable(
  "property_translations",
  {
    id: serial("id").primaryKey(),
    propertyId: integer("property_id")
      .notNull()
      .references(() => properties.id, { onDelete: "cascade" }),

    lang: varchar("lang", { length: 2 }).notNull(), // "en" | "es"

    title: varchar("title", { length: 200 }).notNull(),
    summary: varchar("summary", { length: 300 }), // –∫–æ—Ä–æ—Ç–∫–∏–π —Ç–µ–∫—Å—Ç –¥–ª—è –∫–∞—Ä—Ç–æ—á–∫–∏
    description: text("description"), // –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

    createdAt: timestamp("created_at", { withTimezone: true }).notNull().defaultNow(),
    updatedAt: timestamp("updated_at", { withTimezone: true }).notNull().defaultNow(),
  },
  (t) => ({
    // –æ–¥–Ω–æ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —è–∑—ã–∫ –¥–ª—è –æ–¥–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞
    uniqPerLang: uniqueIndex("property_translations_property_lang_unique").on(t.propertyId, t.lang),
  })
);

// --------------------
// FEATURES (—É–¥–æ–±—Å—Ç–≤–∞)
// --------------------
export const features = pgTable(
  "features",
  {
    id: serial("id").primaryKey(),

    // —Å–∏—Å—Ç–µ–º–Ω—ã–π –∫–ª—é—á (—É–¥–æ–±–Ω–æ –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏/–≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)
    key: varchar("key", { length: 80 }).notNull(),

    createdAt: timestamp("created_at", { withTimezone: true }).notNull().defaultNow(),
  },
  (t) => ({
    keyUnique: uniqueIndex("features_key_unique").on(t.key),
  })
);

export const featureTranslations = pgTable(
  "feature_translations",
  {
    id: serial("id").primaryKey(),
    featureId: integer("feature_id")
      .notNull()
      .references(() => features.id, { onDelete: "cascade" }),

    lang: varchar("lang", { length: 2 }).notNull(), // "en" | "es"
    label: varchar("label", { length: 120 }).notNull(),

    createdAt: timestamp("created_at", { withTimezone: true }).notNull().defaultNow(),
  },
  (t) => ({
    uniqPerLang: uniqueIndex("feature_translations_feature_lang_unique").on(t.featureId, t.lang),
  })
);

// —Å–≤—è–∑—å many-to-many: property <-> feature
export const propertyFeatures = pgTable(
  "property_features",
  {
    propertyId: integer("property_id")
      .notNull()
      .references(() => properties.id, { onDelete: "cascade" }),

    featureId: integer("feature_id")
      .notNull()
      .references(() => features.id, { onDelete: "cascade" }),
  },
  (t) => ({
    pk: primaryKey({ columns: [t.propertyId, t.featureId] }),
  })
);

// --------------------
// IMAGES (–≥–∞–ª–µ—Ä–µ—è)
// --------------------
export const propertyImages = pgTable(
  "property_images",
  {
    id: serial("id").primaryKey(),
    propertyId: integer("property_id")
      .notNull()
      .references(() => properties.id, { onDelete: "cascade" }),

    // –ø—É—Ç—å –∏–ª–∏ URL (–º—ã –±—É–¥–µ–º —Ö—Ä–∞–Ω–∏—Ç—å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å —Ç–∏–ø–∞ /uploads/...)
    url: text("url").notNull(),

    // alt –Ω–∞ –±—É–¥—É—â–µ–µ (–º–æ–∂–Ω–æ —Ç–æ–∂–µ —Å–¥–µ–ª–∞—Ç—å –ø–µ—Ä–µ–≤–æ–¥–∏–º—ã–º, –Ω–æ –ø–æ–∫–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ)
    alt: varchar("alt", { length: 200 }),

    // –ø–æ—Ä—è–¥–æ–∫ –≤ –≥–∞–ª–µ—Ä–µ–µ
    sortOrder: integer("sort_order").notNull().default(0),

    // –æ–±–ª–æ–∂–∫–∞ –¥–ª—è –∫–∞—Ä—Ç–æ—á–∫–∏
    isCover: boolean("is_cover").notNull().default(false),

    createdAt: timestamp("created_at", { withTimezone: true }).notNull().defaultNow(),
  },
  (t) => ({
    byProperty: uniqueIndex("property_images_property_sort_unique").on(t.propertyId, t.sortOrder),
  })
);

```

---

## docker-compose.yml

```yaml
services:
  db:
    image: postgres:16
    container_name: grahalia_postgres
    restart: unless-stopped
    environment:
      POSTGRES_USER: grahalia
      POSTGRES_PASSWORD: grahalia_password
      POSTGRES_DB: grahalia_db
    ports:
      - "5433:5432"
    volumes:
      - grahalia_pgdata:/var/lib/postgresql/data

volumes:
  grahalia_pgdata:

```

---

## drizzle.config.ts

```typescript
import { defineConfig } from "drizzle-kit";

export default defineConfig({
  schema: "./db/schema.ts",
  out: "./db/migrations",
  dialect: "postgresql",
  dbCredentials: {
    url: process.env.DATABASE_URL!,
  },
});

```

---

## eslint.config.mjs

```javascript
import { defineConfig, globalIgnores } from "eslint/config";
import nextVitals from "eslint-config-next/core-web-vitals";
import nextTs from "eslint-config-next/typescript";

const eslintConfig = defineConfig([
  ...nextVitals,
  ...nextTs,
  // Override default ignores of eslint-config-next.
  globalIgnores([
    // Default ignores of eslint-config-next:
    ".next/**",
    "out/**",
    "build/**",
    "next-env.d.ts",
  ]),
]);

export default eslintConfig;

```

---

## i18n/dictionaries.ts

```typescript
export const locales = ["en", "es"] as const;
export type Locale = (typeof locales)[number];

export function isLocale(v: string): v is Locale {
  return (locales as readonly string[]).includes(v);
}

type Dict = Record<string, any>;

// –Ø–≤–Ω–∞—è –∫–∞—Ä—Ç–∞ –∏–º–ø–æ—Ä—Ç–æ–≤ ‚Äî Turbopack —ç—Ç–æ –ª—é–±–∏—Ç, –∏ –Ω–µ –≥–ª—é—á–∏—Ç
const loaders: Record<Locale, () => Promise<Dict>> = {
  en: async () => (await import("./en.json")).default,
  es: async () => (await import("./es.json")).default,
};

export async function getDictionary(locale: Locale) {
  return loaders[locale]();
}

```

---

## i18n/en.json

```json
{
  "header": {
    "nav": {
      "home": "Home",
      "properties": "Properties",
      "services": "Services",
      "about": "About",
      "contact": "Contact"
    },
    "menuTitle": "Menu",
    "whatsapp": "WhatsApp"
  },
  "hero": {
    "titleA": "Find Your Dream Home",
    "titleB": "in Spain",
    "subtitle": "Luxury Properties for Sale & Investment",
    "ctaPrimary": "View Properties",
    "ctaSecondary": "Contact Us"
  },
  "featured": {
    "title": "Featured Properties",
    "subtitle": "Explore our latest listings",
    "cta": "View All Properties",
    "card": {
      "beds": "Beds",
      "baths": "Baths",
      "details": "View Details"
    }
  },
  "services": {
    "title": "Our Services",
    "subtitle": "Personalized real estate solutions",
    "items": [
      { "title": "Property Sales", "text": "Helping you find the perfect home.", "icon": "üè°" },
      { "title": "Investment Consulting", "text": "Expert advice on profitable investments.", "icon": "üìà" },
      { "title": "Legal Assistance", "text": "Full support with legal and paperwork.", "icon": "üìÑ" }
    ]
  },
  "about": {
    "title": "About Us",
    "subtitle": "Your Trusted Real Estate Partner in Spain",
    "body": "We provide exceptional service and expert local knowledge to help you find your ideal property on the Costa del Sol. From selecting the right area to negotiating and paperwork, we guide you through every step ‚Äî clearly and professionally.",
    "cta": "Learn More"
  },
  "contact": {
    "title": "Get in Touch",
    "subtitle": "Ready to find your dream home?",
    "form": {
      "name": "Your Name",
      "phone": "Phone",
      "email": "Email",
      "message": "Message",
      "send": "Send Message",
      "namePlaceholder": "Name",
      "phonePlaceholder": "+34 ...",
      "emailPlaceholder": "you@email.com",
      "messagePlaceholder": "Tell us what you are looking for..."
    },
    "info": {
      "title": "Contact",
      "whatsapp": "WhatsApp Us",
      "note": "We typically reply within a few hours during business days."
    },
    "footerRights": "All rights reserved"
  },
  "seo": {
    "siteName": "Grahalia Estates",
    "home": {
      "title": "Grahalia Estates ‚Äî Real Estate on Costa del Sol",
      "description": "Warm, minimal real estate agency landing. Find properties and request details.",
      "ogTitle": "Grahalia Estates ‚Äî Real Estate on Costa del Sol",
      "ogDescription": "Warm, minimal real estate agency landing. Find properties and request details."
    }
  }
}

```

---

## i18n/es.json

```json
{
  "header": {
    "nav": {
      "home": "Inicio",
      "properties": "Propiedades",
      "services": "Servicios",
      "about": "Sobre nosotros",
      "contact": "Contacto"
    },
    "menuTitle": "Men√∫",
    "whatsapp": "WhatsApp"
  },
  "hero": {
    "titleA": "Encuentra tu casa so√±ada",
    "titleB": "en Espa√±a",
    "subtitle": "Propiedades de lujo en venta e inversi√≥n",
    "ctaPrimary": "Ver propiedades",
    "ctaSecondary": "Cont√°ctanos"
  },
  "featured": {
    "title": "Propiedades destacadas",
    "subtitle": "Descubre nuestras √∫ltimas novedades",
    "cta": "Ver todas las propiedades",
    "card": {
      "beds": "Habitaciones",
      "baths": "Ba√±os",
      "details": "Ver detalles"
    }
  },
  "services": {
    "title": "Nuestros servicios",
    "subtitle": "Soluciones inmobiliarias personalizadas",
    "items": [
      { "title": "Venta de propiedades", "text": "Te ayudamos a encontrar la casa perfecta.", "icon": "üè°" },
      { "title": "Consultor√≠a de inversi√≥n", "text": "Asesoramiento experto en inversiones rentables.", "icon": "üìà" },
      { "title": "Asesoramiento legal", "text": "Gesti√≥n completa de tr√°mites y documentaci√≥n.", "icon": "üìÑ" }
    ]
  },
  "about": {
    "title": "Sobre nosotros",
    "subtitle": "Tu agencia inmobiliaria de confianza en la Costa del Sol",
    "body": "Ofrecemos un servicio excepcional y un profundo conocimiento local para ayudarte a encontrar la propiedad ideal en la Costa del Sol. Desde la elecci√≥n de la zona perfecta hasta la negociaci√≥n y todos los tr√°mites legales, te acompa√±amos en cada paso con claridad y profesionalidad.",
    "cta": "Saber m√°s"
  },
  "contact": {
    "title": "Ponte en contacto",
    "subtitle": "¬øListo para encontrar tu casa so√±ada?",
    "form": {
      "name": "Tu nombre",
      "phone": "Tel√©fono",
      "email": "Correo electr√≥nico",
      "message": "Mensaje",
      "send": "Enviar mensaje",
      "namePlaceholder": "Nombre",
      "phonePlaceholder": "+34 ...",
      "emailPlaceholder": "tu@email.com",
      "messagePlaceholder": "Cu√©ntanos qu√© est√°s buscando..."
    },
    "info": {
      "title": "Contacto",
      "whatsapp": "Escr√≠benos por WhatsApp",
      "note": "Normalmente respondemos en pocas horas en d√≠as laborables."
    },
    "footerRights": "Todos los derechos reservados"
  },
  "seo": {
    "siteName": "Grahalia Estates",
    "home": {
      "title": "Grahalia Estates ‚Äî Inmobiliaria en la Costa del Sol",
      "description": "Agencia inmobiliaria c√°lida y minimalista. Encuentra propiedades y solicita informaci√≥n.",
      "ogTitle": "Grahalia Estates ‚Äî Inmobiliaria en la Costa del Sol",
      "ogDescription": "Agencia inmobiliaria c√°lida y minimalista. Encuentra propiedades y solicita informaci√≥n."
    }
  }
}
```

---

## middleware.ts

```typescript
import { NextRequest, NextResponse } from "next/server";

const SUPPORTED = ["en", "es"] as const;
type Lang = (typeof SUPPORTED)[number];

const DEFAULT_LANG: Lang = "en";
const COOKIE_NAME = "lang";

function parseAcceptLanguage(header: string | null): Lang {
  if (!header) return DEFAULT_LANG;

  const first = header.split(",")[0]?.trim().toLowerCase();
  if (!first) return DEFAULT_LANG;

  const base = first.split("-")[0] as Lang;
  return (SUPPORTED as readonly string[]).includes(base) ? (base as Lang) : DEFAULT_LANG;
}

function isPublicFile(pathname: string) {
  return (
    pathname.startsWith("/_next") ||
    pathname.startsWith("/api") ||
    pathname.startsWith("/uploads") || // ‚úÖ –≤–∞–∂–Ω–æ: –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –≤—Å–µ–≥–¥–∞ –±–µ–∑ i18n
    pathname === "/favicon.ico" ||
    pathname === "/robots.txt" ||
    pathname === "/sitemap.xml" ||
    pathname.startsWith("/assets") ||
    pathname.match(/\.(png|jpg|jpeg|webp|svg|ico|pdf|txt|xml)$/) // ‚úÖ –¥–æ–±–∞–≤–∏–ª pdf –Ω–∞ –≤—Å—è–∫–∏–π
  );
}

export function middleware(req: NextRequest) {
  const { pathname } = req.nextUrl;

  if (isPublicFile(pathname)) return NextResponse.next();

  // ‚úÖ –ê–¥–º–∏–Ω–∫–∞ –ù–ï —É—á–∞—Å—Ç–≤—É–µ—Ç –≤ i18n —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞—Ö
  if (pathname === "/admin" || pathname.startsWith("/admin/")) {
    if (pathname.startsWith("/admin/login")) return NextResponse.next();

    const adminCookie = req.cookies.get("admin")?.value;
    if (adminCookie !== "1") {
      const url = req.nextUrl.clone();
      url.pathname = "/admin/login";
      return NextResponse.redirect(url);
    }

    return NextResponse.next();
  }

  // –£–∂–µ —Å –ª–æ–∫–∞–ª—å—é?
  const hasLocale = SUPPORTED.some((l) => pathname === `/${l}` || pathname.startsWith(`/${l}/`));
  if (hasLocale) {
    const current = pathname.split("/")[1] as Lang;
    const res = NextResponse.next();

    if ((SUPPORTED as readonly string[]).includes(current)) {
      res.cookies.set(COOKIE_NAME, current, {
        path: "/",
        sameSite: "lax",
        maxAge: 60 * 60 * 24 * 365,
      });
    }

    return res;
  }

  // –õ—é–±–æ–π –ø—É—Ç—å –±–µ–∑ –ª–æ–∫–∞–ª–∏ ‚Äî —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏–º –Ω–∞ /{lang}/...
  const cookieLang = req.cookies.get(COOKIE_NAME)?.value as Lang | undefined;
  const detected =
    cookieLang && (SUPPORTED as readonly string[]).includes(cookieLang)
      ? cookieLang
      : parseAcceptLanguage(req.headers.get("accept-language"));

  const url = req.nextUrl.clone();
  url.pathname = `/${detected}${pathname === "/" ? "" : pathname}`;
  return NextResponse.redirect(url);
}

export const config = {
  matcher: ["/((?!_next|api).*)"],
};

```

---

## next-env.d.ts

```typescript
/// <reference types="next" />
/// <reference types="next/image-types/global" />
import "./.next/dev/types/routes.d.ts";

// NOTE: This file should not be edited
// see https://nextjs.org/docs/app/api-reference/config/typescript for more information.

```

---

## next.config.ts

```typescript
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  experimental: {
    serverActions: {
      // ‚úÖ —á—Ç–æ–±—ã –Ω–µ –ø–∞–¥–∞–ª–æ –Ω–∞ —Ñ–æ—Ç–æ/–ø–¥—Ñ
      bodySizeLimit: "25mb",
    },
  },
};

export default nextConfig;

```

---

## package.json

```json
{
  "name": "grahalia-estate",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "db:generate": "drizzle-kit generate",
    "db:migrate": "drizzle-kit migrate"
  },
  "dependencies": {
    "drizzle-orm": "^0.45.1",
    "next": "16.1.2",
    "pg": "^8.17.1",
    "react": "19.2.3",
    "react-dom": "19.2.3"
  },
  "devDependencies": {
    "@tailwindcss/postcss": "^4",
    "@types/node": "^20",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "dotenv-cli": "^11.0.0",
    "drizzle-kit": "^0.31.8",
    "eslint": "^9",
    "eslint-config-next": "16.1.2",
    "tailwindcss": "^4",
    "typescript": "^5"
  },
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "db:generate": "dotenv -e .env.local -- drizzle-kit generate",
    "db:migrate": "dotenv -e .env.local -- drizzle-kit migrate"
  }
}

```

---

## postcss.config.mjs

```javascript
const config = {
  plugins: {
    "@tailwindcss/postcss": {},
  },
};

export default config;

```

---

## tools/snapshot_repo.py

```py
#!/usr/bin/env python3
import argparse
import datetime as dt
from pathlib import Path

# ---------- –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ ----------
# –°—é–¥–∞ –¥–æ–±–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —Ç–æ, —á—Ç–æ –ù–ï –ù–ê–î–û —Å–æ—Ö—Ä–∞–Ω—è—Ç—å
EXCLUDE_DIRS = {
    ".git", ".idea", ".vscode", "__pycache__", "node_modules", "venv",
    ".mypy_cache", ".pytest_cache", ".DS_Store",
    ".next", "dist", "build", "out", ".turbo",
    ".cache", ".parcel-cache", "coverage",
}

EXCLUDE_FILES = {
    ".env", ".env.local", ".env.production", ".env.development",
    "pnpm-lock.yaml", "package-lock.json", 
    "PROJECT_TREE_", "CODE_SNAPSHOT_" # –ò—Å–∫–ª—é—á–∞–µ–º —Å–∞–º–∏ —Å–Ω–∞–ø—à–æ—Ç—ã, —á—Ç–æ–±—ã –Ω–µ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏—Ö –≤ —Å–∞–º–∏—Ö —Å–µ–±—è
}

# –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –∫–æ–¥–∞
INCLUDE_EXT = {
    ".ts", ".tsx", ".js", ".jsx", ".css", ".scss", ".html", 
    ".json", ".md", ".py", ".sql", ".mjs", ".yml", ".yaml", ".prisma"
}

# ---------- —É—Ç–∏–ª–∏—Ç—ã ----------
def project_root() -> Path:
    return Path(__file__).resolve().parents[1]

def is_ignored(path: Path) -> bool:
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞–ø–æ–∫-–∏—Å–∫–ª—é—á–µ–Ω–∏–π
    if any(part in EXCLUDE_DIRS for part in path.parts):
        return True
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–µ–Ω —Ñ–∞–π–ª–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, .env)
    if path.name in EXCLUDE_FILES or any(path.name.startswith(p) for p in ["PROJECT_TREE_", "CODE_SNAPSHOT_"]):
        return True
    return False

def build_tree(root: Path) -> str:
    lines = []
    def walk(base: Path, prefix=""):
        try:
            entries = sorted(
                [p for p in base.iterdir() if not is_ignored(p)],
                key=lambda p: (p.is_file(), p.name.lower())
            )
        except PermissionError:
            return

        for i, p in enumerate(entries):
            last = (i == len(entries) - 1)
            connector = "‚îî‚îÄ‚îÄ " if last else "‚îú‚îÄ‚îÄ "
            lines.append(prefix + connector + p.name)
            if p.is_dir():
                ext = "    " if last else "‚îÇ   "
                walk(p, prefix + ext)
    walk(root)
    return "\n".join(lines)

def get_all_code_files(root: Path):
    """–†–µ–∫—É—Ä—Å–∏–≤–Ω–æ –∏—â–µ—Ç –≤—Å–µ —Ñ–∞–π–ª—ã –∫–æ–¥–∞, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –≤ –∏–≥–Ω–æ—Ä–µ –∏ –∏–º–µ—é—Ç –Ω—É–∂–Ω–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ"""
    code_files = []
    for p in root.rglob("*"):
        if p.is_file() and not is_ignored(p):
            if p.suffix.lower() in INCLUDE_EXT or p.name in {"README.md", ".gitignore", "docker-compose.yml"}:
                code_files.append(p)
    return sorted(code_files)

def guess_lang(p: Path) -> str:
    ext = p.suffix.lower().lstrip(".")
    mapping = {
        "ts": "typescript", "tsx": "typescript",
        "js": "javascript", "jsx": "javascript",
        "mjs": "javascript", "sql": "sql",
        "yml": "yaml", "yaml": "yaml"
    }
    return mapping.get(ext, ext or "text")

# ---------- main ----------
def main():
    parser = argparse.ArgumentParser()
    parser.add_argument("--force", action="store_true", help="–ü–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç—å —Ñ–∞–π–ª—ã –∑–∞ —Å–µ–≥–æ–¥–Ω—è")
    args = parser.parse_args()

    ROOT = project_root()
    now = dt.datetime.now()
    date_str = now.strftime("%Y-%m-%d")
    time_str = now.strftime("%H-%M-%S")

    # –§–æ—Ä–º–∏—Ä—É–µ–º –∏–º–µ–Ω–∞ (–¥–æ–±–∞–≤–∏–ª –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –∏–º–µ–Ω)
    suffix = f"_{time_str}" if not args.force else ""
    tree_name = f"PROJECT_TREE_{date_str}{suffix}.txt"
    code_name = f"CODE_SNAPSHOT_{date_str}{suffix}.md"

    tree_path = ROOT / tree_name
    code_path = ROOT / code_name

    # 1. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –¥–µ—Ä–µ–≤–æ (–æ–Ω–æ –≤—Å–µ–≥–¥–∞ –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ)
    print("–°–∫–∞–Ω–∏—Ä—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞...")
    tree_text = build_tree(ROOT)
    tree_path.write_text(tree_text, encoding="utf-8")
    print(f"[OK] –î–µ—Ä–µ–≤–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ: {tree_path.name}")

    # 2. –°–æ–±–∏—Ä–∞–µ–º –≤–µ—Å—å –∫–æ–¥
    print("–°–æ–±–∏—Ä–∞—é –∫–æ–¥ –∏–∑ –≤—Å–µ—Ö –ø–∞–ø–æ–∫...")
    all_files = get_all_code_files(ROOT)
    
    with code_path.open("w", encoding="utf-8") as f:
        f.write(f"# Code snapshot ({now.isoformat(timespec='seconds')})\n")
        f.write(f"–í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤: {len(all_files)}\n\n")
        
        for p in all_files:
            try:
                rel = p.relative_to(ROOT)
                lang = guess_lang(p)
                content = p.read_text(encoding="utf-8")
                
                f.write(f"## {rel}\n\n")
                f.write(f"```{lang}\n")
                f.write(content)
                f.write("\n```\n\n---\n\n")
            except Exception as e:
                # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –±–∏–Ω–∞—Ä–Ω—ã–µ —Ñ–∞–π–ª—ã –∏–ª–∏ –æ—à–∏–±–∫–∏ –¥–æ—Å—Ç—É–ø–∞
                continue

    print(f"[OK] –°–Ω–∞–ø—à–æ—Ç –∫–æ–¥–∞ —Å–æ–∑–¥–∞–Ω: {code_path.name} ({len(all_files)} —Ñ–∞–π–ª–æ–≤)")

if __name__ == "__main__":
    main()
```

---

## tsconfig.json

```json
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "react-jsx",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "baseUrl": ".",
    "paths": {
      "@/*": ["./*"]
    }
  },
  "include": [
    "next-env.d.ts",
    "**/*.ts",
    "**/*.tsx",
    ".next/types/**/*.ts",
    ".next/dev/types/**/*.ts",
    "**/*.mts"
  ],
  "exclude": ["node_modules"]
}

```

---

## utils/scroll.ts

```typescript
export function clamp(n: number, min: number, max: number) {
  return Math.max(min, Math.min(max, n));
}

export function flyToHash(hash: string, headerOffset = 90) {
  const id = hash.replace("#", "");
  const el = document.getElementById(id);
  if (!el) return;

  flyToElement(el, headerOffset);
  history.pushState(null, "", `#${id}`);
}

export function flyToElement(target: HTMLElement, headerOffset = 90) {
  const targetY =
    target.getBoundingClientRect().top + window.scrollY - headerOffset;

  const startY = window.scrollY;
  const distance = targetY - startY;

  if (Math.abs(distance) < 2) return;

  const abs = Math.abs(distance);
  const duration = clamp(220 + abs * 0.35, 260, 780);

  const startTime = performance.now();

  const easeCruise = (t: number) => {
    if (t < 0.08) {
      const p = t / 0.08;
      return 0.12 * (p * p);
    }
    if (t > 0.82) {
      const p = (t - 0.82) / 0.18;
      return 0.82 + 0.18 * (1 - (1 - p) * (1 - p));
    }
    return 0.12 + (t - 0.08) * (0.70 / 0.74);
  };

  let raf = 0;

  // ‚Äú–º–æ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π –æ—Ç–∫–ª–∏–∫‚Äù –±–µ–∑ –ø–∞—É–∑—ã
  const nudge = clamp(distance * 0.02, -14, 14);
  window.scrollTo(0, startY + nudge);

  const step = (now: number) => {
    const t = clamp((now - startTime) / duration, 0, 1);
    const eased = easeCruise(t);
    window.scrollTo(0, startY + distance * eased);
    if (t < 1) raf = requestAnimationFrame(step);
  };

  raf = requestAnimationFrame(step);

  const cancel = () => cancelAnimationFrame(raf);
  window.addEventListener("wheel", cancel, { passive: true, once: true });
  window.addEventListener("touchstart", cancel, { passive: true, once: true });
}

```

---

## utils/smoothScroll.ts

```typescript
type Options = {
  duration?: number;
  offset?: number;
};

function clamp01(x: number) {
  return Math.min(1, Math.max(0, x));
}

// –†–∞–∑–≥–æ–Ω ‚Üí –±—ã—Å—Ç—Ä–æ ‚Üí —Ç–æ—Ä–º–æ–∂–µ–Ω–∏–µ
function easeInOutCubic(t: number) {
  t = clamp01(t);
  return t < 0.5 ? 4 * t * t * t : 1 - Math.pow(-2 * t + 2, 3) / 2;
}

export function smoothScrollToY(targetY: number, opts: Options = {}) {
  const startY = window.scrollY;
  const offset = opts.offset ?? 0;
  const finalY = targetY - offset;

  const distance = Math.abs(finalY - startY);
  const baseDuration = opts.duration ?? 800;
  const duration = Math.min(1400, Math.max(600, baseDuration + distance * 0.15));

  const start = performance.now();
  let cancelled = false;

  const cancel = () => (cancelled = true);
  window.addEventListener("wheel", cancel, { passive: true, once: true });
  window.addEventListener("touchstart", cancel, { passive: true, once: true });

  function step(now: number) {
    if (cancelled) return;

    const t = (now - start) / duration;
    const p = easeInOutCubic(t);

    window.scrollTo(0, startY + (finalY - startY) * p);

    if (t < 1) requestAnimationFrame(step);
  }

  requestAnimationFrame(step);
}

export function scrollToHash(hash: string, opts: Options = {}) {
  const id = hash.replace("#", "");
  const el = document.getElementById(id);
  if (!el) return;

  const top = el.getBoundingClientRect().top + window.scrollY;
  smoothScrollToY(top, opts);

  history.pushState(null, "", `#${id}`);
}

```

---

